function abstract(){return function(){throw new Error("Unimplemented abstract method.")}()}var uidCounter_=0;function getUid(obj){return obj.ol_uid||(obj.ol_uid=String(++uidCounter_))}var VERSION="6.0.1",__extends=this&&this.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}(),AssertionError=function(_super){function AssertionError(code){var _this=this,message="Assertion failed. See https://openlayers.org/en/"+("v"+VERSION.split("-")[0])+"/doc/errors/#"+code+" for details.";return(_this=_super.call(this,message)||this).code=code,_this.name="AssertionError",_this.message=message,_this}return __extends(AssertionError,_super),AssertionError}(Error),CollectionEventType={ADD:"add",REMOVE:"remove"},ObjectEventType={PROPERTYCHANGE:"propertychange"},assign="function"==typeof Object.assign?Object.assign:function(target,var_sources){if(null==target)throw new TypeError("Cannot convert undefined or null to object");for(var output=Object(target),i=1,ii=arguments.length;i<ii;++i){var source=arguments[i];if(null!=source)for(var key in source)source.hasOwnProperty(key)&&(output[key]=source[key])}return output};function clear(object){for(var property in object)delete object[property]}var getValues="function"==typeof Object.values?Object.values:function(object){var values=[];for(var property in object)values.push(object[property]);return values};function isEmpty(object){var property;for(property in object)return!1;return!property}function listen(target,type,listener,opt_this,opt_once){if(opt_this&&opt_this!==target&&(listener=listener.bind(opt_this)),opt_once){var originalListener_1=listener;listener=function(){target.removeEventListener(type,listener),originalListener_1.apply(this,arguments)}}var eventsKey={target:target,type:type,listener:listener};return target.addEventListener(type,listener),eventsKey}function listenOnce(target,type,listener,opt_this){return listen(target,type,listener,opt_this,!0)}function unlistenByKey(key){key&&key.target&&(key.target.removeEventListener(key.type,key.listener),clear(key))}var Disposable=function(){function Disposable(){this.disposed_=!1}return Disposable.prototype.dispose=function(){this.disposed_||(this.disposed_=!0,this.disposeInternal())},Disposable.prototype.disposeInternal=function(){},Disposable}();function binarySearch(haystack,needle,opt_comparator){for(var mid,cmp,comparator=opt_comparator||numberSafeCompareFunction,low=0,high=haystack.length,found=!1;low<high;)(cmp=+comparator(haystack[mid=low+(high-low>>1)],needle))<0?low=mid+1:(high=mid,found=!cmp);return found?low:~low}function numberSafeCompareFunction(a,b){return a>b?1:a<b?-1:0}function linearFindNearest(arr,target,direction){var n=arr.length;if(arr[0]<=target)return 0;if(target<=arr[n-1])return n-1;var i=void 0;if(direction>0){for(i=1;i<n;++i)if(arr[i]<target)return i-1}else if(direction<0){for(i=1;i<n;++i)if(arr[i]<=target)return i}else for(i=1;i<n;++i){if(arr[i]==target)return i;if(arr[i]<target)return arr[i-1]-target<target-arr[i]?i-1:i}return n-1}function reverseSubArray(arr,begin,end){for(;begin<end;){var tmp=arr[begin];arr[begin]=arr[end],arr[end]=tmp,++begin,--end}}function extend(arr,data){for(var extension=Array.isArray(data)?data:[data],length=extension.length,i=0;i<length;i++)arr[arr.length]=extension[i]}function equals(arr1,arr2){var len1=arr1.length;if(len1!==arr2.length)return!1;for(var i=0;i<len1;i++)if(arr1[i]!==arr2[i])return!1;return!0}function isSorted(arr,opt_func,opt_strict){var compare=opt_func||numberSafeCompareFunction;return arr.every(function(currentVal,index){if(0===index)return!0;var res=compare(arr[index-1],currentVal);return!(res>0||opt_strict&&0===res)})}function TRUE(){return!0}function FALSE(){return!1}function VOID(){}function memoizeOne(fn){var lastResult,lastArgs,lastThis,called=!1;return function(){var nextArgs=Array.prototype.slice.call(arguments);return called&&this===lastThis&&equals(nextArgs,lastArgs)||(called=!0,lastThis=this,lastArgs=nextArgs,lastResult=fn.apply(this,arguments)),lastResult}}var BaseEvent=function(){function BaseEvent(type){this.propagationStopped,this.type=type,this.target=null}return BaseEvent.prototype.preventDefault=function(){this.propagationStopped=!0},BaseEvent.prototype.stopPropagation=function(){this.propagationStopped=!0},BaseEvent}(),Target=function(_super){function Target(opt_target){var _this=_super.call(this)||this;return _this.target_=opt_target,_this.pendingRemovals_={},_this.dispatching_={},_this.listeners_={},_this}return __extends(Target,_super),Target.prototype.addEventListener=function(type,listener){if(type&&listener){var listeners=this.listeners_[type];listeners||(listeners=this.listeners_[type]=[]),-1===listeners.indexOf(listener)&&listeners.push(listener)}},Target.prototype.dispatchEvent=function(event){var evt="string"==typeof event?new BaseEvent(event):event,type=evt.type;evt.target||(evt.target=this.target_||this);var propagate,listeners=this.listeners_[type];if(listeners){type in this.dispatching_||(this.dispatching_[type]=0,this.pendingRemovals_[type]=0),++this.dispatching_[type];for(var i=0,ii=listeners.length;i<ii;++i)if(!1===listeners[i].call(this,evt)||evt.propagationStopped){propagate=!1;break}if(--this.dispatching_[type],0===this.dispatching_[type]){var pendingRemovals=this.pendingRemovals_[type];for(delete this.pendingRemovals_[type];pendingRemovals--;)this.removeEventListener(type,VOID);delete this.dispatching_[type]}return propagate}},Target.prototype.disposeInternal=function(){clear(this.listeners_)},Target.prototype.getListeners=function(type){return this.listeners_[type]},Target.prototype.hasListener=function(opt_type){return opt_type?opt_type in this.listeners_:Object.keys(this.listeners_).length>0},Target.prototype.removeEventListener=function(type,listener){var listeners=this.listeners_[type];if(listeners){var index=listeners.indexOf(listener);-1!==index&&(type in this.pendingRemovals_?(listeners[index]=VOID,++this.pendingRemovals_[type]):(listeners.splice(index,1),0===listeners.length&&delete this.listeners_[type]))}},Target}(Disposable),EventType={CHANGE:"change",ERROR:"error",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",WHEEL:"wheel"},Observable=function(_super){function Observable(){var _this=_super.call(this)||this;return _this.revision_=0,_this}return __extends(Observable,_super),Observable.prototype.changed=function(){++this.revision_,this.dispatchEvent(EventType.CHANGE)},Observable.prototype.getRevision=function(){return this.revision_},Observable.prototype.on=function(type,listener){if(Array.isArray(type)){for(var len=type.length,keys=new Array(len),i=0;i<len;++i)keys[i]=listen(this,type[i],listener);return keys}return listen(this,type,listener)},Observable.prototype.once=function(type,listener){if(Array.isArray(type)){for(var len=type.length,keys=new Array(len),i=0;i<len;++i)keys[i]=listenOnce(this,type[i],listener);return keys}return listenOnce(this,type,listener)},Observable.prototype.un=function(type,listener){if(Array.isArray(type))for(var i=0,ii=type.length;i<ii;++i)this.removeEventListener(type[i],listener);else this.removeEventListener(type,listener)},Observable}(Target),ObjectEvent=function(_super){function ObjectEvent(type,key,oldValue){var _this=_super.call(this,type)||this;return _this.key=key,_this.oldValue=oldValue,_this}return __extends(ObjectEvent,_super),ObjectEvent}(BaseEvent),BaseObject=function(_super){function BaseObject(opt_values){var _this=_super.call(this)||this;return getUid(_this),_this.values_={},void 0!==opt_values&&_this.setProperties(opt_values),_this}return __extends(BaseObject,_super),BaseObject.prototype.get=function(key){var value;return this.values_.hasOwnProperty(key)&&(value=this.values_[key]),value},BaseObject.prototype.getKeys=function(){return Object.keys(this.values_)},BaseObject.prototype.getProperties=function(){return assign({},this.values_)},BaseObject.prototype.notify=function(key,oldValue){var eventType;eventType=getChangeEventType(key),this.dispatchEvent(new ObjectEvent(eventType,key,oldValue)),eventType=ObjectEventType.PROPERTYCHANGE,this.dispatchEvent(new ObjectEvent(eventType,key,oldValue))},BaseObject.prototype.set=function(key,value,opt_silent){if(opt_silent)this.values_[key]=value;else{var oldValue=this.values_[key];this.values_[key]=value,oldValue!==value&&this.notify(key,oldValue)}},BaseObject.prototype.setProperties=function(values,opt_silent){for(var key in values)this.set(key,values[key],opt_silent)},BaseObject.prototype.unset=function(key,opt_silent){if(key in this.values_){var oldValue=this.values_[key];delete this.values_[key],opt_silent||this.notify(key,oldValue)}},BaseObject}(Observable),changeEventTypeCache={};function getChangeEventType(key){return changeEventTypeCache.hasOwnProperty(key)?changeEventTypeCache[key]:changeEventTypeCache[key]="change:"+key}var Property={LENGTH:"length"},CollectionEvent=function(_super){function CollectionEvent(type,opt_element,opt_index){var _this=_super.call(this,type)||this;return _this.element=opt_element,_this.index=opt_index,_this}return __extends(CollectionEvent,_super),CollectionEvent}(BaseEvent),Collection=function(_super){function Collection(opt_array,opt_options){var _this=_super.call(this)||this,options=opt_options||{};if(_this.unique_=!!options.unique,_this.array_=opt_array||[],_this.unique_)for(var i=0,ii=_this.array_.length;i<ii;++i)_this.assertUnique_(_this.array_[i],i);return _this.updateLength_(),_this}return __extends(Collection,_super),Collection.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},Collection.prototype.extend=function(arr){for(var i=0,ii=arr.length;i<ii;++i)this.push(arr[i]);return this},Collection.prototype.forEach=function(f){for(var array=this.array_,i=0,ii=array.length;i<ii;++i)f(array[i],i,array)},Collection.prototype.getArray=function(){return this.array_},Collection.prototype.item=function(index){return this.array_[index]},Collection.prototype.getLength=function(){return this.get(Property.LENGTH)},Collection.prototype.insertAt=function(index,elem){this.unique_&&this.assertUnique_(elem),this.array_.splice(index,0,elem),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,elem,index))},Collection.prototype.pop=function(){return this.removeAt(this.getLength()-1)},Collection.prototype.push=function(elem){this.unique_&&this.assertUnique_(elem);var n=this.getLength();return this.insertAt(n,elem),this.getLength()},Collection.prototype.remove=function(elem){for(var arr=this.array_,i=0,ii=arr.length;i<ii;++i)if(arr[i]===elem)return this.removeAt(i)},Collection.prototype.removeAt=function(index){var prev=this.array_[index];return this.array_.splice(index,1),this.updateLength_(),this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,prev,index)),prev},Collection.prototype.setAt=function(index,elem){var n=this.getLength();if(index<n){this.unique_&&this.assertUnique_(elem,index);var prev=this.array_[index];this.array_[index]=elem,this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE,prev,index)),this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD,elem,index))}else{for(var j=n;j<index;++j)this.insertAt(j,void 0);this.insertAt(index,elem)}},Collection.prototype.updateLength_=function(){this.set(Property.LENGTH,this.array_.length)},Collection.prototype.assertUnique_=function(elem,opt_except){for(var i=0,ii=this.array_.length;i<ii;++i)if(this.array_[i]===elem&&i!==opt_except)throw new AssertionError(58)},Collection}(BaseObject),MapEvent=function(_super){function MapEvent(type,map,opt_frameState){var _this=_super.call(this,type)||this;return _this.map=map,_this.frameState=void 0!==opt_frameState?opt_frameState:null,_this}return __extends(MapEvent,_super),MapEvent}(BaseEvent),MapBrowserEvent=function(_super){function MapBrowserEvent(type,map,browserEvent,opt_dragging,opt_frameState){var _this=_super.call(this,type,map,opt_frameState)||this;return _this.originalEvent=browserEvent,_this.pixel_=null,_this.coordinate_=null,_this.dragging=void 0!==opt_dragging&&opt_dragging,_this}return __extends(MapBrowserEvent,_super),Object.defineProperty(MapBrowserEvent.prototype,"pixel",{get:function(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_},set:function(pixel){this.pixel_=pixel},enumerable:!0,configurable:!0}),Object.defineProperty(MapBrowserEvent.prototype,"coordinate",{get:function(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_},set:function(coordinate){this.coordinate_=coordinate},enumerable:!0,configurable:!0}),MapBrowserEvent.prototype.preventDefault=function(){_super.prototype.preventDefault.call(this),this.originalEvent.preventDefault()},MapBrowserEvent.prototype.stopPropagation=function(){_super.prototype.stopPropagation.call(this),this.originalEvent.stopPropagation()},MapBrowserEvent}(MapEvent),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function createCommonjsModule(fn,module){return fn(module={exports:{}},module.exports),module.exports}var pep=createCommonjsModule(function(module,exports){module.exports=function(){var MOUSE_PROPS=["bubbles","cancelable","view","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pageX","pageY"],MOUSE_DEFAULTS=[!1,!1,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0];function PointerEvent(inType,inDict){inDict=inDict||Object.create(null);var e=document.createEvent("Event");e.initEvent(inType,inDict.bubbles||!1,inDict.cancelable||!1);for(var p,i=2;i<MOUSE_PROPS.length;i++)e[p=MOUSE_PROPS[i]]=inDict[p]||MOUSE_DEFAULTS[i];e.buttons=inDict.buttons||0;var pressure=0;return pressure=void 0!==inDict.pressure&&e.buttons?inDict.pressure:e.buttons?.5:0,e.x=e.clientX,e.y=e.clientY,e.pointerId=inDict.pointerId||0,e.width=inDict.width||1,e.height=inDict.height||1,e.pressure=pressure,e.tiltX=inDict.tiltX||0,e.tiltY=inDict.tiltY||0,e.twist=inDict.twist||0,e.tangentialPressure=inDict.tangentialPressure||0,e.pointerType=inDict.pointerType||"",e.hwTimestamp=inDict.hwTimestamp||0,e.isPrimary=inDict.isPrimary||!1,e.detail=0,e}var PointerMap=window.Map&&window.Map.prototype.forEach?Map:SparseArrayMap;function SparseArrayMap(){this.array=[],this.size=0}SparseArrayMap.prototype={set:function(k,v){if(void 0===v)return this.delete(k);this.has(k)||this.size++,this.array[k]=v},has:function(k){return void 0!==this.array[k]},delete:function(k){this.has(k)&&(delete this.array[k],this.size--)},get:function(k){return this.array[k]},clear:function(){this.array.length=0,this.size=0},forEach:function(callback,thisArg){return this.array.forEach(function(v,k){callback.call(thisArg,v,k,this)},this)}};var CLONE_PROPS=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","buttons","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","type","target","currentTarget","which","pageX","pageY","timeStamp"],CLONE_DEFAULTS=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],BOUNDARY_EVENTS={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},HAS_SVG_INSTANCE="undefined"!=typeof SVGElementInstance,dispatcher={pointermap:new PointerMap,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(name,source){var s=source,newEvents=s.events;newEvents&&(newEvents.forEach(function(e){s[e]&&(this.eventMap[e]=s[e].bind(s))},this),this.eventSources[name]=s,this.eventSourceList.push(s))},register:function(element){for(var es,l=this.eventSourceList.length,i=0;i<l&&(es=this.eventSourceList[i]);i++)es.register.call(es,element)},unregister:function(element){for(var es,l=this.eventSourceList.length,i=0;i<l&&(es=this.eventSourceList[i]);i++)es.unregister.call(es,element)},contains:function(container,contained){try{return container.contains(contained)}catch(ex){return!1}},down:function(inEvent){inEvent.bubbles=!0,this.fireEvent("pointerdown",inEvent)},move:function(inEvent){inEvent.bubbles=!0,this.fireEvent("pointermove",inEvent)},up:function(inEvent){inEvent.bubbles=!0,this.fireEvent("pointerup",inEvent)},enter:function(inEvent){inEvent.bubbles=!1,this.fireEvent("pointerenter",inEvent)},leave:function(inEvent){inEvent.bubbles=!1,this.fireEvent("pointerleave",inEvent)},over:function(inEvent){inEvent.bubbles=!0,this.fireEvent("pointerover",inEvent)},out:function(inEvent){inEvent.bubbles=!0,this.fireEvent("pointerout",inEvent)},cancel:function(inEvent){inEvent.bubbles=!0,this.fireEvent("pointercancel",inEvent)},leaveOut:function(event){this.out(event),this.propagate(event,this.leave,!1)},enterOver:function(event){this.over(event),this.propagate(event,this.enter,!0)},eventHandler:function(inEvent){if(!inEvent._handledByPE){var type=inEvent.type,fn=this.eventMap&&this.eventMap[type];fn&&fn(inEvent),inEvent._handledByPE=!0}},listen:function(target,events){events.forEach(function(e){this.addEvent(target,e)},this)},unlisten:function(target,events){events.forEach(function(e){this.removeEvent(target,e)},this)},addEvent:function(target,eventName){target.addEventListener(eventName,this.boundHandler)},removeEvent:function(target,eventName){target.removeEventListener(eventName,this.boundHandler)},makeEvent:function(inType,inEvent){this.captureInfo[inEvent.pointerId]&&(inEvent.relatedTarget=null);var e=new PointerEvent(inType,inEvent);return inEvent.preventDefault&&(e.preventDefault=inEvent.preventDefault),e._target=e._target||inEvent.target,e},fireEvent:function(inType,inEvent){var e=this.makeEvent(inType,inEvent);return this.dispatchEvent(e)},cloneEvent:function(inEvent){for(var p,eventCopy=Object.create(null),i=0;i<CLONE_PROPS.length;i++)eventCopy[p=CLONE_PROPS[i]]=inEvent[p]||CLONE_DEFAULTS[i],!HAS_SVG_INSTANCE||"target"!==p&&"relatedTarget"!==p||eventCopy[p]instanceof SVGElementInstance&&(eventCopy[p]=eventCopy[p].correspondingUseElement);return inEvent.preventDefault&&(eventCopy.preventDefault=function(){inEvent.preventDefault()}),eventCopy},getTarget:function(inEvent){var capture=this.captureInfo[inEvent.pointerId];return capture?inEvent._target!==capture&&inEvent.type in BOUNDARY_EVENTS?void 0:capture:inEvent._target},propagate:function(event,fn,propagateDown){for(var target=event.target,targets=[];null!=target&&target!==document&&!target.contains(event.relatedTarget);)if(targets.push(target),!(target=target.parentNode))return;propagateDown&&targets.reverse(),targets.forEach(function(target){event.target=target,fn.call(this,event)},this)},setCapture:function(inPointerId,inTarget,skipDispatch){this.captureInfo[inPointerId]&&this.releaseCapture(inPointerId,skipDispatch),this.captureInfo[inPointerId]=inTarget,this.implicitRelease=this.releaseCapture.bind(this,inPointerId,skipDispatch),document.addEventListener("pointerup",this.implicitRelease),document.addEventListener("pointercancel",this.implicitRelease);var e=new PointerEvent("gotpointercapture",{bubbles:!0});e.pointerId=inPointerId,e._target=inTarget,skipDispatch||this.asyncDispatchEvent(e)},releaseCapture:function(inPointerId,skipDispatch){var t=this.captureInfo[inPointerId];if(t){this.captureInfo[inPointerId]=void 0,document.removeEventListener("pointerup",this.implicitRelease),document.removeEventListener("pointercancel",this.implicitRelease);var e=new PointerEvent("lostpointercapture",{bubbles:!0});e.pointerId=inPointerId,e._target=t,skipDispatch||this.asyncDispatchEvent(e)}},dispatchEvent:function(inEvent){var t=this.getTarget(inEvent);if(t)return t.dispatchEvent(inEvent)},asyncDispatchEvent:function(inEvent){requestAnimationFrame(this.dispatchEvent.bind(this,inEvent))}};dispatcher.boundHandler=dispatcher.eventHandler.bind(dispatcher);var targeting={shadow:function(inEl){if(inEl)return inEl.shadowRoot||inEl.webkitShadowRoot},canTarget:function(shadow){return shadow&&Boolean(shadow.elementFromPoint)},targetingShadow:function(inEl){var s=this.shadow(inEl);if(this.canTarget(s))return s},olderShadow:function(shadow){var os=shadow.olderShadowRoot;if(!os){var se=shadow.querySelector("shadow");se&&(os=se.olderShadowRoot)}return os},allShadows:function(element){for(var shadows=[],s=this.shadow(element);s;)shadows.push(s),s=this.olderShadow(s);return shadows},searchRoot:function(inRoot,x,y){if(inRoot){var st,sr,t=inRoot.elementFromPoint(x,y);for(sr=this.targetingShadow(t);sr;){if(st=sr.elementFromPoint(x,y)){var ssr=this.targetingShadow(st);return this.searchRoot(ssr,x,y)||st}sr=this.olderShadow(sr)}return t}},owner:function(element){for(var s=element;s.parentNode;)s=s.parentNode;return s.nodeType!==Node.DOCUMENT_NODE&&s.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(s=document),s},findTarget:function(inEvent){var x=inEvent.clientX,y=inEvent.clientY,s=this.owner(inEvent.target);return s.elementFromPoint(x,y)||(s=document),this.searchRoot(s,x,y)}},forEach=Array.prototype.forEach.call.bind(Array.prototype.forEach),map=Array.prototype.map.call.bind(Array.prototype.map),toArray=Array.prototype.slice.call.bind(Array.prototype.slice),filter=Array.prototype.filter.call.bind(Array.prototype.filter),MO=window.MutationObserver||window.WebKitMutationObserver,OBSERVER_INIT={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};function Installer(add,remove,changed,binder){this.addCallback=add.bind(binder),this.removeCallback=remove.bind(binder),this.changedCallback=changed.bind(binder),MO&&(this.observer=new MO(this.mutationWatcher.bind(this)))}function rule(v){return"{ -ms-touch-action: "+v+"; touch-action: "+v+"; }"}Installer.prototype={watchSubtree:function(target){this.observer&&targeting.canTarget(target)&&this.observer.observe(target,OBSERVER_INIT)},enableOnSubtree:function(target){this.watchSubtree(target),target===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(target)},installNewSubtree:function(target){forEach(this.findElements(target),this.addElement,this)},findElements:function(target){return target.querySelectorAll?target.querySelectorAll("[touch-action]"):[]},removeElement:function(el){this.removeCallback(el)},addElement:function(el){this.addCallback(el)},elementChanged:function(el,oldValue){this.changedCallback(el,oldValue)},concatLists:function(accum,list){return accum.concat(toArray(list))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(n){return n.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(inNodes){var tree=map(inNodes,this.findElements,this);return tree.push(filter(inNodes,this.isElement)),tree.reduce(this.concatLists,[])},mutationWatcher:function(mutations){mutations.forEach(this.mutationHandler,this)},mutationHandler:function(m){"childList"===m.type?(this.flattenMutationTree(m.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(m.removedNodes).forEach(this.removeElement,this)):"attributes"===m.type&&this.elementChanged(m.target,m.oldValue)}};var attrib2css=[{selector:'[touch-action="none"]',value:"none"},{selector:'[touch-action="auto"]',value:"auto"},{selector:'[touch-action~="pan-x"]',value:"pan-x"},{selector:'[touch-action~="pan-y"]',value:"pan-y"},{selector:'[touch-action~="pan-up"]',value:"pan-up"},{selector:'[touch-action~="pan-down"]',value:"pan-down"},{selector:'[touch-action~="pan-left"]',value:"pan-left"},{selector:'[touch-action~="pan-right"]',value:"pan-right"}],styles="",hasNativePE=window.PointerEvent||window.MSPointerEvent,hasShadowRoot=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,pointermap=dispatcher.pointermap,BUTTON_TO_BUTTONS=[1,4,2,8,16],HAS_BUTTONS=!1;try{HAS_BUTTONS=1===new MouseEvent("test",{buttons:1}).buttons}catch(e){}var INSTALLER,mouseEvents={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","webkitmouseforcechanged","mousemove","mouseup","mouseover","mouseout"],register:function(target){dispatcher.listen(target,this.events)},unregister:function(target){dispatcher.unlisten(target,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(inEvent){for(var t,lts=this.lastTouches,x=inEvent.clientX,y=inEvent.clientY,i=0,l=lts.length;i<l&&(t=lts[i]);i++){var dx=Math.abs(x-t.x),dy=Math.abs(y-t.y);if(dx<=25&&dy<=25)return!0}},prepareEvent:function(inEvent){var e=dispatcher.cloneEvent(inEvent),pd=e.preventDefault;return e.preventDefault=function(){inEvent.preventDefault(),pd()},e.pointerId=this.POINTER_ID,e.isPrimary=!0,e.pointerType=this.POINTER_TYPE,"webkitForce"in inEvent&&(e.pressure=inEvent.webkitForce-MouseEvent.WEBKIT_FORCE_AT_MOUSE_DOWN),e},prepareButtonsForMove:function(e,inEvent){var p=pointermap.get(this.POINTER_ID);0!==inEvent.which&&p?e.buttons=p.buttons:e.buttons=0,inEvent.buttons=e.buttons},mousedown:function(inEvent){if(!this.isEventSimulatedFromTouch(inEvent)){var p=pointermap.get(this.POINTER_ID),e=this.prepareEvent(inEvent);HAS_BUTTONS||(e.buttons=BUTTON_TO_BUTTONS[e.button],p&&(e.buttons|=p.buttons),inEvent.buttons=e.buttons),pointermap.set(this.POINTER_ID,inEvent),p&&0!==p.buttons?dispatcher.move(e):dispatcher.down(e)}},webkitmouseforcechanged:function(inEvent){this.mousemove(inEvent)},mousemove:function(inEvent){if(!this.isEventSimulatedFromTouch(inEvent)){var e=this.prepareEvent(inEvent);HAS_BUTTONS||this.prepareButtonsForMove(e,inEvent),e.button=-1,pointermap.set(this.POINTER_ID,inEvent),dispatcher.move(e)}},mouseup:function(inEvent){if(!this.isEventSimulatedFromTouch(inEvent)){var p=pointermap.get(this.POINTER_ID),e=this.prepareEvent(inEvent);if(!HAS_BUTTONS){var up=BUTTON_TO_BUTTONS[e.button];e.buttons=p?p.buttons&~up:0,inEvent.buttons=e.buttons}pointermap.set(this.POINTER_ID,inEvent),e.buttons&=~BUTTON_TO_BUTTONS[e.button],0===e.buttons?dispatcher.up(e):dispatcher.move(e)}},mouseover:function(inEvent){if(!this.isEventSimulatedFromTouch(inEvent)){var e=this.prepareEvent(inEvent);HAS_BUTTONS||this.prepareButtonsForMove(e,inEvent),e.button=-1,pointermap.set(this.POINTER_ID,inEvent),dispatcher.enterOver(e)}},mouseout:function(inEvent){if(!this.isEventSimulatedFromTouch(inEvent)){var e=this.prepareEvent(inEvent);HAS_BUTTONS||this.prepareButtonsForMove(e,inEvent),e.button=-1,dispatcher.leaveOut(e)}},cancel:function(inEvent){var e=this.prepareEvent(inEvent);dispatcher.cancel(e),this.deactivateMouse()},deactivateMouse:function(){pointermap.delete(this.POINTER_ID)}},captureInfo=dispatcher.captureInfo,findTarget=targeting.findTarget.bind(targeting),allShadows=targeting.allShadows.bind(targeting),pointermap$1=dispatcher.pointermap,touchEvents={events:["touchstart","touchmove","touchforcechange","touchend","touchcancel"],register:function(target){INSTALLER.enableOnSubtree(target)},unregister:function(){},elementAdded:function(el){var a=el.getAttribute("touch-action"),st=this.touchActionToScrollType(a);"number"==typeof st&&(el._scrollType=st,dispatcher.listen(el,this.events),allShadows(el).forEach(function(s){s._scrollType=st,dispatcher.listen(s,this.events)},this))},elementRemoved:function(el){if(pointermap$1.size>0){var evts=this.events;el.addEventListener("touchend",function(){el._scrollType=void 0,dispatcher.unlisten(el,evts)})}else el._scrollType=void 0,dispatcher.unlisten(el,this.events);allShadows(el).forEach(function(s){s._scrollType=void 0,dispatcher.unlisten(s,this.events)},this)},elementChanged:function(el,oldValue){var a=el.getAttribute("touch-action"),st=this.touchActionToScrollType(a),oldSt=this.touchActionToScrollType(oldValue);"number"==typeof st&&"number"==typeof oldSt?(el._scrollType=st,allShadows(el).forEach(function(s){s._scrollType=st},this)):"number"==typeof oldSt?this.elementRemoved(el):"number"==typeof st&&this.elementAdded(el)},scrollTypes:{UP:function(s){return s.includes("pan-y")||s.includes("pan-up")?1:0},DOWN:function(s){return s.includes("pan-y")||s.includes("pan-down")?2:0},LEFT:function(s){return s.includes("pan-x")||s.includes("pan-left")?4:0},RIGHT:function(s){return s.includes("pan-x")||s.includes("pan-right")?8:0}},touchActionToScrollType:function(touchAction){if(touchAction){if("auto"===touchAction)return 15;if("none"===touchAction)return 0;var s=touchAction.split(" "),st=this.scrollTypes;return st.UP(s)|st.DOWN(s)|st.LEFT(s)|st.RIGHT(s)}},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(inTouch){return this.firstTouch===inTouch.identifier},setPrimaryTouch:function(inTouch){(0===pointermap$1.size||1===pointermap$1.size&&pointermap$1.has(1))&&(this.firstTouch=inTouch.identifier,this.firstXY={X:inTouch.clientX,Y:inTouch.clientY},this.scrolling=!1)},removePrimaryPointer:function(inPointer){inPointer.isPrimary&&(this.firstTouch=null,this.firstXY=null)},typeToButtons:function(type){var ret=0;return"touchstart"!==type&&"touchmove"!==type&&"touchforcechange"!==type||(ret=1),ret},touchToPointer:function(inTouch){var cte=this.currentTouchEvent,e=dispatcher.cloneEvent(inTouch),id=e.pointerId=inTouch.identifier+2;if(e.target=captureInfo[id]||findTarget(e),e.bubbles=!0,e.cancelable=!0,e.button=0,e.buttons=this.typeToButtons(cte.type),e.width=2*(inTouch.radiusX||inTouch.webkitRadiusX||0),e.height=2*(inTouch.radiusY||inTouch.webkitRadiusY||0),e.pressure=void 0!==inTouch.force?inTouch.force:void 0!==inTouch.webkitForce?inTouch.webkitForce:void 0,e.isPrimary=this.isPrimaryTouch(inTouch),inTouch.altitudeAngle){var tan=Math.tan(inTouch.altitudeAngle),radToDeg=180/Math.PI;e.tiltX=Math.atan(Math.cos(inTouch.azimuthAngle)/tan)*radToDeg,e.tiltY=Math.atan(Math.sin(inTouch.azimuthAngle)/tan)*radToDeg}else e.tiltX=0,e.tiltY=0;"stylus"===inTouch.touchType?e.pointerType="pen":e.pointerType=this.POINTER_TYPE,e.altKey=cte.altKey,e.ctrlKey=cte.ctrlKey,e.metaKey=cte.metaKey,e.shiftKey=cte.shiftKey;var self=this;return e.preventDefault=function(){self.scrolling=!1,self.firstXY=null,cte.preventDefault()},e},processTouches:function(inEvent,inFunction){var tl=inEvent.changedTouches;this.currentTouchEvent=inEvent;for(var t,i=0;i<tl.length;i++)t=tl[i],inFunction.call(this,this.touchToPointer(t))},shouldScroll:function(inEvent){if(this.firstXY){var ret,st=inEvent.currentTarget._scrollType;if(0===st)ret=!1;else if(15===st)ret=!0;else{var t=inEvent.changedTouches[0],dy=t.clientY-this.firstXY.Y,dya=Math.abs(dy),dx=t.clientX-this.firstXY.X,dxa=Math.abs(dx),up=1&st,down=2&st,left=4&st,right=8&st;left&&right?ret=dxa>dya:left?ret=dxa>dya&&dx>0:right&&(ret=dxa>dya&&dx<0),ret||(up&&down?ret=dxa<dya:up?ret=dxa<dya&&dy>0:down&&(ret=dxa<dya&&dy<0))}return this.firstXY=null,ret}},findTouch:function(inTL,inId){for(var t,i=0,l=inTL.length;i<l&&(t=inTL[i]);i++)if(t.identifier===inId)return!0},vacuumTouches:function(inEvent){var tl=inEvent.touches;if(pointermap$1.size>=tl.length){var d=[];pointermap$1.forEach(function(value,key){if(1!==key&&!this.findTouch(tl,key-2)){var p=value.out;d.push(p)}},this),d.forEach(this.cancelOut,this)}},touchstart:function(inEvent){this.vacuumTouches(inEvent),this.setPrimaryTouch(inEvent.changedTouches[0]),this.dedupSynthMouse(inEvent),this.scrolling||this.processTouches(inEvent,this.overDown)},overDown:function(inPointer){pointermap$1.set(inPointer.pointerId,{target:inPointer.target,out:inPointer,outTarget:inPointer.target}),dispatcher.enterOver(inPointer),dispatcher.down(inPointer)},touchforcechange:function(inEvent){this.touchmove(inEvent)},touchmove:function(inEvent){this.scrolling||(this.shouldScroll(inEvent)?(this.scrolling=!0,this.touchcancel(inEvent)):("touchforcechange"!==inEvent.type&&inEvent.preventDefault(),this.processTouches(inEvent,this.moveOverOut)))},moveOverOut:function(inPointer){var event=inPointer,pointer=pointermap$1.get(event.pointerId);if(pointer){var outEvent=pointer.out,outTarget=pointer.outTarget;dispatcher.move(event),outEvent&&outTarget!==event.target&&(outEvent.relatedTarget=event.target,event.relatedTarget=outTarget,outEvent.target=outTarget,event.target?(dispatcher.leaveOut(outEvent),dispatcher.enterOver(event)):(event.target=outTarget,event.relatedTarget=null,this.cancelOut(event))),pointer.out=event,pointer.outTarget=event.target}},touchend:function(inEvent){this.dedupSynthMouse(inEvent),this.processTouches(inEvent,this.upOut)},upOut:function(inPointer){this.scrolling||(dispatcher.up(inPointer),dispatcher.leaveOut(inPointer)),this.cleanUpPointer(inPointer)},touchcancel:function(inEvent){this.processTouches(inEvent,this.cancelOut)},cancelOut:function(inPointer){dispatcher.cancel(inPointer),dispatcher.leaveOut(inPointer),this.cleanUpPointer(inPointer)},cleanUpPointer:function(inPointer){pointermap$1.delete(inPointer.pointerId),this.removePrimaryPointer(inPointer)},dedupSynthMouse:function(inEvent){var lts=mouseEvents.lastTouches,t=inEvent.changedTouches[0];if(this.isPrimaryTouch(t)){var lt={x:t.clientX,y:t.clientY};lts.push(lt);var fn=function(lts,lt){var i=lts.indexOf(lt);i>-1&&lts.splice(i,1)}.bind(null,lts,lt);setTimeout(fn,2500)}}};INSTALLER=new Installer(touchEvents.elementAdded,touchEvents.elementRemoved,touchEvents.elementChanged,touchEvents);var s,r,h,pointermap$2=dispatcher.pointermap,HAS_BITMAP_TYPE=window.MSPointerEvent&&"number"==typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,msEvents={events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],register:function(target){dispatcher.listen(target,this.events)},unregister:function(target){dispatcher.unlisten(target,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(inEvent){var e=inEvent;return HAS_BITMAP_TYPE&&((e=dispatcher.cloneEvent(inEvent)).pointerType=this.POINTER_TYPES[inEvent.pointerType]),e},cleanup:function(id){pointermap$2.delete(id)},MSPointerDown:function(inEvent){pointermap$2.set(inEvent.pointerId,inEvent);var e=this.prepareEvent(inEvent);dispatcher.down(e)},MSPointerMove:function(inEvent){var e=this.prepareEvent(inEvent);dispatcher.move(e)},MSPointerUp:function(inEvent){var e=this.prepareEvent(inEvent);dispatcher.up(e),this.cleanup(inEvent.pointerId)},MSPointerOut:function(inEvent){var e=this.prepareEvent(inEvent);dispatcher.leaveOut(e)},MSPointerOver:function(inEvent){var e=this.prepareEvent(inEvent);dispatcher.enterOver(e)},MSPointerCancel:function(inEvent){var e=this.prepareEvent(inEvent);dispatcher.cancel(e),this.cleanup(inEvent.pointerId)},MSLostPointerCapture:function(inEvent){var e=dispatcher.makeEvent("lostpointercapture",inEvent);dispatcher.dispatchEvent(e)},MSGotPointerCapture:function(inEvent){var e=dispatcher.makeEvent("gotpointercapture",inEvent);dispatcher.dispatchEvent(e)}};function assertActive(id){if(!dispatcher.pointermap.has(id)){var error=new Error("NotFoundError");throw error.name="NotFoundError",error}}function assertConnected(elem){for(var parent=elem.parentNode;parent&&parent!==elem.ownerDocument;)parent=parent.parentNode;if(!parent){var error=new Error("InvalidStateError");throw error.name="InvalidStateError",error}}function inActiveButtonState(id){return 0!==dispatcher.pointermap.get(id).buttons}return window.navigator.msPointerEnabled?(s=function(pointerId){assertActive(pointerId),assertConnected(this),inActiveButtonState(pointerId)&&(dispatcher.setCapture(pointerId,this,!0),this.msSetPointerCapture(pointerId))},r=function(pointerId){assertActive(pointerId),dispatcher.releaseCapture(pointerId,!0),this.msReleasePointerCapture(pointerId)}):(s=function(pointerId){assertActive(pointerId),assertConnected(this),inActiveButtonState(pointerId)&&dispatcher.setCapture(pointerId,this)},r=function(pointerId){assertActive(pointerId),dispatcher.releaseCapture(pointerId)}),h=function(pointerId){return!!dispatcher.captureInfo[pointerId]},function(){if(hasNativePE){attrib2css.forEach(function(r){styles+=r.selector+rule(r.value)+"\n",hasShadowRoot&&(styles+=function(s){return"body /shadow-deep/ "+s}(r.selector)+rule(r.value)+"\n")});var el=document.createElement("style");el.textContent=styles,document.head.appendChild(el)}}(),function(){if(!window.PointerEvent){if(window.PointerEvent=PointerEvent,window.navigator.msPointerEnabled){var tp=window.navigator.msMaxTouchPoints;Object.defineProperty(window.navigator,"maxTouchPoints",{value:tp,enumerable:!0}),dispatcher.registerSource("ms",msEvents)}else Object.defineProperty(window.navigator,"maxTouchPoints",{value:0,enumerable:!0}),dispatcher.registerSource("mouse",mouseEvents),void 0!==window.ontouchstart&&dispatcher.registerSource("touch",touchEvents);dispatcher.register(document)}}(),window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:s},releasePointerCapture:{value:r},hasPointerCapture:{value:h}}),{dispatcher:dispatcher,Installer:Installer,PointerEvent:PointerEvent,PointerMap:PointerMap,targetFinding:targeting}}()}),ua="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",FIREFOX=-1!==ua.indexOf("firefox"),SAFARI=-1!==ua.indexOf("safari")&&-1==ua.indexOf("chrom"),WEBKIT=-1!==ua.indexOf("webkit")&&-1==ua.indexOf("edge"),MAC=-1!==ua.indexOf("macintosh"),DEVICE_PIXEL_RATIO=window.devicePixelRatio||1,IMAGE_DECODE="undefined"!=typeof Image&&Image.prototype.decode,MapBrowserEventType={SINGLECLICK:"singleclick",CLICK:EventType.CLICK,DBLCLICK:EventType.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},MapBrowserPointerEvent=function(_super){function MapBrowserPointerEvent(type,map,pointerEvent,opt_dragging,opt_frameState){var _this=_super.call(this,type,map,pointerEvent,opt_dragging,opt_frameState)||this;return _this.pointerEvent=pointerEvent,_this}return __extends(MapBrowserPointerEvent,_super),MapBrowserPointerEvent}(MapBrowserEvent),PointerEventType={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},MapBrowserEventHandler=function(_super){function MapBrowserEventHandler(map,moveTolerance){var _this=_super.call(this,map)||this;_this.map_=map,_this.clickTimeoutId_,_this.dragging_=!1,_this.dragListenerKeys_=[],_this.moveTolerance_=moveTolerance?moveTolerance*DEVICE_PIXEL_RATIO:DEVICE_PIXEL_RATIO,_this.down_=null;var element=_this.map_.getViewport();return element.setAttribute("touch-action","none"),_this.activePointers_=0,_this.trackedTouches_={},_this.element_=element,_this.pointerdownListenerKey_=listen(element,PointerEventType.POINTERDOWN,_this.handlePointerDown_,_this),_this.relayedListenerKey_=listen(element,PointerEventType.POINTERMOVE,_this.relayEvent_,_this),_this}return __extends(MapBrowserEventHandler,_super),MapBrowserEventHandler.prototype.emulateClick_=function(pointerEvent){var newEvent=new MapBrowserPointerEvent(MapBrowserEventType.CLICK,this.map_,pointerEvent);this.dispatchEvent(newEvent),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,newEvent=new MapBrowserPointerEvent(MapBrowserEventType.DBLCLICK,this.map_,pointerEvent),this.dispatchEvent(newEvent)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var newEvent=new MapBrowserPointerEvent(MapBrowserEventType.SINGLECLICK,this.map_,pointerEvent);this.dispatchEvent(newEvent)}.bind(this),250)},MapBrowserEventHandler.prototype.updateActivePointers_=function(pointerEvent){var event=pointerEvent;event.type==MapBrowserEventType.POINTERUP||event.type==MapBrowserEventType.POINTERCANCEL?delete this.trackedTouches_[event.pointerId]:event.type==MapBrowserEventType.POINTERDOWN&&(this.trackedTouches_[event.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},MapBrowserEventHandler.prototype.handlePointerUp_=function(pointerEvent){this.updateActivePointers_(pointerEvent);var newEvent=new MapBrowserPointerEvent(MapBrowserEventType.POINTERUP,this.map_,pointerEvent);this.dispatchEvent(newEvent),newEvent.propagationStopped||this.dragging_||!this.isMouseActionButton_(pointerEvent)||this.emulateClick_(this.down_),0===this.activePointers_&&(this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)},MapBrowserEventHandler.prototype.isMouseActionButton_=function(pointerEvent){return 0===pointerEvent.button},MapBrowserEventHandler.prototype.handlePointerDown_=function(pointerEvent){this.updateActivePointers_(pointerEvent);var newEvent=new MapBrowserPointerEvent(MapBrowserEventType.POINTERDOWN,this.map_,pointerEvent);this.dispatchEvent(newEvent),this.down_=pointerEvent,0===this.dragListenerKeys_.length&&this.dragListenerKeys_.push(listen(document,MapBrowserEventType.POINTERMOVE,this.handlePointerMove_,this),listen(document,MapBrowserEventType.POINTERUP,this.handlePointerUp_,this),listen(this.element_,MapBrowserEventType.POINTERCANCEL,this.handlePointerUp_,this))},MapBrowserEventHandler.prototype.handlePointerMove_=function(pointerEvent){if(this.isMoving_(pointerEvent)){this.dragging_=!0;var newEvent=new MapBrowserPointerEvent(MapBrowserEventType.POINTERDRAG,this.map_,pointerEvent,this.dragging_);this.dispatchEvent(newEvent)}},MapBrowserEventHandler.prototype.relayEvent_=function(pointerEvent){var dragging=!(!this.down_||!this.isMoving_(pointerEvent));this.dispatchEvent(new MapBrowserPointerEvent(pointerEvent.type,this.map_,pointerEvent,dragging))},MapBrowserEventHandler.prototype.isMoving_=function(pointerEvent){return this.dragging_||Math.abs(pointerEvent.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(pointerEvent.clientY-this.down_.clientY)>this.moveTolerance_},MapBrowserEventHandler.prototype.disposeInternal=function(){this.relayedListenerKey_&&(unlistenByKey(this.relayedListenerKey_),this.relayedListenerKey_=null),this.pointerdownListenerKey_&&(unlistenByKey(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0,this.element_=null,_super.prototype.disposeInternal.call(this)},MapBrowserEventHandler}(Target),MapEventType={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"},MapProperty={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},RenderEventType={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},TileState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4,ABORT:5};function assert(assertion,errorCode){if(!assertion)throw new AssertionError(errorCode)}var DROP=1/0,PriorityQueue=function(){function PriorityQueue(priorityFunction,keyFunction){this.priorityFunction_=priorityFunction,this.keyFunction_=keyFunction,this.elements_=[],this.priorities_=[],this.queuedElements_={}}return PriorityQueue.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,clear(this.queuedElements_)},PriorityQueue.prototype.dequeue=function(){var elements=this.elements_,priorities=this.priorities_,element=elements[0];1==elements.length?(elements.length=0,priorities.length=0):(elements[0]=elements.pop(),priorities[0]=priorities.pop(),this.siftUp_(0));var elementKey=this.keyFunction_(element);return delete this.queuedElements_[elementKey],element},PriorityQueue.prototype.enqueue=function(element){assert(!(this.keyFunction_(element)in this.queuedElements_),31);var priority=this.priorityFunction_(element);return priority!=DROP&&(this.elements_.push(element),this.priorities_.push(priority),this.queuedElements_[this.keyFunction_(element)]=!0,this.siftDown_(0,this.elements_.length-1),!0)},PriorityQueue.prototype.getCount=function(){return this.elements_.length},PriorityQueue.prototype.getLeftChildIndex_=function(index){return 2*index+1},PriorityQueue.prototype.getRightChildIndex_=function(index){return 2*index+2},PriorityQueue.prototype.getParentIndex_=function(index){return index-1>>1},PriorityQueue.prototype.heapify_=function(){var i;for(i=(this.elements_.length>>1)-1;i>=0;i--)this.siftUp_(i)},PriorityQueue.prototype.isEmpty=function(){return 0===this.elements_.length},PriorityQueue.prototype.isKeyQueued=function(key){return key in this.queuedElements_},PriorityQueue.prototype.isQueued=function(element){return this.isKeyQueued(this.keyFunction_(element))},PriorityQueue.prototype.siftUp_=function(index){for(var elements=this.elements_,priorities=this.priorities_,count=elements.length,element=elements[index],priority=priorities[index],startIndex=index;index<count>>1;){var lIndex=this.getLeftChildIndex_(index),rIndex=this.getRightChildIndex_(index),smallerChildIndex=rIndex<count&&priorities[rIndex]<priorities[lIndex]?rIndex:lIndex;elements[index]=elements[smallerChildIndex],priorities[index]=priorities[smallerChildIndex],index=smallerChildIndex}elements[index]=element,priorities[index]=priority,this.siftDown_(startIndex,index)},PriorityQueue.prototype.siftDown_=function(startIndex,index){for(var elements=this.elements_,priorities=this.priorities_,element=elements[index],priority=priorities[index];index>startIndex;){var parentIndex=this.getParentIndex_(index);if(!(priorities[parentIndex]>priority))break;elements[index]=elements[parentIndex],priorities[index]=priorities[parentIndex],index=parentIndex}elements[index]=element,priorities[index]=priority},PriorityQueue.prototype.reprioritize=function(){var element,i,priority,priorityFunction=this.priorityFunction_,elements=this.elements_,priorities=this.priorities_,index=0,n=elements.length;for(i=0;i<n;++i)(priority=priorityFunction(element=elements[i]))==DROP?delete this.queuedElements_[this.keyFunction_(element)]:(priorities[index]=priority,elements[index++]=element);elements.length=index,priorities.length=index,this.heapify_()},PriorityQueue}(),TileQueue=function(_super){function TileQueue(tilePriorityFunction,tileChangeCallback){var _this=_super.call(this,function(element){return tilePriorityFunction.apply(null,element)},function(element){return element[0].getKey()})||this;return _this.boundHandleTileChange_=_this.handleTileChange.bind(_this),_this.tileChangeCallback_=tileChangeCallback,_this.tilesLoading_=0,_this.tilesLoadingKeys_={},_this}return __extends(TileQueue,_super),TileQueue.prototype.enqueue=function(element){var added=_super.prototype.enqueue.call(this,element);added&&element[0].addEventListener(EventType.CHANGE,this.boundHandleTileChange_);return added},TileQueue.prototype.getTilesLoading=function(){return this.tilesLoading_},TileQueue.prototype.handleTileChange=function(event){var tile=event.target,state=tile.getState();if(tile.hifi&&state===TileState.LOADED||state===TileState.ERROR||state===TileState.EMPTY||state===TileState.ABORT){tile.removeEventListener(EventType.CHANGE,this.boundHandleTileChange_);var tileKey=tile.getKey();tileKey in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[tileKey],--this.tilesLoading_),this.tileChangeCallback_()}},TileQueue.prototype.loadMoreTiles=function(maxTotalLoading,maxNewLoads){for(var state,tile,tileKey,newLoads=0,abortedTiles=!1;this.tilesLoading_<maxTotalLoading&&newLoads<maxNewLoads&&this.getCount()>0;)tileKey=(tile=this.dequeue()[0]).getKey(),(state=tile.getState())===TileState.ABORT?abortedTiles=!0:state!==TileState.IDLE||tileKey in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[tileKey]=!0,++this.tilesLoading_,++newLoads,tile.load());0===newLoads&&abortedTiles&&this.tileChangeCallback_()},TileQueue}(PriorityQueue),DEFAULT_MAX_ZOOM=42,DEFAULT_TILE_SIZE=256;function clamp(value,min,max){return Math.min(Math.max(value,min),max)}var cosh="cosh"in Math?Math.cosh:function(x){var y=Math.exp(x);return(y+1/y)/2};function squaredSegmentDistance(x,y,x1,y1,x2,y2){var dx=x2-x1,dy=y2-y1;if(0!==dx||0!==dy){var t=((x-x1)*dx+(y-y1)*dy)/(dx*dx+dy*dy);t>1?(x1=x2,y1=y2):t>0&&(x1+=dx*t,y1+=dy*t)}return squaredDistance(x,y,x1,y1)}function squaredDistance(x1,y1,x2,y2){var dx=x2-x1,dy=y2-y1;return dx*dx+dy*dy}function solveLinearSystem(mat){for(var n=mat.length,i=0;i<n;i++){for(var maxRow=i,maxEl=Math.abs(mat[i][i]),r=i+1;r<n;r++){var absValue=Math.abs(mat[r][i]);absValue>maxEl&&(maxEl=absValue,maxRow=r)}if(0===maxEl)return null;var tmp=mat[maxRow];mat[maxRow]=mat[i],mat[i]=tmp;for(var j=i+1;j<n;j++)for(var coef=-mat[j][i]/mat[i][i],k=i;k<n+1;k++)i==k?mat[j][k]=0:mat[j][k]+=coef*mat[i][k]}for(var x=new Array(n),l=n-1;l>=0;l--){x[l]=mat[l][n]/mat[l][l];for(var m=l-1;m>=0;m--)mat[m][n]-=mat[m][l]*x[l]}return x}function toRadians(angleInDegrees){return angleInDegrees*Math.PI/180}function modulo(a,b){var r=a%b;return r*b<0?r+b:r}function lerp(a,b,x){return a+x*(b-a)}function createExtent(extent,onlyCenter,smooth){return function(center,resolution,size,opt_isMoving){if(center){var viewWidth=onlyCenter?0:size[0]*resolution,viewHeight=onlyCenter?0:size[1]*resolution,minX=extent[0]+viewWidth/2,maxX=extent[2]-viewWidth/2,minY=extent[1]+viewHeight/2,maxY=extent[3]-viewHeight/2;minX>maxX&&(minX=maxX=(maxX+minX)/2),minY>maxY&&(minY=maxY=(maxY+minY)/2);var x=clamp(center[0],minX,maxX),y=clamp(center[1],minY,maxY),ratio=30*resolution;return opt_isMoving&&smooth&&(x+=-ratio*Math.log(1+Math.max(0,minX-center[0])/ratio)+ratio*Math.log(1+Math.max(0,center[0]-maxX)/ratio),y+=-ratio*Math.log(1+Math.max(0,minY-center[1])/ratio)+ratio*Math.log(1+Math.max(0,center[1]-maxY)/ratio)),[x,y]}}}function none(center){return center}var Corner={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},Relationship={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function boundingExtent(coordinates){for(var extent=createEmpty(),i=0,ii=coordinates.length;i<ii;++i)extendCoordinate(extent,coordinates[i]);return extent}function _boundingExtentXYs(xs,ys,opt_extent){return createOrUpdate(Math.min.apply(null,xs),Math.min.apply(null,ys),Math.max.apply(null,xs),Math.max.apply(null,ys),opt_extent)}function buffer(extent,value,opt_extent){return opt_extent?(opt_extent[0]=extent[0]-value,opt_extent[1]=extent[1]-value,opt_extent[2]=extent[2]+value,opt_extent[3]=extent[3]+value,opt_extent):[extent[0]-value,extent[1]-value,extent[2]+value,extent[3]+value]}function clone(extent,opt_extent){return opt_extent?(opt_extent[0]=extent[0],opt_extent[1]=extent[1],opt_extent[2]=extent[2],opt_extent[3]=extent[3],opt_extent):extent.slice()}function closestSquaredDistanceXY(extent,x,y){var dx,dy;return(dx=x<extent[0]?extent[0]-x:extent[2]<x?x-extent[2]:0)*dx+(dy=y<extent[1]?extent[1]-y:extent[3]<y?y-extent[3]:0)*dy}function containsCoordinate(extent,coordinate){return containsXY(extent,coordinate[0],coordinate[1])}function containsExtent(extent1,extent2){return extent1[0]<=extent2[0]&&extent2[2]<=extent1[2]&&extent1[1]<=extent2[1]&&extent2[3]<=extent1[3]}function containsXY(extent,x,y){return extent[0]<=x&&x<=extent[2]&&extent[1]<=y&&y<=extent[3]}function coordinateRelationship(extent,coordinate){var minX=extent[0],minY=extent[1],maxX=extent[2],maxY=extent[3],x=coordinate[0],y=coordinate[1],relationship=Relationship.UNKNOWN;return x<minX?relationship|=Relationship.LEFT:x>maxX&&(relationship|=Relationship.RIGHT),y<minY?relationship|=Relationship.BELOW:y>maxY&&(relationship|=Relationship.ABOVE),relationship===Relationship.UNKNOWN&&(relationship=Relationship.INTERSECTING),relationship}function createEmpty(){return[1/0,1/0,-1/0,-1/0]}function createOrUpdate(minX,minY,maxX,maxY,opt_extent){return opt_extent?(opt_extent[0]=minX,opt_extent[1]=minY,opt_extent[2]=maxX,opt_extent[3]=maxY,opt_extent):[minX,minY,maxX,maxY]}function createOrUpdateEmpty(opt_extent){return createOrUpdate(1/0,1/0,-1/0,-1/0,opt_extent)}function createOrUpdateFromCoordinate(coordinate,opt_extent){var x=coordinate[0],y=coordinate[1];return createOrUpdate(x,y,x,y,opt_extent)}function createOrUpdateFromCoordinates(coordinates,opt_extent){return extendCoordinates(createOrUpdateEmpty(opt_extent),coordinates)}function createOrUpdateFromFlatCoordinates(flatCoordinates,offset,end,stride,opt_extent){return extendFlatCoordinates(createOrUpdateEmpty(opt_extent),flatCoordinates,offset,end,stride)}function equals$1(extent1,extent2){return extent1[0]==extent2[0]&&extent1[2]==extent2[2]&&extent1[1]==extent2[1]&&extent1[3]==extent2[3]}function extend$1(extent1,extent2){return extent2[0]<extent1[0]&&(extent1[0]=extent2[0]),extent2[2]>extent1[2]&&(extent1[2]=extent2[2]),extent2[1]<extent1[1]&&(extent1[1]=extent2[1]),extent2[3]>extent1[3]&&(extent1[3]=extent2[3]),extent1}function extendCoordinate(extent,coordinate){coordinate[0]<extent[0]&&(extent[0]=coordinate[0]),coordinate[0]>extent[2]&&(extent[2]=coordinate[0]),coordinate[1]<extent[1]&&(extent[1]=coordinate[1]),coordinate[1]>extent[3]&&(extent[3]=coordinate[1])}function extendCoordinates(extent,coordinates){for(var i=0,ii=coordinates.length;i<ii;++i)extendCoordinate(extent,coordinates[i]);return extent}function extendFlatCoordinates(extent,flatCoordinates,offset,end,stride){for(;offset<end;offset+=stride)extendXY(extent,flatCoordinates[offset],flatCoordinates[offset+1]);return extent}function extendXY(extent,x,y){extent[0]=Math.min(extent[0],x),extent[1]=Math.min(extent[1],y),extent[2]=Math.max(extent[2],x),extent[3]=Math.max(extent[3],y)}function forEachCorner(extent,callback){var val;return(val=callback(getBottomLeft(extent)))?val:(val=callback(getBottomRight(extent)))?val:(val=callback(getTopRight(extent)))?val:(val=callback(getTopLeft(extent)))||!1}function getArea(extent){var area=0;return isEmpty$1(extent)||(area=getWidth(extent)*getHeight(extent)),area}function getBottomLeft(extent){return[extent[0],extent[1]]}function getBottomRight(extent){return[extent[2],extent[1]]}function getCenter(extent){return[(extent[0]+extent[2])/2,(extent[1]+extent[3])/2]}function getCorner(extent,corner){var coordinate;return corner===Corner.BOTTOM_LEFT?coordinate=getBottomLeft(extent):corner===Corner.BOTTOM_RIGHT?coordinate=getBottomRight(extent):corner===Corner.TOP_LEFT?coordinate=getTopLeft(extent):corner===Corner.TOP_RIGHT?coordinate=getTopRight(extent):assert(!1,13),coordinate}function getForViewAndSize(center,resolution,rotation,size,opt_extent){var dx=resolution*size[0]/2,dy=resolution*size[1]/2,cosRotation=Math.cos(rotation),sinRotation=Math.sin(rotation),xCos=dx*cosRotation,xSin=dx*sinRotation,yCos=dy*cosRotation,ySin=dy*sinRotation,x=center[0],y=center[1],x0=x-xCos+ySin,x1=x-xCos-ySin,x2=x+xCos-ySin,x3=x+xCos+ySin,y0=y-xSin-yCos,y1=y-xSin+yCos,y2=y+xSin+yCos,y3=y+xSin-yCos;return createOrUpdate(Math.min(x0,x1,x2,x3),Math.min(y0,y1,y2,y3),Math.max(x0,x1,x2,x3),Math.max(y0,y1,y2,y3),opt_extent)}function getHeight(extent){return extent[3]-extent[1]}function getIntersection(extent1,extent2,opt_extent){var intersection=opt_extent||createEmpty();return intersects(extent1,extent2)?(extent1[0]>extent2[0]?intersection[0]=extent1[0]:intersection[0]=extent2[0],extent1[1]>extent2[1]?intersection[1]=extent1[1]:intersection[1]=extent2[1],extent1[2]<extent2[2]?intersection[2]=extent1[2]:intersection[2]=extent2[2],extent1[3]<extent2[3]?intersection[3]=extent1[3]:intersection[3]=extent2[3]):createOrUpdateEmpty(intersection),intersection}function getTopLeft(extent){return[extent[0],extent[3]]}function getTopRight(extent){return[extent[2],extent[3]]}function getWidth(extent){return extent[2]-extent[0]}function intersects(extent1,extent2){return extent1[0]<=extent2[2]&&extent1[2]>=extent2[0]&&extent1[1]<=extent2[3]&&extent1[3]>=extent2[1]}function isEmpty$1(extent){return extent[2]<extent[0]||extent[3]<extent[1]}function returnOrUpdate(extent,opt_extent){return opt_extent?(opt_extent[0]=extent[0],opt_extent[1]=extent[1],opt_extent[2]=extent[2],opt_extent[3]=extent[3],opt_extent):extent}function scaleFromCenter(extent,value){var deltaX=(extent[2]-extent[0])/2*(value-1),deltaY=(extent[3]-extent[1])/2*(value-1);extent[0]-=deltaX,extent[2]+=deltaX,extent[1]-=deltaY,extent[3]+=deltaY}function intersectsSegment(extent,start,end){var intersects=!1,startRel=coordinateRelationship(extent,start),endRel=coordinateRelationship(extent,end);if(startRel===Relationship.INTERSECTING||endRel===Relationship.INTERSECTING)intersects=!0;else{var minX=extent[0],minY=extent[1],maxX=extent[2],maxY=extent[3],startX=start[0],startY=start[1],endX=end[0],endY=end[1],slope=(endY-startY)/(endX-startX),x=void 0,y=void 0;endRel&Relationship.ABOVE&&!(startRel&Relationship.ABOVE)&&(intersects=(x=endX-(endY-maxY)/slope)>=minX&&x<=maxX),intersects||!(endRel&Relationship.RIGHT)||startRel&Relationship.RIGHT||(intersects=(y=endY-(endX-maxX)*slope)>=minY&&y<=maxY),intersects||!(endRel&Relationship.BELOW)||startRel&Relationship.BELOW||(intersects=(x=endX-(endY-minY)/slope)>=minX&&x<=maxX),intersects||!(endRel&Relationship.LEFT)||startRel&Relationship.LEFT||(intersects=(y=endY-(endX-minX)*slope)>=minY&&y<=maxY)}return intersects}function applyTransform(extent,transformFn,opt_extent){var coordinates=[extent[0],extent[1],extent[0],extent[3],extent[2],extent[1],extent[2],extent[3]];return transformFn(coordinates,coordinates,2),_boundingExtentXYs([coordinates[0],coordinates[2],coordinates[4],coordinates[6]],[coordinates[1],coordinates[3],coordinates[5],coordinates[7]],opt_extent)}function getViewportClampedResolution(resolution,maxExtent,viewportSize){var xResolution=getWidth(maxExtent)/viewportSize[0],yResolution=getHeight(maxExtent)/viewportSize[1];return Math.min(resolution,Math.min(xResolution,yResolution))}function getSmoothClampedResolution(resolution,maxResolution,minResolution){var result=Math.min(resolution,maxResolution);return result*=Math.log(1+50*Math.max(0,resolution/maxResolution-1))/50+1,minResolution&&(result=Math.max(result,minResolution),result/=Math.log(1+50*Math.max(0,minResolution/resolution-1))/50+1),clamp(result,minResolution/2,2*maxResolution)}function createSnapToResolutions(resolutions,opt_smooth,opt_maxExtent){return function(resolution,direction,size,opt_isMoving){if(void 0!==resolution){var maxResolution=resolutions[0],minResolution=resolutions[resolutions.length-1],cappedMaxRes=opt_maxExtent?getViewportClampedResolution(maxResolution,opt_maxExtent,size):maxResolution;if(opt_isMoving)return void 0===opt_smooth||opt_smooth?getSmoothClampedResolution(resolution,cappedMaxRes,minResolution):clamp(resolution,minResolution,cappedMaxRes);var capped=Math.min(cappedMaxRes,resolution),z=Math.floor(linearFindNearest(resolutions,capped,direction));return resolutions[z]>cappedMaxRes&&z<resolutions.length-1?resolutions[z+1]:resolutions[z]}}}function createSnapToPower(power,maxResolution,opt_minResolution,opt_smooth,opt_maxExtent){return function(resolution,direction,size,opt_isMoving){if(void 0!==resolution){var cappedMaxRes=opt_maxExtent?getViewportClampedResolution(maxResolution,opt_maxExtent,size):maxResolution,minResolution=void 0!==opt_minResolution?opt_minResolution:0;if(opt_isMoving)return void 0===opt_smooth||opt_smooth?getSmoothClampedResolution(resolution,cappedMaxRes,minResolution):clamp(resolution,minResolution,cappedMaxRes);var minZoomLevel=Math.ceil(Math.log(maxResolution/cappedMaxRes)/Math.log(power)-1e-9),offset=-direction*(.5-1e-9)+.5,capped=Math.min(cappedMaxRes,resolution),cappedZoomLevel=Math.floor(Math.log(maxResolution/capped)/Math.log(power)+offset),zoomLevel=Math.max(minZoomLevel,cappedZoomLevel);return clamp(maxResolution/Math.pow(power,zoomLevel),minResolution,cappedMaxRes)}}}function createMinMaxResolution(maxResolution,minResolution,opt_smooth,opt_maxExtent){return function(resolution,direction,size,opt_isMoving){if(void 0!==resolution){var cappedMaxRes=opt_maxExtent?getViewportClampedResolution(maxResolution,opt_maxExtent,size):maxResolution;return(void 0===opt_smooth||opt_smooth)&&opt_isMoving?getSmoothClampedResolution(resolution,cappedMaxRes,minResolution):clamp(resolution,minResolution,cappedMaxRes)}}}function disable(rotation){return void 0!==rotation?0:void 0}function none$1(rotation){return void 0!==rotation?rotation:void 0}function createSnapToN(n){var theta=2*Math.PI/n;return function(rotation,opt_isMoving){return opt_isMoving?rotation:void 0!==rotation?rotation=Math.floor(rotation/theta+.5)*theta:void 0}}function createSnapToZero(opt_tolerance){var tolerance=opt_tolerance||toRadians(5);return function(rotation,opt_isMoving){return opt_isMoving?rotation:void 0!==rotation?Math.abs(rotation)<=tolerance?0:rotation:void 0}}var ViewHint={ANIMATING:0,INTERACTING:1},ViewProperty={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function add(coordinate,delta){return coordinate[0]+=+delta[0],coordinate[1]+=+delta[1],coordinate}function equals$2(coordinate1,coordinate2){for(var equals=!0,i=coordinate1.length-1;i>=0;--i)if(coordinate1[i]!=coordinate2[i]){equals=!1;break}return equals}function rotate(coordinate,angle){var cosAngle=Math.cos(angle),sinAngle=Math.sin(angle),x=coordinate[0]*cosAngle-coordinate[1]*sinAngle,y=coordinate[1]*cosAngle+coordinate[0]*sinAngle;return coordinate[0]=x,coordinate[1]=y,coordinate}function scale(coordinate,scale){return coordinate[0]*=scale,coordinate[1]*=scale,coordinate}function squaredDistance$1(coord1,coord2){var dx=coord1[0]-coord2[0],dy=coord1[1]-coord2[1];return dx*dx+dy*dy}function easeIn(t){return Math.pow(t,3)}function easeOut(t){return 1-easeIn(1-t)}function inAndOut(t){return 3*t*t-2*t*t*t}function linear(t){return t}var GeometryType={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},GeometryLayout={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"};function transform2D(flatCoordinates,offset,end,stride,transform,opt_dest){for(var dest=opt_dest||[],i=0,j=offset;j<end;j+=stride){var x=flatCoordinates[j],y=flatCoordinates[j+1];dest[i++]=transform[0]*x+transform[2]*y+transform[4],dest[i++]=transform[1]*x+transform[3]*y+transform[5]}return opt_dest&&dest.length!=i&&(dest.length=i),dest}function rotate$1(flatCoordinates,offset,end,stride,angle,anchor,opt_dest){for(var dest=opt_dest||[],cos=Math.cos(angle),sin=Math.sin(angle),anchorX=anchor[0],anchorY=anchor[1],i=0,j=offset;j<end;j+=stride){var deltaX=flatCoordinates[j]-anchorX,deltaY=flatCoordinates[j+1]-anchorY;dest[i++]=anchorX+deltaX*cos-deltaY*sin,dest[i++]=anchorY+deltaX*sin+deltaY*cos;for(var k=j+2;k<j+stride;++k)dest[i++]=flatCoordinates[k]}return opt_dest&&dest.length!=i&&(dest.length=i),dest}function scale$1(flatCoordinates,offset,end,stride,sx,sy,anchor,opt_dest){for(var dest=opt_dest||[],anchorX=anchor[0],anchorY=anchor[1],i=0,j=offset;j<end;j+=stride){var deltaX=flatCoordinates[j]-anchorX,deltaY=flatCoordinates[j+1]-anchorY;dest[i++]=anchorX+sx*deltaX,dest[i++]=anchorY+sy*deltaY;for(var k=j+2;k<j+stride;++k)dest[i++]=flatCoordinates[k]}return opt_dest&&dest.length!=i&&(dest.length=i),dest}function translate(flatCoordinates,offset,end,stride,deltaX,deltaY,opt_dest){for(var dest=opt_dest||[],i=0,j=offset;j<end;j+=stride){dest[i++]=flatCoordinates[j]+deltaX,dest[i++]=flatCoordinates[j+1]+deltaY;for(var k=j+2;k<j+stride;++k)dest[i++]=flatCoordinates[k]}return opt_dest&&dest.length!=i&&(dest.length=i),dest}var DEFAULT_RADIUS=6371008.8;function getDistance(c1,c2,opt_radius){var radius=opt_radius||DEFAULT_RADIUS,lat1=toRadians(c1[1]),lat2=toRadians(c2[1]),deltaLatBy2=(lat2-lat1)/2,deltaLonBy2=toRadians(c2[0]-c1[0])/2,a=Math.sin(deltaLatBy2)*Math.sin(deltaLatBy2)+Math.sin(deltaLonBy2)*Math.sin(deltaLonBy2)*Math.cos(lat1)*Math.cos(lat2);return 2*radius*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}var Units={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},METERS_PER_UNIT={};METERS_PER_UNIT[Units.DEGREES]=2*Math.PI*6370997/360,METERS_PER_UNIT[Units.FEET]=.3048,METERS_PER_UNIT[Units.METERS]=1,METERS_PER_UNIT[Units.USFEET]=1200/3937;var Projection=function(){function Projection(options){this.code_=options.code,this.units_=options.units,this.extent_=void 0!==options.extent?options.extent:null,this.worldExtent_=void 0!==options.worldExtent?options.worldExtent:null,this.axisOrientation_=void 0!==options.axisOrientation?options.axisOrientation:"enu",this.global_=void 0!==options.global&&options.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=options.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=options.metersPerUnit}return Projection.prototype.canWrapX=function(){return this.canWrapX_},Projection.prototype.getCode=function(){return this.code_},Projection.prototype.getExtent=function(){return this.extent_},Projection.prototype.getUnits=function(){return this.units_},Projection.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||METERS_PER_UNIT[this.units_]},Projection.prototype.getWorldExtent=function(){return this.worldExtent_},Projection.prototype.getAxisOrientation=function(){return this.axisOrientation_},Projection.prototype.isGlobal=function(){return this.global_},Projection.prototype.setGlobal=function(global){this.global_=global,this.canWrapX_=!(!global||!this.extent_)},Projection.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},Projection.prototype.setDefaultTileGrid=function(tileGrid){this.defaultTileGrid_=tileGrid},Projection.prototype.setExtent=function(extent){this.extent_=extent,this.canWrapX_=!(!this.global_||!extent)},Projection.prototype.setWorldExtent=function(worldExtent){this.worldExtent_=worldExtent},Projection.prototype.setGetPointResolution=function(func){this.getPointResolutionFunc_=func},Projection.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},Projection}(),RADIUS=6378137,HALF_SIZE=Math.PI*RADIUS,EXTENT=[-HALF_SIZE,-HALF_SIZE,HALF_SIZE,HALF_SIZE],WORLD_EXTENT=[-180,-85,180,85],EPSG3857Projection=function(_super){function EPSG3857Projection(code){return _super.call(this,{code:code,units:Units.METERS,extent:EXTENT,global:!0,worldExtent:WORLD_EXTENT,getPointResolution:function(resolution,point){return resolution/cosh(point[1]/RADIUS)}})||this}return __extends(EPSG3857Projection,_super),EPSG3857Projection}(Projection),PROJECTIONS=[new EPSG3857Projection("EPSG:3857"),new EPSG3857Projection("EPSG:102100"),new EPSG3857Projection("EPSG:102113"),new EPSG3857Projection("EPSG:900913"),new EPSG3857Projection("urn:ogc:def:crs:EPSG:6.18:3:3857"),new EPSG3857Projection("urn:ogc:def:crs:EPSG::3857"),new EPSG3857Projection("http://www.opengis.net/gml/srs/epsg.xml#3857")];function fromEPSG4326(input,opt_output,opt_dimension){var length=input.length,dimension=opt_dimension>1?opt_dimension:2,output=opt_output;void 0===output&&(output=dimension>2?input.slice():new Array(length));for(var halfSize=HALF_SIZE,i=0;i<length;i+=dimension){output[i]=halfSize*input[i]/180;var y=RADIUS*Math.log(Math.tan(Math.PI*(+input[i+1]+90)/360));y>halfSize?y=halfSize:y<-halfSize&&(y=-halfSize),output[i+1]=y}return output}function toEPSG4326(input,opt_output,opt_dimension){var length=input.length,dimension=opt_dimension>1?opt_dimension:2,output=opt_output;void 0===output&&(output=dimension>2?input.slice():new Array(length));for(var i=0;i<length;i+=dimension)output[i]=180*input[i]/HALF_SIZE,output[i+1]=360*Math.atan(Math.exp(input[i+1]/RADIUS))/Math.PI-90;return output}var RADIUS$1=6378137,EXTENT$1=[-180,-90,180,90],METERS_PER_UNIT$1=Math.PI*RADIUS$1/180,EPSG4326Projection=function(_super){function EPSG4326Projection(code,opt_axisOrientation){return _super.call(this,{code:code,units:Units.DEGREES,extent:EXTENT$1,axisOrientation:opt_axisOrientation,global:!0,metersPerUnit:METERS_PER_UNIT$1,worldExtent:EXTENT$1})||this}return __extends(EPSG4326Projection,_super),EPSG4326Projection}(Projection),PROJECTIONS$1=[new EPSG4326Projection("CRS:84"),new EPSG4326Projection("EPSG:4326","neu"),new EPSG4326Projection("urn:ogc:def:crs:EPSG::4326","neu"),new EPSG4326Projection("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new EPSG4326Projection("urn:ogc:def:crs:OGC:1.3:CRS84"),new EPSG4326Projection("urn:ogc:def:crs:OGC:2:84"),new EPSG4326Projection("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new EPSG4326Projection("urn:x-ogc:def:crs:EPSG:4326","neu")],transforms={};function add$1(source,destination,transformFn){var sourceCode=source.getCode(),destinationCode=destination.getCode();sourceCode in transforms||(transforms[sourceCode]={}),transforms[sourceCode][destinationCode]=transformFn}function get(sourceCode,destinationCode){var transform;return sourceCode in transforms&&destinationCode in transforms[sourceCode]&&(transform=transforms[sourceCode][destinationCode]),transform}var cache={};function get$1(code){return cache[code]||null}function add$2(code,projection){cache[code]=projection}function cloneTransform(input,opt_output,opt_dimension){var output;if(void 0!==opt_output){for(var i=0,ii=input.length;i<ii;++i)opt_output[i]=input[i];output=opt_output}else output=input.slice();return output}function identityTransform(input,opt_output,opt_dimension){if(void 0!==opt_output&&input!==opt_output){for(var i=0,ii=input.length;i<ii;++i)opt_output[i]=input[i];input=opt_output}return input}function addProjection(projection){add$2(projection.getCode(),projection),add$1(projection,projection,cloneTransform)}function addProjections(projections){projections.forEach(addProjection)}function get$2(projectionLike){return"string"==typeof projectionLike?get$1(projectionLike):projectionLike||null}function getPointResolution(projection,resolution,point,opt_units){var pointResolution,getter=(projection=get$2(projection)).getPointResolutionFunc();if(getter)pointResolution=getter(resolution,point),opt_units&&opt_units!==projection.getUnits()&&(metersPerUnit=projection.getMetersPerUnit())&&(pointResolution=pointResolution*metersPerUnit/METERS_PER_UNIT[opt_units]);else if(projection.getUnits()==Units.DEGREES&&!opt_units||opt_units==Units.DEGREES)pointResolution=resolution;else{var metersPerUnit,toEPSG4326_1=getTransformFromProjections(projection,get$2("EPSG:4326")),vertices=[point[0]-resolution/2,point[1],point[0]+resolution/2,point[1],point[0],point[1]-resolution/2,point[0],point[1]+resolution/2];pointResolution=(getDistance((vertices=toEPSG4326_1(vertices,vertices,2)).slice(0,2),vertices.slice(2,4))+getDistance(vertices.slice(4,6),vertices.slice(6,8)))/2,void 0!==(metersPerUnit=opt_units?METERS_PER_UNIT[opt_units]:projection.getMetersPerUnit())&&(pointResolution/=metersPerUnit)}return pointResolution}function addEquivalentProjections(projections){addProjections(projections),projections.forEach(function(source){projections.forEach(function(destination){source!==destination&&add$1(source,destination,cloneTransform)})})}function addEquivalentTransforms(projections1,projections2,forwardTransform,inverseTransform){projections1.forEach(function(projection1){projections2.forEach(function(projection2){add$1(projection1,projection2,forwardTransform),add$1(projection2,projection1,inverseTransform)})})}function createProjection(projection,defaultCode){return projection?"string"==typeof projection?get$2(projection):projection:get$2(defaultCode)}function equivalent(projection1,projection2){if(projection1===projection2)return!0;var equalUnits=projection1.getUnits()===projection2.getUnits();return projection1.getCode()===projection2.getCode()?equalUnits:getTransformFromProjections(projection1,projection2)===cloneTransform&&equalUnits}function getTransformFromProjections(sourceProjection,destinationProjection){var transformFunc=get(sourceProjection.getCode(),destinationProjection.getCode());return transformFunc||(transformFunc=identityTransform),transformFunc}function getTransform(source,destination){return getTransformFromProjections(get$2(source),get$2(destination))}function transform(coordinate,source,destination){return getTransform(source,destination)(coordinate,void 0,coordinate.length)}function transformExtent(extent,source,destination){return applyTransform(extent,getTransform(source,destination))}var userProjection=null;function getUserProjection(){return userProjection}function toUserCoordinate(coordinate,sourceProjection){return userProjection?transform(coordinate,sourceProjection,userProjection):coordinate}function fromUserCoordinate(coordinate,destProjection){return userProjection?transform(coordinate,userProjection,destProjection):coordinate}function toUserExtent(extent,sourceProjection){return userProjection?transformExtent(extent,sourceProjection,userProjection):extent}function fromUserExtent(extent,destProjection){return userProjection?transformExtent(extent,userProjection,destProjection):extent}function addCommon(){addEquivalentProjections(PROJECTIONS),addEquivalentProjections(PROJECTIONS$1),addEquivalentTransforms(PROJECTIONS$1,PROJECTIONS,fromEPSG4326,toEPSG4326)}function create(){return[1,0,0,1,0,0]}function set(transform,a,b,c,d,e,f){return transform[0]=a,transform[1]=b,transform[2]=c,transform[3]=d,transform[4]=e,transform[5]=f,transform}function setFromArray(transform1,transform2){return transform1[0]=transform2[0],transform1[1]=transform2[1],transform1[2]=transform2[2],transform1[3]=transform2[3],transform1[4]=transform2[4],transform1[5]=transform2[5],transform1}function apply(transform,coordinate){var x=coordinate[0],y=coordinate[1];return coordinate[0]=transform[0]*x+transform[2]*y+transform[4],coordinate[1]=transform[1]*x+transform[3]*y+transform[5],coordinate}function makeScale(target,x,y){return set(target,x,0,0,y,0,0)}function compose(transform,dx1,dy1,sx,sy,angle,dx2,dy2){var sin=Math.sin(angle),cos=Math.cos(angle);return transform[0]=sx*cos,transform[1]=sy*sin,transform[2]=-sx*sin,transform[3]=sy*cos,transform[4]=dx2*sx*cos-dy2*sx*sin+dx1,transform[5]=dx2*sy*sin+dy2*sy*cos+dy1,transform}function makeInverse(target,source){var det=determinant(source);assert(0!==det,32);var a=source[0],b=source[1],c=source[2],d=source[3],e=source[4],f=source[5];return target[0]=d/det,target[1]=-b/det,target[2]=-c/det,target[3]=a/det,target[4]=(c*f-d*e)/det,target[5]=-(a*f-b*e)/det,target}function determinant(mat){return mat[0]*mat[3]-mat[1]*mat[2]}function toString(mat){return"matrix("+mat.join(", ")+")"}addCommon();var tmpTransform=create(),Geometry=function(_super){function Geometry(){var _this=_super.call(this)||this;return _this.extent_=createEmpty(),_this.extentRevision_=-1,_this.simplifiedGeometryMaxMinSquaredTolerance=0,_this.simplifiedGeometryRevision=0,_this.simplifyTransformedInternal=memoizeOne(function(revision,squaredTolerance,opt_transform){if(!opt_transform)return this.getSimplifiedGeometry(squaredTolerance);var clone=this.clone();return clone.applyTransform(opt_transform),clone.getSimplifiedGeometry(squaredTolerance)}),_this}return __extends(Geometry,_super),Geometry.prototype.simplifyTransformed=function(squaredTolerance,opt_transform){return this.simplifyTransformedInternal(this.getRevision(),squaredTolerance,opt_transform)},Geometry.prototype.clone=function(){return abstract()},Geometry.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return abstract()},Geometry.prototype.containsXY=function(x,y){var coord=this.getClosestPoint([x,y]);return coord[0]===x&&coord[1]===y},Geometry.prototype.getClosestPoint=function(point,opt_closestPoint){var closestPoint=opt_closestPoint||[NaN,NaN];return this.closestPointXY(point[0],point[1],closestPoint,1/0),closestPoint},Geometry.prototype.intersectsCoordinate=function(coordinate){return this.containsXY(coordinate[0],coordinate[1])},Geometry.prototype.computeExtent=function(extent){return abstract()},Geometry.prototype.getExtent=function(opt_extent){return this.extentRevision_!=this.getRevision()&&(this.extent_=this.computeExtent(this.extent_),this.extentRevision_=this.getRevision()),returnOrUpdate(this.extent_,opt_extent)},Geometry.prototype.rotate=function(angle,anchor){abstract()},Geometry.prototype.scale=function(sx,opt_sy,opt_anchor){abstract()},Geometry.prototype.simplify=function(tolerance){return this.getSimplifiedGeometry(tolerance*tolerance)},Geometry.prototype.getSimplifiedGeometry=function(squaredTolerance){return abstract()},Geometry.prototype.getType=function(){return abstract()},Geometry.prototype.applyTransform=function(transformFn){abstract()},Geometry.prototype.intersectsExtent=function(extent){return abstract()},Geometry.prototype.translate=function(deltaX,deltaY){abstract()},Geometry.prototype.transform=function(source,destination){var sourceProj=get$2(source),transformFn=sourceProj.getUnits()==Units.TILE_PIXELS?function(inCoordinates,outCoordinates,stride){var pixelExtent=sourceProj.getExtent(),projectedExtent=sourceProj.getWorldExtent(),scale=getHeight(projectedExtent)/getHeight(pixelExtent);return compose(tmpTransform,projectedExtent[0],projectedExtent[3],scale,-scale,0,0,0),transform2D(inCoordinates,0,inCoordinates.length,stride,tmpTransform,outCoordinates),getTransform(sourceProj,destination)(inCoordinates,outCoordinates,stride)}:getTransform(sourceProj,destination);return this.applyTransform(transformFn),this},Geometry}(BaseObject),SimpleGeometry=function(_super){function SimpleGeometry(){var _this=_super.call(this)||this;return _this.layout=GeometryLayout.XY,_this.stride=2,_this.flatCoordinates=null,_this}return __extends(SimpleGeometry,_super),SimpleGeometry.prototype.computeExtent=function(extent){return createOrUpdateFromFlatCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,extent)},SimpleGeometry.prototype.getCoordinates=function(){return abstract()},SimpleGeometry.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},SimpleGeometry.prototype.getFlatCoordinates=function(){return this.flatCoordinates},SimpleGeometry.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},SimpleGeometry.prototype.getLayout=function(){return this.layout},SimpleGeometry.prototype.getSimplifiedGeometry=function(squaredTolerance){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),squaredTolerance<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&squaredTolerance<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var simplifiedGeometry=this.getSimplifiedGeometryInternal(squaredTolerance);return simplifiedGeometry.getFlatCoordinates().length<this.flatCoordinates.length?simplifiedGeometry:(this.simplifiedGeometryMaxMinSquaredTolerance=squaredTolerance,this)},SimpleGeometry.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){return this},SimpleGeometry.prototype.getStride=function(){return this.stride},SimpleGeometry.prototype.setFlatCoordinates=function(layout,flatCoordinates){this.stride=getStrideForLayout(layout),this.layout=layout,this.flatCoordinates=flatCoordinates},SimpleGeometry.prototype.setCoordinates=function(coordinates,opt_layout){abstract()},SimpleGeometry.prototype.setLayout=function(layout,coordinates,nesting){var stride;if(layout)stride=getStrideForLayout(layout);else{for(var i=0;i<nesting;++i){if(0===coordinates.length)return this.layout=GeometryLayout.XY,void(this.stride=2);coordinates=coordinates[0]}layout=getLayoutForStride(stride=coordinates.length)}this.layout=layout,this.stride=stride},SimpleGeometry.prototype.applyTransform=function(transformFn){this.flatCoordinates&&(transformFn(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},SimpleGeometry.prototype.rotate=function(angle,anchor){var flatCoordinates=this.getFlatCoordinates();if(flatCoordinates){var stride=this.getStride();rotate$1(flatCoordinates,0,flatCoordinates.length,stride,angle,anchor,flatCoordinates),this.changed()}},SimpleGeometry.prototype.scale=function(sx,opt_sy,opt_anchor){var sy=opt_sy;void 0===sy&&(sy=sx);var anchor=opt_anchor;anchor||(anchor=getCenter(this.getExtent()));var flatCoordinates=this.getFlatCoordinates();if(flatCoordinates){var stride=this.getStride();scale$1(flatCoordinates,0,flatCoordinates.length,stride,sx,sy,anchor,flatCoordinates),this.changed()}},SimpleGeometry.prototype.translate=function(deltaX,deltaY){var flatCoordinates=this.getFlatCoordinates();if(flatCoordinates){var stride=this.getStride();translate(flatCoordinates,0,flatCoordinates.length,stride,deltaX,deltaY,flatCoordinates),this.changed()}},SimpleGeometry}(Geometry);function getLayoutForStride(stride){var layout;return 2==stride?layout=GeometryLayout.XY:3==stride?layout=GeometryLayout.XYZ:4==stride&&(layout=GeometryLayout.XYZM),layout}function getStrideForLayout(layout){var stride;return layout==GeometryLayout.XY?stride=2:layout==GeometryLayout.XYZ||layout==GeometryLayout.XYM?stride=3:layout==GeometryLayout.XYZM&&(stride=4),stride}function linearRing(flatCoordinates,offset,end,stride){for(var twiceArea=0,x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1];offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1];twiceArea+=y1*x2-x1*y2,x1=x2,y1=y2}return twiceArea/2}function linearRings(flatCoordinates,offset,ends,stride){for(var area=0,i=0,ii=ends.length;i<ii;++i){var end=ends[i];area+=linearRing(flatCoordinates,offset,end,stride),offset=end}return area}function linearRingss(flatCoordinates,offset,endss,stride){for(var area=0,i=0,ii=endss.length;i<ii;++i){var ends=endss[i];area+=linearRings(flatCoordinates,offset,ends,stride),offset=ends[ends.length-1]}return area}function assignClosest(flatCoordinates,offset1,offset2,stride,x,y,closestPoint){var offset,x1=flatCoordinates[offset1],y1=flatCoordinates[offset1+1],dx=flatCoordinates[offset2]-x1,dy=flatCoordinates[offset2+1]-y1;if(0===dx&&0===dy)offset=offset1;else{var t=((x-x1)*dx+(y-y1)*dy)/(dx*dx+dy*dy);if(t>1)offset=offset2;else{if(t>0){for(var i=0;i<stride;++i)closestPoint[i]=lerp(flatCoordinates[offset1+i],flatCoordinates[offset2+i],t);return void(closestPoint.length=stride)}offset=offset1}}for(i=0;i<stride;++i)closestPoint[i]=flatCoordinates[offset+i];closestPoint.length=stride}function maxSquaredDelta(flatCoordinates,offset,end,stride,max){var x1=flatCoordinates[offset],y1=flatCoordinates[offset+1];for(offset+=stride;offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1],squaredDelta=squaredDistance(x1,y1,x2,y2);squaredDelta>max&&(max=squaredDelta),x1=x2,y1=y2}return max}function arrayMaxSquaredDelta(flatCoordinates,offset,ends,stride,max){for(var i=0,ii=ends.length;i<ii;++i){var end=ends[i];max=maxSquaredDelta(flatCoordinates,offset,end,stride,max),offset=end}return max}function multiArrayMaxSquaredDelta(flatCoordinates,offset,endss,stride,max){for(var i=0,ii=endss.length;i<ii;++i){var ends=endss[i];max=arrayMaxSquaredDelta(flatCoordinates,offset,ends,stride,max),offset=ends[ends.length-1]}return max}function assignClosestPoint(flatCoordinates,offset,end,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,opt_tmpPoint){if(offset==end)return minSquaredDistance;var i,squaredDistance$1;if(0===maxDelta){if((squaredDistance$1=squaredDistance(x,y,flatCoordinates[offset],flatCoordinates[offset+1]))<minSquaredDistance){for(i=0;i<stride;++i)closestPoint[i]=flatCoordinates[offset+i];return closestPoint.length=stride,squaredDistance$1}return minSquaredDistance}for(var tmpPoint=opt_tmpPoint||[NaN,NaN],index=offset+stride;index<end;)if(assignClosest(flatCoordinates,index-stride,index,stride,x,y,tmpPoint),(squaredDistance$1=squaredDistance(x,y,tmpPoint[0],tmpPoint[1]))<minSquaredDistance){for(minSquaredDistance=squaredDistance$1,i=0;i<stride;++i)closestPoint[i]=tmpPoint[i];closestPoint.length=stride,index+=stride}else index+=stride*Math.max((Math.sqrt(squaredDistance$1)-Math.sqrt(minSquaredDistance))/maxDelta|0,1);if(isRing&&(assignClosest(flatCoordinates,end-stride,offset,stride,x,y,tmpPoint),(squaredDistance$1=squaredDistance(x,y,tmpPoint[0],tmpPoint[1]))<minSquaredDistance)){for(minSquaredDistance=squaredDistance$1,i=0;i<stride;++i)closestPoint[i]=tmpPoint[i];closestPoint.length=stride}return minSquaredDistance}function assignClosestArrayPoint(flatCoordinates,offset,ends,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,opt_tmpPoint){for(var tmpPoint=opt_tmpPoint||[NaN,NaN],i=0,ii=ends.length;i<ii;++i){var end=ends[i];minSquaredDistance=assignClosestPoint(flatCoordinates,offset,end,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,tmpPoint),offset=end}return minSquaredDistance}function assignClosestMultiArrayPoint(flatCoordinates,offset,endss,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,opt_tmpPoint){for(var tmpPoint=opt_tmpPoint||[NaN,NaN],i=0,ii=endss.length;i<ii;++i){var ends=endss[i];minSquaredDistance=assignClosestArrayPoint(flatCoordinates,offset,ends,stride,maxDelta,isRing,x,y,closestPoint,minSquaredDistance,tmpPoint),offset=ends[ends.length-1]}return minSquaredDistance}function deflateCoordinate(flatCoordinates,offset,coordinate,stride){for(var i=0,ii=coordinate.length;i<ii;++i)flatCoordinates[offset++]=coordinate[i];return offset}function deflateCoordinates(flatCoordinates,offset,coordinates,stride){for(var i=0,ii=coordinates.length;i<ii;++i)for(var coordinate=coordinates[i],j=0;j<stride;++j)flatCoordinates[offset++]=coordinate[j];return offset}function deflateCoordinatesArray(flatCoordinates,offset,coordinatess,stride,opt_ends){for(var ends=opt_ends||[],i=0,j=0,jj=coordinatess.length;j<jj;++j){var end=deflateCoordinates(flatCoordinates,offset,coordinatess[j],stride);ends[i++]=end,offset=end}return ends.length=i,ends}function deflateMultiCoordinatesArray(flatCoordinates,offset,coordinatesss,stride,opt_endss){for(var endss=opt_endss||[],i=0,j=0,jj=coordinatesss.length;j<jj;++j){var ends=deflateCoordinatesArray(flatCoordinates,offset,coordinatesss[j],stride,endss[i]);endss[i++]=ends,offset=ends[ends.length-1]}return endss.length=i,endss}function inflateCoordinates(flatCoordinates,offset,end,stride,opt_coordinates){for(var coordinates=void 0!==opt_coordinates?opt_coordinates:[],i=0,j=offset;j<end;j+=stride)coordinates[i++]=flatCoordinates.slice(j,j+stride);return coordinates.length=i,coordinates}function inflateCoordinatesArray(flatCoordinates,offset,ends,stride,opt_coordinatess){for(var coordinatess=void 0!==opt_coordinatess?opt_coordinatess:[],i=0,j=0,jj=ends.length;j<jj;++j){var end=ends[j];coordinatess[i++]=inflateCoordinates(flatCoordinates,offset,end,stride,coordinatess[i]),offset=end}return coordinatess.length=i,coordinatess}function inflateMultiCoordinatesArray(flatCoordinates,offset,endss,stride,opt_coordinatesss){for(var coordinatesss=void 0!==opt_coordinatesss?opt_coordinatesss:[],i=0,j=0,jj=endss.length;j<jj;++j){var ends=endss[j];coordinatesss[i++]=inflateCoordinatesArray(flatCoordinates,offset,ends,stride,coordinatesss[i]),offset=ends[ends.length-1]}return coordinatesss.length=i,coordinatesss}function douglasPeucker(flatCoordinates,offset,end,stride,squaredTolerance,simplifiedFlatCoordinates,simplifiedOffset){var n=(end-offset)/stride;if(n<3){for(;offset<end;offset+=stride)simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset],simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset+1];return simplifiedOffset}var markers=new Array(n);markers[0]=1,markers[n-1]=1;for(var stack=[offset,end-stride],index=0;stack.length>0;){for(var last=stack.pop(),first=stack.pop(),maxSquaredDistance=0,x1=flatCoordinates[first],y1=flatCoordinates[first+1],x2=flatCoordinates[last],y2=flatCoordinates[last+1],i=first+stride;i<last;i+=stride){var squaredDistance_1=squaredSegmentDistance(flatCoordinates[i],flatCoordinates[i+1],x1,y1,x2,y2);squaredDistance_1>maxSquaredDistance&&(index=i,maxSquaredDistance=squaredDistance_1)}maxSquaredDistance>squaredTolerance&&(markers[(index-offset)/stride]=1,first+stride<index&&stack.push(first,index),index+stride<last&&stack.push(index,last))}for(i=0;i<n;++i)markers[i]&&(simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset+i*stride],simplifiedFlatCoordinates[simplifiedOffset++]=flatCoordinates[offset+i*stride+1]);return simplifiedOffset}function douglasPeuckerArray(flatCoordinates,offset,ends,stride,squaredTolerance,simplifiedFlatCoordinates,simplifiedOffset,simplifiedEnds){for(var i=0,ii=ends.length;i<ii;++i){var end=ends[i];simplifiedOffset=douglasPeucker(flatCoordinates,offset,end,stride,squaredTolerance,simplifiedFlatCoordinates,simplifiedOffset),simplifiedEnds.push(simplifiedOffset),offset=end}return simplifiedOffset}function snap(value,tolerance){return tolerance*Math.round(value/tolerance)}function quantize(flatCoordinates,offset,end,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset){if(offset==end)return simplifiedOffset;var x2,y2,x1=snap(flatCoordinates[offset],tolerance),y1=snap(flatCoordinates[offset+1],tolerance);offset+=stride,simplifiedFlatCoordinates[simplifiedOffset++]=x1,simplifiedFlatCoordinates[simplifiedOffset++]=y1;do{if(x2=snap(flatCoordinates[offset],tolerance),y2=snap(flatCoordinates[offset+1],tolerance),(offset+=stride)==end)return simplifiedFlatCoordinates[simplifiedOffset++]=x2,simplifiedFlatCoordinates[simplifiedOffset++]=y2,simplifiedOffset}while(x2==x1&&y2==y1);for(;offset<end;){var x3=snap(flatCoordinates[offset],tolerance),y3=snap(flatCoordinates[offset+1],tolerance);if(offset+=stride,x3!=x2||y3!=y2){var dx1=x2-x1,dy1=y2-y1,dx2=x3-x1,dy2=y3-y1;dx1*dy2==dy1*dx2&&(dx1<0&&dx2<dx1||dx1==dx2||dx1>0&&dx2>dx1)&&(dy1<0&&dy2<dy1||dy1==dy2||dy1>0&&dy2>dy1)?(x2=x3,y2=y3):(simplifiedFlatCoordinates[simplifiedOffset++]=x2,simplifiedFlatCoordinates[simplifiedOffset++]=y2,x1=x2,y1=y2,x2=x3,y2=y3)}}return simplifiedFlatCoordinates[simplifiedOffset++]=x2,simplifiedFlatCoordinates[simplifiedOffset++]=y2,simplifiedOffset}function quantizeArray(flatCoordinates,offset,ends,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset,simplifiedEnds){for(var i=0,ii=ends.length;i<ii;++i){var end=ends[i];simplifiedOffset=quantize(flatCoordinates,offset,end,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset),simplifiedEnds.push(simplifiedOffset),offset=end}return simplifiedOffset}function quantizeMultiArray(flatCoordinates,offset,endss,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset,simplifiedEndss){for(var i=0,ii=endss.length;i<ii;++i){var ends=endss[i],simplifiedEnds=[];simplifiedOffset=quantizeArray(flatCoordinates,offset,ends,stride,tolerance,simplifiedFlatCoordinates,simplifiedOffset,simplifiedEnds),simplifiedEndss.push(simplifiedEnds),offset=ends[ends.length-1]}return simplifiedOffset}var LinearRing=function(_super){function LinearRing(coordinates,opt_layout){var _this=_super.call(this)||this;return _this.maxDelta_=-1,_this.maxDeltaRevision_=-1,void 0===opt_layout||Array.isArray(coordinates[0])?_this.setCoordinates(coordinates,opt_layout):_this.setFlatCoordinates(opt_layout,coordinates),_this}return __extends(LinearRing,_super),LinearRing.prototype.clone=function(){return new LinearRing(this.flatCoordinates.slice(),this.layout)},LinearRing.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y)?minSquaredDistance:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,x,y,closestPoint,minSquaredDistance))},LinearRing.prototype.getArea=function(){return linearRing(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},LinearRing.prototype.getCoordinates=function(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},LinearRing.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){var simplifiedFlatCoordinates=[];return simplifiedFlatCoordinates.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,squaredTolerance,simplifiedFlatCoordinates,0),new LinearRing(simplifiedFlatCoordinates,GeometryLayout.XY)},LinearRing.prototype.getType=function(){return GeometryType.LINEAR_RING},LinearRing.prototype.intersectsExtent=function(extent){return!1},LinearRing.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,coordinates,this.stride),this.changed()},LinearRing}(SimpleGeometry),Point=function(_super){function Point(coordinates,opt_layout){var _this=_super.call(this)||this;return _this.setCoordinates(coordinates,opt_layout),_this}return __extends(Point,_super),Point.prototype.clone=function(){return new Point(this.flatCoordinates.slice(),this.layout)},Point.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){var flatCoordinates=this.flatCoordinates,squaredDistance$1=squaredDistance(x,y,flatCoordinates[0],flatCoordinates[1]);if(squaredDistance$1<minSquaredDistance){for(var stride=this.stride,i=0;i<stride;++i)closestPoint[i]=flatCoordinates[i];return closestPoint.length=stride,squaredDistance$1}return minSquaredDistance},Point.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},Point.prototype.computeExtent=function(extent){return createOrUpdateFromCoordinate(this.flatCoordinates,extent)},Point.prototype.getType=function(){return GeometryType.POINT},Point.prototype.intersectsExtent=function(extent){return containsXY(extent,this.flatCoordinates[0],this.flatCoordinates[1])},Point.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinate(this.flatCoordinates,0,coordinates,this.stride),this.changed()},Point}(SimpleGeometry);function linearRingContainsExtent(flatCoordinates,offset,end,stride,extent){return!forEachCorner(extent,function(coordinate){return!linearRingContainsXY(flatCoordinates,offset,end,stride,coordinate[0],coordinate[1])})}function linearRingContainsXY(flatCoordinates,offset,end,stride,x,y){for(var wn=0,x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1];offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1];y1<=y?y2>y&&(x2-x1)*(y-y1)-(x-x1)*(y2-y1)>0&&wn++:y2<=y&&(x2-x1)*(y-y1)-(x-x1)*(y2-y1)<0&&wn--,x1=x2,y1=y2}return 0!==wn}function linearRingsContainsXY(flatCoordinates,offset,ends,stride,x,y){if(0===ends.length)return!1;if(!linearRingContainsXY(flatCoordinates,offset,ends[0],stride,x,y))return!1;for(var i=1,ii=ends.length;i<ii;++i)if(linearRingContainsXY(flatCoordinates,ends[i-1],ends[i],stride,x,y))return!1;return!0}function linearRingssContainsXY(flatCoordinates,offset,endss,stride,x,y){if(0===endss.length)return!1;for(var i=0,ii=endss.length;i<ii;++i){var ends=endss[i];if(linearRingsContainsXY(flatCoordinates,offset,ends,stride,x,y))return!0;offset=ends[ends.length-1]}return!1}function getInteriorPointOfArray(flatCoordinates,offset,ends,stride,flatCenters,flatCentersOffset,opt_dest){for(var i,ii,x,x1,x2,y1,y2,y=flatCenters[flatCentersOffset+1],intersections=[],r=0,rr=ends.length;r<rr;++r){var end=ends[r];for(x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1],i=offset;i<end;i+=stride)x2=flatCoordinates[i],y2=flatCoordinates[i+1],(y<=y1&&y2<=y||y1<=y&&y<=y2)&&(x=(y-y1)/(y2-y1)*(x2-x1)+x1,intersections.push(x)),x1=x2,y1=y2}var pointX=NaN,maxSegmentLength=-1/0;for(intersections.sort(numberSafeCompareFunction),x1=intersections[0],i=1,ii=intersections.length;i<ii;++i){x2=intersections[i];var segmentLength=Math.abs(x2-x1);segmentLength>maxSegmentLength&&linearRingsContainsXY(flatCoordinates,offset,ends,stride,x=(x1+x2)/2,y)&&(pointX=x,maxSegmentLength=segmentLength),x1=x2}return isNaN(pointX)&&(pointX=flatCenters[flatCentersOffset]),opt_dest?(opt_dest.push(pointX,y,maxSegmentLength),opt_dest):[pointX,y,maxSegmentLength]}function getInteriorPointsOfMultiArray(flatCoordinates,offset,endss,stride,flatCenters){for(var interiorPoints=[],i=0,ii=endss.length;i<ii;++i){var ends=endss[i];interiorPoints=getInteriorPointOfArray(flatCoordinates,offset,ends,stride,flatCenters,2*i,interiorPoints),offset=ends[ends.length-1]}return interiorPoints}function forEach(flatCoordinates,offset,end,stride,callback){for(var ret,point1=[flatCoordinates[offset],flatCoordinates[offset+1]],point2=[];offset+stride<end;offset+=stride){if(point2[0]=flatCoordinates[offset+stride],point2[1]=flatCoordinates[offset+stride+1],ret=callback(point1,point2))return ret;point1[0]=point2[0],point1[1]=point2[1]}return!1}function intersectsLineString(flatCoordinates,offset,end,stride,extent){var coordinatesExtent=extendFlatCoordinates(createEmpty(),flatCoordinates,offset,end,stride);return!!intersects(extent,coordinatesExtent)&&(!!containsExtent(extent,coordinatesExtent)||(coordinatesExtent[0]>=extent[0]&&coordinatesExtent[2]<=extent[2]||(coordinatesExtent[1]>=extent[1]&&coordinatesExtent[3]<=extent[3]||forEach(flatCoordinates,offset,end,stride,function(point1,point2){return intersectsSegment(extent,point1,point2)}))))}function intersectsLineStringArray(flatCoordinates,offset,ends,stride,extent){for(var i=0,ii=ends.length;i<ii;++i){if(intersectsLineString(flatCoordinates,offset,ends[i],stride,extent))return!0;offset=ends[i]}return!1}function intersectsLinearRing(flatCoordinates,offset,end,stride,extent){return!!intersectsLineString(flatCoordinates,offset,end,stride,extent)||(!!linearRingContainsXY(flatCoordinates,offset,end,stride,extent[0],extent[1])||(!!linearRingContainsXY(flatCoordinates,offset,end,stride,extent[0],extent[3])||(!!linearRingContainsXY(flatCoordinates,offset,end,stride,extent[2],extent[1])||!!linearRingContainsXY(flatCoordinates,offset,end,stride,extent[2],extent[3]))))}function intersectsLinearRingArray(flatCoordinates,offset,ends,stride,extent){if(!intersectsLinearRing(flatCoordinates,offset,ends[0],stride,extent))return!1;if(1===ends.length)return!0;for(var i=1,ii=ends.length;i<ii;++i)if(linearRingContainsExtent(flatCoordinates,ends[i-1],ends[i],stride,extent)&&!intersectsLineString(flatCoordinates,ends[i-1],ends[i],stride,extent))return!1;return!0}function intersectsLinearRingMultiArray(flatCoordinates,offset,endss,stride,extent){for(var i=0,ii=endss.length;i<ii;++i){var ends=endss[i];if(intersectsLinearRingArray(flatCoordinates,offset,ends,stride,extent))return!0;offset=ends[ends.length-1]}return!1}function coordinates(flatCoordinates,offset,end,stride){for(;offset<end-stride;){for(var i=0;i<stride;++i){var tmp=flatCoordinates[offset+i];flatCoordinates[offset+i]=flatCoordinates[end-stride+i],flatCoordinates[end-stride+i]=tmp}offset+=stride,end-=stride}}function linearRingIsClockwise(flatCoordinates,offset,end,stride){for(var edge=0,x1=flatCoordinates[end-stride],y1=flatCoordinates[end-stride+1];offset<end;offset+=stride){var x2=flatCoordinates[offset],y2=flatCoordinates[offset+1];edge+=(x2-x1)*(y2+y1),x1=x2,y1=y2}return edge>0}function linearRingsAreOriented(flatCoordinates,offset,ends,stride,opt_right){for(var right=void 0!==opt_right&&opt_right,i=0,ii=ends.length;i<ii;++i){var end=ends[i],isClockwise=linearRingIsClockwise(flatCoordinates,offset,end,stride);if(0===i){if(right&&isClockwise||!right&&!isClockwise)return!1}else if(right&&!isClockwise||!right&&isClockwise)return!1;offset=end}return!0}function linearRingssAreOriented(flatCoordinates,offset,endss,stride,opt_right){for(var i=0,ii=endss.length;i<ii;++i){var ends=endss[i];if(!linearRingsAreOriented(flatCoordinates,offset,ends,stride,opt_right))return!1;ends.length&&(offset=ends[ends.length-1])}return!0}function orientLinearRings(flatCoordinates,offset,ends,stride,opt_right){for(var right=void 0!==opt_right&&opt_right,i=0,ii=ends.length;i<ii;++i){var end=ends[i],isClockwise=linearRingIsClockwise(flatCoordinates,offset,end,stride);(0===i?right&&isClockwise||!right&&!isClockwise:right&&!isClockwise||!right&&isClockwise)&&coordinates(flatCoordinates,offset,end,stride),offset=end}return offset}function orientLinearRingsArray(flatCoordinates,offset,endss,stride,opt_right){for(var i=0,ii=endss.length;i<ii;++i)offset=orientLinearRings(flatCoordinates,offset,endss[i],stride,opt_right);return offset}var Polygon=function(_super){function Polygon(coordinates,opt_layout,opt_ends){var _this=_super.call(this)||this;return _this.ends_=[],_this.flatInteriorPointRevision_=-1,_this.flatInteriorPoint_=null,_this.maxDelta_=-1,_this.maxDeltaRevision_=-1,_this.orientedRevision_=-1,_this.orientedFlatCoordinates_=null,void 0!==opt_layout&&opt_ends?(_this.setFlatCoordinates(opt_layout,coordinates),_this.ends_=opt_ends):_this.setCoordinates(coordinates,opt_layout),_this}return __extends(Polygon,_super),Polygon.prototype.appendLinearRing=function(linearRing){this.flatCoordinates?extend(this.flatCoordinates,linearRing.getFlatCoordinates()):this.flatCoordinates=linearRing.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},Polygon.prototype.clone=function(){return new Polygon(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},Polygon.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y)?minSquaredDistance:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,x,y,closestPoint,minSquaredDistance))},Polygon.prototype.containsXY=function(x,y){return linearRingsContainsXY(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,x,y)},Polygon.prototype.getArea=function(){return linearRings(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},Polygon.prototype.getCoordinates=function(opt_right){var flatCoordinates;return void 0!==opt_right?orientLinearRings(flatCoordinates=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,opt_right):flatCoordinates=this.flatCoordinates,inflateCoordinatesArray(flatCoordinates,0,this.ends_,this.stride)},Polygon.prototype.getEnds=function(){return this.ends_},Polygon.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var flatCenter=getCenter(this.getExtent());this.flatInteriorPoint_=getInteriorPointOfArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,flatCenter,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},Polygon.prototype.getInteriorPoint=function(){return new Point(this.getFlatInteriorPoint(),GeometryLayout.XYM)},Polygon.prototype.getLinearRingCount=function(){return this.ends_.length},Polygon.prototype.getLinearRing=function(index){return index<0||this.ends_.length<=index?null:new LinearRing(this.flatCoordinates.slice(0===index?0:this.ends_[index-1],this.ends_[index]),this.layout)},Polygon.prototype.getLinearRings=function(){for(var layout=this.layout,flatCoordinates=this.flatCoordinates,ends=this.ends_,linearRings=[],offset=0,i=0,ii=ends.length;i<ii;++i){var end=ends[i],linearRing=new LinearRing(flatCoordinates.slice(offset,end),layout);linearRings.push(linearRing),offset=end}return linearRings},Polygon.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var flatCoordinates=this.flatCoordinates;linearRingsAreOriented(flatCoordinates,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=flatCoordinates:(this.orientedFlatCoordinates_=flatCoordinates.slice(),this.orientedFlatCoordinates_.length=orientLinearRings(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},Polygon.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){var simplifiedFlatCoordinates=[],simplifiedEnds=[];return simplifiedFlatCoordinates.length=quantizeArray(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(squaredTolerance),simplifiedFlatCoordinates,0,simplifiedEnds),new Polygon(simplifiedFlatCoordinates,GeometryLayout.XY,simplifiedEnds)},Polygon.prototype.getType=function(){return GeometryType.POLYGON},Polygon.prototype.intersectsExtent=function(extent){return intersectsLinearRingArray(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,extent)},Polygon.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,2),this.flatCoordinates||(this.flatCoordinates=[]);var ends=deflateCoordinatesArray(this.flatCoordinates,0,coordinates,this.stride,this.ends_);this.flatCoordinates.length=0===ends.length?0:ends[ends.length-1],this.changed()},Polygon}(SimpleGeometry);function fromExtent(extent){var minX=extent[0],minY=extent[1],maxX=extent[2],maxY=extent[3],flatCoordinates=[minX,minY,minX,maxY,maxX,maxY,maxX,minY,minX,minY];return new Polygon(flatCoordinates,GeometryLayout.XY,[flatCoordinates.length])}var DEFAULT_MIN_ZOOM=0,View=function(_super){function View(opt_options){var _this=_super.call(this)||this,options=assign({},opt_options);return _this.hints_=[0,0],_this.animations_=[],_this.updateAnimationKey_,_this.projection_=createProjection(options.projection,"EPSG:3857"),_this.targetCenter_=null,_this.targetResolution_,_this.targetRotation_,options.center&&(options.center=fromUserCoordinate(options.center,_this.projection_)),options.extent&&(options.extent=fromUserExtent(options.extent,_this.projection_)),_this.applyOptions_(options),_this}return __extends(View,_super),View.prototype.applyOptions_=function(options){var resolutionConstraintInfo=createResolutionConstraint(options);this.maxResolution_=resolutionConstraintInfo.maxResolution,this.minResolution_=resolutionConstraintInfo.minResolution,this.zoomFactor_=resolutionConstraintInfo.zoomFactor,this.resolutions_=options.resolutions,this.minZoom_=resolutionConstraintInfo.minZoom;var centerConstraint=createCenterConstraint(options),resolutionConstraint=resolutionConstraintInfo.constraint,rotationConstraint=createRotationConstraint(options);this.constraints_={center:centerConstraint,resolution:resolutionConstraint,rotation:rotationConstraint},this.setRotation(void 0!==options.rotation?options.rotation:0),this.setCenterInternal(void 0!==options.center?options.center:null),void 0!==options.resolution?this.setResolution(options.resolution):void 0!==options.zoom&&this.setZoom(options.zoom),this.resolveConstraints(0),this.setProperties({}),this.options_=options},View.prototype.getUpdatedOptions_=function(newOptions){var options=assign({},this.options_);return void 0!==options.resolution?options.resolution=this.getResolution():options.zoom=this.getZoom(),options.center=this.getCenterInternal(),options.rotation=this.getRotation(),assign({},options,newOptions)},View.prototype.animate=function(var_args){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var args=new Array(arguments.length),i=0;i<args.length;++i){var options=arguments[i];options.center&&((options=assign({},options)).center=fromUserCoordinate(options.center,this.getProjection())),options.anchor&&((options=assign({},options)).anchor=fromUserCoordinate(options.anchor,this.getProjection())),args[i]=options}this.animateInternal.apply(this,args)},View.prototype.animateInternal=function(var_args){var callback,animationCount=arguments.length;if(animationCount>1&&"function"==typeof arguments[animationCount-1]&&(callback=arguments[animationCount-1],--animationCount),!this.isDef()){var state=arguments[animationCount-1];return state.center&&this.setCenterInternal(state.center),void 0!==state.zoom&&this.setZoom(state.zoom),void 0!==state.rotation&&this.setRotation(state.rotation),void(callback&&animationCallback(callback,!0))}for(var start=Date.now(),center=this.targetCenter_.slice(),resolution=this.targetResolution_,rotation=this.targetRotation_,series=[],i=0;i<animationCount;++i){var options=arguments[i],animation={start:start,complete:!1,anchor:options.anchor,duration:void 0!==options.duration?options.duration:1e3,easing:options.easing||inAndOut,callback:callback};if(options.center&&(animation.sourceCenter=center,animation.targetCenter=options.center.slice(),center=animation.targetCenter),void 0!==options.zoom?(animation.sourceResolution=resolution,animation.targetResolution=this.getResolutionForZoom(options.zoom),resolution=animation.targetResolution):options.resolution&&(animation.sourceResolution=resolution,animation.targetResolution=options.resolution,resolution=animation.targetResolution),void 0!==options.rotation){animation.sourceRotation=rotation;var delta=modulo(options.rotation-rotation+Math.PI,2*Math.PI)-Math.PI;animation.targetRotation=rotation+delta,rotation=animation.targetRotation}isNoopAnimation(animation)?animation.complete=!0:start+=animation.duration,series.push(animation)}this.animations_.push(series),this.setHint(ViewHint.ANIMATING,1),this.updateAnimations_()},View.prototype.getAnimating=function(){return this.hints_[ViewHint.ANIMATING]>0},View.prototype.getInteracting=function(){return this.hints_[ViewHint.INTERACTING]>0},View.prototype.cancelAnimations=function(){this.setHint(ViewHint.ANIMATING,-this.hints_[ViewHint.ANIMATING]);for(var i=0,ii=this.animations_.length;i<ii;++i){var series=this.animations_[i];series[0].callback&&animationCallback(series[0].callback,!1)}this.animations_.length=0},View.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),this.getAnimating()){for(var now=Date.now(),more=!1,i=this.animations_.length-1;i>=0;--i){for(var series=this.animations_[i],seriesComplete=!0,j=0,jj=series.length;j<jj;++j){var animation=series[j];if(!animation.complete){var elapsed=now-animation.start,fraction=animation.duration>0?elapsed/animation.duration:1;fraction>=1?(animation.complete=!0,fraction=1):seriesComplete=!1;var progress=animation.easing(fraction);if(animation.sourceCenter){var x0=animation.sourceCenter[0],y0=animation.sourceCenter[1],x=x0+progress*(animation.targetCenter[0]-x0),y=y0+progress*(animation.targetCenter[1]-y0);this.targetCenter_=[x,y]}if(animation.sourceResolution&&animation.targetResolution){var resolution=1===progress?animation.targetResolution:animation.sourceResolution+progress*(animation.targetResolution-animation.sourceResolution);if(animation.anchor){var size=this.getSizeFromViewport_(this.getRotation()),constrainedResolution=this.constraints_.resolution(resolution,0,size,!0);this.targetCenter_=this.calculateCenterZoom(constrainedResolution,animation.anchor)}this.targetResolution_=resolution,this.applyTargetState_(!0)}if(void 0!==animation.sourceRotation&&void 0!==animation.targetRotation){var rotation=1===progress?modulo(animation.targetRotation+Math.PI,2*Math.PI)-Math.PI:animation.sourceRotation+progress*(animation.targetRotation-animation.sourceRotation);if(animation.anchor){var constrainedRotation=this.constraints_.rotation(rotation,!0);this.targetCenter_=this.calculateCenterRotate(constrainedRotation,animation.anchor)}this.targetRotation_=rotation}if(this.applyTargetState_(!0),more=!0,!animation.complete)break}}if(seriesComplete){this.animations_[i]=null,this.setHint(ViewHint.ANIMATING,-1);var callback=series[0].callback;callback&&animationCallback(callback,!0)}}this.animations_=this.animations_.filter(Boolean),more&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}},View.prototype.calculateCenterRotate=function(rotation,anchor){var center,currentCenter=this.getCenterInternal();return void 0!==currentCenter&&(rotate(center=[currentCenter[0]-anchor[0],currentCenter[1]-anchor[1]],rotation-this.getRotation()),add(center,anchor)),center},View.prototype.calculateCenterZoom=function(resolution,anchor){var center,currentCenter=this.getCenterInternal(),currentResolution=this.getResolution();void 0!==currentCenter&&void 0!==currentResolution&&(center=[anchor[0]-resolution*(anchor[0]-currentCenter[0])/currentResolution,anchor[1]-resolution*(anchor[1]-currentCenter[1])/currentResolution]);return center},View.prototype.getSizeFromViewport_=function(opt_rotation){var size=[100,100],selector='.ol-viewport[data-view="'+getUid(this)+'"]',element=document.querySelector(selector);if(element){var metrics=getComputedStyle(element);size[0]=parseInt(metrics.width,10),size[1]=parseInt(metrics.height,10)}if(opt_rotation){var w=size[0],h=size[1];size[0]=Math.abs(w*Math.cos(opt_rotation))+Math.abs(h*Math.sin(opt_rotation)),size[1]=Math.abs(w*Math.sin(opt_rotation))+Math.abs(h*Math.cos(opt_rotation))}return size},View.prototype.getCenter=function(){var center=this.getCenterInternal();return center?toUserCoordinate(center,this.getProjection()):center},View.prototype.getCenterInternal=function(){return this.get(ViewProperty.CENTER)},View.prototype.getConstraints=function(){return this.constraints_},View.prototype.getHints=function(opt_hints){return void 0!==opt_hints?(opt_hints[0]=this.hints_[0],opt_hints[1]=this.hints_[1],opt_hints):this.hints_.slice()},View.prototype.calculateExtent=function(opt_size){return toUserExtent(this.calculateExtentInternal(opt_size),this.getProjection())},View.prototype.calculateExtentInternal=function(opt_size){var size=opt_size||this.getSizeFromViewport_(),center=this.getCenterInternal();assert(center,1);var resolution=this.getResolution();assert(void 0!==resolution,2);var rotation=this.getRotation();return assert(void 0!==rotation,3),getForViewAndSize(center,resolution,rotation,size)},View.prototype.getMaxResolution=function(){return this.maxResolution_},View.prototype.getMinResolution=function(){return this.minResolution_},View.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},View.prototype.setMaxZoom=function(zoom){this.applyOptions_(this.getUpdatedOptions_({maxZoom:zoom}))},View.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},View.prototype.setMinZoom=function(zoom){this.applyOptions_(this.getUpdatedOptions_({minZoom:zoom}))},View.prototype.setConstrainResolution=function(enabled){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:enabled}))},View.prototype.getProjection=function(){return this.projection_},View.prototype.getResolution=function(){return this.get(ViewProperty.RESOLUTION)},View.prototype.getResolutions=function(){return this.resolutions_},View.prototype.getResolutionForExtent=function(extent,opt_size){return this.getResolutionForExtentInternal(fromUserExtent(extent,this.getProjection()),opt_size)},View.prototype.getResolutionForExtentInternal=function(extent,opt_size){var size=opt_size||this.getSizeFromViewport_(),xResolution=getWidth(extent)/size[0],yResolution=getHeight(extent)/size[1];return Math.max(xResolution,yResolution)},View.prototype.getResolutionForValueFunction=function(opt_power){var power=opt_power||2,maxResolution=this.maxResolution_,minResolution=this.minResolution_,max=Math.log(maxResolution/minResolution)/Math.log(power);return function(value){return maxResolution/Math.pow(power,value*max)}},View.prototype.getRotation=function(){return this.get(ViewProperty.ROTATION)},View.prototype.getValueForResolutionFunction=function(opt_power){var power=opt_power||2,maxResolution=this.maxResolution_,minResolution=this.minResolution_,max=Math.log(maxResolution/minResolution)/Math.log(power);return function(resolution){return Math.log(maxResolution/resolution)/Math.log(power)/max}},View.prototype.getState=function(){var center=this.getCenterInternal(),projection=this.getProjection(),resolution=this.getResolution(),rotation=this.getRotation();return{center:center.slice(0),projection:void 0!==projection?projection:null,resolution:resolution,rotation:rotation,zoom:this.getZoom()}},View.prototype.getZoom=function(){var zoom,resolution=this.getResolution();return void 0!==resolution&&(zoom=this.getZoomForResolution(resolution)),zoom},View.prototype.getZoomForResolution=function(resolution){var max,zoomFactor,offset=this.minZoom_||0;if(this.resolutions_){var nearest=linearFindNearest(this.resolutions_,resolution,1);offset=nearest,max=this.resolutions_[nearest],zoomFactor=nearest==this.resolutions_.length-1?2:max/this.resolutions_[nearest+1]}else max=this.maxResolution_,zoomFactor=this.zoomFactor_;return offset+Math.log(max/resolution)/Math.log(zoomFactor)},View.prototype.getResolutionForZoom=function(zoom){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;var baseLevel=clamp(Math.floor(zoom),0,this.resolutions_.length-2),zoomFactor=this.resolutions_[baseLevel]/this.resolutions_[baseLevel+1];return this.resolutions_[baseLevel]/Math.pow(zoomFactor,clamp(zoom-baseLevel,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,zoom-this.minZoom_)},View.prototype.fit=function(geometryOrExtent,opt_options){var geometry,options=assign({size:this.getSizeFromViewport_()},opt_options||{});if(assert(Array.isArray(geometryOrExtent)||"function"==typeof geometryOrExtent.getSimplifiedGeometry,24),Array.isArray(geometryOrExtent))assert(!isEmpty$1(geometryOrExtent),25),geometry=fromExtent(extent=fromUserExtent(geometryOrExtent,this.getProjection()));else if(geometryOrExtent.getType()===GeometryType.CIRCLE){var extent;(geometry=fromExtent(extent=fromUserExtent(geometryOrExtent.getExtent(),this.getProjection()))).rotate(this.getRotation(),getCenter(extent))}else{var userProjection=getUserProjection();geometry=userProjection?geometry.clone().transform(userProjection,this.getProjection()):geometryOrExtent}this.fitInternal(geometry,options)},View.prototype.fitInternal=function(geometry,opt_options){var options=opt_options||{},size=options.size;size||(size=this.getSizeFromViewport_());var minResolution,padding=void 0!==options.padding?options.padding:[0,0,0,0],nearest=void 0!==options.nearest&&options.nearest;minResolution=void 0!==options.minResolution?options.minResolution:void 0!==options.maxZoom?this.getResolutionForZoom(options.maxZoom):0;for(var coords=geometry.getFlatCoordinates(),rotation=this.getRotation(),cosAngle=Math.cos(-rotation),sinAngle=Math.sin(-rotation),minRotX=1/0,minRotY=1/0,maxRotX=-1/0,maxRotY=-1/0,stride=geometry.getStride(),i=0,ii=coords.length;i<ii;i+=stride){var rotX=coords[i]*cosAngle-coords[i+1]*sinAngle,rotY=coords[i]*sinAngle+coords[i+1]*cosAngle;minRotX=Math.min(minRotX,rotX),minRotY=Math.min(minRotY,rotY),maxRotX=Math.max(maxRotX,rotX),maxRotY=Math.max(maxRotY,rotY)}var resolution=this.getResolutionForExtentInternal([minRotX,minRotY,maxRotX,maxRotY],[size[0]-padding[1]-padding[3],size[1]-padding[0]-padding[2]]);resolution=isNaN(resolution)?minResolution:Math.max(resolution,minResolution),resolution=this.getConstrainedResolution(resolution,nearest?0:1),sinAngle=-sinAngle;var centerRotX=(minRotX+maxRotX)/2,centerRotY=(minRotY+maxRotY)/2,center=[(centerRotX+=(padding[1]-padding[3])/2*resolution)*cosAngle-(centerRotY+=(padding[0]-padding[2])/2*resolution)*sinAngle,centerRotY*cosAngle+centerRotX*sinAngle],callback=options.callback?options.callback:VOID;void 0!==options.duration?this.animateInternal({resolution:resolution,center:this.getConstrainedCenter(center,resolution),duration:options.duration,easing:options.easing},callback):(this.targetResolution_=resolution,this.targetCenter_=center,this.applyTargetState_(!1,!0),animationCallback(callback,!0))},View.prototype.centerOn=function(coordinate,size,position){this.centerOnInternal(fromUserCoordinate(coordinate,this.getProjection()),size,position)},View.prototype.centerOnInternal=function(coordinate,size,position){var rotation=this.getRotation(),cosAngle=Math.cos(-rotation),sinAngle=Math.sin(-rotation),rotX=coordinate[0]*cosAngle-coordinate[1]*sinAngle,rotY=coordinate[1]*cosAngle+coordinate[0]*sinAngle,resolution=this.getResolution(),centerX=(rotX+=(size[0]/2-position[0])*resolution)*cosAngle-(rotY+=(position[1]-size[1]/2)*resolution)*(sinAngle=-sinAngle),centerY=rotY*cosAngle+rotX*sinAngle;this.setCenterInternal([centerX,centerY])},View.prototype.isDef=function(){return!!this.getCenterInternal()&&void 0!==this.getResolution()},View.prototype.adjustCenter=function(deltaCoordinates){var center=toUserCoordinate(this.targetCenter_,this.getProjection());this.setCenter([center[0]+deltaCoordinates[0],center[1]+deltaCoordinates[1]])},View.prototype.adjustCenterInternal=function(deltaCoordinates){var center=this.targetCenter_;this.setCenterInternal([center[0]+deltaCoordinates[0],center[1]+deltaCoordinates[1]])},View.prototype.adjustResolution=function(ratio,opt_anchor){var anchor=opt_anchor&&fromUserCoordinate(opt_anchor,this.getProjection());this.adjustResolutionInternal(ratio,anchor)},View.prototype.adjustResolutionInternal=function(ratio,opt_anchor){var isMoving=this.getAnimating()||this.getInteracting(),size=this.getSizeFromViewport_(this.getRotation()),newResolution=this.constraints_.resolution(this.targetResolution_*ratio,0,size,isMoving);void 0!==opt_anchor&&(this.targetCenter_=this.calculateCenterZoom(newResolution,opt_anchor)),this.targetResolution_*=ratio,this.applyTargetState_()},View.prototype.adjustZoom=function(delta,opt_anchor){this.adjustResolution(Math.pow(this.zoomFactor_,-delta),opt_anchor)},View.prototype.adjustRotation=function(delta,opt_anchor){opt_anchor&&(opt_anchor=fromUserCoordinate(opt_anchor,this.getProjection())),this.adjustRotationInternal(delta,opt_anchor)},View.prototype.adjustRotationInternal=function(delta,opt_anchor){var isMoving=this.getAnimating()||this.getInteracting(),newRotation=this.constraints_.rotation(this.targetRotation_+delta,isMoving);void 0!==opt_anchor&&(this.targetCenter_=this.calculateCenterRotate(newRotation,opt_anchor)),this.targetRotation_+=delta,this.applyTargetState_()},View.prototype.setCenter=function(center){this.setCenterInternal(fromUserCoordinate(center,this.getProjection()))},View.prototype.setCenterInternal=function(center){this.targetCenter_=center,this.applyTargetState_()},View.prototype.setHint=function(hint,delta){return this.hints_[hint]+=delta,this.changed(),this.hints_[hint]},View.prototype.setResolution=function(resolution){this.targetResolution_=resolution,this.applyTargetState_()},View.prototype.setRotation=function(rotation){this.targetRotation_=rotation,this.applyTargetState_()},View.prototype.setZoom=function(zoom){this.setResolution(this.getResolutionForZoom(zoom))},View.prototype.applyTargetState_=function(opt_doNotCancelAnims,opt_forceMoving){var isMoving=this.getAnimating()||this.getInteracting()||opt_forceMoving,newRotation=this.constraints_.rotation(this.targetRotation_,isMoving),size=this.getSizeFromViewport_(newRotation),newResolution=this.constraints_.resolution(this.targetResolution_,0,size,isMoving),newCenter=this.constraints_.center(this.targetCenter_,newResolution,size,isMoving);this.get(ViewProperty.ROTATION)!==newRotation&&this.set(ViewProperty.ROTATION,newRotation),this.get(ViewProperty.RESOLUTION)!==newResolution&&this.set(ViewProperty.RESOLUTION,newResolution),this.get(ViewProperty.CENTER)&&equals$2(this.get(ViewProperty.CENTER),newCenter)||this.set(ViewProperty.CENTER,newCenter),this.getAnimating()&&!opt_doNotCancelAnims&&this.cancelAnimations()},View.prototype.resolveConstraints=function(opt_duration,opt_resolutionDirection,opt_anchor){var duration=void 0!==opt_duration?opt_duration:200,direction=opt_resolutionDirection||0,newRotation=this.constraints_.rotation(this.targetRotation_),size=this.getSizeFromViewport_(newRotation),newResolution=this.constraints_.resolution(this.targetResolution_,direction,size),newCenter=this.constraints_.center(this.targetCenter_,newResolution,size);if(0===duration)return this.targetResolution_=newResolution,this.targetRotation_=newRotation,this.targetCenter_=newCenter,void this.applyTargetState_();this.getResolution()===newResolution&&this.getRotation()===newRotation&&this.getCenterInternal()&&equals$2(this.getCenterInternal(),newCenter)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:newRotation,center:newCenter,resolution:newResolution,duration:duration,easing:easeOut,anchor:opt_anchor}))},View.prototype.beginInteraction=function(){this.resolveConstraints(0),this.setHint(ViewHint.INTERACTING,1)},View.prototype.endInteraction=function(opt_duration,opt_resolutionDirection,opt_anchor){var anchor=opt_anchor&&fromUserCoordinate(opt_anchor,this.getProjection());this.endInteractionInternal(opt_duration,opt_resolutionDirection,anchor)},View.prototype.endInteractionInternal=function(opt_duration,opt_resolutionDirection,opt_anchor){this.setHint(ViewHint.INTERACTING,-1),this.resolveConstraints(opt_duration,opt_resolutionDirection,opt_anchor)},View.prototype.getConstrainedCenter=function(targetCenter,opt_targetResolution){var size=this.getSizeFromViewport_(this.getRotation());return this.constraints_.center(targetCenter,opt_targetResolution||this.getResolution(),size)},View.prototype.getConstrainedZoom=function(targetZoom,opt_direction){var targetRes=this.getResolutionForZoom(targetZoom);return this.getZoomForResolution(this.getConstrainedResolution(targetRes,opt_direction))},View.prototype.getConstrainedResolution=function(targetResolution,opt_direction){var direction=opt_direction||0,size=this.getSizeFromViewport_(this.getRotation());return this.constraints_.resolution(targetResolution,direction,size)},View}(BaseObject);function animationCallback(callback,returnValue){setTimeout(function(){callback(returnValue)},0)}function createCenterConstraint(options){if(void 0!==options.extent){var smooth=void 0===options.smoothExtentConstraint||options.smoothExtentConstraint;return createExtent(options.extent,options.constrainOnlyCenter,smooth)}var projection=createProjection(options.projection,"EPSG:3857");if(!0!==options.multiWorld&&projection.isGlobal()){var extent=projection.getExtent().slice();return extent[0]=-1/0,extent[2]=1/0,createExtent(extent,!1,!1)}return none}function createResolutionConstraint(options){var resolutionConstraint,maxResolution,minResolution,minZoom=void 0!==options.minZoom?options.minZoom:DEFAULT_MIN_ZOOM,maxZoom=void 0!==options.maxZoom?options.maxZoom:28,zoomFactor=void 0!==options.zoomFactor?options.zoomFactor:2,multiWorld=void 0!==options.multiWorld&&options.multiWorld,smooth=void 0===options.smoothResolutionConstraint||options.smoothResolutionConstraint,projection=createProjection(options.projection,"EPSG:3857"),projExtent=projection.getExtent(),constrainOnlyCenter=options.constrainOnlyCenter,extent=options.extent;if(multiWorld||extent||!projection.isGlobal()||(constrainOnlyCenter=!1,extent=projExtent),void 0!==options.resolutions){var resolutions=options.resolutions;maxResolution=resolutions[minZoom],minResolution=void 0!==resolutions[maxZoom]?resolutions[maxZoom]:resolutions[resolutions.length-1],resolutionConstraint=options.constrainResolution?createSnapToResolutions(resolutions,smooth,!constrainOnlyCenter&&extent):createMinMaxResolution(maxResolution,minResolution,smooth,!constrainOnlyCenter&&extent)}else{var defaultMaxResolution=(projExtent?Math.max(getWidth(projExtent),getHeight(projExtent)):360*METERS_PER_UNIT[Units.DEGREES]/projection.getMetersPerUnit())/DEFAULT_TILE_SIZE/Math.pow(2,DEFAULT_MIN_ZOOM),defaultMinResolution=defaultMaxResolution/Math.pow(2,28-DEFAULT_MIN_ZOOM);void 0!==(maxResolution=options.maxResolution)?minZoom=0:maxResolution=defaultMaxResolution/Math.pow(zoomFactor,minZoom),void 0===(minResolution=options.minResolution)&&(minResolution=void 0!==options.maxZoom?void 0!==options.maxResolution?maxResolution/Math.pow(zoomFactor,maxZoom):defaultMaxResolution/Math.pow(zoomFactor,maxZoom):defaultMinResolution),maxZoom=minZoom+Math.floor(Math.log(maxResolution/minResolution)/Math.log(zoomFactor)),minResolution=maxResolution/Math.pow(zoomFactor,maxZoom-minZoom),resolutionConstraint=options.constrainResolution?createSnapToPower(zoomFactor,maxResolution,minResolution,smooth,!constrainOnlyCenter&&extent):createMinMaxResolution(maxResolution,minResolution,smooth,!constrainOnlyCenter&&extent)}return{constraint:resolutionConstraint,maxResolution:maxResolution,minResolution:minResolution,minZoom:minZoom,zoomFactor:zoomFactor}}function createRotationConstraint(options){if(void 0===options.enableRotation||options.enableRotation){var constrainRotation=options.constrainRotation;return void 0===constrainRotation||!0===constrainRotation?createSnapToZero():!1===constrainRotation?none$1:"number"==typeof constrainRotation?createSnapToN(constrainRotation):none$1}return disable}function isNoopAnimation(animation){return!(animation.sourceCenter&&animation.targetCenter&&!equals$2(animation.sourceCenter,animation.targetCenter))&&(animation.sourceResolution===animation.targetResolution&&animation.sourceRotation===animation.targetRotation)}function createCanvasContext2D(opt_width,opt_height){var canvas=document.createElement("canvas");return opt_width&&(canvas.width=opt_width),opt_height&&(canvas.height=opt_height),canvas.getContext("2d")}function replaceNode(newNode,oldNode){var parent=oldNode.parentNode;parent&&parent.replaceChild(newNode,oldNode)}function removeNode(node){return node&&node.parentNode?node.parentNode.removeChild(node):null}function removeChildren(node){for(;node.lastChild;)node.removeChild(node.lastChild)}function replaceChildren(node,children){for(var oldChildren=node.childNodes,i=0;;++i){var oldChild=oldChildren[i],newChild=children[i];if(!oldChild&&!newChild)break;oldChild!==newChild&&(oldChild?newChild?node.insertBefore(newChild,oldChild):(node.removeChild(oldChild),--i):node.appendChild(newChild))}}var LayerProperty={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source"},BaseLayer=function(_super){function BaseLayer(options){var _this=_super.call(this)||this,properties=assign({},options);return properties[LayerProperty.OPACITY]=void 0!==options.opacity?options.opacity:1,assert("number"==typeof properties[LayerProperty.OPACITY],64),properties[LayerProperty.VISIBLE]=void 0===options.visible||options.visible,properties[LayerProperty.Z_INDEX]=options.zIndex,properties[LayerProperty.MAX_RESOLUTION]=void 0!==options.maxResolution?options.maxResolution:1/0,properties[LayerProperty.MIN_RESOLUTION]=void 0!==options.minResolution?options.minResolution:0,properties[LayerProperty.MIN_ZOOM]=void 0!==options.minZoom?options.minZoom:-1/0,properties[LayerProperty.MAX_ZOOM]=void 0!==options.maxZoom?options.maxZoom:1/0,_this.className_=void 0!==properties.className?options.className:"ol-layer",delete properties.className,_this.setProperties(properties),_this.state_=null,_this}return __extends(BaseLayer,_super),BaseLayer.prototype.getClassName=function(){return this.className_},BaseLayer.prototype.getLayerState=function(opt_managed){var state=this.state_||{layer:this,managed:void 0===opt_managed||opt_managed,hasOverlay:!1};return state.opacity=clamp(Math.round(100*this.getOpacity())/100,0,1),state.sourceState=this.getSourceState(),state.visible=this.getVisible(),state.extent=this.getExtent(),state.zIndex=this.getZIndex()||(!1===state.managed?1/0:0),state.maxResolution=this.getMaxResolution(),state.minResolution=Math.max(this.getMinResolution(),0),state.minZoom=this.getMinZoom(),state.maxZoom=this.getMaxZoom(),this.state_=state,state},BaseLayer.prototype.getLayersArray=function(opt_array){return abstract()},BaseLayer.prototype.getLayerStatesArray=function(opt_states){return abstract()},BaseLayer.prototype.getExtent=function(){return this.get(LayerProperty.EXTENT)},BaseLayer.prototype.getMaxResolution=function(){return this.get(LayerProperty.MAX_RESOLUTION)},BaseLayer.prototype.getMinResolution=function(){return this.get(LayerProperty.MIN_RESOLUTION)},BaseLayer.prototype.getMinZoom=function(){return this.get(LayerProperty.MIN_ZOOM)},BaseLayer.prototype.getMaxZoom=function(){return this.get(LayerProperty.MAX_ZOOM)},BaseLayer.prototype.getOpacity=function(){return this.get(LayerProperty.OPACITY)},BaseLayer.prototype.getSourceState=function(){return abstract()},BaseLayer.prototype.getVisible=function(){return this.get(LayerProperty.VISIBLE)},BaseLayer.prototype.getZIndex=function(){return this.get(LayerProperty.Z_INDEX)},BaseLayer.prototype.setExtent=function(extent){this.set(LayerProperty.EXTENT,extent)},BaseLayer.prototype.setMaxResolution=function(maxResolution){this.set(LayerProperty.MAX_RESOLUTION,maxResolution)},BaseLayer.prototype.setMinResolution=function(minResolution){this.set(LayerProperty.MIN_RESOLUTION,minResolution)},BaseLayer.prototype.setMaxZoom=function(maxZoom){this.set(LayerProperty.MAX_ZOOM,maxZoom)},BaseLayer.prototype.setMinZoom=function(minZoom){this.set(LayerProperty.MIN_ZOOM,minZoom)},BaseLayer.prototype.setOpacity=function(opacity){assert("number"==typeof opacity,64),this.set(LayerProperty.OPACITY,opacity)},BaseLayer.prototype.setVisible=function(visible){this.set(LayerProperty.VISIBLE,visible)},BaseLayer.prototype.setZIndex=function(zindex){this.set(LayerProperty.Z_INDEX,zindex)},BaseLayer}(BaseObject),SourceState={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"},Property$1={LAYERS:"layers"},LayerGroup=function(_super){function LayerGroup(opt_options){var _this=this,options=opt_options||{},baseOptions=assign({},options);delete baseOptions.layers;var layers=options.layers;return(_this=_super.call(this,baseOptions)||this).layersListenerKeys_=[],_this.listenerKeys_={},_this.addEventListener(getChangeEventType(Property$1.LAYERS),_this.handleLayersChanged_),layers?Array.isArray(layers)?layers=new Collection(layers.slice(),{unique:!0}):assert("function"==typeof layers.getArray,43):layers=new Collection(void 0,{unique:!0}),_this.setLayers(layers),_this}return __extends(LayerGroup,_super),LayerGroup.prototype.handleLayerChange_=function(){this.changed()},LayerGroup.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(unlistenByKey),this.layersListenerKeys_.length=0;var layers=this.getLayers();for(var id in this.layersListenerKeys_.push(listen(layers,CollectionEventType.ADD,this.handleLayersAdd_,this),listen(layers,CollectionEventType.REMOVE,this.handleLayersRemove_,this)),this.listenerKeys_)this.listenerKeys_[id].forEach(unlistenByKey);clear(this.listenerKeys_);for(var layersArray=layers.getArray(),i=0,ii=layersArray.length;i<ii;i++){var layer=layersArray[i];this.listenerKeys_[getUid(layer)]=[listen(layer,ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),listen(layer,EventType.CHANGE,this.handleLayerChange_,this)]}this.changed()},LayerGroup.prototype.handleLayersAdd_=function(collectionEvent){var layer=collectionEvent.element;this.listenerKeys_[getUid(layer)]=[listen(layer,ObjectEventType.PROPERTYCHANGE,this.handleLayerChange_,this),listen(layer,EventType.CHANGE,this.handleLayerChange_,this)],this.changed()},LayerGroup.prototype.handleLayersRemove_=function(collectionEvent){var key=getUid(collectionEvent.element);this.listenerKeys_[key].forEach(unlistenByKey),delete this.listenerKeys_[key],this.changed()},LayerGroup.prototype.getLayers=function(){return this.get(Property$1.LAYERS)},LayerGroup.prototype.setLayers=function(layers){this.set(Property$1.LAYERS,layers)},LayerGroup.prototype.getLayersArray=function(opt_array){var array=void 0!==opt_array?opt_array:[];return this.getLayers().forEach(function(layer){layer.getLayersArray(array)}),array},LayerGroup.prototype.getLayerStatesArray=function(opt_states){var states=void 0!==opt_states?opt_states:[],pos=states.length;this.getLayers().forEach(function(layer){layer.getLayerStatesArray(states)});for(var ownLayerState=this.getLayerState(),i=pos,ii=states.length;i<ii;i++){var layerState=states[i];layerState.opacity*=ownLayerState.opacity,layerState.visible=layerState.visible&&ownLayerState.visible,layerState.maxResolution=Math.min(layerState.maxResolution,ownLayerState.maxResolution),layerState.minResolution=Math.max(layerState.minResolution,ownLayerState.minResolution),layerState.minZoom=Math.max(layerState.minZoom,ownLayerState.minZoom),layerState.maxZoom=Math.min(layerState.maxZoom,ownLayerState.maxZoom),void 0!==ownLayerState.extent&&(void 0!==layerState.extent?layerState.extent=getIntersection(layerState.extent,ownLayerState.extent):layerState.extent=ownLayerState.extent)}return states},LayerGroup.prototype.getSourceState=function(){return SourceState.READY},LayerGroup}(BaseLayer);function hasArea(size){return size[0]>0&&size[1]>0}function scale$2(size,ratio,opt_size){return void 0===opt_size&&(opt_size=[0,0]),opt_size[0]=size[0]*ratio+.5|0,opt_size[1]=size[1]*ratio+.5|0,opt_size}function toSize(size,opt_size){return Array.isArray(size)?size:(void 0===opt_size?opt_size=[size,size]:opt_size[0]=opt_size[1]=size,opt_size)}var PluggableMap=function(_super){function PluggableMap(options){var _this=_super.call(this)||this,optionsInternal=createOptionsInternal(options);_this.boundHandleBrowserEvent_=_this.handleBrowserEvent.bind(_this),_this.maxTilesLoading_=void 0!==options.maxTilesLoading?options.maxTilesLoading:16,_this.pixelRatio_=void 0!==options.pixelRatio?options.pixelRatio:DEVICE_PIXEL_RATIO,_this.postRenderTimeoutHandle_,_this.animationDelayKey_,_this.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}.bind(_this),_this.coordinateToPixelTransform_=create(),_this.pixelToCoordinateTransform_=create(),_this.frameIndex_=0,_this.frameState_=null,_this.previousExtent_=null,_this.viewPropertyListenerKey_=null,_this.viewChangeListenerKey_=null,_this.layerGroupPropertyListenerKeys_=null,_this.viewport_=document.createElement("div"),_this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),_this.viewport_.style.position="relative",_this.viewport_.style.overflow="hidden",_this.viewport_.style.width="100%",_this.viewport_.style.height="100%",_this.viewport_.style.msTouchAction="none",_this.viewport_.style.touchAction="none",_this.overlayContainer_=document.createElement("div"),_this.overlayContainer_.style.position="absolute",_this.overlayContainer_.style.zIndex="0",_this.overlayContainer_.style.width="100%",_this.overlayContainer_.style.height="100%",_this.overlayContainer_.className="ol-overlaycontainer",_this.viewport_.appendChild(_this.overlayContainer_),_this.overlayContainerStopEvent_=document.createElement("div"),_this.overlayContainerStopEvent_.style.position="absolute",_this.overlayContainerStopEvent_.style.zIndex="0",_this.overlayContainerStopEvent_.style.width="100%",_this.overlayContainerStopEvent_.style.height="100%",_this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",_this.viewport_.appendChild(_this.overlayContainerStopEvent_),_this.mapBrowserEventHandler_=new MapBrowserEventHandler(_this,options.moveTolerance);var handleMapBrowserEvent=_this.handleMapBrowserEvent.bind(_this);for(var key in MapBrowserEventType)_this.mapBrowserEventHandler_.addEventListener(MapBrowserEventType[key],handleMapBrowserEvent);_this.keyboardEventTarget_=optionsInternal.keyboardEventTarget,_this.keyHandlerKeys_=null;var handleBrowserEvent=_this.handleBrowserEvent.bind(_this);return _this.viewport_.addEventListener(EventType.CONTEXTMENU,handleBrowserEvent,!1),_this.viewport_.addEventListener(EventType.WHEEL,handleBrowserEvent,!1),_this.controls=optionsInternal.controls||new Collection,_this.interactions=optionsInternal.interactions||new Collection,_this.labelCache_=null,_this.labelCacheListenerKey_,_this.overlays_=optionsInternal.overlays,_this.overlayIdIndex_={},_this.renderer_=null,_this.handleResize_,_this.postRenderFunctions_=[],_this.tileQueue_=new TileQueue(_this.getTilePriority.bind(_this),_this.handleTileChange_.bind(_this)),_this.addEventListener(getChangeEventType(MapProperty.LAYERGROUP),_this.handleLayerGroupChanged_),_this.addEventListener(getChangeEventType(MapProperty.VIEW),_this.handleViewChanged_),_this.addEventListener(getChangeEventType(MapProperty.SIZE),_this.handleSizeChanged_),_this.addEventListener(getChangeEventType(MapProperty.TARGET),_this.handleTargetChanged_),_this.setProperties(optionsInternal.values),_this.controls.forEach(function(control){control.setMap(this)}.bind(_this)),_this.controls.addEventListener(CollectionEventType.ADD,function(event){event.element.setMap(this)}.bind(_this)),_this.controls.addEventListener(CollectionEventType.REMOVE,function(event){event.element.setMap(null)}.bind(_this)),_this.interactions.forEach(function(interaction){interaction.setMap(this)}.bind(_this)),_this.interactions.addEventListener(CollectionEventType.ADD,function(event){event.element.setMap(this)}.bind(_this)),_this.interactions.addEventListener(CollectionEventType.REMOVE,function(event){event.element.setMap(null)}.bind(_this)),_this.overlays_.forEach(_this.addOverlayInternal_.bind(_this)),_this.overlays_.addEventListener(CollectionEventType.ADD,function(event){this.addOverlayInternal_(event.element)}.bind(_this)),_this.overlays_.addEventListener(CollectionEventType.REMOVE,function(event){var id=event.element.getId();void 0!==id&&delete this.overlayIdIndex_[id.toString()],event.element.setMap(null)}.bind(_this)),_this}return __extends(PluggableMap,_super),PluggableMap.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},PluggableMap.prototype.addControl=function(control){this.getControls().push(control)},PluggableMap.prototype.addInteraction=function(interaction){this.getInteractions().push(interaction)},PluggableMap.prototype.addLayer=function(layer){this.getLayerGroup().getLayers().push(layer)},PluggableMap.prototype.addOverlay=function(overlay){this.getOverlays().push(overlay)},PluggableMap.prototype.addOverlayInternal_=function(overlay){var id=overlay.getId();void 0!==id&&(this.overlayIdIndex_[id.toString()]=overlay),overlay.setMap(this)},PluggableMap.prototype.disposeInternal=function(){this.mapBrowserEventHandler_.dispose(),this.viewport_.removeEventListener(EventType.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(EventType.WHEEL,this.boundHandleBrowserEvent_),void 0!==this.handleResize_&&(removeEventListener(EventType.RESIZE,this.handleResize_,!1),this.handleResize_=void 0),this.setTarget(null),_super.prototype.disposeInternal.call(this)},PluggableMap.prototype.forEachFeatureAtPixel=function(pixel,callback,opt_options){if(this.frameState_){var coordinate=this.getCoordinateFromPixelInternal(pixel),hitTolerance=void 0!==(opt_options=void 0!==opt_options?opt_options:{}).hitTolerance?opt_options.hitTolerance*this.frameState_.pixelRatio:0,layerFilter=void 0!==opt_options.layerFilter?opt_options.layerFilter:TRUE,checkWrapped=!1!==opt_options.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(coordinate,this.frameState_,hitTolerance,checkWrapped,callback,null,layerFilter,null)}},PluggableMap.prototype.getFeaturesAtPixel=function(pixel,opt_options){var features=[];return this.forEachFeatureAtPixel(pixel,function(feature){features.push(feature)},opt_options),features},PluggableMap.prototype.forEachLayerAtPixel=function(pixel,callback,opt_options){if(this.frameState_){var options=opt_options||{},hitTolerance=void 0!==options.hitTolerance?options.hitTolerance*this.frameState_.pixelRatio:0,layerFilter=options.layerFilter||TRUE;return this.renderer_.forEachLayerAtPixel(pixel,this.frameState_,hitTolerance,callback,layerFilter)}},PluggableMap.prototype.hasFeatureAtPixel=function(pixel,opt_options){if(!this.frameState_)return!1;var coordinate=this.getCoordinateFromPixelInternal(pixel),layerFilter=void 0!==(opt_options=void 0!==opt_options?opt_options:{}).layerFilter?opt_options.layerFilter:TRUE,hitTolerance=void 0!==opt_options.hitTolerance?opt_options.hitTolerance*this.frameState_.pixelRatio:0,checkWrapped=!1!==opt_options.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(coordinate,this.frameState_,hitTolerance,checkWrapped,layerFilter,null)},PluggableMap.prototype.getEventCoordinate=function(event){return this.getCoordinateFromPixel(this.getEventPixel(event))},PluggableMap.prototype.getEventCoordinateInternal=function(event){return this.getCoordinateFromPixelInternal(this.getEventPixel(event))},PluggableMap.prototype.getEventPixel=function(event){var viewportPosition=this.viewport_.getBoundingClientRect(),eventPosition="changedTouches"in event?event.changedTouches[0]:event;return[eventPosition.clientX-viewportPosition.left,eventPosition.clientY-viewportPosition.top]},PluggableMap.prototype.getTarget=function(){return this.get(MapProperty.TARGET)},PluggableMap.prototype.getTargetElement=function(){var target=this.getTarget();return void 0!==target?"string"==typeof target?document.getElementById(target):target:null},PluggableMap.prototype.getCoordinateFromPixel=function(pixel){return toUserCoordinate(this.getCoordinateFromPixelInternal(pixel),this.getView().getProjection())},PluggableMap.prototype.getCoordinateFromPixelInternal=function(pixel){var frameState=this.frameState_;return frameState?apply(frameState.pixelToCoordinateTransform,pixel.slice()):null},PluggableMap.prototype.getControls=function(){return this.controls},PluggableMap.prototype.getOverlays=function(){return this.overlays_},PluggableMap.prototype.getOverlayById=function(id){var overlay=this.overlayIdIndex_[id.toString()];return void 0!==overlay?overlay:null},PluggableMap.prototype.getInteractions=function(){return this.interactions},PluggableMap.prototype.getLayerGroup=function(){return this.get(MapProperty.LAYERGROUP)},PluggableMap.prototype.getLayers=function(){return this.getLayerGroup().getLayers()},PluggableMap.prototype.getLoading=function(){for(var layerStatesArray=this.getLayerGroup().getLayerStatesArray(),i=0,ii=layerStatesArray.length;i<ii;++i){var source=layerStatesArray[i].layer.getSource();if(source&&source.loading)return!0}return!1},PluggableMap.prototype.getPixelFromCoordinate=function(coordinate){var viewCoordinate=fromUserCoordinate(coordinate,this.getView().getProjection());return this.getPixelFromCoordinateInternal(viewCoordinate)},PluggableMap.prototype.getPixelFromCoordinateInternal=function(coordinate){var frameState=this.frameState_;return frameState?apply(frameState.coordinateToPixelTransform,coordinate.slice(0,2)):null},PluggableMap.prototype.getRenderer=function(){return this.renderer_},PluggableMap.prototype.getSize=function(){return this.get(MapProperty.SIZE)},PluggableMap.prototype.getView=function(){return this.get(MapProperty.VIEW)},PluggableMap.prototype.getViewport=function(){return this.viewport_},PluggableMap.prototype.getOverlayContainer=function(){return this.overlayContainer_},PluggableMap.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},PluggableMap.prototype.getTilePriority=function(tile,tileSourceKey,tileCenter,tileResolution){var frameState=this.frameState_;if(!(frameState&&tileSourceKey in frameState.wantedTiles))return DROP;if(!frameState.wantedTiles[tileSourceKey][tile.getKey()])return DROP;var center=frameState.viewState.center,deltaX=tileCenter[0]-center[0],deltaY=tileCenter[1]-center[1];return 65536*Math.log(tileResolution)+Math.sqrt(deltaX*deltaX+deltaY*deltaY)/tileResolution},PluggableMap.prototype.handleBrowserEvent=function(browserEvent,opt_type){var type=opt_type||browserEvent.type,mapBrowserEvent=new MapBrowserEvent(type,this,browserEvent);this.handleMapBrowserEvent(mapBrowserEvent)},PluggableMap.prototype.handleMapBrowserEvent=function(mapBrowserEvent){if(this.frameState_){for(var target=mapBrowserEvent.originalEvent.target;target instanceof HTMLElement;){if(target.parentElement===this.overlayContainerStopEvent_)return;target=target.parentElement}mapBrowserEvent.frameState=this.frameState_;var interactionsArray=this.getInteractions().getArray();if(!1!==this.dispatchEvent(mapBrowserEvent))for(var i=interactionsArray.length-1;i>=0;i--){var interaction=interactionsArray[i];if(interaction.getActive())if(!interaction.handleEvent(mapBrowserEvent))break}}},PluggableMap.prototype.handlePostRender=function(){var frameState=this.frameState_,tileQueue=this.tileQueue_;if(!tileQueue.isEmpty()){var maxTotalLoading=this.maxTilesLoading_,maxNewLoads=maxTotalLoading;if(frameState){var hints=frameState.viewHints;if(hints[ViewHint.ANIMATING]||hints[ViewHint.INTERACTING]){var lowOnFrameBudget=!IMAGE_DECODE&&Date.now()-frameState.time>8;maxTotalLoading=lowOnFrameBudget?0:8,maxNewLoads=lowOnFrameBudget?0:2}}tileQueue.getTilesLoading()<maxTotalLoading&&(tileQueue.reprioritize(),tileQueue.loadMoreTiles(maxTotalLoading,maxNewLoads))}!frameState||!this.hasListener(RenderEventType.RENDERCOMPLETE)||frameState.animate||this.tileQueue_.getTilesLoading()||this.getLoading()||this.renderer_.dispatchRenderEvent(RenderEventType.RENDERCOMPLETE,frameState);for(var postRenderFunctions=this.postRenderFunctions_,i=0,ii=postRenderFunctions.length;i<ii;++i)postRenderFunctions[i](this,frameState);postRenderFunctions.length=0},PluggableMap.prototype.handleSizeChanged_=function(){this.getView()&&this.getView().resolveConstraints(0),this.render()},PluggableMap.prototype.handleTargetChanged_=function(){var targetElement;if(this.getTarget()&&(targetElement=this.getTargetElement()),this.keyHandlerKeys_){for(var i=0,ii=this.keyHandlerKeys_.length;i<ii;++i)unlistenByKey(this.keyHandlerKeys_[i]);this.keyHandlerKeys_=null}if(targetElement){targetElement.appendChild(this.viewport_),this.renderer_||(this.renderer_=this.createRenderer());var keyboardEventTarget=this.keyboardEventTarget_?this.keyboardEventTarget_:targetElement;this.keyHandlerKeys_=[listen(keyboardEventTarget,EventType.KEYDOWN,this.handleBrowserEvent,this),listen(keyboardEventTarget,EventType.KEYPRESS,this.handleBrowserEvent,this)],this.handleResize_||(this.handleResize_=this.updateSize.bind(this),window.addEventListener(EventType.RESIZE,this.handleResize_,!1))}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0),removeNode(this.viewport_),void 0!==this.handleResize_&&(removeEventListener(EventType.RESIZE,this.handleResize_,!1),this.handleResize_=void 0);this.updateSize()},PluggableMap.prototype.handleTileChange_=function(){this.render()},PluggableMap.prototype.handleViewPropertyChanged_=function(){this.render()},PluggableMap.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(unlistenByKey(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(unlistenByKey(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var view=this.getView();view&&(this.viewport_.setAttribute("data-view",getUid(view)),this.viewPropertyListenerKey_=listen(view,ObjectEventType.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=listen(view,EventType.CHANGE,this.handleViewPropertyChanged_,this),view.resolveConstraints(0)),this.render()},PluggableMap.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(unlistenByKey),this.layerGroupPropertyListenerKeys_=null);var layerGroup=this.getLayerGroup();layerGroup&&(this.layerGroupPropertyListenerKeys_=[listen(layerGroup,ObjectEventType.PROPERTYCHANGE,this.render,this),listen(layerGroup,EventType.CHANGE,this.render,this)]),this.render()},PluggableMap.prototype.isRendered=function(){return!!this.frameState_},PluggableMap.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},PluggableMap.prototype.redrawText=function(){for(var layerStates=this.getLayerGroup().getLayerStatesArray(),i=0,ii=layerStates.length;i<ii;++i){var layer=layerStates[i].layer;layer.hasRenderer()&&layer.getRenderer().handleFontsChanged()}},PluggableMap.prototype.render=function(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},PluggableMap.prototype.removeControl=function(control){return this.getControls().remove(control)},PluggableMap.prototype.removeInteraction=function(interaction){return this.getInteractions().remove(interaction)},PluggableMap.prototype.removeLayer=function(layer){return this.getLayerGroup().getLayers().remove(layer)},PluggableMap.prototype.removeOverlay=function(overlay){return this.getOverlays().remove(overlay)},PluggableMap.prototype.renderFrame_=function(time){var size=this.getSize(),view=this.getView(),previousFrameState=this.frameState_,frameState=null;if(void 0!==size&&hasArea(size)&&view&&view.isDef()){var viewHints=view.getHints(this.frameState_?this.frameState_.viewHints:void 0),viewState=view.getState();frameState={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterItems:previousFrameState?previousFrameState.declutterItems:[],extent:getForViewAndSize(viewState.center,viewState.resolution,viewState.rotation,size),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:size,tileQueue:this.tileQueue_,time:time,usedTiles:{},viewState:viewState,viewHints:viewHints,wantedTiles:{}}}if(this.frameState_=frameState,this.renderer_.renderFrame(frameState),frameState){if(frameState.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,frameState.postRenderFunctions),previousFrameState)(!this.previousExtent_||!isEmpty$1(this.previousExtent_)&&!equals$1(frameState.extent,this.previousExtent_))&&(this.dispatchEvent(new MapEvent(MapEventType.MOVESTART,this,previousFrameState)),this.previousExtent_=createOrUpdateEmpty(this.previousExtent_));this.previousExtent_&&!frameState.viewHints[ViewHint.ANIMATING]&&!frameState.viewHints[ViewHint.INTERACTING]&&!equals$1(frameState.extent,this.previousExtent_)&&(this.dispatchEvent(new MapEvent(MapEventType.MOVEEND,this,frameState)),clone(frameState.extent,this.previousExtent_))}this.dispatchEvent(new MapEvent(MapEventType.POSTRENDER,this,frameState)),this.postRenderTimeoutHandle_=setTimeout(this.handlePostRender.bind(this),0)},PluggableMap.prototype.setLayerGroup=function(layerGroup){this.set(MapProperty.LAYERGROUP,layerGroup)},PluggableMap.prototype.setSize=function(size){this.set(MapProperty.SIZE,size)},PluggableMap.prototype.setTarget=function(target){this.set(MapProperty.TARGET,target)},PluggableMap.prototype.setView=function(view){this.set(MapProperty.VIEW,view)},PluggableMap.prototype.updateSize=function(){var targetElement=this.getTargetElement();if(targetElement){var computedStyle=getComputedStyle(targetElement);this.setSize([targetElement.offsetWidth-parseFloat(computedStyle.borderLeftWidth)-parseFloat(computedStyle.paddingLeft)-parseFloat(computedStyle.paddingRight)-parseFloat(computedStyle.borderRightWidth),targetElement.offsetHeight-parseFloat(computedStyle.borderTopWidth)-parseFloat(computedStyle.paddingTop)-parseFloat(computedStyle.paddingBottom)-parseFloat(computedStyle.borderBottomWidth)])}else this.setSize(void 0)},PluggableMap}(BaseObject);function createOptionsInternal(options){var keyboardEventTarget=null;void 0!==options.keyboardEventTarget&&(keyboardEventTarget="string"==typeof options.keyboardEventTarget?document.getElementById(options.keyboardEventTarget):options.keyboardEventTarget);var controls,interactions,overlays,values={},layerGroup=options.layers&&"function"==typeof options.layers.getLayers?options.layers:new LayerGroup({layers:options.layers});return values[MapProperty.LAYERGROUP]=layerGroup,values[MapProperty.TARGET]=options.target,values[MapProperty.VIEW]=void 0!==options.view?options.view:new View,void 0!==options.controls&&(Array.isArray(options.controls)?controls=new Collection(options.controls.slice()):(assert("function"==typeof options.controls.getArray,47),controls=options.controls)),void 0!==options.interactions&&(Array.isArray(options.interactions)?interactions=new Collection(options.interactions.slice()):(assert("function"==typeof options.interactions.getArray,48),interactions=options.interactions)),void 0!==options.overlays?Array.isArray(options.overlays)?overlays=new Collection(options.overlays.slice()):(assert("function"==typeof options.overlays.getArray,49),overlays=options.overlays):overlays=new Collection,{controls:controls,interactions:interactions,keyboardEventTarget:keyboardEventTarget,overlays:overlays,values:values}}var Control=function(_super){function Control(options){var _this=_super.call(this)||this;return _this.element=options.element?options.element:null,_this.target_=null,_this.map_=null,_this.listenerKeys=[],_this.render=options.render?options.render:VOID,options.target&&_this.setTarget(options.target),_this}return __extends(Control,_super),Control.prototype.disposeInternal=function(){removeNode(this.element),_super.prototype.disposeInternal.call(this)},Control.prototype.getMap=function(){return this.map_},Control.prototype.setMap=function(map){this.map_&&removeNode(this.element);for(var i=0,ii=this.listenerKeys.length;i<ii;++i)unlistenByKey(this.listenerKeys[i]);(this.listenerKeys.length=0,this.map_=map,this.map_)&&((this.target_?this.target_:map.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==VOID&&this.listenerKeys.push(listen(map,MapEventType.POSTRENDER,this.render,this)),map.render())},Control.prototype.setTarget=function(target){this.target_="string"==typeof target?document.getElementById(target):target},Control}(BaseObject),CLASS_HIDDEN="ol-hidden",CLASS_UNSELECTABLE="ol-unselectable",CLASS_CONTROL="ol-control",CLASS_COLLAPSED="ol-collapsed",getFontParameters=function(){var style,cache={};return function(font){if(style||(style=document.createElement("div").style),!(font in cache)){style.font=font;var family=style.fontFamily,fontWeight=style.fontWeight,fontStyle=style.fontStyle;if(style.font="",!family)return null;var families=family.split(/,\s?/);cache[font]={families:families,weight:fontWeight,style:fontStyle}}return cache[font]}}(),Layer=function(_super){function Layer(options){var _this=this,baseOptions=assign({},options);delete baseOptions.source,(_this=_super.call(this,baseOptions)||this).mapPrecomposeKey_=null,_this.mapRenderKey_=null,_this.sourceChangeKey_=null,_this.renderer_=null,options.render&&(_this.render=options.render),options.map&&_this.setMap(options.map),_this.addEventListener(getChangeEventType(LayerProperty.SOURCE),_this.handleSourcePropertyChange_);var source=options.source?options.source:null;return _this.setSource(source),_this}return __extends(Layer,_super),Layer.prototype.getLayersArray=function(opt_array){var array=opt_array||[];return array.push(this),array},Layer.prototype.getLayerStatesArray=function(opt_states){var states=opt_states||[];return states.push(this.getLayerState()),states},Layer.prototype.getSource=function(){return this.get(LayerProperty.SOURCE)||null},Layer.prototype.getSourceState=function(){var source=this.getSource();return source?source.getState():SourceState.UNDEFINED},Layer.prototype.handleSourceChange_=function(){this.changed()},Layer.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(unlistenByKey(this.sourceChangeKey_),this.sourceChangeKey_=null);var source=this.getSource();source&&(this.sourceChangeKey_=listen(source,EventType.CHANGE,this.handleSourceChange_,this)),this.changed()},Layer.prototype.render=function(frameState,target){var layerRenderer=this.getRenderer();if(layerRenderer.prepareFrame(frameState))return layerRenderer.renderFrame(frameState,target)},Layer.prototype.setMap=function(map){this.mapPrecomposeKey_&&(unlistenByKey(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),map||this.changed(),this.mapRenderKey_&&(unlistenByKey(this.mapRenderKey_),this.mapRenderKey_=null),map&&(this.mapPrecomposeKey_=listen(map,RenderEventType.PRECOMPOSE,function(evt){evt.frameState.layerStatesArray.push(this.getLayerState(!1))},this),this.mapRenderKey_=listen(this,EventType.CHANGE,map.render,map),this.changed())},Layer.prototype.setSource=function(source){this.set(LayerProperty.SOURCE,source)},Layer.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},Layer.prototype.hasRenderer=function(){return!!this.renderer_},Layer.prototype.createRenderer=function(){return null},Layer}(BaseLayer);function inView(layerState,viewState){if(!layerState.visible)return!1;var resolution=viewState.resolution;if(resolution<layerState.minResolution||resolution>=layerState.maxResolution)return!1;var zoom=viewState.zoom;return zoom>layerState.minZoom&&zoom<=layerState.maxZoom}var Attribution=function(_super){function Attribution(opt_options){var _this=this,options=opt_options||{};(_this=_super.call(this,{element:document.createElement("div"),render:options.render||render,target:options.target})||this).ulElement_=document.createElement("ul"),_this.collapsed_=void 0===options.collapsed||options.collapsed,_this.overrideCollapsible_=void 0!==options.collapsible,_this.collapsible_=void 0===options.collapsible||options.collapsible,_this.collapsible_||(_this.collapsed_=!1);var className=void 0!==options.className?options.className:"ol-attribution",tipLabel=void 0!==options.tipLabel?options.tipLabel:"Attributions",collapseLabel=void 0!==options.collapseLabel?options.collapseLabel:"»";"string"==typeof collapseLabel?(_this.collapseLabel_=document.createElement("span"),_this.collapseLabel_.textContent=collapseLabel):_this.collapseLabel_=collapseLabel;var label=void 0!==options.label?options.label:"i";"string"==typeof label?(_this.label_=document.createElement("span"),_this.label_.textContent=label):_this.label_=label;var activeLabel=_this.collapsible_&&!_this.collapsed_?_this.collapseLabel_:_this.label_,button=document.createElement("button");button.setAttribute("type","button"),button.title=tipLabel,button.appendChild(activeLabel),button.addEventListener(EventType.CLICK,_this.handleClick_.bind(_this),!1);var cssClasses=className+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL+(_this.collapsed_&&_this.collapsible_?" "+CLASS_COLLAPSED:"")+(_this.collapsible_?"":" ol-uncollapsible"),element=_this.element;return element.className=cssClasses,element.appendChild(_this.ulElement_),element.appendChild(button),_this.renderedAttributions_=[],_this.renderedVisible_=!0,_this}return __extends(Attribution,_super),Attribution.prototype.collectSourceAttributions_=function(frameState){for(var lookup={},visibleAttributions=[],layerStatesArray=frameState.layerStatesArray,i=0,ii=layerStatesArray.length;i<ii;++i){var layerState=layerStatesArray[i];if(inView(layerState,frameState.viewState)){var source=layerState.layer.getSource();if(source){var attributionGetter=source.getAttributions();if(attributionGetter){var attributions=attributionGetter(frameState);if(attributions)if(this.overrideCollapsible_||!1!==source.getAttributionsCollapsible()||this.setCollapsible(!1),Array.isArray(attributions))for(var j=0,jj=attributions.length;j<jj;++j)attributions[j]in lookup||(visibleAttributions.push(attributions[j]),lookup[attributions[j]]=!0);else attributions in lookup||(visibleAttributions.push(attributions),lookup[attributions]=!0)}}}}return visibleAttributions},Attribution.prototype.updateElement_=function(frameState){if(frameState){var attributions=this.collectSourceAttributions_(frameState),visible=attributions.length>0;if(this.renderedVisible_!=visible&&(this.element.style.display=visible?"":"none",this.renderedVisible_=visible),!equals(attributions,this.renderedAttributions_)){removeChildren(this.ulElement_);for(var i=0,ii=attributions.length;i<ii;++i){var element=document.createElement("li");element.innerHTML=attributions[i],this.ulElement_.appendChild(element)}this.renderedAttributions_=attributions}}else this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1)},Attribution.prototype.handleClick_=function(event){event.preventDefault(),this.handleToggle_()},Attribution.prototype.handleToggle_=function(){this.element.classList.toggle(CLASS_COLLAPSED),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_},Attribution.prototype.getCollapsible=function(){return this.collapsible_},Attribution.prototype.setCollapsible=function(collapsible){this.collapsible_!==collapsible&&(this.collapsible_=collapsible,this.element.classList.toggle("ol-uncollapsible"),!collapsible&&this.collapsed_&&this.handleToggle_())},Attribution.prototype.setCollapsed=function(collapsed){this.collapsible_&&this.collapsed_!==collapsed&&this.handleToggle_()},Attribution.prototype.getCollapsed=function(){return this.collapsed_},Attribution}(Control);function render(mapEvent){this.updateElement_(mapEvent.frameState)}var Rotate=function(_super){function Rotate(opt_options){var _this=this,options=opt_options||{};_this=_super.call(this,{element:document.createElement("div"),render:options.render||render$1,target:options.target})||this;var className=void 0!==options.className?options.className:"ol-rotate",label=void 0!==options.label?options.label:"⇧";_this.label_=null,"string"==typeof label?(_this.label_=document.createElement("span"),_this.label_.className="ol-compass",_this.label_.textContent=label):(_this.label_=label,_this.label_.classList.add("ol-compass"));var tipLabel=options.tipLabel?options.tipLabel:"Reset rotation",button=document.createElement("button");button.className=className+"-reset",button.setAttribute("type","button"),button.title=tipLabel,button.appendChild(_this.label_),button.addEventListener(EventType.CLICK,_this.handleClick_.bind(_this),!1);var cssClasses=className+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,element=_this.element;return element.className=cssClasses,element.appendChild(button),_this.callResetNorth_=options.resetNorth?options.resetNorth:void 0,_this.duration_=void 0!==options.duration?options.duration:250,_this.autoHide_=void 0===options.autoHide||options.autoHide,_this.rotation_=void 0,_this.autoHide_&&_this.element.classList.add(CLASS_HIDDEN),_this}return __extends(Rotate,_super),Rotate.prototype.handleClick_=function(event){event.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()},Rotate.prototype.resetNorth_=function(){var view=this.getMap().getView();view&&void 0!==view.getRotation()&&(this.duration_>0?view.animate({rotation:0,duration:this.duration_,easing:easeOut}):view.setRotation(0))},Rotate}(Control);function render$1(mapEvent){var frameState=mapEvent.frameState;if(frameState){var rotation=frameState.viewState.rotation;if(rotation!=this.rotation_){var transform="rotate("+rotation+"rad)";if(this.autoHide_){var contains=this.element.classList.contains(CLASS_HIDDEN);contains||0!==rotation?contains&&0!==rotation&&this.element.classList.remove(CLASS_HIDDEN):this.element.classList.add(CLASS_HIDDEN)}this.label_.style.transform=transform}this.rotation_=rotation}}var Zoom=function(_super){function Zoom(opt_options){var _this=this,options=opt_options||{};_this=_super.call(this,{element:document.createElement("div"),target:options.target})||this;var className=void 0!==options.className?options.className:"ol-zoom",delta=void 0!==options.delta?options.delta:1,zoomInLabel=void 0!==options.zoomInLabel?options.zoomInLabel:"+",zoomOutLabel=void 0!==options.zoomOutLabel?options.zoomOutLabel:"−",zoomInTipLabel=void 0!==options.zoomInTipLabel?options.zoomInTipLabel:"Zoom in",zoomOutTipLabel=void 0!==options.zoomOutTipLabel?options.zoomOutTipLabel:"Zoom out",inElement=document.createElement("button");inElement.className=className+"-in",inElement.setAttribute("type","button"),inElement.title=zoomInTipLabel,inElement.appendChild("string"==typeof zoomInLabel?document.createTextNode(zoomInLabel):zoomInLabel),inElement.addEventListener(EventType.CLICK,_this.handleClick_.bind(_this,delta),!1);var outElement=document.createElement("button");outElement.className=className+"-out",outElement.setAttribute("type","button"),outElement.title=zoomOutTipLabel,outElement.appendChild("string"==typeof zoomOutLabel?document.createTextNode(zoomOutLabel):zoomOutLabel),outElement.addEventListener(EventType.CLICK,_this.handleClick_.bind(_this,-delta),!1);var cssClasses=className+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,element=_this.element;return element.className=cssClasses,element.appendChild(inElement),element.appendChild(outElement),_this.duration_=void 0!==options.duration?options.duration:250,_this}return __extends(Zoom,_super),Zoom.prototype.handleClick_=function(delta,event){event.preventDefault(),this.zoomByDelta_(delta)},Zoom.prototype.zoomByDelta_=function(delta){var view=this.getMap().getView();if(view){var currentZoom=view.getZoom();if(void 0!==currentZoom){var newZoom=view.getConstrainedZoom(currentZoom+delta);this.duration_>0?(view.getAnimating()&&view.cancelAnimations(),view.animate({zoom:newZoom,duration:this.duration_,easing:easeOut})):view.setZoom(newZoom)}}},Zoom}(Control),RenderEvent=function(_super){function RenderEvent(type,opt_inversePixelTransform,opt_frameState,opt_context){var _this=_super.call(this,type)||this;return _this.inversePixelTransform=opt_inversePixelTransform,_this.frameState=opt_frameState,_this.context=opt_context,_this}return __extends(RenderEvent,_super),RenderEvent}(BaseEvent),HEX_COLOR_RE_=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,NAMED_COLOR_RE_=/^([a-z]*)$/i;function asString(color){return"string"==typeof color?color:toString$1(color)}function fromNamed(color){var el=document.createElement("div");if(el.style.color=color,""!==el.style.color){document.body.appendChild(el);var rgb=getComputedStyle(el).color;return document.body.removeChild(el),rgb}return""}var fromString=function(){var cache={},cacheSize=0;return function(s){var color;if(cache.hasOwnProperty(s))color=cache[s];else{if(cacheSize>=1024){var i=0;for(var key in cache)0==(3&i++)&&(delete cache[key],--cacheSize)}color=fromStringInternal_(s),cache[s]=color,++cacheSize}return color}}();function asArray(color){return Array.isArray(color)?color:fromString(color)}function fromStringInternal_(s){var r,g,b,a,color;if(NAMED_COLOR_RE_.exec(s)&&(s=fromNamed(s)),HEX_COLOR_RE_.exec(s)){var n=s.length-1,d=void 0;d=n<=4?1:2;var hasAlpha=4===n||8===n;r=parseInt(s.substr(1+0*d,d),16),g=parseInt(s.substr(1+1*d,d),16),b=parseInt(s.substr(1+2*d,d),16),a=hasAlpha?parseInt(s.substr(1+3*d,d),16):255,1==d&&(r=(r<<4)+r,g=(g<<4)+g,b=(b<<4)+b,hasAlpha&&(a=(a<<4)+a)),color=[r,g,b,a/255]}else 0==s.indexOf("rgba(")?normalize(color=s.slice(5,-1).split(",").map(Number)):0==s.indexOf("rgb(")?((color=s.slice(4,-1).split(",").map(Number)).push(1),normalize(color)):assert(!1,14);return color}function normalize(color){return color[0]=clamp(color[0]+.5|0,0,255),color[1]=clamp(color[1]+.5|0,0,255),color[2]=clamp(color[2]+.5|0,0,255),color[3]=clamp(color[3],0,1),color}function toString$1(color){var r=color[0];r!=(0|r)&&(r=r+.5|0);var g=color[1];g!=(0|g)&&(g=g+.5|0);var b=color[2];return b!=(0|b)&&(b=b+.5|0),"rgba("+r+","+g+","+b+","+(void 0===color[3]?1:color[3])+")"}var IconImageCache=function(){function IconImageCache(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return IconImageCache.prototype.clear=function(){this.cache_={},this.cacheSize_=0},IconImageCache.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},IconImageCache.prototype.expire=function(){if(this.canExpireCache()){var i=0;for(var key in this.cache_){var iconImage=this.cache_[key];0!=(3&i++)||iconImage.hasListener()||(delete this.cache_[key],--this.cacheSize_)}}},IconImageCache.prototype.get=function(src,crossOrigin,color){var key=getKey(src,crossOrigin,color);return key in this.cache_?this.cache_[key]:null},IconImageCache.prototype.set=function(src,crossOrigin,color,iconImage){var key=getKey(src,crossOrigin,color);this.cache_[key]=iconImage,++this.cacheSize_},IconImageCache.prototype.setSize=function(maxCacheSize){this.maxCacheSize_=maxCacheSize,this.expire()},IconImageCache}();function getKey(src,crossOrigin,color){return crossOrigin+":"+src+":"+(color?asString(color):"null")}var shared=new IconImageCache;function asColorLike(color){return Array.isArray(color)?toString$1(color):color}var measureFont,VectorContext=function(){function VectorContext(){}return VectorContext.prototype.drawCustom=function(geometry,feature,renderer){},VectorContext.prototype.drawGeometry=function(geometry){},VectorContext.prototype.setStyle=function(style){},VectorContext.prototype.drawCircle=function(circleGeometry,feature){},VectorContext.prototype.drawFeature=function(feature,style){},VectorContext.prototype.drawGeometryCollection=function(geometryCollectionGeometry,feature){},VectorContext.prototype.drawLineString=function(lineStringGeometry,feature){},VectorContext.prototype.drawMultiLineString=function(multiLineStringGeometry,feature){},VectorContext.prototype.drawMultiPoint=function(multiPointGeometry,feature){},VectorContext.prototype.drawMultiPolygon=function(multiPolygonGeometry,feature){},VectorContext.prototype.drawPoint=function(pointGeometry,feature){},VectorContext.prototype.drawPolygon=function(polygonGeometry,feature){},VectorContext.prototype.drawText=function(geometry,feature){},VectorContext.prototype.setFillStrokeStyle=function(fillStyle,strokeStyle){},VectorContext.prototype.setImageStyle=function(imageStyle,opt_declutterGroup){},VectorContext.prototype.setTextStyle=function(textStyle,opt_declutterGroups){},VectorContext}(),LRUCache=function(_super){function LRUCache(opt_highWaterMark){var _this=_super.call(this)||this;return _this.highWaterMark=void 0!==opt_highWaterMark?opt_highWaterMark:2048,_this.count_=0,_this.entries_={},_this.oldest_=null,_this.newest_=null,_this}return __extends(LRUCache,_super),LRUCache.prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark},LRUCache.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null,this.dispatchEvent(EventType.CLEAR)},LRUCache.prototype.containsKey=function(key){return this.entries_.hasOwnProperty(key)},LRUCache.prototype.forEach=function(f){for(var entry=this.oldest_;entry;)f(entry.value_,entry.key_,this),entry=entry.newer},LRUCache.prototype.get=function(key,opt_options){var entry=this.entries_[key];return assert(void 0!==entry,15),entry===this.newest_?entry.value_:(entry===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(entry.newer.older=entry.older,entry.older.newer=entry.newer),entry.newer=null,entry.older=this.newest_,this.newest_.newer=entry,this.newest_=entry,entry.value_)},LRUCache.prototype.remove=function(key){var entry=this.entries_[key];return assert(void 0!==entry,15),entry===this.newest_?(this.newest_=entry.older,this.newest_&&(this.newest_.newer=null)):entry===this.oldest_?(this.oldest_=entry.newer,this.oldest_&&(this.oldest_.older=null)):(entry.newer.older=entry.older,entry.older.newer=entry.newer),delete this.entries_[key],--this.count_,entry.value_},LRUCache.prototype.getCount=function(){return this.count_},LRUCache.prototype.getKeys=function(){var entry,keys=new Array(this.count_),i=0;for(entry=this.newest_;entry;entry=entry.older)keys[i++]=entry.key_;return keys},LRUCache.prototype.getValues=function(){var entry,values=new Array(this.count_),i=0;for(entry=this.newest_;entry;entry=entry.older)values[i++]=entry.value_;return values},LRUCache.prototype.peekLast=function(){return this.oldest_.value_},LRUCache.prototype.peekLastKey=function(){return this.oldest_.key_},LRUCache.prototype.peekFirstKey=function(){return this.newest_.key_},LRUCache.prototype.pop=function(){var entry=this.oldest_;return delete this.entries_[entry.key_],entry.newer&&(entry.newer.older=null),this.oldest_=entry.newer,this.oldest_||(this.newest_=null),--this.count_,entry.value_},LRUCache.prototype.replace=function(key,value){this.get(key),this.entries_[key].value_=value},LRUCache.prototype.set=function(key,value){assert(!(key in this.entries_),16);var entry={key_:key,newer:null,older:this.newest_,value_:value};this.newest_?this.newest_.newer=entry:this.oldest_=entry,this.newest_=entry,this.entries_[key]=entry,++this.count_},LRUCache.prototype.setSize=function(size){this.highWaterMark=size},LRUCache}(Target),LabelCache=function(_super){function LabelCache(opt_highWaterMark){var _this=_super.call(this,opt_highWaterMark)||this;return _this.consumers={},_this}return __extends(LabelCache,_super),LabelCache.prototype.clear=function(){this.consumers={},_super.prototype.clear.call(this)},LabelCache.prototype.get=function(key,consumer){var canvas=_super.prototype.get.call(this,key),consumerId=getUid(consumer);return consumerId in this.consumers||(this.consumers[consumerId]={}),this.consumers[consumerId][key]=!0,canvas},LabelCache.prototype.prune=function(){outer:for(;this.canExpireCache();){var key=this.peekLastKey();for(var consumerId in this.consumers)if(key in this.consumers[consumerId])break outer;var canvas=this.pop();for(var consumerId in canvas.width=canvas.height=0,this.consumers)delete this.consumers[consumerId][key]}},LabelCache.prototype.release=function(consumer){delete this.consumers[getUid(consumer)]},LabelCache}(LRUCache),defaultFont="10px sans-serif",defaultFillStyle="#000",defaultLineCap="round",defaultLineDash=[],defaultLineDashOffset=0,defaultLineJoin="round",defaultMiterLimit=10,defaultStrokeStyle="#000",defaultTextAlign="center",defaultTextBaseline="middle",defaultPadding=[0,0,0,0],defaultLineWidth=1,labelCache=new LabelCache,checkedFonts={},measureContext=null,textHeights={},checkFont=function(){var interval,referenceWidth,retries=100,checked=checkedFonts,size="32px ",referenceFonts=["monospace","serif"],len=referenceFonts.length,text="wmytzilWMYTZIL@#/&?$%10";function isAvailable(fontStyle,fontWeight,fontFamily){for(var context=getMeasureContext(),available=!0,i=0;i<len;++i){var referenceFont=referenceFonts[i];if(context.font=fontStyle+" "+fontWeight+" "+size+referenceFont,referenceWidth=context.measureText(text).width,fontFamily!=referenceFont){context.font=fontStyle+" "+fontWeight+" "+size+fontFamily+","+referenceFont;var width=context.measureText(text).width;available=available&&width!=referenceWidth}}return!!available}function check(){var done=!0;for(var font in checked)checked[font]<retries&&(isAvailable.apply(this,font.split("\n"))?(checked[font]=retries,clear(textHeights),measureContext=null,measureFont=void 0,labelCache.getCount()&&labelCache.clear()):(++checked[font],done=!1));done&&(clearInterval(interval),interval=void 0)}return function(fontSpec){var font=getFontParameters(fontSpec);if(font)for(var families=font.families,i=0,ii=families.length;i<ii;++i){var family=families[i],key=font.style+"\n"+font.weight+"\n"+family;key in checked||(checked[key]=retries,isAvailable(font.style,font.weight,family)||(checked[key]=0,void 0===interval&&(interval=setInterval(check,32))))}}}();function getMeasureContext(){return measureContext||(measureContext=createCanvasContext2D(1,1)),measureContext}var measureTextHeight=function(){var div,heights=textHeights;return function(font){var height=heights[font];return null==height&&(div||((div=document.createElement("div")).innerHTML="M",div.style.margin=div.style.padding="0 !important",div.style.position="absolute !important",div.style.left="-99999px !important"),div.style.font=font,document.body.appendChild(div),height=heights[font]=div.offsetHeight,document.body.removeChild(div)),height}}();function measureTextWidth(font,text){var measureContext=getMeasureContext();return font!=measureFont&&(measureContext.font=measureFont=font),measureContext.measureText(text).width}function measureAndCacheTextWidth(font,text,cache){return text in cache?cache[text]:cache[text]=measureTextWidth(font,text)}function measureTextWidths(font,lines,widths){for(var numLines=lines.length,width=0,i=0;i<numLines;++i){var currentWidth=measureTextWidth(font,lines[i]);width=Math.max(width,currentWidth),widths.push(currentWidth)}return width}function rotateAtOffset(context,rotation,offsetX,offsetY){0!==rotation&&(context.translate(offsetX,offsetY),context.rotate(rotation),context.translate(-offsetX,-offsetY))}var resetTransform=create();function drawImage(context,transform,opacity,image,originX,originY,w,h,x,y,scale){var alpha;1!=opacity&&(alpha=context.globalAlpha,context.globalAlpha=alpha*opacity),transform&&context.setTransform.apply(context,transform),context.drawImage(image,originX,originY,w,h,x,y,w*scale,h*scale),1!=opacity&&(context.globalAlpha=alpha),transform&&context.setTransform.apply(context,resetTransform)}var ImageState={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4},BuilderType={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"},SIMPLIFY_TOLERANCE=.5,GEOMETRY_RENDERERS={Point:renderPointGeometry,LineString:renderLineStringGeometry,Polygon:renderPolygonGeometry,MultiPoint:renderMultiPointGeometry,MultiLineString:renderMultiLineStringGeometry,MultiPolygon:renderMultiPolygonGeometry,GeometryCollection:renderGeometryCollectionGeometry,Circle:renderCircleGeometry};function defaultOrder(feature1,feature2){return parseInt(getUid(feature1),10)-parseInt(getUid(feature2),10)}function getSquaredTolerance(resolution,pixelRatio){var tolerance=getTolerance(resolution,pixelRatio);return tolerance*tolerance}function getTolerance(resolution,pixelRatio){return SIMPLIFY_TOLERANCE*resolution/pixelRatio}function renderCircleGeometry(builderGroup,geometry,style,feature){var fillStyle=style.getFill(),strokeStyle=style.getStroke();if(fillStyle||strokeStyle){var circleReplay=builderGroup.getBuilder(style.getZIndex(),BuilderType.CIRCLE);circleReplay.setFillStrokeStyle(fillStyle,strokeStyle),circleReplay.drawCircle(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=builderGroup.getBuilder(style.getZIndex(),BuilderType.TEXT);textReplay.setTextStyle(textStyle,builderGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}}function renderFeature(replayGroup,feature,style,squaredTolerance,listener,opt_transform){var loading=!1,imageStyle=style.getImage();if(imageStyle){var imageState=imageStyle.getImageState();imageState==ImageState.LOADED||imageState==ImageState.ERROR?imageStyle.unlistenImageChange(listener):(imageState==ImageState.IDLE&&imageStyle.load(),imageState=imageStyle.getImageState(),imageStyle.listenImageChange(listener),loading=!0)}return renderFeatureInternal(replayGroup,feature,style,squaredTolerance,opt_transform),loading}function renderFeatureInternal(replayGroup,feature,style,squaredTolerance,opt_transform){var geometry=style.getGeometryFunction()(feature);if(geometry){var simplifiedGeometry=geometry.simplifyTransformed(squaredTolerance,opt_transform);if(style.getRenderer())renderGeometry(replayGroup,simplifiedGeometry,style,feature);else(0,GEOMETRY_RENDERERS[simplifiedGeometry.getType()])(replayGroup,simplifiedGeometry,style,feature)}}function renderGeometry(replayGroup,geometry,style,feature){if(geometry.getType()!=GeometryType.GEOMETRY_COLLECTION)replayGroup.getBuilder(style.getZIndex(),BuilderType.DEFAULT).drawCustom(geometry,feature,style.getRenderer());else for(var geometries=geometry.getGeometries(),i=0,ii=geometries.length;i<ii;++i)renderGeometry(replayGroup,geometries[i],style,feature)}function renderGeometryCollectionGeometry(replayGroup,geometry,style,feature){var i,ii,geometries=geometry.getGeometriesArray();for(i=0,ii=geometries.length;i<ii;++i){(0,GEOMETRY_RENDERERS[geometries[i].getType()])(replayGroup,geometries[i],style,feature)}}function renderLineStringGeometry(builderGroup,geometry,style,feature){var strokeStyle=style.getStroke();if(strokeStyle){var lineStringReplay=builderGroup.getBuilder(style.getZIndex(),BuilderType.LINE_STRING);lineStringReplay.setFillStrokeStyle(null,strokeStyle),lineStringReplay.drawLineString(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=builderGroup.getBuilder(style.getZIndex(),BuilderType.TEXT);textReplay.setTextStyle(textStyle,builderGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}}function renderMultiLineStringGeometry(builderGroup,geometry,style,feature){var strokeStyle=style.getStroke();if(strokeStyle){var lineStringReplay=builderGroup.getBuilder(style.getZIndex(),BuilderType.LINE_STRING);lineStringReplay.setFillStrokeStyle(null,strokeStyle),lineStringReplay.drawMultiLineString(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=builderGroup.getBuilder(style.getZIndex(),BuilderType.TEXT);textReplay.setTextStyle(textStyle,builderGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}}function renderMultiPolygonGeometry(builderGroup,geometry,style,feature){var fillStyle=style.getFill(),strokeStyle=style.getStroke();if(strokeStyle||fillStyle){var polygonReplay=builderGroup.getBuilder(style.getZIndex(),BuilderType.POLYGON);polygonReplay.setFillStrokeStyle(fillStyle,strokeStyle),polygonReplay.drawMultiPolygon(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=builderGroup.getBuilder(style.getZIndex(),BuilderType.TEXT);textReplay.setTextStyle(textStyle,builderGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}}function renderPointGeometry(builderGroup,geometry,style,feature){var imageStyle=style.getImage();if(imageStyle){if(imageStyle.getImageState()!=ImageState.LOADED)return;var imageReplay=builderGroup.getBuilder(style.getZIndex(),BuilderType.IMAGE);imageReplay.setImageStyle(imageStyle,builderGroup.addDeclutter(!1)),imageReplay.drawPoint(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=builderGroup.getBuilder(style.getZIndex(),BuilderType.TEXT);textReplay.setTextStyle(textStyle,builderGroup.addDeclutter(!!imageStyle)),textReplay.drawText(geometry,feature)}}function renderMultiPointGeometry(builderGroup,geometry,style,feature){var imageStyle=style.getImage();if(imageStyle){if(imageStyle.getImageState()!=ImageState.LOADED)return;var imageReplay=builderGroup.getBuilder(style.getZIndex(),BuilderType.IMAGE);imageReplay.setImageStyle(imageStyle,builderGroup.addDeclutter(!1)),imageReplay.drawMultiPoint(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=builderGroup.getBuilder(style.getZIndex(),BuilderType.TEXT);textReplay.setTextStyle(textStyle,builderGroup.addDeclutter(!!imageStyle)),textReplay.drawText(geometry,feature)}}function renderPolygonGeometry(builderGroup,geometry,style,feature){var fillStyle=style.getFill(),strokeStyle=style.getStroke();if(fillStyle||strokeStyle){var polygonReplay=builderGroup.getBuilder(style.getZIndex(),BuilderType.POLYGON);polygonReplay.setFillStrokeStyle(fillStyle,strokeStyle),polygonReplay.drawPolygon(geometry,feature)}var textStyle=style.getText();if(textStyle){var textReplay=builderGroup.getBuilder(style.getZIndex(),BuilderType.TEXT);textReplay.setTextStyle(textStyle,builderGroup.addDeclutter(!1)),textReplay.drawText(geometry,feature)}}function renderDeclutterItems(frameState,declutterTree){declutterTree&&declutterTree.clear();for(var items=frameState.declutterItems,z=items.length-1;z>=0;--z)for(var item=items[z],zIndexItems=item.items,i=0,ii=zIndexItems.length;i<ii;i+=3)declutterTree=zIndexItems[i].renderDeclutter(zIndexItems[i+1],zIndexItems[i+2],item.opacity,declutterTree);return items.length=0,declutterTree}var MapRenderer=function(_super){function MapRenderer(map){var _this=_super.call(this)||this;return _this.map_=map,_this.declutterTree_=null,_this}return __extends(MapRenderer,_super),MapRenderer.prototype.dispatchRenderEvent=function(type,frameState){abstract()},MapRenderer.prototype.calculateMatrices2D=function(frameState){var viewState=frameState.viewState,coordinateToPixelTransform=frameState.coordinateToPixelTransform,pixelToCoordinateTransform=frameState.pixelToCoordinateTransform;compose(coordinateToPixelTransform,frameState.size[0]/2,frameState.size[1]/2,1/viewState.resolution,-1/viewState.resolution,-viewState.rotation,-viewState.center[0],-viewState.center[1]),makeInverse(pixelToCoordinateTransform,coordinateToPixelTransform)},MapRenderer.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,checkWrapped,callback,thisArg,layerFilter,thisArg2){var result,viewState=frameState.viewState;function forEachFeatureAtCoordinate(managed,feature,layer){return callback.call(thisArg,feature,managed?layer:null)}var projection=viewState.projection,translatedCoordinate=coordinate,offsets=[[0,0]];if(projection.canWrapX()){var projectionExtent=projection.getExtent(),worldWidth=getWidth(projectionExtent),x=coordinate[0];if(x<projectionExtent[0]||x>projectionExtent[2])translatedCoordinate=[x+worldWidth*Math.ceil((projectionExtent[0]-x)/worldWidth),coordinate[1]];checkWrapped&&offsets.push([-worldWidth,0],[worldWidth,0])}var declutteredFeatures,layerStates=frameState.layerStatesArray,numLayers=layerStates.length;this.declutterTree_&&(declutteredFeatures=this.declutterTree_.all().map(function(entry){return entry.value}));for(var tmpCoord=[],i=0;i<offsets.length;i++)for(var j=numLayers-1;j>=0;--j){var layerState=layerStates[j],layer=layerState.layer;if(layer.hasRenderer()&&inView(layerState,viewState)&&layerFilter.call(thisArg2,layer)){var layerRenderer=layer.getRenderer(),source=layer.getSource(),coordinates=source.getWrapX()?translatedCoordinate:coordinate;if(layerRenderer&&source){var callback_1=forEachFeatureAtCoordinate.bind(null,layerState.managed);tmpCoord[0]=coordinates[0]+offsets[i][0],tmpCoord[1]=coordinates[1]+offsets[i][1],result=layerRenderer.forEachFeatureAtCoordinate(tmpCoord,frameState,hitTolerance,callback_1,declutteredFeatures)}if(result)return result}}},MapRenderer.prototype.forEachLayerAtPixel=function(pixel,frameState,hitTolerance,callback,layerFilter){return abstract()},MapRenderer.prototype.hasFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,checkWrapped,layerFilter,thisArg){return void 0!==this.forEachFeatureAtCoordinate(coordinate,frameState,hitTolerance,checkWrapped,TRUE,this,layerFilter,thisArg)},MapRenderer.prototype.getMap=function(){return this.map_},MapRenderer.prototype.renderFrame=function(frameState){this.declutterTree_=renderDeclutterItems(frameState,this.declutterTree_)},MapRenderer.prototype.scheduleExpireIconCache=function(frameState){shared.canExpireCache()&&frameState.postRenderFunctions.push(expireIconCache)},MapRenderer}(Disposable);function expireIconCache(map,frameState){shared.expire()}var CompositeMapRenderer=function(_super){function CompositeMapRenderer(map){var _this=_super.call(this,map)||this;_this.labelCacheKey_=listen(labelCache,EventType.CLEAR,map.redrawText.bind(map)),_this.element_=document.createElement("div");var style=_this.element_.style;style.position="absolute",style.width="100%",style.height="100%",style.zIndex="0",_this.element_.className=CLASS_UNSELECTABLE+" ol-layers";var container=map.getViewport();return container.insertBefore(_this.element_,container.firstChild||null),_this.children_=[],_this.renderedVisible_=!0,_this}return __extends(CompositeMapRenderer,_super),CompositeMapRenderer.prototype.dispatchRenderEvent=function(type,frameState){var map=this.getMap();if(map.hasListener(type)){var event_1=new RenderEvent(type,void 0,frameState);map.dispatchEvent(event_1)}},CompositeMapRenderer.prototype.disposeInternal=function(){unlistenByKey(this.labelCacheKey_),_super.prototype.disposeInternal.call(this)},CompositeMapRenderer.prototype.renderFrame=function(frameState){if(frameState){this.calculateMatrices2D(frameState),this.dispatchRenderEvent(RenderEventType.PRECOMPOSE,frameState);var layerStatesArray=frameState.layerStatesArray.sort(function(a,b){return a.zIndex-b.zIndex}),viewState=frameState.viewState;this.children_.length=0;for(var hasOverlay=!1,previousElement=null,i=0,ii=layerStatesArray.length;i<ii;++i){var layerState=layerStatesArray[i];if(hasOverlay=hasOverlay||layerState.hasOverlay,frameState.layerIndex=i,inView(layerState,viewState)&&(layerState.sourceState==SourceState.READY||layerState.sourceState==SourceState.UNDEFINED)){var element=layerState.layer.render(frameState,previousElement);if(element){var childElementCount=element.childElementCount;element===previousElement&&i!=ii-1||2!==childElementCount||hasOverlay||element.removeChild(element.lastElementChild),element!==previousElement&&(this.children_.push(element),hasOverlay=2===childElementCount,previousElement=element)}}}_super.prototype.renderFrame.call(this,frameState),replaceChildren(this.element_,this.children_),this.dispatchRenderEvent(RenderEventType.POSTCOMPOSE,frameState),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(frameState)}else this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1)},CompositeMapRenderer.prototype.forEachLayerAtPixel=function(pixel,frameState,hitTolerance,callback,layerFilter){for(var viewState=frameState.viewState,layerStates=frameState.layerStatesArray,i=layerStates.length-1;i>=0;--i){var layerState=layerStates[i],layer=layerState.layer;if(layer.hasRenderer()&&inView(layerState,viewState)&&layerFilter(layer)){var data=layer.getRenderer().getDataAtPixel(pixel,frameState,hitTolerance);if(data){var result=callback(layer,data);if(result)return result}}}},CompositeMapRenderer}(MapRenderer);function defaults(opt_options){var options=opt_options||{},controls=new Collection;return(void 0===options.zoom||options.zoom)&&controls.push(new Zoom(options.zoomOptions)),(void 0===options.rotate||options.rotate)&&controls.push(new Rotate(options.rotateOptions)),(void 0===options.attribution||options.attribution)&&controls.push(new Attribution(options.attributionOptions)),controls}var Kinetic=function(){function Kinetic(decay,minVelocity,delay){this.decay_=decay,this.minVelocity_=minVelocity,this.delay_=delay,this.points_=[],this.angle_=0,this.initialVelocity_=0}return Kinetic.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},Kinetic.prototype.update=function(x,y){this.points_.push(x,y,Date.now())},Kinetic.prototype.end=function(){if(this.points_.length<6)return!1;var delay=Date.now()-this.delay_,lastIndex=this.points_.length-3;if(this.points_[lastIndex+2]<delay)return!1;for(var firstIndex=lastIndex-3;firstIndex>0&&this.points_[firstIndex+2]>delay;)firstIndex-=3;var duration=this.points_[lastIndex+2]-this.points_[firstIndex+2];if(duration<1e3/60)return!1;var dx=this.points_[lastIndex]-this.points_[firstIndex],dy=this.points_[lastIndex+1]-this.points_[firstIndex+1];return this.angle_=Math.atan2(dy,dx),this.initialVelocity_=Math.sqrt(dx*dx+dy*dy)/duration,this.initialVelocity_>this.minVelocity_},Kinetic.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},Kinetic.prototype.getAngle=function(){return this.angle_},Kinetic}(),InteractionProperty={ACTIVE:"active"},Interaction=function(_super){function Interaction(options){var _this=_super.call(this)||this;return options.handleEvent&&(_this.handleEvent=options.handleEvent),_this.map_=null,_this.setActive(!0),_this}return __extends(Interaction,_super),Interaction.prototype.getActive=function(){return this.get(InteractionProperty.ACTIVE)},Interaction.prototype.getMap=function(){return this.map_},Interaction.prototype.handleEvent=function(mapBrowserEvent){return!0},Interaction.prototype.setActive=function(active){this.set(InteractionProperty.ACTIVE,active)},Interaction.prototype.setMap=function(map){this.map_=map},Interaction}(BaseObject);function pan(view,delta,opt_duration){var currentCenter=view.getCenterInternal();if(currentCenter){var center=[currentCenter[0]+delta[0],currentCenter[1]+delta[1]];view.animateInternal({duration:void 0!==opt_duration?opt_duration:250,easing:linear,center:view.getConstrainedCenter(center)})}}function zoomByDelta(view,delta,opt_anchor,opt_duration){var currentZoom=view.getZoom();if(void 0!==currentZoom){var newZoom=view.getConstrainedZoom(currentZoom+delta),newResolution=view.getResolutionForZoom(newZoom);view.getAnimating()&&view.cancelAnimations(),view.animate({resolution:newResolution,anchor:opt_anchor,duration:void 0!==opt_duration?opt_duration:250,easing:easeOut})}}var DoubleClickZoom=function(_super){function DoubleClickZoom(opt_options){var _this=_super.call(this,{handleEvent:handleEvent})||this,options=opt_options||{};return _this.delta_=options.delta?options.delta:1,_this.duration_=void 0!==options.duration?options.duration:250,_this}return __extends(DoubleClickZoom,_super),DoubleClickZoom}(Interaction);function handleEvent(mapBrowserEvent){var stopEvent=!1;if(mapBrowserEvent.type==MapBrowserEventType.DBLCLICK){var browserEvent=mapBrowserEvent.originalEvent,map=mapBrowserEvent.map,anchor=mapBrowserEvent.coordinate,delta=browserEvent.shiftKey?-this.delta_:this.delta_;zoomByDelta(map.getView(),delta,anchor,this.duration_),mapBrowserEvent.preventDefault(),stopEvent=!0}return!stopEvent}var altShiftKeysOnly=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&originalEvent.shiftKey},focus=function(event){return event.target.getTargetElement()===document.activeElement},always=TRUE,mouseActionButton=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return 0==originalEvent.button&&!(WEBKIT&&MAC&&originalEvent.ctrlKey)},noModifierKeys=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return!originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&!originalEvent.shiftKey},shiftKeyOnly=function(mapBrowserEvent){var originalEvent=mapBrowserEvent.originalEvent;return!originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&originalEvent.shiftKey},targetNotEditable=function(mapBrowserEvent){var tagName=mapBrowserEvent.target.tagName;return"INPUT"!==tagName&&"SELECT"!==tagName&&"TEXTAREA"!==tagName},mouseOnly=function(mapBrowserEvent){var pointerEvent=mapBrowserEvent.pointerEvent;return assert(void 0!==pointerEvent,56),"mouse"==pointerEvent.pointerType},primaryAction=function(mapBrowserEvent){var pointerEvent=mapBrowserEvent.pointerEvent;return assert(void 0!==pointerEvent,56),pointerEvent.isPrimary&&0===pointerEvent.button},PointerInteraction=function(_super){function PointerInteraction(opt_options){var _this=this,options=opt_options||{};return _this=_super.call(this,options)||this,options.handleDownEvent&&(_this.handleDownEvent=options.handleDownEvent),options.handleDragEvent&&(_this.handleDragEvent=options.handleDragEvent),options.handleMoveEvent&&(_this.handleMoveEvent=options.handleMoveEvent),options.handleUpEvent&&(_this.handleUpEvent=options.handleUpEvent),options.stopDown&&(_this.stopDown=options.stopDown),_this.handlingDownUpSequence=!1,_this.trackedPointers_={},_this.targetPointers=[],_this}return __extends(PointerInteraction,_super),PointerInteraction.prototype.handleDownEvent=function(mapBrowserEvent){return!1},PointerInteraction.prototype.handleDragEvent=function(mapBrowserEvent){},PointerInteraction.prototype.handleEvent=function(mapBrowserEvent){if(!mapBrowserEvent.pointerEvent)return!0;var stopEvent=!1;if(this.updateTrackedPointers_(mapBrowserEvent),this.handlingDownUpSequence){if(mapBrowserEvent.type==MapBrowserEventType.POINTERDRAG)this.handleDragEvent(mapBrowserEvent);else if(mapBrowserEvent.type==MapBrowserEventType.POINTERUP){var handledUp=this.handleUpEvent(mapBrowserEvent);this.handlingDownUpSequence=handledUp&&this.targetPointers.length>0}}else if(mapBrowserEvent.type==MapBrowserEventType.POINTERDOWN){var handled=this.handleDownEvent(mapBrowserEvent);handled&&mapBrowserEvent.preventDefault(),this.handlingDownUpSequence=handled,stopEvent=this.stopDown(handled)}else mapBrowserEvent.type==MapBrowserEventType.POINTERMOVE&&this.handleMoveEvent(mapBrowserEvent);return!stopEvent},PointerInteraction.prototype.handleMoveEvent=function(mapBrowserEvent){},PointerInteraction.prototype.handleUpEvent=function(mapBrowserEvent){return!1},PointerInteraction.prototype.stopDown=function(handled){return handled},PointerInteraction.prototype.updateTrackedPointers_=function(mapBrowserEvent){if(isPointerDraggingEvent(mapBrowserEvent)){var event_1=mapBrowserEvent.pointerEvent,id=event_1.pointerId.toString();mapBrowserEvent.type==MapBrowserEventType.POINTERUP?delete this.trackedPointers_[id]:mapBrowserEvent.type==MapBrowserEventType.POINTERDOWN?this.trackedPointers_[id]=event_1:id in this.trackedPointers_&&(this.trackedPointers_[id]=event_1),this.targetPointers=getValues(this.trackedPointers_)}},PointerInteraction}(Interaction);function centroid(pointerEvents){for(var length=pointerEvents.length,clientX=0,clientY=0,i=0;i<length;i++)clientX+=pointerEvents[i].clientX,clientY+=pointerEvents[i].clientY;return[clientX/length,clientY/length]}function isPointerDraggingEvent(mapBrowserEvent){var type=mapBrowserEvent.type;return type===MapBrowserEventType.POINTERDOWN||type===MapBrowserEventType.POINTERDRAG||type===MapBrowserEventType.POINTERUP}var DragPan=function(_super){function DragPan(opt_options){var _this=_super.call(this,{stopDown:FALSE})||this,options=opt_options||{};return _this.kinetic_=options.kinetic,_this.lastCentroid=null,_this.lastPointersCount_,_this.panning_=!1,_this.condition_=options.condition?options.condition:defaultCondition,_this.noKinetic_=!1,_this}return __extends(DragPan,_super),DragPan.prototype.handleDragEvent=function(mapBrowserEvent){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());var targetPointers=this.targetPointers,centroid$1=centroid(targetPointers);if(targetPointers.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(centroid$1[0],centroid$1[1]),this.lastCentroid){var delta=[this.lastCentroid[0]-centroid$1[0],centroid$1[1]-this.lastCentroid[1]],view=mapBrowserEvent.map.getView();scale(delta,view.getResolution()),rotate(delta,view.getRotation()),view.adjustCenterInternal(delta)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=centroid$1,this.lastPointersCount_=targetPointers.length},DragPan.prototype.handleUpEvent=function(mapBrowserEvent){var map=mapBrowserEvent.map,view=map.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var distance=this.kinetic_.getDistance(),angle=this.kinetic_.getAngle(),center=view.getCenterInternal(),centerpx=map.getPixelFromCoordinateInternal(center),dest=map.getCoordinateFromPixelInternal([centerpx[0]-distance*Math.cos(angle),centerpx[1]-distance*Math.sin(angle)]);view.animateInternal({center:view.getConstrainedCenter(dest),duration:500,easing:easeOut})}return this.panning_&&(this.panning_=!1,view.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},DragPan.prototype.handleDownEvent=function(mapBrowserEvent){if(this.targetPointers.length>0&&this.condition_(mapBrowserEvent)){var view=mapBrowserEvent.map.getView();return this.lastCentroid=null,view.getAnimating()&&view.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1},DragPan}(PointerInteraction);function defaultCondition(mapBrowserEvent){return noModifierKeys(mapBrowserEvent)&&primaryAction(mapBrowserEvent)}var DragRotate=function(_super){function DragRotate(opt_options){var _this=this,options=opt_options||{};return(_this=_super.call(this,{stopDown:FALSE})||this).condition_=options.condition?options.condition:altShiftKeysOnly,_this.lastAngle_=void 0,_this.duration_=void 0!==options.duration?options.duration:250,_this}return __extends(DragRotate,_super),DragRotate.prototype.handleDragEvent=function(mapBrowserEvent){if(mouseOnly(mapBrowserEvent)){var map=mapBrowserEvent.map,view=map.getView();if(view.getConstraints().rotation!==disable){var size=map.getSize(),offset=mapBrowserEvent.pixel,theta=Math.atan2(size[1]/2-offset[1],offset[0]-size[0]/2);if(void 0!==this.lastAngle_){var delta=theta-this.lastAngle_;view.adjustRotationInternal(-delta)}this.lastAngle_=theta}}},DragRotate.prototype.handleUpEvent=function(mapBrowserEvent){return!mouseOnly(mapBrowserEvent)||(mapBrowserEvent.map.getView().endInteraction(this.duration_),!1)},DragRotate.prototype.handleDownEvent=function(mapBrowserEvent){return!!mouseOnly(mapBrowserEvent)&&(!(!mouseActionButton(mapBrowserEvent)||!this.condition_(mapBrowserEvent))&&(mapBrowserEvent.map.getView().beginInteraction(),this.lastAngle_=void 0,!0))},DragRotate}(PointerInteraction),RenderBox=function(_super){function RenderBox(className){var _this=_super.call(this)||this;return _this.geometry_=null,_this.element_=document.createElement("div"),_this.element_.style.position="absolute",_this.element_.className="ol-box "+className,_this.map_=null,_this.startPixel_=null,_this.endPixel_=null,_this}return __extends(RenderBox,_super),RenderBox.prototype.disposeInternal=function(){this.setMap(null)},RenderBox.prototype.render_=function(){var startPixel=this.startPixel_,endPixel=this.endPixel_,style=this.element_.style;style.left=Math.min(startPixel[0],endPixel[0])+"px",style.top=Math.min(startPixel[1],endPixel[1])+"px",style.width=Math.abs(endPixel[0]-startPixel[0])+"px",style.height=Math.abs(endPixel[1]-startPixel[1])+"px"},RenderBox.prototype.setMap=function(map){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var style=this.element_.style;style.left=style.top=style.width=style.height="inherit"}this.map_=map,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},RenderBox.prototype.setPixels=function(startPixel,endPixel){this.startPixel_=startPixel,this.endPixel_=endPixel,this.createOrUpdateGeometry(),this.render_()},RenderBox.prototype.createOrUpdateGeometry=function(){var startPixel=this.startPixel_,endPixel=this.endPixel_,coordinates=[startPixel,[startPixel[0],endPixel[1]],endPixel,[endPixel[0],startPixel[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);coordinates[4]=coordinates[0].slice(),this.geometry_?this.geometry_.setCoordinates([coordinates]):this.geometry_=new Polygon([coordinates])},RenderBox.prototype.getGeometry=function(){return this.geometry_},RenderBox}(Disposable),DragBoxEventType={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend"},DragBoxEvent=function(_super){function DragBoxEvent(type,coordinate,mapBrowserEvent){var _this=_super.call(this,type)||this;return _this.coordinate=coordinate,_this.mapBrowserEvent=mapBrowserEvent,_this}return __extends(DragBoxEvent,_super),DragBoxEvent}(BaseEvent),DragBox=function(_super){function DragBox(opt_options){var _this=_super.call(this)||this,options=opt_options||{};return _this.box_=new RenderBox(options.className||"ol-dragbox"),_this.minArea_=void 0!==options.minArea?options.minArea:64,_this.onBoxEnd_=options.onBoxEnd?options.onBoxEnd:VOID,_this.startPixel_=null,_this.condition_=options.condition?options.condition:always,_this.boxEndCondition_=options.boxEndCondition?options.boxEndCondition:_this.defaultBoxEndCondition,_this}return __extends(DragBox,_super),DragBox.prototype.defaultBoxEndCondition=function(mapBrowserEvent,startPixel,endPixel){var width=endPixel[0]-startPixel[0],height=endPixel[1]-startPixel[1];return width*width+height*height>=this.minArea_},DragBox.prototype.getGeometry=function(){return this.box_.getGeometry()},DragBox.prototype.handleDragEvent=function(mapBrowserEvent){mouseOnly(mapBrowserEvent)&&(this.box_.setPixels(this.startPixel_,mapBrowserEvent.pixel),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXDRAG,mapBrowserEvent.coordinate,mapBrowserEvent)))},DragBox.prototype.handleUpEvent=function(mapBrowserEvent){return!mouseOnly(mapBrowserEvent)||(this.box_.setMap(null),this.boxEndCondition_(mapBrowserEvent,this.startPixel_,mapBrowserEvent.pixel)&&(this.onBoxEnd_(mapBrowserEvent),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXEND,mapBrowserEvent.coordinate,mapBrowserEvent))),!1)},DragBox.prototype.handleDownEvent=function(mapBrowserEvent){return!!mouseOnly(mapBrowserEvent)&&(!(!mouseActionButton(mapBrowserEvent)||!this.condition_(mapBrowserEvent))&&(this.startPixel_=mapBrowserEvent.pixel,this.box_.setMap(mapBrowserEvent.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new DragBoxEvent(DragBoxEventType.BOXSTART,mapBrowserEvent.coordinate,mapBrowserEvent)),!0))},DragBox}(PointerInteraction),DragZoom=function(_super){function DragZoom(opt_options){var _this=this,options=opt_options||{},condition=options.condition?options.condition:shiftKeyOnly;return(_this=_super.call(this,{condition:condition,className:options.className||"ol-dragzoom",minArea:options.minArea,onBoxEnd:onBoxEnd})||this).duration_=void 0!==options.duration?options.duration:200,_this.out_=void 0!==options.out&&options.out,_this}return __extends(DragZoom,_super),DragZoom}(DragBox);function onBoxEnd(){var map=this.getMap(),view=map.getView(),size=map.getSize(),extent=this.getGeometry().getExtent();if(this.out_){var mapExtent=view.calculateExtentInternal(size),boxPixelExtent=createOrUpdateFromCoordinates([map.getPixelFromCoordinateInternal(getBottomLeft(extent)),map.getPixelFromCoordinateInternal(getTopRight(extent))]);scaleFromCenter(mapExtent,1/view.getResolutionForExtentInternal(boxPixelExtent,size)),extent=mapExtent}var resolution=view.getConstrainedResolution(view.getResolutionForExtentInternal(extent,size)),center=view.getConstrainedCenter(getCenter(extent),resolution);view.animateInternal({resolution:resolution,center:center,duration:this.duration_,easing:easeOut})}var KeyCode={LEFT:37,UP:38,RIGHT:39,DOWN:40},KeyboardPan=function(_super){function KeyboardPan(opt_options){var _this=_super.call(this,{handleEvent:handleEvent$1})||this,options=opt_options||{};return _this.defaultCondition_=function(mapBrowserEvent){return noModifierKeys(mapBrowserEvent)&&targetNotEditable(mapBrowserEvent)},_this.condition_=void 0!==options.condition?options.condition:_this.defaultCondition_,_this.duration_=void 0!==options.duration?options.duration:100,_this.pixelDelta_=void 0!==options.pixelDelta?options.pixelDelta:128,_this}return __extends(KeyboardPan,_super),KeyboardPan}(Interaction);function handleEvent$1(mapBrowserEvent){var stopEvent=!1;if(mapBrowserEvent.type==EventType.KEYDOWN){var keyCode=mapBrowserEvent.originalEvent.keyCode;if(this.condition_(mapBrowserEvent)&&(keyCode==KeyCode.DOWN||keyCode==KeyCode.LEFT||keyCode==KeyCode.RIGHT||keyCode==KeyCode.UP)){var view=mapBrowserEvent.map.getView(),mapUnitsDelta=view.getResolution()*this.pixelDelta_,deltaX=0,deltaY=0;keyCode==KeyCode.DOWN?deltaY=-mapUnitsDelta:keyCode==KeyCode.LEFT?deltaX=-mapUnitsDelta:keyCode==KeyCode.RIGHT?deltaX=mapUnitsDelta:deltaY=mapUnitsDelta;var delta=[deltaX,deltaY];rotate(delta,view.getRotation()),pan(view,delta,this.duration_),mapBrowserEvent.preventDefault(),stopEvent=!0}}return!stopEvent}var KeyboardZoom=function(_super){function KeyboardZoom(opt_options){var _this=_super.call(this,{handleEvent:handleEvent$2})||this,options=opt_options||{};return _this.condition_=options.condition?options.condition:targetNotEditable,_this.delta_=options.delta?options.delta:1,_this.duration_=void 0!==options.duration?options.duration:100,_this}return __extends(KeyboardZoom,_super),KeyboardZoom}(Interaction);function handleEvent$2(mapBrowserEvent){var stopEvent=!1;if(mapBrowserEvent.type==EventType.KEYDOWN||mapBrowserEvent.type==EventType.KEYPRESS){var charCode=mapBrowserEvent.originalEvent.charCode;if(this.condition_(mapBrowserEvent)&&(charCode=="+".charCodeAt(0)||charCode=="-".charCodeAt(0))){var map=mapBrowserEvent.map,delta=charCode=="+".charCodeAt(0)?this.delta_:-this.delta_;zoomByDelta(map.getView(),delta,void 0,this.duration_),mapBrowserEvent.preventDefault(),stopEvent=!0}}return!stopEvent}var Mode={TRACKPAD:"trackpad",WHEEL:"wheel"},MouseWheelZoom=function(_super){function MouseWheelZoom(opt_options){var _this=this,options=opt_options||{};return(_this=_super.call(this,options)||this).totalDelta_=0,_this.lastDelta_=0,_this.maxDelta_=void 0!==options.maxDelta?options.maxDelta:1,_this.duration_=void 0!==options.duration?options.duration:250,_this.timeout_=void 0!==options.timeout?options.timeout:80,_this.useAnchor_=void 0===options.useAnchor||options.useAnchor,_this.condition_=options.condition?options.condition:always,_this.lastAnchor_=null,_this.startTime_=void 0,_this.timeoutId_,_this.mode_=void 0,_this.trackpadEventGap_=400,_this.trackpadTimeoutId_,_this.trackpadDeltaPerZoom_=300,_this}return __extends(MouseWheelZoom,_super),MouseWheelZoom.prototype.endInteraction_=function(){this.trackpadTimeoutId_=void 0,this.getMap().getView().endInteraction(void 0,Math.sign(this.lastDelta_),this.lastAnchor_)},MouseWheelZoom.prototype.handleEvent=function(mapBrowserEvent){if(!this.condition_(mapBrowserEvent))return!0;if(mapBrowserEvent.type!==EventType.WHEEL)return!0;mapBrowserEvent.preventDefault();var delta,map=mapBrowserEvent.map,wheelEvent=mapBrowserEvent.originalEvent;if(this.useAnchor_&&(this.lastAnchor_=mapBrowserEvent.coordinate),mapBrowserEvent.type==EventType.WHEEL&&(delta=wheelEvent.deltaY,FIREFOX&&wheelEvent.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(delta/=DEVICE_PIXEL_RATIO),wheelEvent.deltaMode===WheelEvent.DOM_DELTA_LINE&&(delta*=40)),0===delta)return!1;this.lastDelta_=delta;var now=Date.now();if(void 0===this.startTime_&&(this.startTime_=now),(!this.mode_||now-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(delta)<4?Mode.TRACKPAD:Mode.WHEEL),this.mode_===Mode.TRACKPAD){var view=map.getView();return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):view.beginInteraction(),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.trackpadEventGap_),view.adjustZoom(-delta/this.trackpadDeltaPerZoom_,this.lastAnchor_),this.startTime_=now,!1}this.totalDelta_+=delta;var timeLeft=Math.max(this.timeout_-(now-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,map),timeLeft),!1},MouseWheelZoom.prototype.handleWheelZoom_=function(map){var view=map.getView();view.getAnimating()&&view.cancelAnimations(),zoomByDelta(view,-clamp(this.totalDelta_,-this.maxDelta_,this.maxDelta_),this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},MouseWheelZoom.prototype.setMouseAnchor=function(useAnchor){this.useAnchor_=useAnchor,useAnchor||(this.lastAnchor_=null)},MouseWheelZoom}(Interaction),PinchRotate=function(_super){function PinchRotate(opt_options){var _this=this,options=opt_options||{},pointerOptions=options;return pointerOptions.stopDown||(pointerOptions.stopDown=FALSE),(_this=_super.call(this,pointerOptions)||this).anchor_=null,_this.lastAngle_=void 0,_this.rotating_=!1,_this.rotationDelta_=0,_this.threshold_=void 0!==options.threshold?options.threshold:.3,_this.duration_=void 0!==options.duration?options.duration:250,_this}return __extends(PinchRotate,_super),PinchRotate.prototype.handleDragEvent=function(mapBrowserEvent){var rotationDelta=0,touch0=this.targetPointers[0],touch1=this.targetPointers[1],angle=Math.atan2(touch1.clientY-touch0.clientY,touch1.clientX-touch0.clientX);if(void 0!==this.lastAngle_){var delta=angle-this.lastAngle_;this.rotationDelta_+=delta,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),rotationDelta=delta}this.lastAngle_=angle;var map=mapBrowserEvent.map,view=map.getView();if(view.getConstraints().rotation!==disable){var viewportPosition=map.getViewport().getBoundingClientRect(),centroid$1=centroid(this.targetPointers);centroid$1[0]-=viewportPosition.left,centroid$1[1]-=viewportPosition.top,this.anchor_=map.getCoordinateFromPixelInternal(centroid$1),this.rotating_&&(map.render(),view.adjustRotationInternal(rotationDelta,this.anchor_))}},PinchRotate.prototype.handleUpEvent=function(mapBrowserEvent){return!(this.targetPointers.length<2)||(mapBrowserEvent.map.getView().endInteraction(this.duration_),!1)},PinchRotate.prototype.handleDownEvent=function(mapBrowserEvent){if(this.targetPointers.length>=2){var map=mapBrowserEvent.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||map.getView().beginInteraction(),!0}return!1},PinchRotate}(PointerInteraction),PinchZoom=function(_super){function PinchZoom(opt_options){var _this=this,options=opt_options||{},pointerOptions=options;return pointerOptions.stopDown||(pointerOptions.stopDown=FALSE),(_this=_super.call(this,pointerOptions)||this).anchor_=null,_this.duration_=void 0!==options.duration?options.duration:400,_this.lastDistance_=void 0,_this.lastScaleDelta_=1,_this}return __extends(PinchZoom,_super),PinchZoom.prototype.handleDragEvent=function(mapBrowserEvent){var scaleDelta=1,touch0=this.targetPointers[0],touch1=this.targetPointers[1],dx=touch0.clientX-touch1.clientX,dy=touch0.clientY-touch1.clientY,distance=Math.sqrt(dx*dx+dy*dy);void 0!==this.lastDistance_&&(scaleDelta=this.lastDistance_/distance),this.lastDistance_=distance;var map=mapBrowserEvent.map,view=map.getView();1!=scaleDelta&&(this.lastScaleDelta_=scaleDelta);var viewportPosition=map.getViewport().getBoundingClientRect(),centroid$1=centroid(this.targetPointers);centroid$1[0]-=viewportPosition.left,centroid$1[1]-=viewportPosition.top,this.anchor_=map.getCoordinateFromPixelInternal(centroid$1),map.render(),view.adjustResolutionInternal(scaleDelta,this.anchor_)},PinchZoom.prototype.handleUpEvent=function(mapBrowserEvent){if(this.targetPointers.length<2){var view=mapBrowserEvent.map.getView(),direction=this.lastScaleDelta_>1?1:-1;return view.endInteraction(this.duration_,direction),!1}return!0},PinchZoom.prototype.handleDownEvent=function(mapBrowserEvent){if(this.targetPointers.length>=2){var map=mapBrowserEvent.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||map.getView().beginInteraction(),!0}return!1},PinchZoom}(PointerInteraction),Feature=function(_super){function Feature(opt_geometryOrProperties){var _this=_super.call(this)||this;if(_this.id_=void 0,_this.geometryName_="geometry",_this.style_=null,_this.styleFunction_=void 0,_this.geometryChangeKey_=null,_this.addEventListener(getChangeEventType(_this.geometryName_),_this.handleGeometryChanged_),opt_geometryOrProperties)if("function"==typeof opt_geometryOrProperties.getSimplifiedGeometry){var geometry=opt_geometryOrProperties;_this.setGeometry(geometry)}else{var properties=opt_geometryOrProperties;_this.setProperties(properties)}return _this}return __extends(Feature,_super),Feature.prototype.clone=function(){var clone=new Feature(this.getProperties());clone.setGeometryName(this.getGeometryName());var geometry=this.getGeometry();geometry&&clone.setGeometry(geometry.clone());var style=this.getStyle();return style&&clone.setStyle(style),clone},Feature.prototype.getGeometry=function(){return this.get(this.geometryName_)},Feature.prototype.getId=function(){return this.id_},Feature.prototype.getGeometryName=function(){return this.geometryName_},Feature.prototype.getStyle=function(){return this.style_},Feature.prototype.getStyleFunction=function(){return this.styleFunction_},Feature.prototype.handleGeometryChange_=function(){this.changed()},Feature.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(unlistenByKey(this.geometryChangeKey_),this.geometryChangeKey_=null);var geometry=this.getGeometry();geometry&&(this.geometryChangeKey_=listen(geometry,EventType.CHANGE,this.handleGeometryChange_,this)),this.changed()},Feature.prototype.setGeometry=function(geometry){this.set(this.geometryName_,geometry)},Feature.prototype.setStyle=function(style){this.style_=style,this.styleFunction_=style?createStyleFunction(style):void 0,this.changed()},Feature.prototype.setId=function(id){this.id_=id,this.changed()},Feature.prototype.setGeometryName=function(name){this.removeEventListener(getChangeEventType(this.geometryName_),this.handleGeometryChanged_),this.geometryName_=name,this.addEventListener(getChangeEventType(this.geometryName_),this.handleGeometryChanged_),this.handleGeometryChanged_()},Feature}(BaseObject);function createStyleFunction(obj){return"function"==typeof obj?obj:(Array.isArray(obj)?styles_1=obj:(assert("function"==typeof obj.getZIndex,41),styles_1=[obj]),function(){return styles_1});var styles_1}var Circle=function(_super){function Circle(center,opt_radius,opt_layout){var _this=_super.call(this)||this;if(void 0!==opt_layout&&void 0===opt_radius)_this.setFlatCoordinates(opt_layout,center);else{var radius=opt_radius||0;_this.setCenterAndRadius(center,radius,opt_layout)}return _this}return __extends(Circle,_super),Circle.prototype.clone=function(){return new Circle(this.flatCoordinates.slice(),void 0,this.layout)},Circle.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){var flatCoordinates=this.flatCoordinates,dx=x-flatCoordinates[0],dy=y-flatCoordinates[1],squaredDistance=dx*dx+dy*dy;if(squaredDistance<minSquaredDistance){if(0===squaredDistance)for(var i=0;i<this.stride;++i)closestPoint[i]=flatCoordinates[i];else{var delta=this.getRadius()/Math.sqrt(squaredDistance);closestPoint[0]=flatCoordinates[0]+delta*dx,closestPoint[1]=flatCoordinates[1]+delta*dy;for(i=2;i<this.stride;++i)closestPoint[i]=flatCoordinates[i]}return closestPoint.length=this.stride,squaredDistance}return minSquaredDistance},Circle.prototype.containsXY=function(x,y){var flatCoordinates=this.flatCoordinates,dx=x-flatCoordinates[0],dy=y-flatCoordinates[1];return dx*dx+dy*dy<=this.getRadiusSquared_()},Circle.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)},Circle.prototype.computeExtent=function(extent){var flatCoordinates=this.flatCoordinates,radius=flatCoordinates[this.stride]-flatCoordinates[0];return createOrUpdate(flatCoordinates[0]-radius,flatCoordinates[1]-radius,flatCoordinates[0]+radius,flatCoordinates[1]+radius,extent)},Circle.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())},Circle.prototype.getRadiusSquared_=function(){var dx=this.flatCoordinates[this.stride]-this.flatCoordinates[0],dy=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return dx*dx+dy*dy},Circle.prototype.getType=function(){return GeometryType.CIRCLE},Circle.prototype.intersectsExtent=function(extent){if(intersects(extent,this.getExtent())){var center=this.getCenter();return extent[0]<=center[0]&&extent[2]>=center[0]||(extent[1]<=center[1]&&extent[3]>=center[1]||forEachCorner(extent,this.intersectsCoordinate.bind(this)))}return!1},Circle.prototype.setCenter=function(center){var stride=this.stride,radius=this.flatCoordinates[stride]-this.flatCoordinates[0],flatCoordinates=center.slice();flatCoordinates[stride]=flatCoordinates[0]+radius;for(var i=1;i<stride;++i)flatCoordinates[stride+i]=center[i];this.setFlatCoordinates(this.layout,flatCoordinates),this.changed()},Circle.prototype.setCenterAndRadius=function(center,radius,opt_layout){this.setLayout(opt_layout,center,0),this.flatCoordinates||(this.flatCoordinates=[]);var flatCoordinates=this.flatCoordinates,offset=deflateCoordinate(flatCoordinates,0,center,this.stride);flatCoordinates[offset++]=flatCoordinates[0]+radius;for(var i=1,ii=this.stride;i<ii;++i)flatCoordinates[offset++]=flatCoordinates[i];flatCoordinates.length=offset,this.changed()},Circle.prototype.getCoordinates=function(){return null},Circle.prototype.setCoordinates=function(coordinates,opt_layout){},Circle.prototype.setRadius=function(radius){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+radius,this.changed()},Circle.prototype.rotate=function(angle,anchor){var center=this.getCenter(),stride=this.getStride();this.setCenter(rotate$1(center,0,center.length,stride,angle,anchor,center)),this.changed()},Circle.prototype.translate=function(deltaX,deltaY){var center=this.getCenter(),stride=this.getStride();this.setCenter(translate(center,0,center.length,stride,deltaX,deltaY,center)),this.changed()},Circle}(SimpleGeometry);function interpolatePoint(flatCoordinates,offset,end,stride,fraction,opt_dest){var pointX=NaN,pointY=NaN,n=(end-offset)/stride;if(1===n)pointX=flatCoordinates[offset],pointY=flatCoordinates[offset+1];else if(2==n)pointX=(1-fraction)*flatCoordinates[offset]+fraction*flatCoordinates[offset+stride],pointY=(1-fraction)*flatCoordinates[offset+1]+fraction*flatCoordinates[offset+stride+1];else if(0!==n){for(var x1=flatCoordinates[offset],y1=flatCoordinates[offset+1],length_1=0,cumulativeLengths=[0],i=offset+stride;i<end;i+=stride){var x2=flatCoordinates[i],y2=flatCoordinates[i+1];length_1+=Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)),cumulativeLengths.push(length_1),x1=x2,y1=y2}var target=fraction*length_1,index=binarySearch(cumulativeLengths,target);if(index<0){var t=(target-cumulativeLengths[-index-2])/(cumulativeLengths[-index-1]-cumulativeLengths[-index-2]),o=offset+(-index-2)*stride;pointX=lerp(flatCoordinates[o],flatCoordinates[o+stride],t),pointY=lerp(flatCoordinates[o+1],flatCoordinates[o+stride+1],t)}else pointX=flatCoordinates[offset+index*stride],pointY=flatCoordinates[offset+index*stride+1]}return opt_dest?(opt_dest[0]=pointX,opt_dest[1]=pointY,opt_dest):[pointX,pointY]}function lineStringCoordinateAtM(flatCoordinates,offset,end,stride,m,extrapolate){if(end==offset)return null;var coordinate;if(m<flatCoordinates[offset+stride-1])return extrapolate?((coordinate=flatCoordinates.slice(offset,offset+stride))[stride-1]=m,coordinate):null;if(flatCoordinates[end-1]<m)return extrapolate?((coordinate=flatCoordinates.slice(end-stride,end))[stride-1]=m,coordinate):null;if(m==flatCoordinates[offset+stride-1])return flatCoordinates.slice(offset,offset+stride);for(var lo=offset/stride,hi=end/stride;lo<hi;){var mid=lo+hi>>1;m<flatCoordinates[(mid+1)*stride-1]?hi=mid:lo=mid+1}var m0=flatCoordinates[lo*stride-1];if(m==m0)return flatCoordinates.slice((lo-1)*stride,(lo-1)*stride+stride);var t=(m-m0)/(flatCoordinates[(lo+1)*stride-1]-m0);coordinate=[];for(var i=0;i<stride-1;++i)coordinate.push(lerp(flatCoordinates[(lo-1)*stride+i],flatCoordinates[lo*stride+i],t));return coordinate.push(m),coordinate}function lineStringsCoordinateAtM(flatCoordinates,offset,ends,stride,m,extrapolate,interpolate){if(interpolate)return lineStringCoordinateAtM(flatCoordinates,offset,ends[ends.length-1],stride,m,extrapolate);var coordinate;if(m<flatCoordinates[stride-1])return extrapolate?((coordinate=flatCoordinates.slice(0,stride))[stride-1]=m,coordinate):null;if(flatCoordinates[flatCoordinates.length-1]<m)return extrapolate?((coordinate=flatCoordinates.slice(flatCoordinates.length-stride))[stride-1]=m,coordinate):null;for(var i=0,ii=ends.length;i<ii;++i){var end=ends[i];if(offset!=end){if(m<flatCoordinates[offset+stride-1])return null;if(m<=flatCoordinates[end-1])return lineStringCoordinateAtM(flatCoordinates,offset,end,stride,m,!1);offset=end}}return null}function lineStringLength(flatCoordinates,offset,end,stride){for(var x1=flatCoordinates[offset],y1=flatCoordinates[offset+1],length=0,i=offset+stride;i<end;i+=stride){var x2=flatCoordinates[i],y2=flatCoordinates[i+1];length+=Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)),x1=x2,y1=y2}return length}Circle.prototype.transform;var LineString=function(_super){function LineString(coordinates,opt_layout){var _this=_super.call(this)||this;return _this.flatMidpoint_=null,_this.flatMidpointRevision_=-1,_this.maxDelta_=-1,_this.maxDeltaRevision_=-1,void 0===opt_layout||Array.isArray(coordinates[0])?_this.setCoordinates(coordinates,opt_layout):_this.setFlatCoordinates(opt_layout,coordinates),_this}return __extends(LineString,_super),LineString.prototype.appendCoordinate=function(coordinate){this.flatCoordinates?extend(this.flatCoordinates,coordinate):this.flatCoordinates=coordinate.slice(),this.changed()},LineString.prototype.clone=function(){return new LineString(this.flatCoordinates.slice(),this.layout)},LineString.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y)?minSquaredDistance:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(maxSquaredDelta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestPoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,x,y,closestPoint,minSquaredDistance))},LineString.prototype.forEachSegment=function(callback){return forEach(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,callback)},LineString.prototype.getCoordinateAtM=function(m,opt_extrapolate){if(this.layout!=GeometryLayout.XYM&&this.layout!=GeometryLayout.XYZM)return null;var extrapolate=void 0!==opt_extrapolate&&opt_extrapolate;return lineStringCoordinateAtM(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,m,extrapolate)},LineString.prototype.getCoordinates=function(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},LineString.prototype.getCoordinateAt=function(fraction,opt_dest){return interpolatePoint(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,fraction,opt_dest)},LineString.prototype.getLength=function(){return lineStringLength(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},LineString.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},LineString.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){var simplifiedFlatCoordinates=[];return simplifiedFlatCoordinates.length=douglasPeucker(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,squaredTolerance,simplifiedFlatCoordinates,0),new LineString(simplifiedFlatCoordinates,GeometryLayout.XY)},LineString.prototype.getType=function(){return GeometryType.LINE_STRING},LineString.prototype.intersectsExtent=function(extent){return intersectsLineString(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,extent)},LineString.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,coordinates,this.stride),this.changed()},LineString}(SimpleGeometry),MultiLineString=function(_super){function MultiLineString(coordinates,opt_layout,opt_ends){var _this=_super.call(this)||this;if(_this.ends_=[],_this.maxDelta_=-1,_this.maxDeltaRevision_=-1,Array.isArray(coordinates[0]))_this.setCoordinates(coordinates,opt_layout);else if(void 0!==opt_layout&&opt_ends)_this.setFlatCoordinates(opt_layout,coordinates),_this.ends_=opt_ends;else{for(var layout=_this.getLayout(),lineStrings=coordinates,flatCoordinates=[],ends=[],i=0,ii=lineStrings.length;i<ii;++i){var lineString=lineStrings[i];0===i&&(layout=lineString.getLayout()),extend(flatCoordinates,lineString.getFlatCoordinates()),ends.push(flatCoordinates.length)}_this.setFlatCoordinates(layout,flatCoordinates),_this.ends_=ends}return _this}return __extends(MultiLineString,_super),MultiLineString.prototype.appendLineString=function(lineString){this.flatCoordinates?extend(this.flatCoordinates,lineString.getFlatCoordinates().slice()):this.flatCoordinates=lineString.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},MultiLineString.prototype.clone=function(){return new MultiLineString(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},MultiLineString.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y)?minSquaredDistance:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(arrayMaxSquaredDelta(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestArrayPoint(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,x,y,closestPoint,minSquaredDistance))},MultiLineString.prototype.getCoordinateAtM=function(m,opt_extrapolate,opt_interpolate){if(this.layout!=GeometryLayout.XYM&&this.layout!=GeometryLayout.XYZM||0===this.flatCoordinates.length)return null;var extrapolate=void 0!==opt_extrapolate&&opt_extrapolate,interpolate=void 0!==opt_interpolate&&opt_interpolate;return lineStringsCoordinateAtM(this.flatCoordinates,0,this.ends_,this.stride,m,extrapolate,interpolate)},MultiLineString.prototype.getCoordinates=function(){return inflateCoordinatesArray(this.flatCoordinates,0,this.ends_,this.stride)},MultiLineString.prototype.getEnds=function(){return this.ends_},MultiLineString.prototype.getLineString=function(index){return index<0||this.ends_.length<=index?null:new LineString(this.flatCoordinates.slice(0===index?0:this.ends_[index-1],this.ends_[index]),this.layout)},MultiLineString.prototype.getLineStrings=function(){for(var flatCoordinates=this.flatCoordinates,ends=this.ends_,layout=this.layout,lineStrings=[],offset=0,i=0,ii=ends.length;i<ii;++i){var end=ends[i],lineString=new LineString(flatCoordinates.slice(offset,end),layout);lineStrings.push(lineString),offset=end}return lineStrings},MultiLineString.prototype.getFlatMidpoints=function(){for(var midpoints=[],flatCoordinates=this.flatCoordinates,offset=0,ends=this.ends_,stride=this.stride,i=0,ii=ends.length;i<ii;++i){var end=ends[i];extend(midpoints,interpolatePoint(flatCoordinates,offset,end,stride,.5)),offset=end}return midpoints},MultiLineString.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){var simplifiedFlatCoordinates=[],simplifiedEnds=[];return simplifiedFlatCoordinates.length=douglasPeuckerArray(this.flatCoordinates,0,this.ends_,this.stride,squaredTolerance,simplifiedFlatCoordinates,0,simplifiedEnds),new MultiLineString(simplifiedFlatCoordinates,GeometryLayout.XY,simplifiedEnds)},MultiLineString.prototype.getType=function(){return GeometryType.MULTI_LINE_STRING},MultiLineString.prototype.intersectsExtent=function(extent){return intersectsLineStringArray(this.flatCoordinates,0,this.ends_,this.stride,extent)},MultiLineString.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,2),this.flatCoordinates||(this.flatCoordinates=[]);var ends=deflateCoordinatesArray(this.flatCoordinates,0,coordinates,this.stride,this.ends_);this.flatCoordinates.length=0===ends.length?0:ends[ends.length-1],this.changed()},MultiLineString}(SimpleGeometry),MultiPoint=function(_super){function MultiPoint(coordinates,opt_layout){var _this=_super.call(this)||this;return opt_layout&&!Array.isArray(coordinates[0])?_this.setFlatCoordinates(opt_layout,coordinates):_this.setCoordinates(coordinates,opt_layout),_this}return __extends(MultiPoint,_super),MultiPoint.prototype.appendPoint=function(point){this.flatCoordinates?extend(this.flatCoordinates,point.getFlatCoordinates()):this.flatCoordinates=point.getFlatCoordinates().slice(),this.changed()},MultiPoint.prototype.clone=function(){return new MultiPoint(this.flatCoordinates.slice(),this.layout)},MultiPoint.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){if(minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y))return minSquaredDistance;for(var flatCoordinates=this.flatCoordinates,stride=this.stride,i=0,ii=flatCoordinates.length;i<ii;i+=stride){var squaredDistance$1=squaredDistance(x,y,flatCoordinates[i],flatCoordinates[i+1]);if(squaredDistance$1<minSquaredDistance){minSquaredDistance=squaredDistance$1;for(var j=0;j<stride;++j)closestPoint[j]=flatCoordinates[i+j];closestPoint.length=stride}}return minSquaredDistance},MultiPoint.prototype.getCoordinates=function(){return inflateCoordinates(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},MultiPoint.prototype.getPoint=function(index){var n=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return index<0||n<=index?null:new Point(this.flatCoordinates.slice(index*this.stride,(index+1)*this.stride),this.layout)},MultiPoint.prototype.getPoints=function(){for(var flatCoordinates=this.flatCoordinates,layout=this.layout,stride=this.stride,points=[],i=0,ii=flatCoordinates.length;i<ii;i+=stride){var point=new Point(flatCoordinates.slice(i,i+stride),layout);points.push(point)}return points},MultiPoint.prototype.getType=function(){return GeometryType.MULTI_POINT},MultiPoint.prototype.intersectsExtent=function(extent){for(var flatCoordinates=this.flatCoordinates,stride=this.stride,i=0,ii=flatCoordinates.length;i<ii;i+=stride){if(containsXY(extent,flatCoordinates[i],flatCoordinates[i+1]))return!0}return!1},MultiPoint.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=deflateCoordinates(this.flatCoordinates,0,coordinates,this.stride),this.changed()},MultiPoint}(SimpleGeometry);function linearRingss$1(flatCoordinates,offset,endss,stride){for(var flatCenters=[],extent=createEmpty(),i=0,ii=endss.length;i<ii;++i){var ends=endss[i];extent=createOrUpdateFromFlatCoordinates(flatCoordinates,offset,ends[0],stride),flatCenters.push((extent[0]+extent[2])/2,(extent[1]+extent[3])/2),offset=ends[ends.length-1]}return flatCenters}var MultiPolygon=function(_super){function MultiPolygon(coordinates,opt_layout,opt_endss){var _this=_super.call(this)||this;if(_this.endss_=[],_this.flatInteriorPointsRevision_=-1,_this.flatInteriorPoints_=null,_this.maxDelta_=-1,_this.maxDeltaRevision_=-1,_this.orientedRevision_=-1,_this.orientedFlatCoordinates_=null,!opt_endss&&!Array.isArray(coordinates[0])){for(var layout=_this.getLayout(),polygons=coordinates,flatCoordinates=[],endss=[],i=0,ii=polygons.length;i<ii;++i){var polygon=polygons[i];0===i&&(layout=polygon.getLayout());for(var offset=flatCoordinates.length,ends=polygon.getEnds(),j=0,jj=ends.length;j<jj;++j)ends[j]+=offset;extend(flatCoordinates,polygon.getFlatCoordinates()),endss.push(ends)}opt_layout=layout,coordinates=flatCoordinates,opt_endss=endss}return void 0!==opt_layout&&opt_endss?(_this.setFlatCoordinates(opt_layout,coordinates),_this.endss_=opt_endss):_this.setCoordinates(coordinates,opt_layout),_this}return __extends(MultiPolygon,_super),MultiPolygon.prototype.appendPolygon=function(polygon){var ends;if(this.flatCoordinates){var offset=this.flatCoordinates.length;extend(this.flatCoordinates,polygon.getFlatCoordinates());for(var i=0,ii=(ends=polygon.getEnds().slice()).length;i<ii;++i)ends[i]+=offset}else this.flatCoordinates=polygon.getFlatCoordinates().slice(),ends=polygon.getEnds().slice(),this.endss_.push();this.endss_.push(ends),this.changed()},MultiPolygon.prototype.clone=function(){for(var len=this.endss_.length,newEndss=new Array(len),i=0;i<len;++i)newEndss[i]=this.endss_[i].slice();return new MultiPolygon(this.flatCoordinates.slice(),this.layout,newEndss)},MultiPolygon.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){return minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y)?minSquaredDistance:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(multiArrayMaxSquaredDelta(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),assignClosestMultiArrayPoint(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,x,y,closestPoint,minSquaredDistance))},MultiPolygon.prototype.containsXY=function(x,y){return linearRingssContainsXY(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,x,y)},MultiPolygon.prototype.getArea=function(){return linearRingss(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},MultiPolygon.prototype.getCoordinates=function(opt_right){var flatCoordinates;return void 0!==opt_right?orientLinearRingsArray(flatCoordinates=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,opt_right):flatCoordinates=this.flatCoordinates,inflateMultiCoordinatesArray(flatCoordinates,0,this.endss_,this.stride)},MultiPolygon.prototype.getEndss=function(){return this.endss_},MultiPolygon.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var flatCenters=linearRingss$1(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=getInteriorPointsOfMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,flatCenters),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},MultiPolygon.prototype.getInteriorPoints=function(){return new MultiPoint(this.getFlatInteriorPoints().slice(),GeometryLayout.XYM)},MultiPolygon.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var flatCoordinates=this.flatCoordinates;linearRingssAreOriented(flatCoordinates,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=flatCoordinates:(this.orientedFlatCoordinates_=flatCoordinates.slice(),this.orientedFlatCoordinates_.length=orientLinearRingsArray(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},MultiPolygon.prototype.getSimplifiedGeometryInternal=function(squaredTolerance){var simplifiedFlatCoordinates=[],simplifiedEndss=[];return simplifiedFlatCoordinates.length=quantizeMultiArray(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(squaredTolerance),simplifiedFlatCoordinates,0,simplifiedEndss),new MultiPolygon(simplifiedFlatCoordinates,GeometryLayout.XY,simplifiedEndss)},MultiPolygon.prototype.getPolygon=function(index){if(index<0||this.endss_.length<=index)return null;var offset;if(0===index)offset=0;else{var prevEnds=this.endss_[index-1];offset=prevEnds[prevEnds.length-1]}var ends=this.endss_[index].slice(),end=ends[ends.length-1];if(0!==offset)for(var i=0,ii=ends.length;i<ii;++i)ends[i]-=offset;return new Polygon(this.flatCoordinates.slice(offset,end),this.layout,ends)},MultiPolygon.prototype.getPolygons=function(){for(var layout=this.layout,flatCoordinates=this.flatCoordinates,endss=this.endss_,polygons=[],offset=0,i=0,ii=endss.length;i<ii;++i){var ends=endss[i].slice(),end=ends[ends.length-1];if(0!==offset)for(var j=0,jj=ends.length;j<jj;++j)ends[j]-=offset;var polygon=new Polygon(flatCoordinates.slice(offset,end),layout,ends);polygons.push(polygon),offset=end}return polygons},MultiPolygon.prototype.getType=function(){return GeometryType.MULTI_POLYGON},MultiPolygon.prototype.intersectsExtent=function(extent){return intersectsLinearRingMultiArray(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,extent)},MultiPolygon.prototype.setCoordinates=function(coordinates,opt_layout){this.setLayout(opt_layout,coordinates,3),this.flatCoordinates||(this.flatCoordinates=[]);var endss=deflateMultiCoordinatesArray(this.flatCoordinates,0,coordinates,this.stride,this.endss_);if(0===endss.length)this.flatCoordinates.length=0;else{var lastEnds=endss[endss.length-1];this.flatCoordinates.length=0===lastEnds.length?0:lastEnds[lastEnds.length-1]}this.changed()},MultiPolygon}(SimpleGeometry),ImageStyle=function(){function ImageStyle(options){this.opacity_=options.opacity,this.rotateWithView_=options.rotateWithView,this.rotation_=options.rotation,this.scale_=options.scale}return ImageStyle.prototype.clone=function(){return new ImageStyle({opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})},ImageStyle.prototype.getOpacity=function(){return this.opacity_},ImageStyle.prototype.getRotateWithView=function(){return this.rotateWithView_},ImageStyle.prototype.getRotation=function(){return this.rotation_},ImageStyle.prototype.getScale=function(){return this.scale_},ImageStyle.prototype.getAnchor=function(){return abstract()},ImageStyle.prototype.getImage=function(pixelRatio){return abstract()},ImageStyle.prototype.getHitDetectionImage=function(pixelRatio){return abstract()},ImageStyle.prototype.getImageState=function(){return abstract()},ImageStyle.prototype.getImageSize=function(){return abstract()},ImageStyle.prototype.getHitDetectionImageSize=function(){return abstract()},ImageStyle.prototype.getOrigin=function(){return abstract()},ImageStyle.prototype.getSize=function(){return abstract()},ImageStyle.prototype.setOpacity=function(opacity){this.opacity_=opacity},ImageStyle.prototype.setRotateWithView=function(rotateWithView){this.rotateWithView_=rotateWithView},ImageStyle.prototype.setRotation=function(rotation){this.rotation_=rotation},ImageStyle.prototype.setScale=function(scale){this.scale_=scale},ImageStyle.prototype.listenImageChange=function(listener){abstract()},ImageStyle.prototype.load=function(){abstract()},ImageStyle.prototype.unlistenImageChange=function(listener){abstract()},ImageStyle}(),RegularShape=function(_super){function RegularShape(options){var _this=this,rotateWithView=void 0!==options.rotateWithView&&options.rotateWithView;return(_this=_super.call(this,{opacity:1,rotateWithView:rotateWithView,rotation:void 0!==options.rotation?options.rotation:0,scale:1})||this).canvas_=null,_this.hitDetectionCanvas_=null,_this.fill_=void 0!==options.fill?options.fill:null,_this.origin_=[0,0],_this.points_=options.points,_this.radius_=void 0!==options.radius?options.radius:options.radius1,_this.radius2_=options.radius2,_this.angle_=void 0!==options.angle?options.angle:0,_this.stroke_=void 0!==options.stroke?options.stroke:null,_this.anchor_=null,_this.size_=null,_this.imageSize_=null,_this.hitDetectionImageSize_=null,_this.render(),_this}return __extends(RegularShape,_super),RegularShape.prototype.clone=function(){var style=new RegularShape({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView()});return style.setOpacity(this.getOpacity()),style.setScale(this.getScale()),style},RegularShape.prototype.getAnchor=function(){return this.anchor_},RegularShape.prototype.getAngle=function(){return this.angle_},RegularShape.prototype.getFill=function(){return this.fill_},RegularShape.prototype.getHitDetectionImage=function(pixelRatio){return this.hitDetectionCanvas_},RegularShape.prototype.getImage=function(pixelRatio){return this.canvas_},RegularShape.prototype.getImageSize=function(){return this.imageSize_},RegularShape.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_},RegularShape.prototype.getImageState=function(){return ImageState.LOADED},RegularShape.prototype.getOrigin=function(){return this.origin_},RegularShape.prototype.getPoints=function(){return this.points_},RegularShape.prototype.getRadius=function(){return this.radius_},RegularShape.prototype.getRadius2=function(){return this.radius2_},RegularShape.prototype.getSize=function(){return this.size_},RegularShape.prototype.getStroke=function(){return this.stroke_},RegularShape.prototype.listenImageChange=function(listener){},RegularShape.prototype.load=function(){},RegularShape.prototype.unlistenImageChange=function(listener){},RegularShape.prototype.render=function(){var strokeStyle,lineCap=defaultLineCap,lineJoin=defaultLineJoin,miterLimit=0,lineDash=null,lineDashOffset=0,strokeWidth=0;this.stroke_&&(null===(strokeStyle=this.stroke_.getColor())&&(strokeStyle=defaultStrokeStyle),strokeStyle=asColorLike(strokeStyle),void 0===(strokeWidth=this.stroke_.getWidth())&&(strokeWidth=defaultLineWidth),lineDash=this.stroke_.getLineDash(),lineDashOffset=this.stroke_.getLineDashOffset(),void 0===(lineJoin=this.stroke_.getLineJoin())&&(lineJoin=defaultLineJoin),void 0===(lineCap=this.stroke_.getLineCap())&&(lineCap=defaultLineCap),void 0===(miterLimit=this.stroke_.getMiterLimit())&&(miterLimit=defaultMiterLimit));var size=2*(this.radius_+strokeWidth)+1,renderOptions={strokeStyle:strokeStyle,strokeWidth:strokeWidth,size:size,lineCap:lineCap,lineDash:lineDash,lineDashOffset:lineDashOffset,lineJoin:lineJoin,miterLimit:miterLimit},context=createCanvasContext2D(size,size);this.canvas_=context.canvas;var imageSize=size=this.canvas_.width;this.draw_(renderOptions,context,0,0),this.createHitDetectionCanvas_(renderOptions),this.anchor_=[size/2,size/2],this.size_=[size,size],this.imageSize_=[imageSize,imageSize]},RegularShape.prototype.draw_=function(renderOptions,context,x,y){var i,angle0,radiusC;context.setTransform(1,0,0,1,0,0),context.translate(x,y),context.beginPath();var points=this.points_;if(points===1/0)context.arc(renderOptions.size/2,renderOptions.size/2,this.radius_,0,2*Math.PI,!0);else{var radius2=void 0!==this.radius2_?this.radius2_:this.radius_;for(radius2!==this.radius_&&(points*=2),i=0;i<=points;i++)angle0=2*i*Math.PI/points-Math.PI/2+this.angle_,radiusC=i%2==0?this.radius_:radius2,context.lineTo(renderOptions.size/2+radiusC*Math.cos(angle0),renderOptions.size/2+radiusC*Math.sin(angle0))}if(this.fill_){var color=this.fill_.getColor();null===color&&(color=defaultFillStyle),context.fillStyle=asColorLike(color),context.fill()}this.stroke_&&(context.strokeStyle=renderOptions.strokeStyle,context.lineWidth=renderOptions.strokeWidth,context.setLineDash&&renderOptions.lineDash&&(context.setLineDash(renderOptions.lineDash),context.lineDashOffset=renderOptions.lineDashOffset),context.lineCap=renderOptions.lineCap,context.lineJoin=renderOptions.lineJoin,context.miterLimit=renderOptions.miterLimit,context.stroke()),context.closePath()},RegularShape.prototype.createHitDetectionCanvas_=function(renderOptions){if(this.hitDetectionImageSize_=[renderOptions.size,renderOptions.size],this.hitDetectionCanvas_=this.canvas_,this.fill_){var color=this.fill_.getColor(),opacity=0;if("string"==typeof color&&(color=asArray(color)),null===color?opacity=1:Array.isArray(color)&&(opacity=4===color.length?color[3]:1),0===opacity){var context=createCanvasContext2D(renderOptions.size,renderOptions.size);this.hitDetectionCanvas_=context.canvas,this.drawHitDetectionCanvas_(renderOptions,context,0,0)}}},RegularShape.prototype.drawHitDetectionCanvas_=function(renderOptions,context,x,y){context.setTransform(1,0,0,1,0,0),context.translate(x,y),context.beginPath();var points=this.points_;if(points===1/0)context.arc(renderOptions.size/2,renderOptions.size/2,this.radius_,0,2*Math.PI,!0);else{var radius2=void 0!==this.radius2_?this.radius2_:this.radius_;radius2!==this.radius_&&(points*=2);var i=void 0,radiusC=void 0,angle0=void 0;for(i=0;i<=points;i++)angle0=2*i*Math.PI/points-Math.PI/2+this.angle_,radiusC=i%2==0?this.radius_:radius2,context.lineTo(renderOptions.size/2+radiusC*Math.cos(angle0),renderOptions.size/2+radiusC*Math.sin(angle0))}context.fillStyle=defaultFillStyle,context.fill(),this.stroke_&&(context.strokeStyle=renderOptions.strokeStyle,context.lineWidth=renderOptions.strokeWidth,renderOptions.lineDash&&(context.setLineDash(renderOptions.lineDash),context.lineDashOffset=renderOptions.lineDashOffset),context.stroke()),context.closePath()},RegularShape}(ImageStyle),CircleStyle=function(_super){function CircleStyle(opt_options){var options=opt_options||{};return _super.call(this,{points:1/0,fill:options.fill,radius:options.radius,stroke:options.stroke})||this}return __extends(CircleStyle,_super),CircleStyle.prototype.clone=function(){var style=new CircleStyle({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius()});return style.setOpacity(this.getOpacity()),style.setScale(this.getScale()),style},CircleStyle.prototype.setRadius=function(radius){this.radius_=radius,this.render()},CircleStyle}(RegularShape),Fill=function(){function Fill(opt_options){var options=opt_options||{};this.color_=void 0!==options.color?options.color:null}return Fill.prototype.clone=function(){var color=this.getColor();return new Fill({color:Array.isArray(color)?color.slice():color||void 0})},Fill.prototype.getColor=function(){return this.color_},Fill.prototype.setColor=function(color){this.color_=color},Fill}(),Stroke=function(){function Stroke(opt_options){var options=opt_options||{};this.color_=void 0!==options.color?options.color:null,this.lineCap_=options.lineCap,this.lineDash_=void 0!==options.lineDash?options.lineDash:null,this.lineDashOffset_=options.lineDashOffset,this.lineJoin_=options.lineJoin,this.miterLimit_=options.miterLimit,this.width_=options.width}return Stroke.prototype.clone=function(){var color=this.getColor();return new Stroke({color:Array.isArray(color)?color.slice():color||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},Stroke.prototype.getColor=function(){return this.color_},Stroke.prototype.getLineCap=function(){return this.lineCap_},Stroke.prototype.getLineDash=function(){return this.lineDash_},Stroke.prototype.getLineDashOffset=function(){return this.lineDashOffset_},Stroke.prototype.getLineJoin=function(){return this.lineJoin_},Stroke.prototype.getMiterLimit=function(){return this.miterLimit_},Stroke.prototype.getWidth=function(){return this.width_},Stroke.prototype.setColor=function(color){this.color_=color},Stroke.prototype.setLineCap=function(lineCap){this.lineCap_=lineCap},Stroke.prototype.setLineDash=function(lineDash){this.lineDash_=lineDash},Stroke.prototype.setLineDashOffset=function(lineDashOffset){this.lineDashOffset_=lineDashOffset},Stroke.prototype.setLineJoin=function(lineJoin){this.lineJoin_=lineJoin},Stroke.prototype.setMiterLimit=function(miterLimit){this.miterLimit_=miterLimit},Stroke.prototype.setWidth=function(width){this.width_=width},Stroke}(),Style=function(){function Style(opt_options){var options=opt_options||{};this.geometry_=null,this.geometryFunction_=defaultGeometryFunction,void 0!==options.geometry&&this.setGeometry(options.geometry),this.fill_=void 0!==options.fill?options.fill:null,this.image_=void 0!==options.image?options.image:null,this.renderer_=void 0!==options.renderer?options.renderer:null,this.stroke_=void 0!==options.stroke?options.stroke:null,this.text_=void 0!==options.text?options.text:null,this.zIndex_=options.zIndex}return Style.prototype.clone=function(){var geometry=this.getGeometry();return geometry&&"object"==typeof geometry&&(geometry=geometry.clone()),new Style({geometry:geometry,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},Style.prototype.getRenderer=function(){return this.renderer_},Style.prototype.setRenderer=function(renderer){this.renderer_=renderer},Style.prototype.getGeometry=function(){return this.geometry_},Style.prototype.getGeometryFunction=function(){return this.geometryFunction_},Style.prototype.getFill=function(){return this.fill_},Style.prototype.setFill=function(fill){this.fill_=fill},Style.prototype.getImage=function(){return this.image_},Style.prototype.setImage=function(image){this.image_=image},Style.prototype.getStroke=function(){return this.stroke_},Style.prototype.setStroke=function(stroke){this.stroke_=stroke},Style.prototype.getText=function(){return this.text_},Style.prototype.setText=function(text){this.text_=text},Style.prototype.getZIndex=function(){return this.zIndex_},Style.prototype.setGeometry=function(geometry){"function"==typeof geometry?this.geometryFunction_=geometry:"string"==typeof geometry?this.geometryFunction_=function(feature){return feature.get(geometry)}:geometry?void 0!==geometry&&(this.geometryFunction_=function(){return geometry}):this.geometryFunction_=defaultGeometryFunction,this.geometry_=geometry},Style.prototype.setZIndex=function(zIndex){this.zIndex_=zIndex},Style}();function toFunction(obj){var styleFunction;if("function"==typeof obj)styleFunction=obj;else{var styles_1;if(Array.isArray(obj))styles_1=obj;else assert("function"==typeof obj.getZIndex,41),styles_1=[obj];styleFunction=function(){return styles_1}}return styleFunction}var defaultStyles=null;function createDefaultStyle(feature,resolution){if(!defaultStyles){var fill=new Fill({color:"rgba(255,255,255,0.4)"}),stroke=new Stroke({color:"#3399CC",width:1.25});defaultStyles=[new Style({image:new CircleStyle({fill:fill,stroke:stroke,radius:5}),fill:fill,stroke:stroke})]}return defaultStyles}function createEditingStyle(){var styles={},white=[255,255,255,1],blue=[0,153,255,1];return styles[GeometryType.POLYGON]=[new Style({fill:new Fill({color:[255,255,255,.5]})})],styles[GeometryType.MULTI_POLYGON]=styles[GeometryType.POLYGON],styles[GeometryType.LINE_STRING]=[new Style({stroke:new Stroke({color:white,width:5})}),new Style({stroke:new Stroke({color:blue,width:3})})],styles[GeometryType.MULTI_LINE_STRING]=styles[GeometryType.LINE_STRING],styles[GeometryType.CIRCLE]=styles[GeometryType.POLYGON].concat(styles[GeometryType.LINE_STRING]),styles[GeometryType.POINT]=[new Style({image:new CircleStyle({radius:6,fill:new Fill({color:blue}),stroke:new Stroke({color:white,width:1.5})}),zIndex:1/0})],styles[GeometryType.MULTI_POINT]=styles[GeometryType.POINT],styles[GeometryType.GEOMETRY_COLLECTION]=styles[GeometryType.POLYGON].concat(styles[GeometryType.LINE_STRING],styles[GeometryType.POINT]),styles}function defaultGeometryFunction(feature){return feature.getGeometry()}var Property$2={RENDER_ORDER:"renderOrder"},BaseVectorLayer=function(_super){function BaseVectorLayer(opt_options){var _this=this,options=opt_options||{},baseOptions=assign({},options);return delete baseOptions.style,delete baseOptions.renderBuffer,delete baseOptions.updateWhileAnimating,delete baseOptions.updateWhileInteracting,(_this=_super.call(this,baseOptions)||this).declutter_=void 0!==options.declutter&&options.declutter,_this.renderBuffer_=void 0!==options.renderBuffer?options.renderBuffer:100,_this.style_=null,_this.styleFunction_=void 0,_this.setStyle(options.style),_this.updateWhileAnimating_=void 0!==options.updateWhileAnimating&&options.updateWhileAnimating,_this.updateWhileInteracting_=void 0!==options.updateWhileInteracting&&options.updateWhileInteracting,_this}return __extends(BaseVectorLayer,_super),BaseVectorLayer.prototype.getDeclutter=function(){return this.declutter_},BaseVectorLayer.prototype.getRenderBuffer=function(){return this.renderBuffer_},BaseVectorLayer.prototype.getRenderOrder=function(){return this.get(Property$2.RENDER_ORDER)},BaseVectorLayer.prototype.getStyle=function(){return this.style_},BaseVectorLayer.prototype.getStyleFunction=function(){return this.styleFunction_},BaseVectorLayer.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},BaseVectorLayer.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},BaseVectorLayer.prototype.setRenderOrder=function(renderOrder){this.set(Property$2.RENDER_ORDER,renderOrder)},BaseVectorLayer.prototype.setStyle=function(style){this.style_=void 0!==style?style:createDefaultStyle,this.styleFunction_=null===style?void 0:toFunction(this.style_),this.changed()},BaseVectorLayer}(Layer),Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},fillInstruction=[Instruction.FILL],strokeInstruction=[Instruction.STROKE],beginPathInstruction=[Instruction.BEGIN_PATH],closePathInstruction=[Instruction.CLOSE_PATH],CanvasBuilder=function(_super){function CanvasBuilder(tolerance,maxExtent,resolution,pixelRatio){var _this=_super.call(this)||this;return _this.tolerance=tolerance,_this.maxExtent=maxExtent,_this.pixelRatio=pixelRatio,_this.maxLineWidth=0,_this.resolution=resolution,_this.beginGeometryInstruction1_=null,_this.beginGeometryInstruction2_=null,_this.bufferedMaxExtent_=null,_this.instructions=[],_this.coordinates=[],_this.tmpCoordinate_=[],_this.hitDetectionInstructions=[],_this.state={},_this}return __extends(CanvasBuilder,_super),CanvasBuilder.prototype.applyPixelRatio=function(dashArray){var pixelRatio=this.pixelRatio;return 1==pixelRatio?dashArray:dashArray.map(function(dash){return dash*pixelRatio})},CanvasBuilder.prototype.appendFlatCoordinates=function(flatCoordinates,offset,end,stride,closed,skipFirst){var myEnd=this.coordinates.length,extent=this.getBufferedMaxExtent();skipFirst&&(offset+=stride);var i,lastRel,nextRel,lastXCoord=flatCoordinates[offset],lastYCoord=flatCoordinates[offset+1],nextCoord=this.tmpCoordinate_,skipped=!0;for(i=offset+stride;i<end;i+=stride)nextCoord[0]=flatCoordinates[i],nextCoord[1]=flatCoordinates[i+1],(nextRel=coordinateRelationship(extent,nextCoord))!==lastRel?(skipped&&(this.coordinates[myEnd++]=lastXCoord,this.coordinates[myEnd++]=lastYCoord),this.coordinates[myEnd++]=nextCoord[0],this.coordinates[myEnd++]=nextCoord[1],skipped=!1):nextRel===Relationship.INTERSECTING?(this.coordinates[myEnd++]=nextCoord[0],this.coordinates[myEnd++]=nextCoord[1],skipped=!1):skipped=!0,lastXCoord=nextCoord[0],lastYCoord=nextCoord[1],lastRel=nextRel;return(closed&&skipped||i===offset+stride)&&(this.coordinates[myEnd++]=lastXCoord,this.coordinates[myEnd++]=lastYCoord),myEnd},CanvasBuilder.prototype.drawCustomCoordinates_=function(flatCoordinates,offset,ends,stride,builderEnds){for(var i=0,ii=ends.length;i<ii;++i){var end=ends[i],builderEnd=this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!1,!1);builderEnds.push(builderEnd),offset=end}return offset},CanvasBuilder.prototype.drawCustom=function(geometry,feature,renderer){this.beginGeometry(geometry,feature);var flatCoordinates,builderEnd,builderEnds,builderEndss,offset,type=geometry.getType(),stride=geometry.getStride(),builderBegin=this.coordinates.length;if(type==GeometryType.MULTI_POLYGON){flatCoordinates=(geometry=geometry).getOrientedFlatCoordinates(),builderEndss=[];var endss=geometry.getEndss();offset=0;for(var i=0,ii=endss.length;i<ii;++i){var myEnds=[];offset=this.drawCustomCoordinates_(flatCoordinates,offset,endss[i],stride,myEnds),builderEndss.push(myEnds)}this.instructions.push([Instruction.CUSTOM,builderBegin,builderEndss,geometry,renderer,inflateMultiCoordinatesArray])}else type==GeometryType.POLYGON||type==GeometryType.MULTI_LINE_STRING?(builderEnds=[],flatCoordinates=type==GeometryType.POLYGON?geometry.getOrientedFlatCoordinates():geometry.getFlatCoordinates(),offset=this.drawCustomCoordinates_(flatCoordinates,0,geometry.getEnds(),stride,builderEnds),this.instructions.push([Instruction.CUSTOM,builderBegin,builderEnds,geometry,renderer,inflateCoordinatesArray])):type==GeometryType.LINE_STRING||type==GeometryType.MULTI_POINT?(flatCoordinates=geometry.getFlatCoordinates(),builderEnd=this.appendFlatCoordinates(flatCoordinates,0,flatCoordinates.length,stride,!1,!1),this.instructions.push([Instruction.CUSTOM,builderBegin,builderEnd,geometry,renderer,inflateCoordinates])):type==GeometryType.POINT&&(flatCoordinates=geometry.getFlatCoordinates(),this.coordinates.push(flatCoordinates[0],flatCoordinates[1]),builderEnd=this.coordinates.length,this.instructions.push([Instruction.CUSTOM,builderBegin,builderEnd,geometry,renderer]));this.endGeometry(feature)},CanvasBuilder.prototype.beginGeometry=function(geometry,feature){var extent=geometry.getExtent();this.beginGeometryInstruction1_=[Instruction.BEGIN_GEOMETRY,feature,0,extent],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Instruction.BEGIN_GEOMETRY,feature,0,extent],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},CanvasBuilder.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},CanvasBuilder.prototype.reverseHitDetectionInstructions=function(){var i,hitDetectionInstructions=this.hitDetectionInstructions;hitDetectionInstructions.reverse();var instruction,type,n=hitDetectionInstructions.length,begin=-1;for(i=0;i<n;++i)(type=(instruction=hitDetectionInstructions[i])[0])==Instruction.END_GEOMETRY?begin=i:type==Instruction.BEGIN_GEOMETRY&&(instruction[2]=i,reverseSubArray(this.hitDetectionInstructions,begin,i),begin=-1)},CanvasBuilder.prototype.setFillStrokeStyle=function(fillStyle,strokeStyle){var state=this.state;if(fillStyle){var fillStyleColor=fillStyle.getColor();state.fillStyle=asColorLike(fillStyleColor||defaultFillStyle)}else state.fillStyle=void 0;if(strokeStyle){var strokeStyleColor=strokeStyle.getColor();state.strokeStyle=asColorLike(strokeStyleColor||defaultStrokeStyle);var strokeStyleLineCap=strokeStyle.getLineCap();state.lineCap=void 0!==strokeStyleLineCap?strokeStyleLineCap:defaultLineCap;var strokeStyleLineDash=strokeStyle.getLineDash();state.lineDash=strokeStyleLineDash?strokeStyleLineDash.slice():defaultLineDash;var strokeStyleLineDashOffset=strokeStyle.getLineDashOffset();state.lineDashOffset=strokeStyleLineDashOffset||defaultLineDashOffset;var strokeStyleLineJoin=strokeStyle.getLineJoin();state.lineJoin=void 0!==strokeStyleLineJoin?strokeStyleLineJoin:defaultLineJoin;var strokeStyleWidth=strokeStyle.getWidth();state.lineWidth=void 0!==strokeStyleWidth?strokeStyleWidth:defaultLineWidth;var strokeStyleMiterLimit=strokeStyle.getMiterLimit();state.miterLimit=void 0!==strokeStyleMiterLimit?strokeStyleMiterLimit:defaultMiterLimit,state.lineWidth>this.maxLineWidth&&(this.maxLineWidth=state.lineWidth,this.bufferedMaxExtent_=null)}else state.strokeStyle=void 0,state.lineCap=void 0,state.lineDash=null,state.lineDashOffset=void 0,state.lineJoin=void 0,state.lineWidth=void 0,state.miterLimit=void 0},CanvasBuilder.prototype.createFill=function(state){var fillStyle=state.fillStyle,fillInstruction=[Instruction.SET_FILL_STYLE,fillStyle];return"string"!=typeof fillStyle&&fillInstruction.push(!0),fillInstruction},CanvasBuilder.prototype.applyStroke=function(state){this.instructions.push(this.createStroke(state))},CanvasBuilder.prototype.createStroke=function(state){return[Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth*this.pixelRatio,state.lineCap,state.lineJoin,state.miterLimit,this.applyPixelRatio(state.lineDash),state.lineDashOffset*this.pixelRatio]},CanvasBuilder.prototype.updateFillStyle=function(state,createFill){var fillStyle=state.fillStyle;"string"==typeof fillStyle&&state.currentFillStyle==fillStyle||(void 0!==fillStyle&&this.instructions.push(createFill.call(this,state)),state.currentFillStyle=fillStyle)},CanvasBuilder.prototype.updateStrokeStyle=function(state,applyStroke){var strokeStyle=state.strokeStyle,lineCap=state.lineCap,lineDash=state.lineDash,lineDashOffset=state.lineDashOffset,lineJoin=state.lineJoin,lineWidth=state.lineWidth,miterLimit=state.miterLimit;(state.currentStrokeStyle!=strokeStyle||state.currentLineCap!=lineCap||lineDash!=state.currentLineDash&&!equals(state.currentLineDash,lineDash)||state.currentLineDashOffset!=lineDashOffset||state.currentLineJoin!=lineJoin||state.currentLineWidth!=lineWidth||state.currentMiterLimit!=miterLimit)&&(void 0!==strokeStyle&&applyStroke.call(this,state),state.currentStrokeStyle=strokeStyle,state.currentLineCap=lineCap,state.currentLineDash=lineDash,state.currentLineDashOffset=lineDashOffset,state.currentLineJoin=lineJoin,state.currentLineWidth=lineWidth,state.currentMiterLimit=miterLimit)},CanvasBuilder.prototype.endGeometry=function(feature){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var endGeometryInstruction=[Instruction.END_GEOMETRY,feature];this.instructions.push(endGeometryInstruction),this.hitDetectionInstructions.push(endGeometryInstruction)},CanvasBuilder.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=clone(this.maxExtent),this.maxLineWidth>0)){var width=this.resolution*(this.maxLineWidth+1)/2;buffer(this.bufferedMaxExtent_,width,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},CanvasBuilder}(VectorContext),CanvasImageBuilder=function(_super){function CanvasImageBuilder(tolerance,maxExtent,resolution,pixelRatio){var _this=_super.call(this,tolerance,maxExtent,resolution,pixelRatio)||this;return _this.declutterGroups_=null,_this.hitDetectionImage_=null,_this.image_=null,_this.anchorX_=void 0,_this.anchorY_=void 0,_this.height_=void 0,_this.opacity_=void 0,_this.originX_=void 0,_this.originY_=void 0,_this.rotateWithView_=void 0,_this.rotation_=void 0,_this.scale_=void 0,_this.width_=void 0,_this}return __extends(CanvasImageBuilder,_super),CanvasImageBuilder.prototype.drawCoordinates_=function(flatCoordinates,offset,end,stride){return this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!1,!1)},CanvasImageBuilder.prototype.drawPoint=function(pointGeometry,feature){if(this.image_){this.beginGeometry(pointGeometry,feature);var flatCoordinates=pointGeometry.getFlatCoordinates(),stride=pointGeometry.getStride(),myBegin=this.coordinates.length,myEnd=this.drawCoordinates_(flatCoordinates,0,flatCoordinates.length,stride);this.instructions.push([Instruction.DRAW_IMAGE,myBegin,myEnd,this.image_,this.anchorX_,this.anchorY_,this.declutterGroups_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,myBegin,myEnd,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroups_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(feature)}},CanvasImageBuilder.prototype.drawMultiPoint=function(multiPointGeometry,feature){if(this.image_){this.beginGeometry(multiPointGeometry,feature);var flatCoordinates=multiPointGeometry.getFlatCoordinates(),stride=multiPointGeometry.getStride(),myBegin=this.coordinates.length,myEnd=this.drawCoordinates_(flatCoordinates,0,flatCoordinates.length,stride);this.instructions.push([Instruction.DRAW_IMAGE,myBegin,myEnd,this.image_,this.anchorX_,this.anchorY_,this.declutterGroups_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,myBegin,myEnd,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroups_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]),this.endGeometry(feature)}},CanvasImageBuilder.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,_super.prototype.finish.call(this)},CanvasImageBuilder.prototype.setImageStyle=function(imageStyle,declutterGroups){var anchor=imageStyle.getAnchor(),size=imageStyle.getSize(),hitDetectionImage=imageStyle.getHitDetectionImage(1),image=imageStyle.getImage(1),origin=imageStyle.getOrigin();this.anchorX_=anchor[0],this.anchorY_=anchor[1],this.declutterGroups_=declutterGroups,this.hitDetectionImage_=hitDetectionImage,this.image_=image,this.height_=size[1],this.opacity_=imageStyle.getOpacity(),this.originX_=origin[0],this.originY_=origin[1],this.rotateWithView_=imageStyle.getRotateWithView(),this.rotation_=imageStyle.getRotation(),this.scale_=imageStyle.getScale(),this.width_=size[0]},CanvasImageBuilder}(CanvasBuilder),CanvasLineStringBuilder=function(_super){function CanvasLineStringBuilder(tolerance,maxExtent,resolution,pixelRatio){return _super.call(this,tolerance,maxExtent,resolution,pixelRatio)||this}return __extends(CanvasLineStringBuilder,_super),CanvasLineStringBuilder.prototype.drawFlatCoordinates_=function(flatCoordinates,offset,end,stride){var myBegin=this.coordinates.length,myEnd=this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!1,!1),moveToLineToInstruction=[Instruction.MOVE_TO_LINE_TO,myBegin,myEnd];return this.instructions.push(moveToLineToInstruction),this.hitDetectionInstructions.push(moveToLineToInstruction),end},CanvasLineStringBuilder.prototype.drawLineString=function(lineStringGeometry,feature){var state=this.state,strokeStyle=state.strokeStyle,lineWidth=state.lineWidth;if(void 0!==strokeStyle&&void 0!==lineWidth){this.updateStrokeStyle(state,this.applyStroke),this.beginGeometry(lineStringGeometry,feature),this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset],beginPathInstruction);var flatCoordinates=lineStringGeometry.getFlatCoordinates(),stride=lineStringGeometry.getStride();this.drawFlatCoordinates_(flatCoordinates,0,flatCoordinates.length,stride),this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(feature)}},CanvasLineStringBuilder.prototype.drawMultiLineString=function(multiLineStringGeometry,feature){var state=this.state,strokeStyle=state.strokeStyle,lineWidth=state.lineWidth;if(void 0!==strokeStyle&&void 0!==lineWidth){this.updateStrokeStyle(state,this.applyStroke),this.beginGeometry(multiLineStringGeometry,feature),this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset],beginPathInstruction);for(var ends=multiLineStringGeometry.getEnds(),flatCoordinates=multiLineStringGeometry.getFlatCoordinates(),stride=multiLineStringGeometry.getStride(),offset=0,i=0,ii=ends.length;i<ii;++i)offset=this.drawFlatCoordinates_(flatCoordinates,offset,ends[i],stride);this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(feature)}},CanvasLineStringBuilder.prototype.finish=function(){var state=this.state;return null!=state.lastStroke&&state.lastStroke!=this.coordinates.length&&this.instructions.push(strokeInstruction),this.reverseHitDetectionInstructions(),this.state=null,_super.prototype.finish.call(this)},CanvasLineStringBuilder.prototype.applyStroke=function(state){null!=state.lastStroke&&state.lastStroke!=this.coordinates.length&&(this.instructions.push(strokeInstruction),state.lastStroke=this.coordinates.length),state.lastStroke=0,_super.prototype.applyStroke.call(this,state),this.instructions.push(beginPathInstruction)},CanvasLineStringBuilder}(CanvasBuilder),CanvasPolygonBuilder=function(_super){function CanvasPolygonBuilder(tolerance,maxExtent,resolution,pixelRatio){return _super.call(this,tolerance,maxExtent,resolution,pixelRatio)||this}return __extends(CanvasPolygonBuilder,_super),CanvasPolygonBuilder.prototype.drawFlatCoordinatess_=function(flatCoordinates,offset,ends,stride){var state=this.state,fill=void 0!==state.fillStyle,stroke=void 0!==state.strokeStyle,numEnds=ends.length;this.instructions.push(beginPathInstruction),this.hitDetectionInstructions.push(beginPathInstruction);for(var i=0;i<numEnds;++i){var end=ends[i],myBegin=this.coordinates.length,myEnd=this.appendFlatCoordinates(flatCoordinates,offset,end,stride,!0,!stroke),moveToLineToInstruction=[Instruction.MOVE_TO_LINE_TO,myBegin,myEnd];this.instructions.push(moveToLineToInstruction),this.hitDetectionInstructions.push(moveToLineToInstruction),stroke&&(this.instructions.push(closePathInstruction),this.hitDetectionInstructions.push(closePathInstruction)),offset=end}return fill&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),stroke&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),offset},CanvasPolygonBuilder.prototype.drawCircle=function(circleGeometry,feature){var state=this.state,fillStyle=state.fillStyle,strokeStyle=state.strokeStyle;if(void 0!==fillStyle||void 0!==strokeStyle){this.setFillStrokeStyles_(),this.beginGeometry(circleGeometry,feature),void 0!==state.fillStyle&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),void 0!==state.strokeStyle&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset]);var flatCoordinates=circleGeometry.getFlatCoordinates(),stride=circleGeometry.getStride(),myBegin=this.coordinates.length;this.appendFlatCoordinates(flatCoordinates,0,flatCoordinates.length,stride,!1,!1);var circleInstruction=[Instruction.CIRCLE,myBegin];this.instructions.push(beginPathInstruction,circleInstruction),this.hitDetectionInstructions.push(beginPathInstruction,circleInstruction),void 0!==state.fillStyle&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),void 0!==state.strokeStyle&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),this.endGeometry(feature)}},CanvasPolygonBuilder.prototype.drawPolygon=function(polygonGeometry,feature){var state=this.state,fillStyle=state.fillStyle,strokeStyle=state.strokeStyle;if(void 0!==fillStyle||void 0!==strokeStyle){this.setFillStrokeStyles_(),this.beginGeometry(polygonGeometry,feature),void 0!==state.fillStyle&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),void 0!==state.strokeStyle&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset]);var ends=polygonGeometry.getEnds(),flatCoordinates=polygonGeometry.getOrientedFlatCoordinates(),stride=polygonGeometry.getStride();this.drawFlatCoordinatess_(flatCoordinates,0,ends,stride),this.endGeometry(feature)}},CanvasPolygonBuilder.prototype.drawMultiPolygon=function(multiPolygonGeometry,feature){var state=this.state,fillStyle=state.fillStyle,strokeStyle=state.strokeStyle;if(void 0!==fillStyle||void 0!==strokeStyle){this.setFillStrokeStyles_(),this.beginGeometry(multiPolygonGeometry,feature),void 0!==state.fillStyle&&this.hitDetectionInstructions.push([Instruction.SET_FILL_STYLE,defaultFillStyle]),void 0!==state.strokeStyle&&this.hitDetectionInstructions.push([Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,state.lineDash,state.lineDashOffset]);for(var endss=multiPolygonGeometry.getEndss(),flatCoordinates=multiPolygonGeometry.getOrientedFlatCoordinates(),stride=multiPolygonGeometry.getStride(),offset=0,i=0,ii=endss.length;i<ii;++i)offset=this.drawFlatCoordinatess_(flatCoordinates,offset,endss[i],stride);this.endGeometry(feature)}},CanvasPolygonBuilder.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var tolerance=this.tolerance;if(0!==tolerance)for(var coordinates=this.coordinates,i=0,ii=coordinates.length;i<ii;++i)coordinates[i]=snap(coordinates[i],tolerance);return _super.prototype.finish.call(this)},CanvasPolygonBuilder.prototype.setFillStrokeStyles_=function(){var state=this.state;void 0!==state.fillStyle&&this.updateFillStyle(state,this.createFill),void 0!==state.strokeStyle&&this.updateStrokeStyle(state,this.applyStroke)},CanvasPolygonBuilder}(CanvasBuilder);function matchingChunk(maxAngle,flatCoordinates,offset,end,stride){var i,m12,m23,x1,y1,x12,y12,x23,y23,chunkStart=offset,chunkEnd=offset,chunkM=0,m=0,start=offset;for(i=offset;i<end;i+=stride){var x2=flatCoordinates[i],y2=flatCoordinates[i+1];void 0!==x1&&(x23=x2-x1,y23=y2-y1,m23=Math.sqrt(x23*x23+y23*y23),void 0!==x12&&(m+=m12,Math.acos((x12*x23+y12*y23)/(m12*m23))>maxAngle&&(m>chunkM&&(chunkM=m,chunkStart=start,chunkEnd=i),m=0,start=i-stride)),m12=m23,x12=x23,y12=y23),x1=x2,y1=y2}return(m+=m23)>chunkM?[start,i]:[chunkStart,chunkEnd]}var TextPlacement={POINT:"point",LINE:"line"},TEXT_ALIGN={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},CanvasTextBuilder=function(_super){function CanvasTextBuilder(tolerance,maxExtent,resolution,pixelRatio){var _this=_super.call(this,tolerance,maxExtent,resolution,pixelRatio)||this;return _this.declutterGroups_,_this.labels_=null,_this.text_="",_this.textOffsetX_=0,_this.textOffsetY_=0,_this.textRotateWithView_=void 0,_this.textRotation_=0,_this.textFillState_=null,_this.fillStates={},_this.textStrokeState_=null,_this.strokeStates={},_this.textState_={},_this.textStates={},_this.textKey_="",_this.fillKey_="",_this.strokeKey_="",labelCache.prune(),_this}return __extends(CanvasTextBuilder,_super),CanvasTextBuilder.prototype.finish=function(){var instructions=_super.prototype.finish.call(this);return instructions.textStates=this.textStates,instructions.fillStates=this.fillStates,instructions.strokeStates=this.strokeStates,instructions},CanvasTextBuilder.prototype.drawText=function(geometry,feature){var fillState=this.textFillState_,strokeState=this.textStrokeState_,textState=this.textState_;if(""!==this.text_&&textState&&(fillState||strokeState)){var i,ii,begin=this.coordinates.length,geometryType=geometry.getType(),flatCoordinates=null,end=2,stride=2;if(textState.placement===TextPlacement.LINE){if(!intersects(this.getBufferedMaxExtent(),geometry.getExtent()))return;var ends=void 0;if(flatCoordinates=geometry.getFlatCoordinates(),stride=geometry.getStride(),geometryType==GeometryType.LINE_STRING)ends=[flatCoordinates.length];else if(geometryType==GeometryType.MULTI_LINE_STRING)ends=geometry.getEnds();else if(geometryType==GeometryType.POLYGON)ends=geometry.getEnds().slice(0,1);else if(geometryType==GeometryType.MULTI_POLYGON){var endss=geometry.getEndss();for(ends=[],i=0,ii=endss.length;i<ii;++i)ends.push(endss[i][0])}this.beginGeometry(geometry,feature);for(var textAlign=textState.textAlign,flatOffset=0,flatEnd=void 0,o=0,oo=ends.length;o<oo;++o){if(null==textAlign){var range=matchingChunk(textState.maxAngle,flatCoordinates,flatOffset,ends[o],stride);flatOffset=range[0],flatEnd=range[1]}else flatEnd=ends[o];for(i=flatOffset;i<flatEnd;i+=stride)this.coordinates.push(flatCoordinates[i],flatCoordinates[i+1]);end=this.coordinates.length,flatOffset=ends[o];var declutterGroup=this.declutterGroups_?0===o?this.declutterGroups_[0]:[].concat(this.declutterGroups_[0]):null;this.drawChars_(begin,end,declutterGroup),begin=end}this.endGeometry(feature)}else{var geometryWidths=null;switch(textState.overflow||(geometryWidths=[]),geometryType){case GeometryType.POINT:case GeometryType.MULTI_POINT:end=(flatCoordinates=geometry.getFlatCoordinates()).length;break;case GeometryType.LINE_STRING:flatCoordinates=geometry.getFlatMidpoint();break;case GeometryType.CIRCLE:flatCoordinates=geometry.getCenter();break;case GeometryType.MULTI_LINE_STRING:end=(flatCoordinates=geometry.getFlatMidpoints()).length;break;case GeometryType.POLYGON:flatCoordinates=geometry.getFlatInteriorPoint(),textState.overflow||geometryWidths.push(flatCoordinates[2]/this.resolution),stride=3;break;case GeometryType.MULTI_POLYGON:var interiorPoints=geometry.getFlatInteriorPoints();for(flatCoordinates=[],i=0,ii=interiorPoints.length;i<ii;i+=3)textState.overflow||geometryWidths.push(interiorPoints[i+2]/this.resolution),flatCoordinates.push(interiorPoints[i],interiorPoints[i+1]);if(0==(end=flatCoordinates.length))return}end=this.appendFlatCoordinates(flatCoordinates,0,end,stride,!1,!1),this.saveTextStates_(),(textState.backgroundFill||textState.backgroundStroke)&&(this.setFillStrokeStyle(textState.backgroundFill,textState.backgroundStroke),textState.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),textState.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(geometry,feature);var pixelRatio_1=this.pixelRatio;this.instructions.push([Instruction.DRAW_IMAGE,begin,end,null,NaN,NaN,this.declutterGroups_,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,1,NaN,textState.padding==defaultPadding?defaultPadding:textState.padding.map(function(p){return p*pixelRatio_1}),!!textState.backgroundFill,!!textState.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,geometryWidths]),this.hitDetectionInstructions.push([Instruction.DRAW_IMAGE,begin,end,null,NaN,NaN,this.declutterGroups_,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,1/this.pixelRatio,NaN,textState.padding,!!textState.backgroundFill,!!textState.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,geometryWidths]),this.endGeometry(feature)}}},CanvasTextBuilder.prototype.saveTextStates_=function(){var strokeState=this.textStrokeState_,textState=this.textState_,fillState=this.textFillState_,strokeKey=this.strokeKey_;strokeState&&(strokeKey in this.strokeStates||(this.strokeStates[strokeKey]={strokeStyle:strokeState.strokeStyle,lineCap:strokeState.lineCap,lineDashOffset:strokeState.lineDashOffset,lineWidth:strokeState.lineWidth,lineJoin:strokeState.lineJoin,miterLimit:strokeState.miterLimit,lineDash:strokeState.lineDash}));var textKey=this.textKey_;textKey in this.textStates||(this.textStates[textKey]={font:textState.font,textAlign:textState.textAlign||defaultTextAlign,textBaseline:textState.textBaseline||defaultTextBaseline,scale:textState.scale});var fillKey=this.fillKey_;fillState&&(fillKey in this.fillStates||(this.fillStates[fillKey]={fillStyle:fillState.fillStyle}))},CanvasTextBuilder.prototype.drawChars_=function(begin,end,declutterGroup){var strokeState=this.textStrokeState_,textState=this.textState_,strokeKey=this.strokeKey_,textKey=this.textKey_,fillKey=this.fillKey_;this.saveTextStates_();var pixelRatio=this.pixelRatio,baseline=TEXT_ALIGN[textState.textBaseline],offsetY=this.textOffsetY_*pixelRatio,text=this.text_,textScale=textState.scale,strokeWidth=strokeState?strokeState.lineWidth*textScale/2:0;this.instructions.push([Instruction.DRAW_CHARS,begin,end,baseline,declutterGroup,textState.overflow,fillKey,textState.maxAngle,pixelRatio,offsetY,strokeKey,strokeWidth*pixelRatio,text,textKey,1]),this.hitDetectionInstructions.push([Instruction.DRAW_CHARS,begin,end,baseline,declutterGroup,textState.overflow,fillKey,textState.maxAngle,1,offsetY,strokeKey,strokeWidth,text,textKey,1/pixelRatio])},CanvasTextBuilder.prototype.setTextStyle=function(textStyle,declutterGroups){var textState,fillState,strokeState;if(textStyle){this.declutterGroups_=declutterGroups;var textFillStyle=textStyle.getFill();textFillStyle?((fillState=this.textFillState_)||(fillState=this.textFillState_={}),fillState.fillStyle=asColorLike(textFillStyle.getColor()||defaultFillStyle)):fillState=this.textFillState_=null;var textStrokeStyle=textStyle.getStroke();if(textStrokeStyle){(strokeState=this.textStrokeState_)||(strokeState=this.textStrokeState_={});var lineDash=textStrokeStyle.getLineDash(),lineDashOffset=textStrokeStyle.getLineDashOffset(),lineWidth=textStrokeStyle.getWidth(),miterLimit=textStrokeStyle.getMiterLimit();strokeState.lineCap=textStrokeStyle.getLineCap()||defaultLineCap,strokeState.lineDash=lineDash?lineDash.slice():defaultLineDash,strokeState.lineDashOffset=void 0===lineDashOffset?defaultLineDashOffset:lineDashOffset,strokeState.lineJoin=textStrokeStyle.getLineJoin()||defaultLineJoin,strokeState.lineWidth=void 0===lineWidth?defaultLineWidth:lineWidth,strokeState.miterLimit=void 0===miterLimit?defaultMiterLimit:miterLimit,strokeState.strokeStyle=asColorLike(textStrokeStyle.getColor()||defaultStrokeStyle)}else strokeState=this.textStrokeState_=null;textState=this.textState_;var font=textStyle.getFont()||defaultFont;checkFont(font);var textScale=textStyle.getScale();textState.overflow=textStyle.getOverflow(),textState.font=font,textState.maxAngle=textStyle.getMaxAngle(),textState.placement=textStyle.getPlacement(),textState.textAlign=textStyle.getTextAlign(),textState.textBaseline=textStyle.getTextBaseline()||defaultTextBaseline,textState.backgroundFill=textStyle.getBackgroundFill(),textState.backgroundStroke=textStyle.getBackgroundStroke(),textState.padding=textStyle.getPadding()||defaultPadding,textState.scale=void 0===textScale?1:textScale;var textOffsetX=textStyle.getOffsetX(),textOffsetY=textStyle.getOffsetY(),textRotateWithView=textStyle.getRotateWithView(),textRotation=textStyle.getRotation();this.text_=textStyle.getText()||"",this.textOffsetX_=void 0===textOffsetX?0:textOffsetX,this.textOffsetY_=void 0===textOffsetY?0:textOffsetY,this.textRotateWithView_=void 0!==textRotateWithView&&textRotateWithView,this.textRotation_=void 0===textRotation?0:textRotation,this.strokeKey_=strokeState?("string"==typeof strokeState.strokeStyle?strokeState.strokeStyle:getUid(strokeState.strokeStyle))+strokeState.lineCap+strokeState.lineDashOffset+"|"+strokeState.lineWidth+strokeState.lineJoin+strokeState.miterLimit+"["+strokeState.lineDash.join()+"]":"",this.textKey_=textState.font+textState.scale+(textState.textAlign||"?"),this.fillKey_=fillState?"string"==typeof fillState.fillStyle?fillState.fillStyle:"|"+getUid(fillState.fillStyle):""}else this.text_=""},CanvasTextBuilder}(CanvasBuilder),BATCH_CONSTRUCTORS={Circle:CanvasPolygonBuilder,Default:CanvasBuilder,Image:CanvasImageBuilder,LineString:CanvasLineStringBuilder,Polygon:CanvasPolygonBuilder,Text:CanvasTextBuilder},BuilderGroup=function(){function BuilderGroup(tolerance,maxExtent,resolution,pixelRatio,declutter){this.declutter_=declutter,this.declutterGroups_=null,this.tolerance_=tolerance,this.maxExtent_=maxExtent,this.pixelRatio_=pixelRatio,this.resolution_=resolution,this.buildersByZIndex_={}}return BuilderGroup.prototype.addDeclutter=function(group){var declutter=null;return this.declutter_&&(group?(declutter=this.declutterGroups_)[0][4]++:(declutter=this.declutterGroups_=[createEmpty()])[0].push(1)),declutter},BuilderGroup.prototype.finish=function(){var builderInstructions={};for(var zKey in this.buildersByZIndex_){builderInstructions[zKey]=builderInstructions[zKey]||{};var builders=this.buildersByZIndex_[zKey];for(var builderKey in builders){var builderInstruction=builders[builderKey].finish();builderInstructions[zKey][builderKey]=builderInstruction}}return builderInstructions},BuilderGroup.prototype.getBuilder=function(zIndex,builderType){var zIndexKey=void 0!==zIndex?zIndex.toString():"0",replays=this.buildersByZIndex_[zIndexKey];void 0===replays&&(replays={},this.buildersByZIndex_[zIndexKey]=replays);var replay=replays[builderType];void 0===replay&&(replay=new(0,BATCH_CONSTRUCTORS[builderType])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),replays[builderType]=replay);return replay},BuilderGroup}();function drawTextOnPath(flatCoordinates,offset,end,stride,text,startM,maxAngle,scale,measureAndCacheTextWidth,font,cache){for(var index,previousAngle,result=[],reverse=flatCoordinates[offset]>flatCoordinates[end-stride],numChars=text.length,x1=flatCoordinates[offset],y1=flatCoordinates[offset+1],x2=flatCoordinates[offset+=stride],y2=flatCoordinates[offset+1],segmentM=0,segmentLength=Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2)),angleChanged=!1,i=0;i<numChars;++i){for(var char=text[index=reverse?numChars-i-1:i],charLength=scale*measureAndCacheTextWidth(font,char,cache),charM=startM+charLength/2;offset<end-stride&&segmentM+segmentLength<charM;)x1=x2,y1=y2,x2=flatCoordinates[offset+=stride],y2=flatCoordinates[offset+1],segmentM+=segmentLength,segmentLength=Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2));var segmentPos=charM-segmentM,angle=Math.atan2(y2-y1,x2-x1);if(reverse&&(angle+=angle>0?-Math.PI:Math.PI),void 0!==previousAngle){var delta=angle-previousAngle;if(angleChanged=angleChanged||0!==delta,delta+=delta>Math.PI?-2*Math.PI:delta<-Math.PI?2*Math.PI:0,Math.abs(delta)>maxAngle)return null}previousAngle=angle;var interpolate=segmentPos/segmentLength,x=lerp(x1,x2,interpolate),y=lerp(y1,y2,interpolate);result[index]=[x,y,charLength/2,angle,char],startM+=charLength}return angleChanged?result:[[result[0][0],result[0][1],result[0][2],result[0][3],text]]}function quickselect(arr,k,left,right,compare){quickselectStep(arr,k,left||0,right||arr.length-1,compare||defaultCompare)}function quickselectStep(arr,k,left,right,compare){for(;right>left;){if(right-left>600){var n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselectStep(arr,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}var t=arr[k],i=left,j=right;for(swap(arr,left,k),compare(arr[right],t)>0&&swap(arr,left,right);i<j;){for(swap(arr,i,j),i++,j--;compare(arr[i],t)<0;)i++;for(;compare(arr[j],t)>0;)j--}0===compare(arr[left],t)?swap(arr,left,j):swap(arr,++j,right),j<=k&&(left=j+1),k<=j&&(right=j-1)}}function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}function defaultCompare(a,b){return a<b?-1:a>b?1:0}class RBush{constructor(maxEntries=9){this._maxEntries=Math.max(4,maxEntries),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(bbox){let node=this.data;const result=[];if(!intersects$1(bbox,node))return result;const toBBox=this.toBBox,nodesToSearch=[];for(;node;){for(let i=0;i<node.children.length;i++){const child=node.children[i],childBBox=node.leaf?toBBox(child):child;intersects$1(bbox,childBBox)&&(node.leaf?result.push(child):contains(bbox,childBBox)?this._all(child,result):nodesToSearch.push(child))}node=nodesToSearch.pop()}return result}collides(bbox){let node=this.data;if(!intersects$1(bbox,node))return!1;const nodesToSearch=[];for(;node;){for(let i=0;i<node.children.length;i++){const child=node.children[i],childBBox=node.leaf?this.toBBox(child):child;if(intersects$1(bbox,childBBox)){if(node.leaf||contains(bbox,childBBox))return!0;nodesToSearch.push(child)}}node=nodesToSearch.pop()}return!1}load(data){if(!data||!data.length)return this;if(data.length<this._minEntries){for(let i=0;i<data.length;i++)this.insert(data[i]);return this}let node=this._build(data.slice(),0,data.length-1,0);if(this.data.children.length)if(this.data.height===node.height)this._splitRoot(this.data,node);else{if(this.data.height<node.height){const tmpNode=this.data;this.data=node,node=tmpNode}this._insert(node,this.data.height-node.height-1,!0)}else this.data=node;return this}insert(item){return item&&this._insert(item,this.data.height-1),this}clear(){return this.data=createNode([]),this}remove(item,equalsFn){if(!item)return this;let node=this.data;const bbox=this.toBBox(item),path=[],indexes=[];let i,parent,goingUp;for(;node||path.length;){if(node||(node=path.pop(),parent=path[path.length-1],i=indexes.pop(),goingUp=!0),node.leaf){const index=findItem(item,node.children,equalsFn);if(-1!==index)return node.children.splice(index,1),path.push(node),this._condense(path),this}goingUp||node.leaf||!contains(node,bbox)?parent?(i++,node=parent.children[i],goingUp=!1):node=null:(path.push(node),indexes.push(i),i=0,parent=node,node=node.children[0])}return this}toBBox(item){return item}compareMinX(a,b){return a.minX-b.minX}compareMinY(a,b){return a.minY-b.minY}toJSON(){return this.data}fromJSON(data){return this.data=data,this}_all(node,result){const nodesToSearch=[];for(;node;)node.leaf?result.push(...node.children):nodesToSearch.push(...node.children),node=nodesToSearch.pop();return result}_build(items,left,right,height){const N=right-left+1;let node,M=this._maxEntries;if(N<=M)return calcBBox(node=createNode(items.slice(left,right+1)),this.toBBox),node;height||(height=Math.ceil(Math.log(N)/Math.log(M)),M=Math.ceil(N/Math.pow(M,height-1))),(node=createNode([])).leaf=!1,node.height=height;const N2=Math.ceil(N/M),N1=N2*Math.ceil(Math.sqrt(M));multiSelect(items,left,right,N1,this.compareMinX);for(let i=left;i<=right;i+=N1){const right2=Math.min(i+N1-1,right);multiSelect(items,i,right2,N2,this.compareMinY);for(let j=i;j<=right2;j+=N2){const right3=Math.min(j+N2-1,right2);node.children.push(this._build(items,j,right3,height-1))}}return calcBBox(node,this.toBBox),node}_chooseSubtree(bbox,node,level,path){for(;path.push(node),!node.leaf&&path.length-1!==level;){let targetNode,minArea=1/0,minEnlargement=1/0;for(let i=0;i<node.children.length;i++){const child=node.children[i],area=bboxArea(child),enlargement=enlargedArea(bbox,child)-area;enlargement<minEnlargement?(minEnlargement=enlargement,minArea=area<minArea?area:minArea,targetNode=child):enlargement===minEnlargement&&area<minArea&&(minArea=area,targetNode=child)}node=targetNode||node.children[0]}return node}_insert(item,level,isNode){const bbox=isNode?item:this.toBBox(item),insertPath=[],node=this._chooseSubtree(bbox,this.data,level,insertPath);for(node.children.push(item),extend$2(node,bbox);level>=0&&insertPath[level].children.length>this._maxEntries;)this._split(insertPath,level),level--;this._adjustParentBBoxes(bbox,insertPath,level)}_split(insertPath,level){const node=insertPath[level],M=node.children.length,m=this._minEntries;this._chooseSplitAxis(node,m,M);const splitIndex=this._chooseSplitIndex(node,m,M),newNode=createNode(node.children.splice(splitIndex,node.children.length-splitIndex));newNode.height=node.height,newNode.leaf=node.leaf,calcBBox(node,this.toBBox),calcBBox(newNode,this.toBBox),level?insertPath[level-1].children.push(newNode):this._splitRoot(node,newNode)}_splitRoot(node,newNode){this.data=createNode([node,newNode]),this.data.height=node.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)}_chooseSplitIndex(node,m,M){let index,minOverlap=1/0,minArea=1/0;for(let i=m;i<=M-m;i++){const bbox1=distBBox(node,0,i,this.toBBox),bbox2=distBBox(node,i,M,this.toBBox),overlap=intersectionArea(bbox1,bbox2),area=bboxArea(bbox1)+bboxArea(bbox2);overlap<minOverlap?(minOverlap=overlap,index=i,minArea=area<minArea?area:minArea):overlap===minOverlap&&area<minArea&&(minArea=area,index=i)}return index||M-m}_chooseSplitAxis(node,m,M){const compareMinX=node.leaf?this.compareMinX:compareNodeMinX,compareMinY=node.leaf?this.compareMinY:compareNodeMinY;this._allDistMargin(node,m,M,compareMinX)<this._allDistMargin(node,m,M,compareMinY)&&node.children.sort(compareMinX)}_allDistMargin(node,m,M,compare){node.children.sort(compare);const toBBox=this.toBBox,leftBBox=distBBox(node,0,m,toBBox),rightBBox=distBBox(node,M-m,M,toBBox);let margin=bboxMargin(leftBBox)+bboxMargin(rightBBox);for(let i=m;i<M-m;i++){const child=node.children[i];extend$2(leftBBox,node.leaf?toBBox(child):child),margin+=bboxMargin(leftBBox)}for(let i=M-m-1;i>=m;i--){const child=node.children[i];extend$2(rightBBox,node.leaf?toBBox(child):child),margin+=bboxMargin(rightBBox)}return margin}_adjustParentBBoxes(bbox,path,level){for(let i=level;i>=0;i--)extend$2(path[i],bbox)}_condense(path){for(let siblings,i=path.length-1;i>=0;i--)0===path[i].children.length?i>0?(siblings=path[i-1].children).splice(siblings.indexOf(path[i]),1):this.clear():calcBBox(path[i],this.toBBox)}}function findItem(item,items,equalsFn){if(!equalsFn)return items.indexOf(item);for(let i=0;i<items.length;i++)if(equalsFn(item,items[i]))return i;return-1}function calcBBox(node,toBBox){distBBox(node,0,node.children.length,toBBox,node)}function distBBox(node,k,p,toBBox,destNode){destNode||(destNode=createNode(null)),destNode.minX=1/0,destNode.minY=1/0,destNode.maxX=-1/0,destNode.maxY=-1/0;for(let i=k;i<p;i++){const child=node.children[i];extend$2(destNode,node.leaf?toBBox(child):child)}return destNode}function extend$2(a,b){return a.minX=Math.min(a.minX,b.minX),a.minY=Math.min(a.minY,b.minY),a.maxX=Math.max(a.maxX,b.maxX),a.maxY=Math.max(a.maxY,b.maxY),a}function compareNodeMinX(a,b){return a.minX-b.minX}function compareNodeMinY(a,b){return a.minY-b.minY}function bboxArea(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function bboxMargin(a){return a.maxX-a.minX+(a.maxY-a.minY)}function enlargedArea(a,b){return(Math.max(b.maxX,a.maxX)-Math.min(b.minX,a.minX))*(Math.max(b.maxY,a.maxY)-Math.min(b.minY,a.minY))}function intersectionArea(a,b){const minX=Math.max(a.minX,b.minX),minY=Math.max(a.minY,b.minY),maxX=Math.min(a.maxX,b.maxX),maxY=Math.min(a.maxY,b.maxY);return Math.max(0,maxX-minX)*Math.max(0,maxY-minY)}function contains(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function intersects$1(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function createNode(children){return{children:children,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(arr,left,right,n,compare){const stack=[left,right];for(;stack.length;){if((right=stack.pop())-(left=stack.pop())<=n)continue;const mid=left+Math.ceil((right-left)/n/2)*n;quickselect(arr,mid,left,right,compare),stack.push(left,mid,mid,right)}}var tmpExtent=createEmpty(),tmpTransform$1=create(),p1=[],p2=[],p3=[],p4=[],Executor=function(_super){function Executor(resolution,pixelRatio,overlaps,instructions){var _this=_super.call(this)||this;return _this.overlaps=overlaps,_this.pixelRatio=pixelRatio,_this.resolution=resolution,_this.alignFill_,_this.declutterItems=[],_this.instructions=instructions.instructions,_this.coordinates=instructions.coordinates,_this.coordinateCache_={},_this.renderedTransform_=create(),_this.hitDetectionInstructions=instructions.hitDetectionInstructions,_this.pixelCoordinates_=null,_this.viewRotation_=0,_this.fillStates=instructions.fillStates||{},_this.strokeStates=instructions.strokeStates||{},_this.textStates=instructions.textStates||{},_this.widths_={},_this}return __extends(Executor,_super),Executor.prototype.disposeInternal=function(){labelCache.release(this),_super.prototype.disposeInternal.call(this)},Executor.prototype.getTextImage=function(text,textKey,fillKey,strokeKey){var label,key=strokeKey+textKey+text+fillKey+this.pixelRatio;if(!labelCache.containsKey(key)){var strokeState=strokeKey?this.strokeStates[strokeKey]:null,fillState=fillKey?this.fillStates[fillKey]:null,textState=this.textStates[textKey],pixelRatio=this.pixelRatio,scale=textState.scale*pixelRatio,align=TEXT_ALIGN[textState.textAlign||defaultTextAlign],strokeWidth=strokeKey&&strokeState.lineWidth?strokeState.lineWidth:0,lines=text.split("\n"),numLines=lines.length,widths=[],width=measureTextWidths(textState.font,lines,widths),lineHeight=measureTextHeight(textState.font),height=lineHeight*numLines,renderWidth=width+strokeWidth,context=createCanvasContext2D(Math.ceil((renderWidth+2)*scale),Math.ceil((height+strokeWidth)*scale));label=context.canvas,labelCache.set(key,label),1!=scale&&context.scale(scale,scale),context.font=textState.font,strokeKey&&(context.strokeStyle=strokeState.strokeStyle,context.lineWidth=strokeWidth,context.lineCap=strokeState.lineCap,context.lineJoin=strokeState.lineJoin,context.miterLimit=strokeState.miterLimit,context.setLineDash&&strokeState.lineDash.length&&(context.setLineDash(strokeState.lineDash),context.lineDashOffset=strokeState.lineDashOffset)),fillKey&&(context.fillStyle=fillState.fillStyle),context.textBaseline="middle",context.textAlign="center";var leftRight=.5-align,x=align*renderWidth+leftRight*strokeWidth,i=void 0;if(strokeKey)for(i=0;i<numLines;++i)context.strokeText(lines[i],x+leftRight*widths[i],.5*(strokeWidth+lineHeight)+i*lineHeight);if(fillKey)for(i=0;i<numLines;++i)context.fillText(lines[i],x+leftRight*widths[i],.5*(strokeWidth+lineHeight)+i*lineHeight)}return labelCache.get(key,this)},Executor.prototype.replayTextBackground_=function(context,p1,p2,p3,p4,fillInstruction,strokeInstruction){context.beginPath(),context.moveTo.apply(context,p1),context.lineTo.apply(context,p2),context.lineTo.apply(context,p3),context.lineTo.apply(context,p4),context.lineTo.apply(context,p1),fillInstruction&&(this.alignFill_=fillInstruction[2],this.fill_(context)),strokeInstruction&&(this.setStrokeStyle_(context,strokeInstruction),context.stroke())},Executor.prototype.replayImage_=function(context,x,y,image,anchorX,anchorY,declutterGroup,height,opacity,originX,originY,rotation,scale,snapToPixel,width,padding,fillInstruction,strokeInstruction){var fillStroke=fillInstruction||strokeInstruction;x-=anchorX*=scale,y-=anchorY*=scale;var w=width+originX>image.width?image.width-originX:width,h=height+originY>image.height?image.height-originY:height,boxW=padding[3]+w*scale+padding[1],boxH=padding[0]+h*scale+padding[2],boxX=x-padding[3],boxY=y-padding[0];(fillStroke||0!==rotation)&&(p1[0]=p4[0]=boxX,p1[1]=p2[1]=boxY,p2[0]=p3[0]=boxX+boxW,p3[1]=p4[1]=boxY+boxH);var transform=null;if(0!==rotation){var centerX=x+anchorX,centerY=y+anchorY;transform=compose(tmpTransform$1,centerX,centerY,1,1,rotation,-centerX,-centerY),apply(tmpTransform$1,p1),apply(tmpTransform$1,p2),apply(tmpTransform$1,p3),apply(tmpTransform$1,p4),createOrUpdate(Math.min(p1[0],p2[0],p3[0],p4[0]),Math.min(p1[1],p2[1],p3[1],p4[1]),Math.max(p1[0],p2[0],p3[0],p4[0]),Math.max(p1[1],p2[1],p3[1],p4[1]),tmpExtent)}else createOrUpdate(boxX,boxY,boxX+boxW,boxY+boxH,tmpExtent);var canvas=context.canvas,strokePadding=strokeInstruction?strokeInstruction[2]*scale/2:0,intersects=tmpExtent[0]-strokePadding<=canvas.width&&tmpExtent[2]+strokePadding>=0&&tmpExtent[1]-strokePadding<=canvas.height&&tmpExtent[3]+strokePadding>=0;if(snapToPixel&&(x=Math.round(x),y=Math.round(y)),declutterGroup){if(!intersects&&1==declutterGroup[4])return;extend$1(declutterGroup,tmpExtent);var declutterArgs=intersects?[context,transform?transform.slice(0):null,opacity,image,originX,originY,w,h,x,y,scale]:null;declutterArgs&&(fillStroke&&declutterArgs.push(fillInstruction,strokeInstruction,p1,p2,p3,p4),declutterGroup.push(declutterArgs))}else intersects&&(fillStroke&&this.replayTextBackground_(context,p1,p2,p3,p4,fillInstruction,strokeInstruction),drawImage(context,transform,opacity,image,originX,originY,w,h,x,y,scale))},Executor.prototype.fill_=function(context){if(this.alignFill_){var origin_1=apply(this.renderedTransform_,[0,0]),repeatSize=512*this.pixelRatio;context.save(),context.translate(origin_1[0]%repeatSize,origin_1[1]%repeatSize),context.rotate(this.viewRotation_)}context.fill(),this.alignFill_&&context.restore()},Executor.prototype.setStrokeStyle_=function(context,instruction){context.strokeStyle=instruction[1],context.lineWidth=instruction[2],context.lineCap=instruction[3],context.lineJoin=instruction[4],context.miterLimit=instruction[5],context.setLineDash&&(context.lineDashOffset=instruction[7],context.setLineDash(instruction[6]))},Executor.prototype.renderDeclutter=function(declutterGroup,feature,opacity,declutterTree){if(declutterGroup&&declutterGroup.length>5){var groupCount=declutterGroup[4];if(1==groupCount||groupCount==declutterGroup.length-5){var box={minX:declutterGroup[0],minY:declutterGroup[1],maxX:declutterGroup[2],maxY:declutterGroup[3],value:feature};if(declutterTree||(declutterTree=new RBush(9)),!declutterTree.collides(box)){declutterTree.insert(box);for(var j=5,jj=declutterGroup.length;j<jj;++j){var declutterData=declutterGroup[j],context=declutterData[0],currentAlpha=context.globalAlpha;currentAlpha!==opacity&&(context.globalAlpha=opacity),declutterData.length>11&&this.replayTextBackground_(declutterData[0],declutterData[13],declutterData[14],declutterData[15],declutterData[16],declutterData[11],declutterData[12]),drawImage.apply(void 0,declutterData),currentAlpha!==opacity&&(context.globalAlpha=currentAlpha)}}declutterGroup.length=5,createOrUpdateEmpty(declutterGroup)}}return declutterTree},Executor.prototype.drawTextImageWithPointPlacement_=function(text,textKey,strokeKey,fillKey){var textState=this.textStates[textKey],label=this.getTextImage(text,textKey,fillKey,strokeKey),strokeState=this.strokeStates[strokeKey],pixelRatio=this.pixelRatio,align=TEXT_ALIGN[textState.textAlign||defaultTextAlign],baseline=TEXT_ALIGN[textState.textBaseline||defaultTextBaseline],strokeWidth=strokeState&&strokeState.lineWidth?strokeState.lineWidth:0;return{label:label,anchorX:align*(label.width/pixelRatio-2*textState.scale)+2*(.5-align)*strokeWidth,anchorY:baseline*label.height/pixelRatio+2*(.5-baseline)*strokeWidth}},Executor.prototype.execute_=function(context,transform,instructions,snapToPixel,featureCallback,opt_hitExtent){var pixelCoordinates;this.declutterItems.length=0,this.pixelCoordinates_&&equals(transform,this.renderedTransform_)?pixelCoordinates=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),pixelCoordinates=transform2D(this.coordinates,0,this.coordinates.length,2,transform,this.pixelCoordinates_),setFromArray(this.renderedTransform_,transform));for(var dd,anchorX,anchorY,prevX,prevY,roundX,roundY,declutterGroup,declutterGroups,image,text,textKey,strokeKey,fillKey,feature,x,y,i=0,ii=instructions.length,d=0,pendingFill=0,pendingStroke=0,lastFillInstruction=null,lastStrokeInstruction=null,coordinateCache=this.coordinateCache_,viewRotation=this.viewRotation_,state={context:context,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:viewRotation},batchSize=this.instructions!=instructions||this.overlaps?0:200;i<ii;){var instruction=instructions[i];switch(instruction[0]){case Instruction.BEGIN_GEOMETRY:(feature=instruction[1]).getGeometry()?void 0===opt_hitExtent||intersects(opt_hitExtent,instruction[3])?++i:i=instruction[2]+1:i=instruction[2];break;case Instruction.BEGIN_PATH:pendingFill>batchSize&&(this.fill_(context),pendingFill=0),pendingStroke>batchSize&&(context.stroke(),pendingStroke=0),pendingFill||pendingStroke||(context.beginPath(),prevX=prevY=NaN),++i;break;case Instruction.CIRCLE:var x1=pixelCoordinates[d=instruction[1]],y1=pixelCoordinates[d+1],dx=pixelCoordinates[d+2]-x1,dy=pixelCoordinates[d+3]-y1,r=Math.sqrt(dx*dx+dy*dy);context.moveTo(x1+r,y1),context.arc(x1,y1,r,0,2*Math.PI,!0),++i;break;case Instruction.CLOSE_PATH:context.closePath(),++i;break;case Instruction.CUSTOM:d=instruction[1],dd=instruction[2];var geometry=instruction[3],renderer=instruction[4],fn=6==instruction.length?instruction[5]:void 0;state.geometry=geometry,state.feature=feature,i in coordinateCache||(coordinateCache[i]=[]);var coords=coordinateCache[i];fn?fn(pixelCoordinates,d,dd,2,coords):(coords[0]=pixelCoordinates[d],coords[1]=pixelCoordinates[d+1],coords.length=2),renderer(coords,state),++i;break;case Instruction.DRAW_IMAGE:d=instruction[1],dd=instruction[2],image=instruction[3],anchorX=instruction[4],anchorY=instruction[5],declutterGroups=featureCallback?null:instruction[6];var height=instruction[7],opacity=instruction[8],originX=instruction[9],originY=instruction[10],rotateWithView=instruction[11],rotation=instruction[12],scale=instruction[13],width=instruction[14];if(!image&&instruction.length>=19){text=instruction[18],textKey=instruction[19],strokeKey=instruction[20],fillKey=instruction[21];var labelWithAnchor=this.drawTextImageWithPointPlacement_(text,textKey,strokeKey,fillKey);image=instruction[3]=labelWithAnchor.label;var textOffsetX=instruction[22];anchorX=instruction[4]=(labelWithAnchor.anchorX-textOffsetX)*this.pixelRatio;var textOffsetY=instruction[23];anchorY=instruction[5]=(labelWithAnchor.anchorY-textOffsetY)*this.pixelRatio,height=instruction[7]=image.height,width=instruction[14]=image.width}var geometryWidths=void 0;instruction.length>24&&(geometryWidths=instruction[24]);var padding=void 0,backgroundFill=void 0,backgroundStroke=void 0;instruction.length>16?(padding=instruction[15],backgroundFill=instruction[16],backgroundStroke=instruction[17]):(padding=defaultPadding,backgroundFill=backgroundStroke=!1),rotateWithView&&(rotation+=viewRotation);for(var widthIndex=0,declutterGroupIndex=0;d<dd;d+=2)if(!(geometryWidths&&geometryWidths[widthIndex++]<width/this.pixelRatio)){if(declutterGroups){var index=Math.floor(declutterGroupIndex);declutterGroups.length<index+1&&((declutterGroup=createEmpty()).push(declutterGroups[0][4]),declutterGroups.push(declutterGroup)),declutterGroup=declutterGroups[index]}this.replayImage_(context,pixelCoordinates[d],pixelCoordinates[d+1],image,anchorX,anchorY,declutterGroup,height,opacity,originX,originY,rotation,scale,snapToPixel,width,padding,backgroundFill?lastFillInstruction:null,backgroundStroke?lastStrokeInstruction:null),declutterGroup&&(declutterGroupIndex===Math.floor(declutterGroupIndex)&&this.declutterItems.push(this,declutterGroup,feature),declutterGroupIndex+=1/declutterGroup[4])}++i;break;case Instruction.DRAW_CHARS:var begin=instruction[1],end=instruction[2],baseline=instruction[3];declutterGroup=featureCallback?null:instruction[4];var overflow=instruction[5];fillKey=instruction[6];var maxAngle=instruction[7],measurePixelRatio=instruction[8],offsetY=instruction[9];strokeKey=instruction[10];var strokeWidth=instruction[11];text=instruction[12],textKey=instruction[13];var pixelRatioScale=instruction[14],textState=this.textStates[textKey],font=textState.font,textScale=textState.scale*measurePixelRatio,cachedWidths=void 0;cachedWidths=font in this.widths_?this.widths_[font]:this.widths_[font]={};var pathLength=lineStringLength(pixelCoordinates,begin,end,2),textLength=textScale*measureAndCacheTextWidth(font,text,cachedWidths);if(overflow||textLength<=pathLength){var textAlign=this.textStates[textKey].textAlign,parts=drawTextOnPath(pixelCoordinates,begin,end,2,text,(pathLength-textLength)*TEXT_ALIGN[textAlign],maxAngle,textScale,measureAndCacheTextWidth,font,cachedWidths);if(parts){var c=void 0,cc=void 0,chars=void 0,label=void 0,part=void 0;if(strokeKey)for(c=0,cc=parts.length;c<cc;++c)chars=(part=parts[c])[4],label=this.getTextImage(chars,textKey,"",strokeKey),anchorX=part[2]+strokeWidth,anchorY=baseline*label.height+2*(.5-baseline)*strokeWidth-offsetY,this.replayImage_(context,part[0],part[1],label,anchorX,anchorY,declutterGroup,label.height,1,0,0,part[3],pixelRatioScale,!1,label.width,defaultPadding,null,null);if(fillKey)for(c=0,cc=parts.length;c<cc;++c)chars=(part=parts[c])[4],label=this.getTextImage(chars,textKey,fillKey,""),anchorX=part[2],anchorY=baseline*label.height-offsetY,this.replayImage_(context,part[0],part[1],label,anchorX,anchorY,declutterGroup,label.height,1,0,0,part[3],pixelRatioScale,!1,label.width,defaultPadding,null,null)}}this.declutterItems.push(this,declutterGroup,feature),++i;break;case Instruction.END_GEOMETRY:if(void 0!==featureCallback){var result=featureCallback(feature=instruction[1]);if(result)return result}++i;break;case Instruction.FILL:batchSize?pendingFill++:this.fill_(context),++i;break;case Instruction.MOVE_TO_LINE_TO:for(d=instruction[1],dd=instruction[2],x=pixelCoordinates[d],roundY=(y=pixelCoordinates[d+1])+.5|0,(roundX=x+.5|0)===prevX&&roundY===prevY||(context.moveTo(x,y),prevX=roundX,prevY=roundY),d+=2;d<dd;d+=2)roundX=(x=pixelCoordinates[d])+.5|0,roundY=(y=pixelCoordinates[d+1])+.5|0,d!=dd-2&&roundX===prevX&&roundY===prevY||(context.lineTo(x,y),prevX=roundX,prevY=roundY);++i;break;case Instruction.SET_FILL_STYLE:lastFillInstruction=instruction,this.alignFill_=instruction[2],pendingFill&&(this.fill_(context),pendingFill=0,pendingStroke&&(context.stroke(),pendingStroke=0)),context.fillStyle=instruction[1],++i;break;case Instruction.SET_STROKE_STYLE:lastStrokeInstruction=instruction,pendingStroke&&(context.stroke(),pendingStroke=0),this.setStrokeStyle_(context,instruction),++i;break;case Instruction.STROKE:batchSize?pendingStroke++:context.stroke(),++i;break;default:++i}}pendingFill&&this.fill_(context),pendingStroke&&context.stroke()},Executor.prototype.execute=function(context,transform,viewRotation,snapToPixel){this.viewRotation_=viewRotation,this.execute_(context,transform,this.instructions,snapToPixel,void 0,void 0)},Executor.prototype.executeHitDetection=function(context,transform,viewRotation,opt_featureCallback,opt_hitExtent){return this.viewRotation_=viewRotation,this.execute_(context,transform,this.hitDetectionInstructions,!0,opt_featureCallback,opt_hitExtent)},Executor}(Disposable),ORDER=[BuilderType.POLYGON,BuilderType.CIRCLE,BuilderType.LINE_STRING,BuilderType.IMAGE,BuilderType.TEXT,BuilderType.DEFAULT],ExecutorGroup=function(_super){function ExecutorGroup(maxExtent,resolution,pixelRatio,overlaps,allInstructions,opt_renderBuffer){var _this=_super.call(this)||this;return _this.maxExtent_=maxExtent,_this.overlaps_=overlaps,_this.pixelRatio_=pixelRatio,_this.resolution_=resolution,_this.renderBuffer_=opt_renderBuffer,_this.executorsByZIndex_={},_this.hitDetectionContext_=null,_this.hitDetectionTransform_=create(),_this.createExecutors_(allInstructions),_this}return __extends(ExecutorGroup,_super),ExecutorGroup.prototype.clip=function(context,transform){var flatClipCoords=this.getClipCoords(transform);context.beginPath(),context.moveTo(flatClipCoords[0],flatClipCoords[1]),context.lineTo(flatClipCoords[2],flatClipCoords[3]),context.lineTo(flatClipCoords[4],flatClipCoords[5]),context.lineTo(flatClipCoords[6],flatClipCoords[7]),context.clip()},ExecutorGroup.prototype.createExecutors_=function(allInstructions){for(var zIndex in allInstructions){var executors=this.executorsByZIndex_[zIndex];void 0===executors&&(this.executorsByZIndex_[zIndex]=executors={});var instructionByZindex=allInstructions[zIndex];for(var builderType in instructionByZindex){var instructions=instructionByZindex[builderType];executors[builderType]=new Executor(this.resolution_,this.pixelRatio_,this.overlaps_,instructions)}}},ExecutorGroup.prototype.disposeInternal=function(){for(var z in this.executorsByZIndex_){var executors=this.executorsByZIndex_[z];for(var key in executors)executors[key].disposeInternal()}if(this.hitDetectionContext_){var canvas=this.hitDetectionContext_.canvas;canvas.width=canvas.height=0}_super.prototype.disposeInternal.call(this)},ExecutorGroup.prototype.hasExecutors=function(executors){for(var zIndex in this.executorsByZIndex_)for(var candidates=this.executorsByZIndex_[zIndex],i=0,ii=executors.length;i<ii;++i)if(executors[i]in candidates)return!0;return!1},ExecutorGroup.prototype.forEachFeatureAtCoordinate=function(coordinate,resolution,rotation,hitTolerance,callback,declutteredFeatures){var contextSize=2*(hitTolerance=Math.round(hitTolerance))+1,transform=compose(this.hitDetectionTransform_,hitTolerance+.5,hitTolerance+.5,1/resolution,-1/resolution,-rotation,-coordinate[0],-coordinate[1]);this.hitDetectionContext_||(this.hitDetectionContext_=createCanvasContext2D(contextSize,contextSize));var hitExtent,context=this.hitDetectionContext_;context.canvas.width!==contextSize||context.canvas.height!==contextSize?(context.canvas.width=contextSize,context.canvas.height=contextSize):context.clearRect(0,0,contextSize,contextSize),void 0!==this.renderBuffer_&&(extendCoordinate(hitExtent=createEmpty(),coordinate),buffer(hitExtent,resolution*(this.renderBuffer_+hitTolerance),hitExtent));var builderType,mask=getCircleArray(hitTolerance);function featureCallback(feature){for(var imageData=context.getImageData(0,0,contextSize,contextSize).data,i_1=0;i_1<contextSize;i_1++)for(var j_1=0;j_1<contextSize;j_1++)if(mask[i_1][j_1]&&imageData[4*(j_1*contextSize+i_1)+3]>0){var result_1=void 0;return(!declutteredFeatures||builderType!=BuilderType.IMAGE&&builderType!=BuilderType.TEXT||-1!==declutteredFeatures.indexOf(feature))&&(result_1=callback(feature)),result_1||void context.clearRect(0,0,contextSize,contextSize)}}var i,j,executors,executor,result,zs=Object.keys(this.executorsByZIndex_).map(Number);for(zs.sort(numberSafeCompareFunction),i=zs.length-1;i>=0;--i){var zIndexKey=zs[i].toString();for(executors=this.executorsByZIndex_[zIndexKey],j=ORDER.length-1;j>=0;--j)if(void 0!==(executor=executors[builderType=ORDER[j]])&&(result=executor.executeHitDetection(context,transform,rotation,featureCallback,hitExtent)))return result}},ExecutorGroup.prototype.getClipCoords=function(transform){var maxExtent=this.maxExtent_;if(!maxExtent)return null;var minX=maxExtent[0],minY=maxExtent[1],maxX=maxExtent[2],maxY=maxExtent[3],flatClipCoords=[minX,minY,minX,maxY,maxX,maxY,maxX,minY];return transform2D(flatClipCoords,0,8,2,transform,flatClipCoords),flatClipCoords},ExecutorGroup.prototype.isEmpty=function(){return isEmpty(this.executorsByZIndex_)},ExecutorGroup.prototype.execute=function(context,transform,viewRotation,snapToPixel,opt_builderTypes,opt_declutterReplays){var zs=Object.keys(this.executorsByZIndex_).map(Number);zs.sort(numberSafeCompareFunction),this.maxExtent_&&(context.save(),this.clip(context,transform));var i,ii,j,jj,replays,replay,builderTypes=opt_builderTypes||ORDER;for(i=0,ii=zs.length;i<ii;++i){var zIndexKey=zs[i].toString();for(replays=this.executorsByZIndex_[zIndexKey],j=0,jj=builderTypes.length;j<jj;++j){var builderType=builderTypes[j];if(void 0!==(replay=replays[builderType]))if(!opt_declutterReplays||builderType!=BuilderType.IMAGE&&builderType!=BuilderType.TEXT)replay.execute(context,transform,viewRotation,snapToPixel);else{var declutter=opt_declutterReplays[zIndexKey];declutter?declutter.push(replay,transform.slice(0)):opt_declutterReplays[zIndexKey]=[replay,transform.slice(0)]}}}this.maxExtent_&&context.restore()},ExecutorGroup}(Disposable),circleArrayCache={0:[[!0]]};function fillCircleArrayRowToMiddle(array,x,y){var i,radius=Math.floor(array.length/2);if(x>=radius)for(i=radius;i<x;i++)array[i][y]=!0;else if(x<radius)for(i=x+1;i<radius;i++)array[i][y]=!0}function getCircleArray(radius){if(void 0!==circleArrayCache[radius])return circleArrayCache[radius];for(var arraySize=2*radius+1,arr=new Array(arraySize),i=0;i<arraySize;i++)arr[i]=new Array(arraySize);for(var x=radius,y=0,error=0;x>=y;)fillCircleArrayRowToMiddle(arr,radius+x,radius+y),fillCircleArrayRowToMiddle(arr,radius+y,radius+x),fillCircleArrayRowToMiddle(arr,radius-y,radius+x),fillCircleArrayRowToMiddle(arr,radius-x,radius+y),fillCircleArrayRowToMiddle(arr,radius-x,radius-y),fillCircleArrayRowToMiddle(arr,radius-y,radius-x),fillCircleArrayRowToMiddle(arr,radius+y,radius-x),fillCircleArrayRowToMiddle(arr,radius+x,radius-y),2*((error+=1+2*++y)-x)+1>0&&(error+=1-2*(x-=1));return circleArrayCache[radius]=arr,arr}function replayDeclutter(declutterReplays,context,rotation,opacity,snapToPixel,declutterItems){for(var zs=Object.keys(declutterReplays).map(Number).sort(numberSafeCompareFunction),z=0,zz=zs.length;z<zz;++z)for(var executorData=declutterReplays[zs[z].toString()],currentExecutor=void 0,i=0,ii=executorData.length;i<ii;){var executor=executorData[i++];executor!==currentExecutor&&(currentExecutor=executor,declutterItems.push({items:executor.declutterItems,opacity:opacity}));var transform=executorData[i++];executor.execute(context,transform,rotation,snapToPixel)}}var LayerRenderer=function(_super){function LayerRenderer(layer){var _this=_super.call(this)||this;return _this.boundHandleImageChange_=_this.handleImageChange_.bind(_this),_this.layer_=layer,_this}return __extends(LayerRenderer,_super),LayerRenderer.prototype.prepareFrame=function(frameState){return abstract()},LayerRenderer.prototype.renderFrame=function(frameState,target){return abstract()},LayerRenderer.prototype.loadedTileCallback=function(tiles,zoom,tile){tiles[zoom]||(tiles[zoom]={}),tiles[zoom][tile.tileCoord.toString()]=tile},LayerRenderer.prototype.createLoadedTileFinder=function(source,projection,tiles){return function(zoom,tileRange){var callback=this.loadedTileCallback.bind(this,tiles,zoom);return source.forEachLoadedTile(projection,zoom,tileRange,callback)}.bind(this)},LayerRenderer.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,declutteredFeatures){},LayerRenderer.prototype.getDataAtPixel=function(pixel,frameState,hitTolerance){return abstract()},LayerRenderer.prototype.getLayer=function(){return this.layer_},LayerRenderer.prototype.handleFontsChanged=function(){},LayerRenderer.prototype.handleImageChange_=function(event){event.target.getState()===ImageState.LOADED&&this.renderIfReadyAndVisible()},LayerRenderer.prototype.loadImage=function(image){var imageState=image.getState();return imageState!=ImageState.LOADED&&imageState!=ImageState.ERROR&&image.addEventListener(EventType.CHANGE,this.boundHandleImageChange_),imageState==ImageState.IDLE&&(image.load(),imageState=image.getState()),imageState==ImageState.LOADED},LayerRenderer.prototype.renderIfReadyAndVisible=function(){var layer=this.getLayer();layer.getVisible()&&layer.getSourceState()==SourceState.READY&&layer.changed()},LayerRenderer}(Observable),CanvasLayerRenderer=function(_super){function CanvasLayerRenderer(layer){var _this=_super.call(this,layer)||this;return _this.container=null,_this.renderedResolution,_this.tempTransform_=create(),_this.pixelTransform=create(),_this.inversePixelTransform=create(),_this.context=null,_this.containerReused=!1,_this}return __extends(CanvasLayerRenderer,_super),CanvasLayerRenderer.prototype.useContainer=function(target,transform,opacity){var container,context,layerClassName=this.getLayer().getClassName();target&&""===target.style.opacity&&target.className===layerClassName&&((canvas=target.firstElementChild)instanceof HTMLCanvasElement&&(context=canvas.getContext("2d")));if(context&&context.canvas.style.transform===toString(transform)?(this.container=target,this.context=context,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){(container=document.createElement("div")).className=layerClassName;var style=container.style;style.position="absolute",style.width="100%",style.height="100%";var canvas=(context=createCanvasContext2D()).canvas;container.appendChild(canvas),(style=canvas.style).position="absolute",style.transformOrigin="top left",this.container=container,this.context=context}},CanvasLayerRenderer.prototype.clip=function(context,frameState,extent){var pixelRatio=frameState.pixelRatio,halfWidth=frameState.size[0]*pixelRatio/2,halfHeight=frameState.size[1]*pixelRatio/2,rotation=frameState.viewState.rotation,topLeft=getTopLeft(extent),topRight=getTopRight(extent),bottomRight=getBottomRight(extent),bottomLeft=getBottomLeft(extent);apply(frameState.coordinateToPixelTransform,topLeft),apply(frameState.coordinateToPixelTransform,topRight),apply(frameState.coordinateToPixelTransform,bottomRight),apply(frameState.coordinateToPixelTransform,bottomLeft),context.save(),rotateAtOffset(context,-rotation,halfWidth,halfHeight),context.beginPath(),context.moveTo(topLeft[0]*pixelRatio,topLeft[1]*pixelRatio),context.lineTo(topRight[0]*pixelRatio,topRight[1]*pixelRatio),context.lineTo(bottomRight[0]*pixelRatio,bottomRight[1]*pixelRatio),context.lineTo(bottomLeft[0]*pixelRatio,bottomLeft[1]*pixelRatio),context.clip(),rotateAtOffset(context,rotation,halfWidth,halfHeight)},CanvasLayerRenderer.prototype.clipUnrotated=function(context,frameState,extent){var topLeft=getTopLeft(extent),topRight=getTopRight(extent),bottomRight=getBottomRight(extent),bottomLeft=getBottomLeft(extent);apply(frameState.coordinateToPixelTransform,topLeft),apply(frameState.coordinateToPixelTransform,topRight),apply(frameState.coordinateToPixelTransform,bottomRight),apply(frameState.coordinateToPixelTransform,bottomLeft);var inverted=this.inversePixelTransform;apply(inverted,topLeft),apply(inverted,topRight),apply(inverted,bottomRight),apply(inverted,bottomLeft),context.save(),context.beginPath(),context.moveTo(Math.round(topLeft[0]),Math.round(topLeft[1])),context.lineTo(Math.round(topRight[0]),Math.round(topRight[1])),context.lineTo(Math.round(bottomRight[0]),Math.round(bottomRight[1])),context.lineTo(Math.round(bottomLeft[0]),Math.round(bottomLeft[1])),context.clip()},CanvasLayerRenderer.prototype.dispatchRenderEvent_=function(type,context,frameState){var layer=this.getLayer();if(layer.hasListener(type)){var event_1=new RenderEvent(type,this.inversePixelTransform,frameState,context);layer.dispatchEvent(event_1)}},CanvasLayerRenderer.prototype.preRender=function(context,frameState){this.dispatchRenderEvent_(RenderEventType.PRERENDER,context,frameState)},CanvasLayerRenderer.prototype.postRender=function(context,frameState){this.dispatchRenderEvent_(RenderEventType.POSTRENDER,context,frameState)},CanvasLayerRenderer.prototype.getRenderTransform=function(frameState,width,height,offsetX){var viewState=frameState.viewState,dx1=width/2,dy1=height/2,sx=frameState.pixelRatio/viewState.resolution,sy=-sx,dx2=-viewState.center[0]+offsetX,dy2=-viewState.center[1];return compose(this.tempTransform_,dx1,dy1,sx,sy,-viewState.rotation,dx2,dy2)},CanvasLayerRenderer.prototype.getDataAtPixel=function(pixel,frameState,hitTolerance){var data,renderPixel=apply(this.inversePixelTransform,pixel.slice()),context=this.context;try{data=context.getImageData(Math.round(renderPixel[0]),Math.round(renderPixel[1]),1,1).data}catch(err){return"SecurityError"===err.name?new Uint8Array:data}return 0===data[3]?null:data},CanvasLayerRenderer}(LayerRenderer),CanvasVectorLayerRenderer=function(_super){function CanvasVectorLayerRenderer(vectorLayer){var _this=_super.call(this,vectorLayer)||this;return _this.boundHandleStyleImageChange_=_this.handleStyleImageChange_.bind(_this),_this.dirty_=!1,_this.renderedRevision_=-1,_this.renderedResolution_=NaN,_this.renderedExtent_=createEmpty(),_this.renderedRenderOrder_=null,_this.replayGroup_=null,_this.replayGroupChanged=!0,_this}return __extends(CanvasVectorLayerRenderer,_super),CanvasVectorLayerRenderer.prototype.useContainer=function(target,transform,opacity){opacity<1&&(target=null),_super.prototype.useContainer.call(this,target,transform,opacity)},CanvasVectorLayerRenderer.prototype.renderFrame=function(frameState,target){var pixelRatio=frameState.pixelRatio,layerState=frameState.layerStatesArray[frameState.layerIndex];makeScale(this.pixelTransform,1/pixelRatio,1/pixelRatio),makeInverse(this.inversePixelTransform,this.pixelTransform),this.useContainer(target,this.pixelTransform,layerState.opacity);var context=this.context,canvas=context.canvas,replayGroup=this.replayGroup_;if(!replayGroup||replayGroup.isEmpty())return!this.containerReused&&canvas.width>0&&(canvas.width=0),this.container;var width=Math.round(frameState.size[0]*pixelRatio),height=Math.round(frameState.size[1]*pixelRatio);if(canvas.width!=width||canvas.height!=height){canvas.width=width,canvas.height=height;var canvasTransform=toString(this.pixelTransform);canvas.style.transform!==canvasTransform&&(canvas.style.transform=canvasTransform)}else this.containerReused||context.clearRect(0,0,width,height);this.preRender(context,frameState);var extent=frameState.extent,viewState=frameState.viewState,projection=viewState.projection,rotation=viewState.rotation,projectionExtent=projection.getExtent(),vectorSource=this.getLayer().getSource(),clipped=!1;if(layerState.extent){var layerExtent=fromUserExtent(layerState.extent,projection);(clipped=!containsExtent(layerExtent,frameState.extent)&&intersects(layerExtent,frameState.extent))&&this.clip(context,frameState,layerExtent)}var viewHints=frameState.viewHints,snapToPixel=!(viewHints[ViewHint.ANIMATING]||viewHints[ViewHint.INTERACTING]),transform=this.getRenderTransform(frameState,width,height,0),declutterReplays=this.getLayer().getDeclutter()?{}:null;if(replayGroup.execute(context,transform,rotation,snapToPixel,void 0,declutterReplays),vectorSource.getWrapX()&&projection.canWrapX()&&!containsExtent(projectionExtent,extent)){for(var startX=extent[0],worldWidth=getWidth(projectionExtent),world=0,offsetX=void 0;startX<projectionExtent[0];){offsetX=worldWidth*--world;var transform_1=this.getRenderTransform(frameState,width,height,offsetX);replayGroup.execute(context,transform_1,rotation,snapToPixel,void 0,declutterReplays),startX+=worldWidth}for(world=0,startX=extent[2];startX>projectionExtent[2];){offsetX=worldWidth*++world;var transform_2=this.getRenderTransform(frameState,width,height,offsetX);replayGroup.execute(context,transform_2,rotation,snapToPixel,void 0,declutterReplays),startX-=worldWidth}}if(declutterReplays){var viewHints_1=frameState.viewHints;replayDeclutter(declutterReplays,context,rotation,1,!(viewHints_1[ViewHint.ANIMATING]||viewHints_1[ViewHint.INTERACTING]),frameState.declutterItems)}clipped&&context.restore(),this.postRender(context,frameState);var opacity=layerState.opacity,container=this.container;return opacity!==parseFloat(container.style.opacity)&&(container.style.opacity=1===opacity?"":opacity),this.container},CanvasVectorLayerRenderer.prototype.forEachFeatureAtCoordinate=function(coordinate,frameState,hitTolerance,callback,declutteredFeatures){if(this.replayGroup_){var resolution=frameState.viewState.resolution,rotation=frameState.viewState.rotation,layer_1=this.getLayer(),features_1={};return this.replayGroup_.forEachFeatureAtCoordinate(coordinate,resolution,rotation,hitTolerance,function(feature){var key=getUid(feature);if(!(key in features_1))return features_1[key]=!0,callback(feature,layer_1)},layer_1.getDeclutter()?declutteredFeatures:null)}},CanvasVectorLayerRenderer.prototype.handleFontsChanged=function(){var layer=this.getLayer();layer.getVisible()&&this.replayGroup_&&layer.changed()},CanvasVectorLayerRenderer.prototype.handleStyleImageChange_=function(event){this.renderIfReadyAndVisible()},CanvasVectorLayerRenderer.prototype.prepareFrame=function(frameState){var vectorLayer=this.getLayer(),vectorSource=vectorLayer.getSource(),animating=frameState.viewHints[ViewHint.ANIMATING],interacting=frameState.viewHints[ViewHint.INTERACTING],updateWhileAnimating=vectorLayer.getUpdateWhileAnimating(),updateWhileInteracting=vectorLayer.getUpdateWhileInteracting();if(!this.dirty_&&!updateWhileAnimating&&animating||!updateWhileInteracting&&interacting)return!0;var frameStateExtent=frameState.extent,viewState=frameState.viewState,projection=viewState.projection,resolution=viewState.resolution,pixelRatio=frameState.pixelRatio,vectorLayerRevision=vectorLayer.getRevision(),vectorLayerRenderBuffer=vectorLayer.getRenderBuffer(),vectorLayerRenderOrder=vectorLayer.getRenderOrder();void 0===vectorLayerRenderOrder&&(vectorLayerRenderOrder=defaultOrder);var extent=buffer(frameStateExtent,vectorLayerRenderBuffer*resolution),projectionExtent=viewState.projection.getExtent();if(vectorSource.getWrapX()&&viewState.projection.canWrapX()&&!containsExtent(projectionExtent,frameState.extent)){var worldWidth=getWidth(projectionExtent),gutter=Math.max(getWidth(extent)/2,worldWidth);extent[0]=projectionExtent[0]-gutter,extent[2]=projectionExtent[2]+gutter}if(!this.dirty_&&this.renderedResolution_==resolution&&this.renderedRevision_==vectorLayerRevision&&this.renderedRenderOrder_==vectorLayerRenderOrder&&containsExtent(this.renderedExtent_,extent))return this.replayGroupChanged=!1,!0;this.replayGroup_&&this.replayGroup_.dispose(),this.replayGroup_=null,this.dirty_=!1;var userTransform,replayGroup=new BuilderGroup(getTolerance(resolution,pixelRatio),extent,resolution,pixelRatio,vectorLayer.getDeclutter()),userProjection=getUserProjection();userProjection?(vectorSource.loadFeatures(toUserExtent(extent,projection),resolution,userProjection),userTransform=getTransformFromProjections(userProjection,projection)):vectorSource.loadFeatures(extent,resolution,projection);var squaredTolerance=getSquaredTolerance(resolution,pixelRatio),render=function(feature){var styles,styleFunction=feature.getStyleFunction()||vectorLayer.getStyleFunction();if(styleFunction&&(styles=styleFunction(feature,resolution)),styles){var dirty=this.renderFeature(feature,squaredTolerance,styles,replayGroup,userTransform);this.dirty_=this.dirty_||dirty}}.bind(this),userExtent=toUserExtent(extent,projection);if(vectorLayerRenderOrder){var features_2=[];vectorSource.forEachFeatureInExtent(userExtent,function(feature){features_2.push(feature)}),features_2.sort(vectorLayerRenderOrder);for(var i=0,ii=features_2.length;i<ii;++i)render(features_2[i])}else vectorSource.forEachFeatureInExtent(userExtent,render);var replayGroupInstructions=replayGroup.finish(),executorGroup=new ExecutorGroup(extent,resolution,pixelRatio,vectorSource.getOverlaps(),replayGroupInstructions,vectorLayer.getRenderBuffer());return this.renderedResolution_=resolution,this.renderedRevision_=vectorLayerRevision,this.renderedRenderOrder_=vectorLayerRenderOrder,this.renderedExtent_=extent,this.replayGroup_=executorGroup,this.replayGroupChanged=!0,!0},CanvasVectorLayerRenderer.prototype.renderFeature=function(feature,squaredTolerance,styles,builderGroup,opt_transform){if(!styles)return!1;var loading=!1;if(Array.isArray(styles))for(var i=0,ii=styles.length;i<ii;++i)loading=renderFeature(builderGroup,feature,styles[i],squaredTolerance,this.boundHandleStyleImageChange_,opt_transform)||loading;else loading=renderFeature(builderGroup,feature,styles,squaredTolerance,this.boundHandleStyleImageChange_,opt_transform);return loading},CanvasVectorLayerRenderer}(CanvasLayerRenderer),VectorLayer=function(_super){function VectorLayer(opt_options){return _super.call(this,opt_options)||this}return __extends(VectorLayer,_super),VectorLayer.prototype.createRenderer=function(){return new CanvasVectorLayerRenderer(this)},VectorLayer}(BaseVectorLayer),FormatType={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"},withCredentials=!1;function loadFeaturesXhr(url,format,success,failure){return function(extent,resolution,projection){var xhr=new XMLHttpRequest;xhr.open("GET","function"==typeof url?url(extent,resolution,projection):url,!0),format.getType()==FormatType.ARRAY_BUFFER&&(xhr.responseType="arraybuffer"),xhr.withCredentials=withCredentials,xhr.onload=function(event){if(!xhr.status||xhr.status>=200&&xhr.status<300){var type=format.getType(),source=void 0;type==FormatType.JSON||type==FormatType.TEXT?source=xhr.responseText:type==FormatType.XML?(source=xhr.responseXML)||(source=(new DOMParser).parseFromString(xhr.responseText,"application/xml")):type==FormatType.ARRAY_BUFFER&&(source=xhr.response),source?success.call(this,format.readFeatures(source,{extent:extent,featureProjection:projection}),format.readProjection(source)):failure.call(this)}else failure.call(this)}.bind(this),xhr.onerror=function(){failure.call(this)}.bind(this),xhr.send()}}function xhr(url,format){return loadFeaturesXhr(url,format,function(features,dataProjection){"function"==typeof this.addFeatures&&this.addFeatures(features)},VOID)}function all(extent,resolution){return[[-1/0,-1/0,1/0,1/0]]}var Source=function(_super){function Source(options){var _this=_super.call(this)||this;return _this.projection_=get$2(options.projection),_this.attributions_=adaptAttributions(options.attributions),_this.attributionsCollapsible_=void 0===options.attributionsCollapsible||options.attributionsCollapsible,_this.loading=!1,_this.state_=void 0!==options.state?options.state:SourceState.READY,_this.wrapX_=void 0!==options.wrapX&&options.wrapX,_this}return __extends(Source,_super),Source.prototype.getAttributions=function(){return this.attributions_},Source.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},Source.prototype.getProjection=function(){return this.projection_},Source.prototype.getResolutions=function(){return abstract()},Source.prototype.getState=function(){return this.state_},Source.prototype.getWrapX=function(){return this.wrapX_},Source.prototype.refresh=function(){this.changed()},Source.prototype.setAttributions=function(attributions){this.attributions_=adaptAttributions(attributions),this.changed()},Source.prototype.setState=function(state){this.state_=state,this.changed()},Source}(BaseObject);function adaptAttributions(attributionLike){return attributionLike?Array.isArray(attributionLike)?function(frameState){return attributionLike}:"function"==typeof attributionLike?attributionLike:function(frameState){return[attributionLike]}:null}var VectorEventType={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature"},RBush$1=function(){function RBush$1(opt_maxEntries){this.rbush_=new RBush(opt_maxEntries),this.items_={}}return RBush$1.prototype.insert=function(extent,value){var item={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3],value:value};this.rbush_.insert(item),this.items_[getUid(value)]=item},RBush$1.prototype.load=function(extents,values){for(var items=new Array(values.length),i=0,l=values.length;i<l;i++){var extent=extents[i],value=values[i],item={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3],value:value};items[i]=item,this.items_[getUid(value)]=item}this.rbush_.load(items)},RBush$1.prototype.remove=function(value){var uid=getUid(value),item=this.items_[uid];return delete this.items_[uid],null!==this.rbush_.remove(item)},RBush$1.prototype.update=function(extent,value){var item=this.items_[getUid(value)];equals$1([item.minX,item.minY,item.maxX,item.maxY],extent)||(this.remove(value),this.insert(extent,value))},RBush$1.prototype.getAll=function(){return this.rbush_.all().map(function(item){return item.value})},RBush$1.prototype.getInExtent=function(extent){var bbox={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3]};return this.rbush_.search(bbox).map(function(item){return item.value})},RBush$1.prototype.forEach=function(callback){return this.forEach_(this.getAll(),callback)},RBush$1.prototype.forEachInExtent=function(extent,callback){return this.forEach_(this.getInExtent(extent),callback)},RBush$1.prototype.forEach_=function(values,callback){for(var result,i=0,l=values.length;i<l;i++)if(result=callback(values[i]))return result;return result},RBush$1.prototype.isEmpty=function(){return isEmpty(this.items_)},RBush$1.prototype.clear=function(){this.rbush_.clear(),this.items_={}},RBush$1.prototype.getExtent=function(opt_extent){var data=this.rbush_.toJSON();return createOrUpdate(data.minX,data.minY,data.maxX,data.maxY,opt_extent)},RBush$1.prototype.concat=function(rbush){for(var i in this.rbush_.load(rbush.rbush_.all()),rbush.items_)this.items_[i]=rbush.items_[i]},RBush$1}(),VectorSourceEvent=function(_super){function VectorSourceEvent(type,opt_feature){var _this=_super.call(this,type)||this;return _this.feature=opt_feature,_this}return __extends(VectorSourceEvent,_super),VectorSourceEvent}(BaseEvent),VectorSource=function(_super){function VectorSource(opt_options){var _this=this,options=opt_options||{};(_this=_super.call(this,{attributions:options.attributions,projection:void 0,state:SourceState.READY,wrapX:void 0===options.wrapX||options.wrapX})||this).loader_=VOID,_this.format_=options.format,_this.overlaps_=null==options.overlaps||options.overlaps,_this.url_=options.url,void 0!==options.loader?_this.loader_=options.loader:void 0!==_this.url_&&(assert(_this.format_,7),_this.loader_=xhr(_this.url_,_this.format_)),_this.strategy_=void 0!==options.strategy?options.strategy:all;var collection,features,useSpatialIndex=void 0===options.useSpatialIndex||options.useSpatialIndex;return _this.featuresRtree_=useSpatialIndex?new RBush$1:null,_this.loadedExtentsRtree_=new RBush$1,_this.nullGeometryFeatures_={},_this.idIndex_={},_this.uidIndex_={},_this.featureChangeKeys_={},_this.featuresCollection_=null,Array.isArray(options.features)?features=options.features:options.features&&(features=(collection=options.features).getArray()),useSpatialIndex||void 0!==collection||(collection=new Collection(features)),void 0!==features&&_this.addFeaturesInternal(features),void 0!==collection&&_this.bindFeaturesCollection_(collection),_this}return __extends(VectorSource,_super),VectorSource.prototype.addFeature=function(feature){this.addFeatureInternal(feature),this.changed()},VectorSource.prototype.addFeatureInternal=function(feature){var featureKey=getUid(feature);if(this.addToIndex_(featureKey,feature)){this.setupChangeEvents_(featureKey,feature);var geometry=feature.getGeometry();if(geometry){var extent=geometry.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(extent,feature)}else this.nullGeometryFeatures_[featureKey]=feature;this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,feature))}else this.featuresCollection_&&this.featuresCollection_.remove(feature)},VectorSource.prototype.setupChangeEvents_=function(featureKey,feature){this.featureChangeKeys_[featureKey]=[listen(feature,EventType.CHANGE,this.handleFeatureChange_,this),listen(feature,ObjectEventType.PROPERTYCHANGE,this.handleFeatureChange_,this)]},VectorSource.prototype.addToIndex_=function(featureKey,feature){var valid=!0,id=feature.getId();return void 0!==id&&(id.toString()in this.idIndex_?valid=!1:this.idIndex_[id.toString()]=feature),valid&&(assert(!(featureKey in this.uidIndex_),30),this.uidIndex_[featureKey]=feature),valid},VectorSource.prototype.addFeatures=function(features){this.addFeaturesInternal(features),this.changed()},VectorSource.prototype.addFeaturesInternal=function(features){for(var extents=[],newFeatures=[],geometryFeatures=[],i=0,length_1=features.length;i<length_1;i++){var featureKey=getUid(feature=features[i]);this.addToIndex_(featureKey,feature)&&newFeatures.push(feature)}i=0;for(var length_2=newFeatures.length;i<length_2;i++){var feature;featureKey=getUid(feature=newFeatures[i]);this.setupChangeEvents_(featureKey,feature);var geometry=feature.getGeometry();if(geometry){var extent=geometry.getExtent();extents.push(extent),geometryFeatures.push(feature)}else this.nullGeometryFeatures_[featureKey]=feature}this.featuresRtree_&&this.featuresRtree_.load(extents,geometryFeatures);i=0;for(var length_3=newFeatures.length;i<length_3;i++)this.dispatchEvent(new VectorSourceEvent(VectorEventType.ADDFEATURE,newFeatures[i]))},VectorSource.prototype.bindFeaturesCollection_=function(collection){var modifyingCollection=!1;this.addEventListener(VectorEventType.ADDFEATURE,function(evt){modifyingCollection||(modifyingCollection=!0,collection.push(evt.feature),modifyingCollection=!1)}),this.addEventListener(VectorEventType.REMOVEFEATURE,function(evt){modifyingCollection||(modifyingCollection=!0,collection.remove(evt.feature),modifyingCollection=!1)}),collection.addEventListener(CollectionEventType.ADD,function(evt){modifyingCollection||(modifyingCollection=!0,this.addFeature(evt.element),modifyingCollection=!1)}.bind(this)),collection.addEventListener(CollectionEventType.REMOVE,function(evt){modifyingCollection||(modifyingCollection=!0,this.removeFeature(evt.element),modifyingCollection=!1)}.bind(this)),this.featuresCollection_=collection},VectorSource.prototype.clear=function(opt_fast){if(opt_fast){for(var featureId in this.featureChangeKeys_){this.featureChangeKeys_[featureId].forEach(unlistenByKey)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_)for(var id in this.featuresRtree_.forEach(this.removeFeatureInternal.bind(this)),this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[id]);this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var clearEvent=new VectorSourceEvent(VectorEventType.CLEAR);this.dispatchEvent(clearEvent),this.changed()},VectorSource.prototype.forEachFeature=function(callback){if(this.featuresRtree_)return this.featuresRtree_.forEach(callback);this.featuresCollection_&&this.featuresCollection_.forEach(callback)},VectorSource.prototype.forEachFeatureAtCoordinateDirect=function(coordinate,callback){var extent=[coordinate[0],coordinate[1],coordinate[0],coordinate[1]];return this.forEachFeatureInExtent(extent,function(feature){return feature.getGeometry().intersectsCoordinate(coordinate)?callback(feature):void 0})},VectorSource.prototype.forEachFeatureInExtent=function(extent,callback){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(extent,callback);this.featuresCollection_&&this.featuresCollection_.forEach(callback)},VectorSource.prototype.forEachFeatureIntersectingExtent=function(extent,callback){return this.forEachFeatureInExtent(extent,function(feature){if(feature.getGeometry().intersectsExtent(extent)){var result=callback(feature);if(result)return result}})},VectorSource.prototype.getFeaturesCollection=function(){return this.featuresCollection_},VectorSource.prototype.getFeatures=function(){var features;return this.featuresCollection_?features=this.featuresCollection_.getArray():this.featuresRtree_&&(features=this.featuresRtree_.getAll(),isEmpty(this.nullGeometryFeatures_)||extend(features,getValues(this.nullGeometryFeatures_))),features},VectorSource.prototype.getFeaturesAtCoordinate=function(coordinate){var features=[];return this.forEachFeatureAtCoordinateDirect(coordinate,function(feature){features.push(feature)}),features},VectorSource.prototype.getFeaturesInExtent=function(extent){return this.featuresRtree_.getInExtent(extent)},VectorSource.prototype.getClosestFeatureToCoordinate=function(coordinate,opt_filter){var x=coordinate[0],y=coordinate[1],closestFeature=null,closestPoint=[NaN,NaN],minSquaredDistance=1/0,extent=[-1/0,-1/0,1/0,1/0],filter=opt_filter||TRUE;return this.featuresRtree_.forEachInExtent(extent,function(feature){if(filter(feature)){var geometry=feature.getGeometry(),previousMinSquaredDistance=minSquaredDistance;if((minSquaredDistance=geometry.closestPointXY(x,y,closestPoint,minSquaredDistance))<previousMinSquaredDistance){closestFeature=feature;var minDistance=Math.sqrt(minSquaredDistance);extent[0]=x-minDistance,extent[1]=y-minDistance,extent[2]=x+minDistance,extent[3]=y+minDistance}}}),closestFeature},VectorSource.prototype.getExtent=function(opt_extent){return this.featuresRtree_.getExtent(opt_extent)},VectorSource.prototype.getFeatureById=function(id){var feature=this.idIndex_[id.toString()];return void 0!==feature?feature:null},VectorSource.prototype.getFeatureByUid=function(uid){var feature=this.uidIndex_[uid];return void 0!==feature?feature:null},VectorSource.prototype.getFormat=function(){return this.format_},VectorSource.prototype.getOverlaps=function(){return this.overlaps_},VectorSource.prototype.getUrl=function(){return this.url_},VectorSource.prototype.handleFeatureChange_=function(event){var feature=event.target,featureKey=getUid(feature),geometry=feature.getGeometry();if(geometry){var extent=geometry.getExtent();featureKey in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[featureKey],this.featuresRtree_&&this.featuresRtree_.insert(extent,feature)):this.featuresRtree_&&this.featuresRtree_.update(extent,feature)}else featureKey in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(feature),this.nullGeometryFeatures_[featureKey]=feature);var id=feature.getId();if(void 0!==id){var sid=id.toString();this.idIndex_[sid]!==feature&&(this.removeFromIdIndex_(feature),this.idIndex_[sid]=feature)}else this.removeFromIdIndex_(feature),this.uidIndex_[featureKey]=feature;this.changed(),this.dispatchEvent(new VectorSourceEvent(VectorEventType.CHANGEFEATURE,feature))},VectorSource.prototype.hasFeature=function(feature){var id=feature.getId();return void 0!==id?id in this.idIndex_:getUid(feature)in this.uidIndex_},VectorSource.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&isEmpty(this.nullGeometryFeatures_)},VectorSource.prototype.loadFeatures=function(extent,resolution,projection){var loadedExtentsRtree=this.loadedExtentsRtree_,extentsToLoad=this.strategy_(extent,resolution);this.loading=!1;for(var _loop_1=function(i,ii){var extentToLoad=extentsToLoad[i];loadedExtentsRtree.forEachInExtent(extentToLoad,function(object){return containsExtent(object.extent,extentToLoad)})||(this_1.loader_.call(this_1,extentToLoad,resolution,projection),loadedExtentsRtree.insert(extentToLoad,{extent:extentToLoad.slice()}),this_1.loading=this_1.loader_!==VOID)},this_1=this,i=0,ii=extentsToLoad.length;i<ii;++i)_loop_1(i)},VectorSource.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),_super.prototype.refresh.call(this)},VectorSource.prototype.removeLoadedExtent=function(extent){var obj,loadedExtentsRtree=this.loadedExtentsRtree_;loadedExtentsRtree.forEachInExtent(extent,function(object){if(equals$1(object.extent,extent))return obj=object,!0}),obj&&loadedExtentsRtree.remove(obj)},VectorSource.prototype.removeFeature=function(feature){var featureKey=getUid(feature);featureKey in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[featureKey]:this.featuresRtree_&&this.featuresRtree_.remove(feature),this.removeFeatureInternal(feature),this.changed()},VectorSource.prototype.removeFeatureInternal=function(feature){var featureKey=getUid(feature);this.featureChangeKeys_[featureKey].forEach(unlistenByKey),delete this.featureChangeKeys_[featureKey];var id=feature.getId();void 0!==id&&delete this.idIndex_[id.toString()],delete this.uidIndex_[featureKey],this.dispatchEvent(new VectorSourceEvent(VectorEventType.REMOVEFEATURE,feature))},VectorSource.prototype.removeFromIdIndex_=function(feature){var removed=!1;for(var id in this.idIndex_)if(this.idIndex_[id]===feature){delete this.idIndex_[id],removed=!0;break}return removed},VectorSource.prototype.setLoader=function(loader){this.loader_=loader},VectorSource.prototype.setUrl=function(url){assert(this.format_,7),this.setLoader(xhr(url,this.format_))},VectorSource}(Source),Mode$1={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",CIRCLE:"Circle"},DrawEventType={DRAWSTART:"drawstart",DRAWEND:"drawend"},DrawEvent=function(_super){function DrawEvent(type,feature){var _this=_super.call(this,type)||this;return _this.feature=feature,_this}return __extends(DrawEvent,_super),DrawEvent}(BaseEvent),Draw=function(_super){function Draw(options){var _this=this,pointerOptions=options;pointerOptions.stopDown||(pointerOptions.stopDown=FALSE),(_this=_super.call(this,pointerOptions)||this).shouldHandle_=!1,_this.downPx_=null,_this.downTimeout_,_this.lastDragTime_,_this.freehand_=!1,_this.source_=options.source?options.source:null,_this.features_=options.features?options.features:null,_this.snapTolerance_=options.snapTolerance?options.snapTolerance:12,_this.type_=options.type,_this.mode_=getMode(_this.type_),_this.stopClick_=!!options.stopClick,_this.minPoints_=options.minPoints?options.minPoints:_this.mode_===Mode$1.POLYGON?3:2,_this.maxPoints_=options.maxPoints?options.maxPoints:1/0,_this.finishCondition_=options.finishCondition?options.finishCondition:TRUE;var geometryFunction=options.geometryFunction;if(!geometryFunction)if(_this.type_===GeometryType.CIRCLE)geometryFunction=function(coordinates,opt_geometry){var circle=opt_geometry||new Circle([NaN,NaN]),squaredLength=squaredDistance$1(coordinates[0],coordinates[1]);return circle.setCenterAndRadius(coordinates[0],Math.sqrt(squaredLength)),circle};else{var Constructor_1,mode_1=_this.mode_;mode_1===Mode$1.POINT?Constructor_1=Point:mode_1===Mode$1.LINE_STRING?Constructor_1=LineString:mode_1===Mode$1.POLYGON&&(Constructor_1=Polygon),geometryFunction=function(coordinates,opt_geometry){var geometry=opt_geometry;return geometry?mode_1===Mode$1.POLYGON?coordinates[0].length?geometry.setCoordinates([coordinates[0].concat([coordinates[0][0]])]):geometry.setCoordinates([]):geometry.setCoordinates(coordinates):geometry=new Constructor_1(coordinates),geometry}}return _this.geometryFunction_=geometryFunction,_this.dragVertexDelay_=void 0!==options.dragVertexDelay?options.dragVertexDelay:500,_this.finishCoordinate_=null,_this.sketchFeature_=null,_this.sketchPoint_=null,_this.sketchCoords_=null,_this.sketchLine_=null,_this.sketchLineCoords_=null,_this.squaredClickTolerance_=options.clickTolerance?options.clickTolerance*options.clickTolerance:36,_this.overlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:!!options.wrapX&&options.wrapX}),style:options.style?options.style:getDefaultStyleFunction(),updateWhileInteracting:!0}),_this.geometryName_=options.geometryName,_this.condition_=options.condition?options.condition:noModifierKeys,_this.freehandCondition_,options.freehand?_this.freehandCondition_=always:_this.freehandCondition_=options.freehandCondition?options.freehandCondition:shiftKeyOnly,_this.addEventListener(getChangeEventType(InteractionProperty.ACTIVE),_this.updateState_),_this}return __extends(Draw,_super),Draw.prototype.setMap=function(map){_super.prototype.setMap.call(this,map),this.updateState_()},Draw.prototype.getOverlay=function(){return this.overlay_},Draw.prototype.handleEvent=function(event){event.originalEvent.type===EventType.CONTEXTMENU&&event.preventDefault(),this.freehand_=this.mode_!==Mode$1.POINT&&this.freehandCondition_(event);var move=event.type===MapBrowserEventType.POINTERMOVE,pass=!0;!this.freehand_&&this.lastDragTime_&&event.type===MapBrowserEventType.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=event.pixel,this.shouldHandle_=!this.freehand_,move=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0));return this.freehand_&&event.type===MapBrowserEventType.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(event),pass=!1):this.freehand_&&event.type===MapBrowserEventType.POINTERDOWN?pass=!1:move?(pass=event.type===MapBrowserEventType.POINTERMOVE)&&this.freehand_?pass=this.handlePointerMove_(event):("mouse"==event.pointerEvent.pointerType||event.type===MapBrowserEventType.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(event):event.type===MapBrowserEventType.DBLCLICK&&(pass=!1),_super.prototype.handleEvent.call(this,event)&&pass},Draw.prototype.handleDownEvent=function(event){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=event.pixel,this.finishCoordinate_||this.startDrawing_(event),!0):this.condition_(event)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new MapBrowserPointerEvent(MapBrowserEventType.POINTERMOVE,event.map,event.pointerEvent,!1,event.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=event.pixel,!0):(this.lastDragTime_=void 0,!1)},Draw.prototype.handleUpEvent=function(event){var pass=!0;this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(event);var circleMode=this.mode_===Mode$1.CIRCLE;return this.shouldHandle_?(this.finishCoordinate_?this.freehand_||circleMode?this.finishDrawing():this.atFinish_(event)?this.finishCondition_(event)&&this.finishDrawing():this.addToDrawing_(event):(this.startDrawing_(event),this.mode_===Mode$1.POINT&&this.finishDrawing()),pass=!1):this.freehand_&&(this.finishCoordinate_=null,this.abortDrawing_()),!pass&&this.stopClick_&&event.stopPropagation(),pass},Draw.prototype.handlePointerMove_=function(event){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var downPx=this.downPx_,clickPx=event.pixel,dx=downPx[0]-clickPx[0],dy=downPx[1]-clickPx[1],squaredDistance=dx*dx+dy*dy;if(this.shouldHandle_=this.freehand_?squaredDistance>this.squaredClickTolerance_:squaredDistance<=this.squaredClickTolerance_,!this.shouldHandle_)return!0}return this.finishCoordinate_?this.modifyDrawing_(event):this.createOrUpdateSketchPoint_(event),!0},Draw.prototype.atFinish_=function(event){var at=!1;if(this.sketchFeature_){var potentiallyDone=!1,potentiallyFinishCoordinates=[this.finishCoordinate_];if(this.mode_===Mode$1.LINE_STRING)potentiallyDone=this.sketchCoords_.length>this.minPoints_;else if(this.mode_===Mode$1.POLYGON){var sketchCoords=this.sketchCoords_;potentiallyDone=sketchCoords[0].length>this.minPoints_,potentiallyFinishCoordinates=[sketchCoords[0][0],sketchCoords[0][sketchCoords[0].length-2]]}if(potentiallyDone)for(var map=event.map,i=0,ii=potentiallyFinishCoordinates.length;i<ii;i++){var finishCoordinate=potentiallyFinishCoordinates[i],finishPixel=map.getPixelFromCoordinate(finishCoordinate),pixel=event.pixel,dx=pixel[0]-finishPixel[0],dy=pixel[1]-finishPixel[1],snapTolerance=this.freehand_?1:this.snapTolerance_;if(at=Math.sqrt(dx*dx+dy*dy)<=snapTolerance){this.finishCoordinate_=finishCoordinate;break}}}return at},Draw.prototype.createOrUpdateSketchPoint_=function(event){var coordinates=event.coordinate.slice();this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(coordinates):(this.sketchPoint_=new Feature(new Point(coordinates)),this.updateSketchFeatures_())},Draw.prototype.startDrawing_=function(event){var start=event.coordinate;this.finishCoordinate_=start,this.mode_===Mode$1.POINT?this.sketchCoords_=start.slice():this.mode_===Mode$1.POLYGON?(this.sketchCoords_=[[start.slice(),start.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[start.slice(),start.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Feature(new LineString(this.sketchLineCoords_)));var geometry=this.geometryFunction_(this.sketchCoords_);this.sketchFeature_=new Feature,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(geometry),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))},Draw.prototype.modifyDrawing_=function(event){var coordinates,last,sketchLineGeom,coordinate=event.coordinate,geometry=this.sketchFeature_.getGeometry();(this.mode_===Mode$1.POINT?last=this.sketchCoords_:this.mode_===Mode$1.POLYGON?(last=(coordinates=this.sketchCoords_[0])[coordinates.length-1],this.atFinish_(event)&&(coordinate=this.finishCoordinate_.slice())):last=(coordinates=this.sketchCoords_)[coordinates.length-1],last[0]=coordinate[0],last[1]=coordinate[1],this.geometryFunction_(this.sketchCoords_,geometry),this.sketchPoint_)&&this.sketchPoint_.getGeometry().setCoordinates(coordinate);if(geometry.getType()==GeometryType.POLYGON&&this.mode_!==Mode$1.POLYGON){this.sketchLine_||(this.sketchLine_=new Feature);var ring=geometry.getLinearRing(0);(sketchLineGeom=this.sketchLine_.getGeometry())?(sketchLineGeom.setFlatCoordinates(ring.getLayout(),ring.getFlatCoordinates()),sketchLineGeom.changed()):(sketchLineGeom=new LineString(ring.getFlatCoordinates(),ring.getLayout()),this.sketchLine_.setGeometry(sketchLineGeom))}else this.sketchLineCoords_&&(sketchLineGeom=this.sketchLine_.getGeometry()).setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()},Draw.prototype.addToDrawing_=function(event){var done,coordinates,coordinate=event.coordinate,geometry=this.sketchFeature_.getGeometry();this.mode_===Mode$1.LINE_STRING?(this.finishCoordinate_=coordinate.slice(),(coordinates=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?coordinates.pop():done=!0),coordinates.push(coordinate.slice()),this.geometryFunction_(coordinates,geometry)):this.mode_===Mode$1.POLYGON&&((coordinates=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?coordinates.pop():done=!0),coordinates.push(coordinate.slice()),done&&(this.finishCoordinate_=coordinates[0]),this.geometryFunction_(this.sketchCoords_,geometry)),this.updateSketchFeatures_(),done&&this.finishDrawing()},Draw.prototype.removeLastPoint=function(){if(this.sketchFeature_){var coordinates,geometry=this.sketchFeature_.getGeometry();this.mode_===Mode$1.LINE_STRING?((coordinates=this.sketchCoords_).splice(-2,1),this.geometryFunction_(coordinates,geometry),coordinates.length>=2&&(this.finishCoordinate_=coordinates[coordinates.length-2].slice())):this.mode_===Mode$1.POLYGON&&((coordinates=this.sketchCoords_[0]).splice(-2,1),this.sketchLine_.getGeometry().setCoordinates(coordinates),this.geometryFunction_(this.sketchCoords_,geometry)),0===coordinates.length&&(this.finishCoordinate_=null),this.updateSketchFeatures_()}},Draw.prototype.finishDrawing=function(){var sketchFeature=this.abortDrawing_();if(sketchFeature){var coordinates=this.sketchCoords_,geometry=sketchFeature.getGeometry();this.mode_===Mode$1.LINE_STRING?(coordinates.pop(),this.geometryFunction_(coordinates,geometry)):this.mode_===Mode$1.POLYGON&&(coordinates[0].pop(),this.geometryFunction_(coordinates,geometry),coordinates=geometry.getCoordinates()),this.type_===GeometryType.MULTI_POINT?sketchFeature.setGeometry(new MultiPoint([coordinates])):this.type_===GeometryType.MULTI_LINE_STRING?sketchFeature.setGeometry(new MultiLineString([coordinates])):this.type_===GeometryType.MULTI_POLYGON&&sketchFeature.setGeometry(new MultiPolygon([coordinates])),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWEND,sketchFeature)),this.features_&&this.features_.push(sketchFeature),this.source_&&this.source_.addFeature(sketchFeature)}},Draw.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var sketchFeature=this.sketchFeature_;return sketchFeature&&(this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0)),sketchFeature},Draw.prototype.extend=function(feature){var lineString=feature.getGeometry();this.sketchFeature_=feature,this.sketchCoords_=lineString.getCoordinates();var last=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=last.slice(),this.sketchCoords_.push(last.slice()),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))},Draw.prototype.updateSketchFeatures_=function(){var sketchFeatures=[];this.sketchFeature_&&sketchFeatures.push(this.sketchFeature_),this.sketchLine_&&sketchFeatures.push(this.sketchLine_),this.sketchPoint_&&sketchFeatures.push(this.sketchPoint_);var overlaySource=this.overlay_.getSource();overlaySource.clear(!0),overlaySource.addFeatures(sketchFeatures)},Draw.prototype.updateState_=function(){var map=this.getMap(),active=this.getActive();map&&active||this.abortDrawing_(),this.overlay_.setMap(active?map:null)},Draw}(PointerInteraction);function getDefaultStyleFunction(){var styles=createEditingStyle();return function(feature,resolution){return styles[feature.getGeometry().getType()]}}function getMode(type){var mode;return type===GeometryType.POINT||type===GeometryType.MULTI_POINT?mode=Mode$1.POINT:type===GeometryType.LINE_STRING||type===GeometryType.MULTI_LINE_STRING?mode=Mode$1.LINE_STRING:type===GeometryType.POLYGON||type===GeometryType.MULTI_POLYGON?mode=Mode$1.POLYGON:type===GeometryType.CIRCLE&&(mode=Mode$1.CIRCLE),mode}function defaults$1(opt_options){var options=opt_options||{},interactions=new Collection,kinetic=new Kinetic(-.005,.05,100);return(void 0===options.altShiftDragRotate||options.altShiftDragRotate)&&interactions.push(new DragRotate),(void 0===options.doubleClickZoom||options.doubleClickZoom)&&interactions.push(new DoubleClickZoom({delta:options.zoomDelta,duration:options.zoomDuration})),(void 0===options.dragPan||options.dragPan)&&interactions.push(new DragPan({condition:options.onFocusOnly?focus:void 0,kinetic:kinetic})),(void 0===options.pinchRotate||options.pinchRotate)&&interactions.push(new PinchRotate),(void 0===options.pinchZoom||options.pinchZoom)&&interactions.push(new PinchZoom({duration:options.zoomDuration})),(void 0===options.keyboard||options.keyboard)&&(interactions.push(new KeyboardPan),interactions.push(new KeyboardZoom({delta:options.zoomDelta,duration:options.zoomDuration}))),(void 0===options.mouseWheelZoom||options.mouseWheelZoom)&&interactions.push(new MouseWheelZoom({condition:options.onFocusOnly?focus:void 0,duration:options.zoomDuration})),(void 0===options.shiftDragZoom||options.shiftDragZoom)&&interactions.push(new DragZoom({duration:options.zoomDuration})),interactions}var Map$1=function(_super){function Map(options){return(options=assign({},options)).controls||(options.controls=defaults()),options.interactions||(options.interactions=defaults$1()),_super.call(this,options)||this}return __extends(Map,_super),Map.prototype.createRenderer=function(){return new CompositeMapRenderer(this)},Map}(PluggableMap),FeatureFormat=function(){function FeatureFormat(){this.dataProjection=null,this.defaultFeatureProjection=null}return FeatureFormat.prototype.getReadOptions=function(source,opt_options){var options;if(opt_options){var dataProjection=opt_options.dataProjection?get$2(opt_options.dataProjection):this.readProjection(source);opt_options.extent&&dataProjection&&dataProjection.getUnits()===Units.TILE_PIXELS&&(dataProjection=get$2(dataProjection)).setWorldExtent(opt_options.extent),options={dataProjection:dataProjection,featureProjection:opt_options.featureProjection}}return this.adaptOptions(options)},FeatureFormat.prototype.adaptOptions=function(options){return assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},options)},FeatureFormat.prototype.getType=function(){return abstract()},FeatureFormat.prototype.readFeature=function(source,opt_options){return abstract()},FeatureFormat.prototype.readFeatures=function(source,opt_options){return abstract()},FeatureFormat.prototype.readGeometry=function(source,opt_options){return abstract()},FeatureFormat.prototype.readProjection=function(source){return abstract()},FeatureFormat.prototype.writeFeature=function(feature,opt_options){return abstract()},FeatureFormat.prototype.writeFeatures=function(features,opt_options){return abstract()},FeatureFormat.prototype.writeGeometry=function(geometry,opt_options){return abstract()},FeatureFormat}();function transformGeometryWithOptions(geometry,write,opt_options){var transformed,featureProjection=opt_options?get$2(opt_options.featureProjection):null,dataProjection=opt_options?get$2(opt_options.dataProjection):null;if(transformed=featureProjection&&dataProjection&&!equivalent(featureProjection,dataProjection)?(write?geometry.clone():geometry).transform(write?featureProjection:dataProjection,write?dataProjection:featureProjection):geometry,write&&opt_options&&void 0!==opt_options.decimals){var power_1=Math.pow(10,opt_options.decimals);transformed===geometry&&(transformed=geometry.clone()),transformed.applyTransform(function(coordinates){for(var i=0,ii=coordinates.length;i<ii;++i)coordinates[i]=Math.round(coordinates[i]*power_1)/power_1;return coordinates})}return transformed}var JSONFeature=function(_super){function JSONFeature(){return _super.call(this)||this}return __extends(JSONFeature,_super),JSONFeature.prototype.getType=function(){return FormatType.JSON},JSONFeature.prototype.readFeature=function(source,opt_options){return this.readFeatureFromObject(getObject(source),this.getReadOptions(source,opt_options))},JSONFeature.prototype.readFeatures=function(source,opt_options){return this.readFeaturesFromObject(getObject(source),this.getReadOptions(source,opt_options))},JSONFeature.prototype.readFeatureFromObject=function(object,opt_options){return abstract()},JSONFeature.prototype.readFeaturesFromObject=function(object,opt_options){return abstract()},JSONFeature.prototype.readGeometry=function(source,opt_options){return this.readGeometryFromObject(getObject(source),this.getReadOptions(source,opt_options))},JSONFeature.prototype.readGeometryFromObject=function(object,opt_options){return abstract()},JSONFeature.prototype.readProjection=function(source){return this.readProjectionFromObject(getObject(source))},JSONFeature.prototype.readProjectionFromObject=function(object){return abstract()},JSONFeature.prototype.writeFeature=function(feature,opt_options){return JSON.stringify(this.writeFeatureObject(feature,opt_options))},JSONFeature.prototype.writeFeatureObject=function(feature,opt_options){return abstract()},JSONFeature.prototype.writeFeatures=function(features,opt_options){return JSON.stringify(this.writeFeaturesObject(features,opt_options))},JSONFeature.prototype.writeFeaturesObject=function(features,opt_options){return abstract()},JSONFeature.prototype.writeGeometry=function(geometry,opt_options){return JSON.stringify(this.writeGeometryObject(geometry,opt_options))},JSONFeature.prototype.writeGeometryObject=function(geometry,opt_options){return abstract()},JSONFeature}(FeatureFormat);function getObject(source){if("string"==typeof source){var object=JSON.parse(source);return object||null}return null!==source?source:null}var GeometryCollection=function(_super){function GeometryCollection(opt_geometries){var _this=_super.call(this)||this;return _this.geometries_=opt_geometries||null,_this.changeEventsKeys_=[],_this.listenGeometriesChange_(),_this}return __extends(GeometryCollection,_super),GeometryCollection.prototype.unlistenGeometriesChange_=function(){this.changeEventsKeys_.forEach(unlistenByKey),this.changeEventsKeys_.length=0},GeometryCollection.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var i=0,ii=this.geometries_.length;i<ii;++i)this.changeEventsKeys_.push(listen(this.geometries_[i],EventType.CHANGE,this.changed,this))},GeometryCollection.prototype.clone=function(){var geometryCollection=new GeometryCollection(null);return geometryCollection.setGeometries(this.geometries_),geometryCollection},GeometryCollection.prototype.closestPointXY=function(x,y,closestPoint,minSquaredDistance){if(minSquaredDistance<closestSquaredDistanceXY(this.getExtent(),x,y))return minSquaredDistance;for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)minSquaredDistance=geometries[i].closestPointXY(x,y,closestPoint,minSquaredDistance);return minSquaredDistance},GeometryCollection.prototype.containsXY=function(x,y){for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)if(geometries[i].containsXY(x,y))return!0;return!1},GeometryCollection.prototype.computeExtent=function(extent){createOrUpdateEmpty(extent);for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)extend$1(extent,geometries[i].getExtent());return extent},GeometryCollection.prototype.getGeometries=function(){return cloneGeometries(this.geometries_)},GeometryCollection.prototype.getGeometriesArray=function(){return this.geometries_},GeometryCollection.prototype.getSimplifiedGeometry=function(squaredTolerance){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),squaredTolerance<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&squaredTolerance<this.simplifiedGeometryMaxMinSquaredTolerance)return this;for(var simplifiedGeometries=[],geometries=this.geometries_,simplified=!1,i=0,ii=geometries.length;i<ii;++i){var geometry=geometries[i],simplifiedGeometry=geometry.getSimplifiedGeometry(squaredTolerance);simplifiedGeometries.push(simplifiedGeometry),simplifiedGeometry!==geometry&&(simplified=!0)}if(simplified){var simplifiedGeometryCollection=new GeometryCollection(null);return simplifiedGeometryCollection.setGeometriesArray(simplifiedGeometries),simplifiedGeometryCollection}return this.simplifiedGeometryMaxMinSquaredTolerance=squaredTolerance,this},GeometryCollection.prototype.getType=function(){return GeometryType.GEOMETRY_COLLECTION},GeometryCollection.prototype.intersectsExtent=function(extent){for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)if(geometries[i].intersectsExtent(extent))return!0;return!1},GeometryCollection.prototype.isEmpty=function(){return 0===this.geometries_.length},GeometryCollection.prototype.rotate=function(angle,anchor){for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)geometries[i].rotate(angle,anchor);this.changed()},GeometryCollection.prototype.scale=function(sx,opt_sy,opt_anchor){var anchor=opt_anchor;anchor||(anchor=getCenter(this.getExtent()));for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)geometries[i].scale(sx,opt_sy,anchor);this.changed()},GeometryCollection.prototype.setGeometries=function(geometries){this.setGeometriesArray(cloneGeometries(geometries))},GeometryCollection.prototype.setGeometriesArray=function(geometries){this.unlistenGeometriesChange_(),this.geometries_=geometries,this.listenGeometriesChange_(),this.changed()},GeometryCollection.prototype.applyTransform=function(transformFn){for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)geometries[i].applyTransform(transformFn);this.changed()},GeometryCollection.prototype.translate=function(deltaX,deltaY){for(var geometries=this.geometries_,i=0,ii=geometries.length;i<ii;++i)geometries[i].translate(deltaX,deltaY);this.changed()},GeometryCollection.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),_super.prototype.disposeInternal.call(this)},GeometryCollection}(Geometry);function cloneGeometries(geometries){for(var clonedGeometries=[],i=0,ii=geometries.length;i<ii;++i)clonedGeometries.push(geometries[i].clone());return clonedGeometries}var GeoJSON=function(_super){function GeoJSON(opt_options){var _this=this,options=opt_options||{};return(_this=_super.call(this)||this).dataProjection=get$2(options.dataProjection?options.dataProjection:"EPSG:4326"),options.featureProjection&&(_this.defaultFeatureProjection=get$2(options.featureProjection)),_this.geometryName_=options.geometryName,_this.extractGeometryName_=options.extractGeometryName,_this}return __extends(GeoJSON,_super),GeoJSON.prototype.readFeatureFromObject=function(object,opt_options){var geoJSONFeature=null,geometry=readGeometry((geoJSONFeature="Feature"===object.type?object:{type:"Feature",geometry:object,properties:null}).geometry,opt_options),feature=new Feature;return this.geometryName_?feature.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in geoJSONFeature!==void 0&&feature.setGeometryName(geoJSONFeature.geometry_name),feature.setGeometry(geometry),"id"in geoJSONFeature&&feature.setId(geoJSONFeature.id),geoJSONFeature.properties&&feature.setProperties(geoJSONFeature.properties,!0),feature},GeoJSON.prototype.readFeaturesFromObject=function(object,opt_options){var features=null;if("FeatureCollection"===object.type){features=[];for(var geoJSONFeatures=object.features,i=0,ii=geoJSONFeatures.length;i<ii;++i)features.push(this.readFeatureFromObject(geoJSONFeatures[i],opt_options))}else features=[this.readFeatureFromObject(object,opt_options)];return features},GeoJSON.prototype.readGeometryFromObject=function(object,opt_options){return readGeometry(object,opt_options)},GeoJSON.prototype.readProjectionFromObject=function(object){var projection,crs=object.crs;return crs?"name"==crs.type?projection=get$2(crs.properties.name):assert(!1,36):projection=this.dataProjection,projection},GeoJSON.prototype.writeFeatureObject=function(feature,opt_options){opt_options=this.adaptOptions(opt_options);var object={type:"Feature",geometry:null,properties:null},id=feature.getId();void 0!==id&&(object.id=id);var geometry=feature.getGeometry();geometry&&(object.geometry=writeGeometry(geometry,opt_options));var properties=feature.getProperties();return delete properties[feature.getGeometryName()],isEmpty(properties)||(object.properties=properties),object},GeoJSON.prototype.writeFeaturesObject=function(features,opt_options){opt_options=this.adaptOptions(opt_options);for(var objects=[],i=0,ii=features.length;i<ii;++i)objects.push(this.writeFeatureObject(features[i],opt_options));return{type:"FeatureCollection",features:objects}},GeoJSON.prototype.writeGeometryObject=function(geometry,opt_options){return writeGeometry(geometry,this.adaptOptions(opt_options))},GeoJSON}(JSONFeature);function readGeometry(object,opt_options){if(!object)return null;var geometry;switch(object.type){case GeometryType.POINT:geometry=readPointGeometry(object);break;case GeometryType.LINE_STRING:geometry=readLineStringGeometry(object);break;case GeometryType.POLYGON:geometry=readPolygonGeometry(object);break;case GeometryType.MULTI_POINT:geometry=readMultiPointGeometry(object);break;case GeometryType.MULTI_LINE_STRING:geometry=readMultiLineStringGeometry(object);break;case GeometryType.MULTI_POLYGON:geometry=readMultiPolygonGeometry(object);break;case GeometryType.GEOMETRY_COLLECTION:geometry=readGeometryCollectionGeometry(object);break;default:throw new Error("Unsupported GeoJSON type: "+object.type)}return transformGeometryWithOptions(geometry,!1,opt_options)}function readGeometryCollectionGeometry(object,opt_options){var geometries=object.geometries.map(function(geometry){return readGeometry(geometry,opt_options)});return new GeometryCollection(geometries)}function readPointGeometry(object){return new Point(object.coordinates)}function readLineStringGeometry(object){return new LineString(object.coordinates)}function readMultiLineStringGeometry(object){return new MultiLineString(object.coordinates)}function readMultiPointGeometry(object){return new MultiPoint(object.coordinates)}function readMultiPolygonGeometry(object){return new MultiPolygon(object.coordinates)}function readPolygonGeometry(object){return new Polygon(object.coordinates)}function writeGeometry(geometry,opt_options){var geoJSON,type=(geometry=transformGeometryWithOptions(geometry,!0,opt_options)).getType();switch(type){case GeometryType.POINT:geoJSON=writePointGeometry(geometry);break;case GeometryType.LINE_STRING:geoJSON=writeLineStringGeometry(geometry);break;case GeometryType.POLYGON:geoJSON=writePolygonGeometry(geometry,opt_options);break;case GeometryType.MULTI_POINT:geoJSON=writeMultiPointGeometry(geometry);break;case GeometryType.MULTI_LINE_STRING:geoJSON=writeMultiLineStringGeometry(geometry);break;case GeometryType.MULTI_POLYGON:geoJSON=writeMultiPolygonGeometry(geometry,opt_options);break;case GeometryType.GEOMETRY_COLLECTION:geoJSON=writeGeometryCollectionGeometry(geometry,opt_options);break;case GeometryType.CIRCLE:geoJSON={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+type)}return geoJSON}function writeGeometryCollectionGeometry(geometry,opt_options){return{type:"GeometryCollection",geometries:geometry.getGeometriesArray().map(function(geometry){var options=assign({},opt_options);return delete options.featureProjection,writeGeometry(geometry,options)})}}function writeLineStringGeometry(geometry,opt_options){return{type:"LineString",coordinates:geometry.getCoordinates()}}function writeMultiLineStringGeometry(geometry,opt_options){return{type:"MultiLineString",coordinates:geometry.getCoordinates()}}function writeMultiPointGeometry(geometry,opt_options){return{type:"MultiPoint",coordinates:geometry.getCoordinates()}}function writeMultiPolygonGeometry(geometry,opt_options){var right;return opt_options&&(right=opt_options.rightHanded),{type:"MultiPolygon",coordinates:geometry.getCoordinates(right)}}function writePointGeometry(geometry,opt_options){return{type:"Point",coordinates:geometry.getCoordinates()}}function writePolygonGeometry(geometry,opt_options){var right;return opt_options&&(right=opt_options.rightHanded),{type:"Polygon",coordinates:geometry.getCoordinates(right)}}var TileProperty={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"},BaseTileLayer=function(_super){function BaseTileLayer(opt_options){var _this=this,options=opt_options||{},baseOptions=assign({},options);return delete baseOptions.preload,delete baseOptions.useInterimTilesOnError,(_this=_super.call(this,baseOptions)||this).setPreload(void 0!==options.preload?options.preload:0),_this.setUseInterimTilesOnError(void 0===options.useInterimTilesOnError||options.useInterimTilesOnError),_this}return __extends(BaseTileLayer,_super),BaseTileLayer.prototype.getPreload=function(){return this.get(TileProperty.PRELOAD)},BaseTileLayer.prototype.setPreload=function(preload){this.set(TileProperty.PRELOAD,preload)},BaseTileLayer.prototype.getUseInterimTilesOnError=function(){return this.get(TileProperty.USE_INTERIM_TILES_ON_ERROR)},BaseTileLayer.prototype.setUseInterimTilesOnError=function(useInterimTilesOnError){this.set(TileProperty.USE_INTERIM_TILES_ON_ERROR,useInterimTilesOnError)},BaseTileLayer}(Layer),TileRange=function(){function TileRange(minX,maxX,minY,maxY){this.minX=minX,this.maxX=maxX,this.minY=minY,this.maxY=maxY}return TileRange.prototype.contains=function(tileCoord){return this.containsXY(tileCoord[1],tileCoord[2])},TileRange.prototype.containsTileRange=function(tileRange){return this.minX<=tileRange.minX&&tileRange.maxX<=this.maxX&&this.minY<=tileRange.minY&&tileRange.maxY<=this.maxY},TileRange.prototype.containsXY=function(x,y){return this.minX<=x&&x<=this.maxX&&this.minY<=y&&y<=this.maxY},TileRange.prototype.equals=function(tileRange){return this.minX==tileRange.minX&&this.minY==tileRange.minY&&this.maxX==tileRange.maxX&&this.maxY==tileRange.maxY},TileRange.prototype.extend=function(tileRange){tileRange.minX<this.minX&&(this.minX=tileRange.minX),tileRange.maxX>this.maxX&&(this.maxX=tileRange.maxX),tileRange.minY<this.minY&&(this.minY=tileRange.minY),tileRange.maxY>this.maxY&&(this.maxY=tileRange.maxY)},TileRange.prototype.getHeight=function(){return this.maxY-this.minY+1},TileRange.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},TileRange.prototype.getWidth=function(){return this.maxX-this.minX+1},TileRange.prototype.intersects=function(tileRange){return this.minX<=tileRange.maxX&&this.maxX>=tileRange.minX&&this.minY<=tileRange.maxY&&this.maxY>=tileRange.minY},TileRange}();function createOrUpdate$1(minX,maxX,minY,maxY,tileRange){return void 0!==tileRange?(tileRange.minX=minX,tileRange.maxX=maxX,tileRange.minY=minY,tileRange.maxY=maxY,tileRange):new TileRange(minX,maxX,minY,maxY)}var CanvasTileLayerRenderer=function(_super){function CanvasTileLayerRenderer(tileLayer){var _this=_super.call(this,tileLayer)||this;return _this.extentChanged=!0,_this.renderedExtent_=null,_this.renderedRevision,_this.renderedTiles=[],_this.newTiles_=!1,_this.tmpExtent=createEmpty(),_this.tmpTileRange_=new TileRange(0,0,0,0),_this}return __extends(CanvasTileLayerRenderer,_super),CanvasTileLayerRenderer.prototype.isDrawableTile=function(tile){var tileLayer=this.getLayer(),tileState=tile.getState(),useInterimTilesOnError=tileLayer.getUseInterimTilesOnError();return tileState==TileState.LOADED||tileState==TileState.EMPTY||tileState==TileState.ERROR&&!useInterimTilesOnError},CanvasTileLayerRenderer.prototype.getTile=function(z,x,y,frameState){var pixelRatio=frameState.pixelRatio,projection=frameState.viewState.projection,tileLayer=this.getLayer(),tile=tileLayer.getSource().getTile(z,x,y,pixelRatio,projection);return tile.getState()==TileState.ERROR&&(tileLayer.getUseInterimTilesOnError()?tileLayer.getPreload()>0&&(this.newTiles_=!0):tile.setState(TileState.LOADED)),this.isDrawableTile(tile)||(tile=tile.getInterimTile()),tile},CanvasTileLayerRenderer.prototype.loadedTileCallback=function(tiles,zoom,tile){return!!this.isDrawableTile(tile)&&_super.prototype.loadedTileCallback.call(this,tiles,zoom,tile)},CanvasTileLayerRenderer.prototype.prepareFrame=function(frameState){return!!this.getLayer().getSource()},CanvasTileLayerRenderer.prototype.renderFrame=function(frameState,target){var layerState=frameState.layerStatesArray[frameState.layerIndex],viewState=frameState.viewState,projection=viewState.projection,viewResolution=viewState.resolution,viewCenter=viewState.center,rotation=viewState.rotation,pixelRatio=frameState.pixelRatio,tileLayer=this.getLayer(),tileSource=tileLayer.getSource(),sourceRevision=tileSource.getRevision(),tileGrid=tileSource.getTileGridForProjection(projection),z=tileGrid.getZForResolution(viewResolution,tileSource.zDirection),tileResolution=tileGrid.getResolution(z),extent=frameState.extent,layerExtent=layerState.extent&&fromUserExtent(layerState.extent,projection);layerExtent&&(extent=getIntersection(extent,fromUserExtent(layerState.extent,projection)));var tilePixelRatio=tileSource.getTilePixelRatio(pixelRatio),width=Math.round(frameState.size[0]*tilePixelRatio),height=Math.round(frameState.size[1]*tilePixelRatio);rotation&&(width=height=Math.round(Math.sqrt(width*width+height*height)));var dx=tileResolution*width/2/tilePixelRatio,dy=tileResolution*height/2/tilePixelRatio,canvasExtent=[viewCenter[0]-dx,viewCenter[1]-dy,viewCenter[0]+dx,viewCenter[1]+dy],tileRange=tileGrid.getTileRangeForExtentAndZ(extent,z),tilesToDrawByZ={};tilesToDrawByZ[z]={};var findLoadedTiles=this.createLoadedTileFinder(tileSource,projection,tilesToDrawByZ),tmpExtent=this.tmpExtent,tmpTileRange=this.tmpTileRange_;this.newTiles_=!1;for(var x=tileRange.minX;x<=tileRange.maxX;++x)for(var y=tileRange.minY;y<=tileRange.maxY;++y){var tile=this.getTile(z,x,y,frameState);if(this.isDrawableTile(tile)){var uid=getUid(this);if(tile.getState()==TileState.LOADED){tilesToDrawByZ[z][tile.tileCoord.toString()]=tile;var inTransition=tile.inTransition(uid);this.newTiles_||!inTransition&&-1!==this.renderedTiles.indexOf(tile)||(this.newTiles_=!0)}if(1===tile.getAlpha(uid,frameState.time))continue}var childTileRange=tileGrid.getTileCoordChildTileRange(tile.tileCoord,tmpTileRange,tmpExtent),covered=!1;childTileRange&&(covered=findLoadedTiles(z+1,childTileRange)),covered||tileGrid.forEachTileCoordParentTileRange(tile.tileCoord,findLoadedTiles,tmpTileRange,tmpExtent)}var canvasScale=tileResolution/viewResolution;compose(this.pixelTransform,frameState.size[0]/2,frameState.size[1]/2,1/tilePixelRatio,1/tilePixelRatio,rotation,-width/2,-height/2),this.useContainer(target,this.pixelTransform,layerState.opacity);var context=this.context,canvas=context.canvas;makeInverse(this.inversePixelTransform,this.pixelTransform),compose(this.tempTransform_,width/2,height/2,canvasScale,canvasScale,0,-width/2,-height/2),canvas.width!=width||canvas.height!=height?(canvas.width=width,canvas.height=height):this.containerReused||context.clearRect(0,0,width,height),layerExtent&&this.clipUnrotated(context,frameState,layerExtent),this.preRender(context,frameState),this.renderedTiles.length=0;var clips,clipZs,currentClip,zs=Object.keys(tilesToDrawByZ).map(Number);zs.sort(numberSafeCompareFunction),1!==layerState.opacity||this.containerReused&&!tileSource.getOpaque(frameState.viewState.projection)?(clips=[],clipZs=[]):zs=zs.reverse();for(var i=zs.length-1;i>=0;--i){var currentZ=zs[i],currentTilePixelSize=tileSource.getTilePixelSize(currentZ,pixelRatio,projection),currentScale=tileGrid.getResolution(currentZ)/tileResolution,dx_1=currentTilePixelSize[0]*currentScale*canvasScale,dy_1=currentTilePixelSize[1]*currentScale*canvasScale,originTileCoord=tileGrid.getTileCoordForCoordAndZ(getTopLeft(canvasExtent),currentZ),originTileExtent=tileGrid.getTileCoordExtent(originTileCoord),origin_1=apply(this.tempTransform_,[tilePixelRatio*(originTileExtent[0]-canvasExtent[0])/tileResolution,tilePixelRatio*(canvasExtent[3]-originTileExtent[3])/tileResolution]),tileGutter=tilePixelRatio*tileSource.getGutterForProjection(projection),tilesToDraw=tilesToDrawByZ[currentZ];for(var tileCoordKey in tilesToDraw){var tileCoord=(tile=tilesToDraw[tileCoordKey]).tileCoord,floatX=origin_1[0]-(originTileCoord[1]-tileCoord[1])*dx_1,nextX=Math.round(floatX+dx_1),floatY=origin_1[1]-(originTileCoord[2]-tileCoord[2])*dy_1,nextY=Math.round(floatY+dy_1),w=nextX-(x=Math.round(floatX)),h=nextY-(y=Math.round(floatY)),transition=z===currentZ;if(!(inTransition=transition&&1!==tile.getAlpha(getUid(this),frameState.time)))if(clips){context.save(),currentClip=[x,y,x+w,y,x+w,y+h,x,y+h];for(var i_1=0,ii=clips.length;i_1<ii;++i_1)if(z!==currentZ&&currentZ<clipZs[i_1]){var clip=clips[i_1];context.beginPath(),context.moveTo(currentClip[0],currentClip[1]),context.lineTo(currentClip[2],currentClip[3]),context.lineTo(currentClip[4],currentClip[5]),context.lineTo(currentClip[6],currentClip[7]),context.moveTo(clip[6],clip[7]),context.lineTo(clip[4],clip[5]),context.lineTo(clip[2],clip[3]),context.lineTo(clip[0],clip[1]),context.clip()}clips.push(currentClip),clipZs.push(currentZ)}else context.clearRect(x,y,w,h);this.drawTileImage(tile,frameState,x,y,w,h,tileGutter,transition,layerState.opacity),clips&&!inTransition&&context.restore(),this.renderedTiles.push(tile),this.updateUsedTiles(frameState.usedTiles,tileSource,tile)}}this.renderedRevision=sourceRevision,this.renderedResolution=tileResolution,this.extentChanged=!this.renderedExtent_||!equals$1(this.renderedExtent_,canvasExtent),this.renderedExtent_=canvasExtent,this.manageTilePyramid(frameState,tileSource,tileGrid,pixelRatio,projection,extent,z,tileLayer.getPreload()),this.updateCacheSize_(frameState,tileSource),this.scheduleExpireCache(frameState,tileSource),this.postRender(context,frameState),layerState.extent&&context.restore();var canvasTransform=toString(this.pixelTransform);return canvasTransform!==canvas.style.transform&&(canvas.style.transform=canvasTransform),this.container},CanvasTileLayerRenderer.prototype.drawTileImage=function(tile,frameState,x,y,w,h,gutter,transition,opacity){var image=this.getTileImage(tile);if(image){var uid=getUid(this),tileAlpha=transition?tile.getAlpha(uid,frameState.time):1,alpha=opacity*tileAlpha,alphaChanged=alpha!==this.context.globalAlpha;alphaChanged&&(this.context.save(),this.context.globalAlpha=alpha),this.context.drawImage(image,gutter,gutter,image.width-2*gutter,image.height-2*gutter,x,y,w,h),alphaChanged&&this.context.restore(),1!==tileAlpha?frameState.animate=!0:transition&&tile.endTransition(uid)}},CanvasTileLayerRenderer.prototype.getImage=function(){var context=this.context;return context?context.canvas:null},CanvasTileLayerRenderer.prototype.getTileImage=function(tile){return tile.getImage()},CanvasTileLayerRenderer.prototype.scheduleExpireCache=function(frameState,tileSource){if(tileSource.canExpireCache()){var postRenderFunction=function(tileSource,map,frameState){var tileSourceKey=getUid(tileSource);tileSourceKey in frameState.usedTiles&&tileSource.expireCache(frameState.viewState.projection,frameState.usedTiles[tileSourceKey])}.bind(null,tileSource);frameState.postRenderFunctions.push(postRenderFunction)}},CanvasTileLayerRenderer.prototype.updateUsedTiles=function(usedTiles,tileSource,tile){var tileSourceKey=getUid(tileSource);tileSourceKey in usedTiles||(usedTiles[tileSourceKey]={}),usedTiles[tileSourceKey][tile.getKey()]=!0},CanvasTileLayerRenderer.prototype.updateCacheSize_=function(frameState,tileSource){var tileSourceKey=getUid(tileSource),size=0;tileSourceKey in frameState.usedTiles&&(size+=Object.keys(frameState.usedTiles[tileSourceKey]).length),tileSourceKey in frameState.wantedTiles&&(size+=Object.keys(frameState.wantedTiles[tileSourceKey]).length);var tileCache=tileSource.tileCache;tileCache.highWaterMark<size&&(tileCache.highWaterMark=size)},CanvasTileLayerRenderer.prototype.manageTilePyramid=function(frameState,tileSource,tileGrid,pixelRatio,projection,extent,currentZ,preload,opt_tileCallback){var tileSourceKey=getUid(tileSource);tileSourceKey in frameState.wantedTiles||(frameState.wantedTiles[tileSourceKey]={});var tile,tileRange,tileResolution,x,y,z,wantedTiles=frameState.wantedTiles[tileSourceKey],tileQueue=frameState.tileQueue;for(z=tileGrid.getMinZoom();z<=currentZ;++z)for(tileRange=tileGrid.getTileRangeForExtentAndZ(extent,z,tileRange),tileResolution=tileGrid.getResolution(z),x=tileRange.minX;x<=tileRange.maxX;++x)for(y=tileRange.minY;y<=tileRange.maxY;++y)currentZ-z<=preload?((tile=tileSource.getTile(z,x,y,pixelRatio,projection)).getState()==TileState.IDLE&&(wantedTiles[tile.getKey()]=!0,tileQueue.isKeyQueued(tile.getKey())||tileQueue.enqueue([tile,tileSourceKey,tileGrid.getTileCoordCenter(tile.tileCoord),tileResolution])),void 0!==opt_tileCallback&&opt_tileCallback(tile)):tileSource.useTile(z,x,y,projection)},CanvasTileLayerRenderer}(CanvasLayerRenderer);CanvasTileLayerRenderer.prototype.getLayer;var TileLayer=function(_super){function TileLayer(opt_options){return _super.call(this,opt_options)||this}return __extends(TileLayer,_super),TileLayer.prototype.createRenderer=function(){return new CanvasTileLayerRenderer(this)},TileLayer}(BaseTileLayer),ERROR_THRESHOLD=.5,Tile=function(_super){function Tile(tileCoord,state,opt_options){var _this=_super.call(this)||this,options=opt_options||{};return _this.tileCoord=tileCoord,_this.state=state,_this.interimTile=null,_this.hifi=!0,_this.key="",_this.transition_=void 0===options.transition?250:options.transition,_this.transitionStarts_={},_this}return __extends(Tile,_super),Tile.prototype.changed=function(){this.dispatchEvent(EventType.CHANGE)},Tile.prototype.getKey=function(){return this.key+"/"+this.tileCoord},Tile.prototype.getInterimTile=function(){if(!this.interimTile)return this;var tile=this.interimTile;do{if(tile.getState()==TileState.LOADED)return this.transition_=0,tile;tile=tile.interimTile}while(tile);return this},Tile.prototype.refreshInterimChain=function(){if(this.interimTile){var tile=this.interimTile,prev=this;do{if(tile.getState()==TileState.LOADED){tile.interimTile=null;break}tile.getState()==TileState.LOADING?prev=tile:tile.getState()==TileState.IDLE?prev.interimTile=tile.interimTile:prev=tile,tile=prev.interimTile}while(tile)}},Tile.prototype.getTileCoord=function(){return this.tileCoord},Tile.prototype.getState=function(){return this.state},Tile.prototype.setState=function(state){if(this.state!==TileState.ERROR&&this.state>state)throw new Error("Tile load sequence violation");this.state=state,this.changed()},Tile.prototype.load=function(){abstract()},Tile.prototype.getAlpha=function(id,time){if(!this.transition_)return 1;var start=this.transitionStarts_[id];if(start){if(-1===start)return 1}else start=time,this.transitionStarts_[id]=start;var delta=time-start+1e3/60;return delta>=this.transition_?1:easeIn(delta/this.transition_)},Tile.prototype.inTransition=function(id){return!!this.transition_&&-1!==this.transitionStarts_[id]},Tile.prototype.endTransition=function(id){this.transition_&&(this.transitionStarts_[id]=-1)},Tile}(Target),ImageBase=function(_super){function ImageBase(extent,resolution,pixelRatio,state){var _this=_super.call(this)||this;return _this.extent=extent,_this.pixelRatio_=pixelRatio,_this.resolution=resolution,_this.state=state,_this}return __extends(ImageBase,_super),ImageBase.prototype.changed=function(){this.dispatchEvent(EventType.CHANGE)},ImageBase.prototype.getExtent=function(){return this.extent},ImageBase.prototype.getImage=function(){return abstract()},ImageBase.prototype.getPixelRatio=function(){return this.pixelRatio_},ImageBase.prototype.getResolution=function(){return this.resolution},ImageBase.prototype.getState=function(){return this.state},ImageBase.prototype.load=function(){abstract()},ImageBase}(Target),ImageWrapper=function(_super){function ImageWrapper(extent,resolution,pixelRatio,src,crossOrigin,imageLoadFunction){var _this=_super.call(this,extent,resolution,pixelRatio,ImageState.IDLE)||this;return _this.src_=src,_this.image_=new Image,null!==crossOrigin&&(_this.image_.crossOrigin=crossOrigin),_this.unlisten_=null,_this.state=ImageState.IDLE,_this.imageLoadFunction_=imageLoadFunction,_this}return __extends(ImageWrapper,_super),ImageWrapper.prototype.getImage=function(){return this.image_},ImageWrapper.prototype.handleImageError_=function(){this.state=ImageState.ERROR,this.unlistenImage_(),this.changed()},ImageWrapper.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=getHeight(this.extent)/this.image_.height),this.state=ImageState.LOADED,this.unlistenImage_(),this.changed()},ImageWrapper.prototype.load=function(){this.state!=ImageState.IDLE&&this.state!=ImageState.ERROR||(this.state=ImageState.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},ImageWrapper.prototype.setImage=function(image){this.image_=image},ImageWrapper.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},ImageWrapper}(ImageBase);function listenImage(image,loadHandler,errorHandler){var img=image;if(img.src&&IMAGE_DECODE){var promise=img.decode(),listening_1=!0;return promise.then(function(){listening_1&&loadHandler()}).catch(function(error){listening_1&&("EncodingError"===error.name&&"Invalid image type."===error.message?loadHandler():errorHandler())}),function(){listening_1=!1}}var listenerKeys=[listenOnce(img,EventType.LOAD,loadHandler),listenOnce(img,EventType.ERROR,errorHandler)];return function(){listenerKeys.forEach(unlistenByKey)}}var ImageTile=function(_super){function ImageTile(tileCoord,state,src,crossOrigin,tileLoadFunction,opt_options){var _this=_super.call(this,tileCoord,state,opt_options)||this;return _this.crossOrigin_=crossOrigin,_this.src_=src,_this.image_=new Image,null!==crossOrigin&&(_this.image_.crossOrigin=crossOrigin),_this.unlisten_=null,_this.tileLoadFunction_=tileLoadFunction,_this}return __extends(ImageTile,_super),ImageTile.prototype.disposeInternal=function(){this.state==TileState.LOADING&&(this.unlistenImage_(),this.image_=getBlankImage()),this.interimTile&&this.interimTile.dispose(),this.state=TileState.ABORT,this.changed(),_super.prototype.disposeInternal.call(this)},ImageTile.prototype.getImage=function(){return this.image_},ImageTile.prototype.getKey=function(){return this.src_},ImageTile.prototype.handleImageError_=function(){this.state=TileState.ERROR,this.unlistenImage_(),this.image_=getBlankImage(),this.changed()},ImageTile.prototype.handleImageLoad_=function(){var image=this.image_;image.naturalWidth&&image.naturalHeight?this.state=TileState.LOADED:this.state=TileState.EMPTY,this.unlistenImage_(),this.changed()},ImageTile.prototype.load=function(){this.state==TileState.ERROR&&(this.state=TileState.IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==TileState.IDLE&&(this.state=TileState.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=listenImage(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},ImageTile.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},ImageTile}(Tile);function getBlankImage(){var ctx=createCanvasContext2D(1,1);return ctx.fillStyle="rgba(0,0,0,0)",ctx.fillRect(0,0,1,1),ctx.canvas}function createOrUpdate$2(z,x,y,opt_tileCoord){return void 0!==opt_tileCoord?(opt_tileCoord[0]=z,opt_tileCoord[1]=x,opt_tileCoord[2]=y,opt_tileCoord):[z,x,y]}function getKeyZXY(z,x,y){return z+"/"+x+"/"+y}function getKey$1(tileCoord){return getKeyZXY(tileCoord[0],tileCoord[1],tileCoord[2])}function fromKey(key){return key.split("/").map(Number)}function hash(tileCoord){return(tileCoord[1]<<tileCoord[0])+tileCoord[2]}function withinExtentAndZ(tileCoord,tileGrid){var z=tileCoord[0],x=tileCoord[1],y=tileCoord[2];if(tileGrid.getMinZoom()>z||z>tileGrid.getMaxZoom())return!1;var tileRange,extent=tileGrid.getExtent();return!(tileRange=extent?tileGrid.getTileRangeForExtentAndZ(extent,z):tileGrid.getFullTileRange(z))||tileRange.containsXY(x,y)}var TileCache=function(_super){function TileCache(opt_highWaterMark){return _super.call(this,opt_highWaterMark)||this}return __extends(TileCache,_super),TileCache.prototype.expireCache=function(usedTiles){for(;this.canExpireCache();){if(this.peekLast().getKey()in usedTiles)break;this.pop().dispose()}},TileCache.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var z=fromKey(this.peekFirstKey())[0];this.forEach(function(tile){tile.tileCoord[0]!==z&&(this.remove(getKey$1(tile.tileCoord)),tile.dispose())}.bind(this))}},TileCache}(LRUCache);function calculateSourceResolution(sourceProj,targetProj,targetCenter,targetResolution){var sourceCenter=transform(targetCenter,targetProj,sourceProj),sourceResolution=getPointResolution(targetProj,targetResolution,targetCenter),targetMetersPerUnit=targetProj.getMetersPerUnit();void 0!==targetMetersPerUnit&&(sourceResolution*=targetMetersPerUnit);var sourceMetersPerUnit=sourceProj.getMetersPerUnit();void 0!==sourceMetersPerUnit&&(sourceResolution/=sourceMetersPerUnit);var sourceExtent=sourceProj.getExtent();if(!sourceExtent||containsCoordinate(sourceExtent,sourceCenter)){var compensationFactor=getPointResolution(sourceProj,sourceResolution,sourceCenter)/sourceResolution;isFinite(compensationFactor)&&compensationFactor>0&&(sourceResolution/=compensationFactor)}return sourceResolution}function enlargeClipPoint(centroidX,centroidY,x,y){var dX=x-centroidX,dY=y-centroidY,distance=Math.sqrt(dX*dX+dY*dY);return[Math.round(x+dX/distance),Math.round(y+dY/distance)]}function render$2(width,height,pixelRatio,sourceResolution,sourceExtent,targetResolution,targetExtent,triangulation,sources,gutter,opt_renderEdges){var context=createCanvasContext2D(Math.round(pixelRatio*width),Math.round(pixelRatio*height));if(0===sources.length)return context.canvas;context.scale(pixelRatio,pixelRatio);var sourceDataExtent=createEmpty();sources.forEach(function(src,i,arr){extend$1(sourceDataExtent,src.extent)});var canvasWidthInUnits=getWidth(sourceDataExtent),canvasHeightInUnits=getHeight(sourceDataExtent),stitchContext=createCanvasContext2D(Math.round(pixelRatio*canvasWidthInUnits/sourceResolution),Math.round(pixelRatio*canvasHeightInUnits/sourceResolution)),stitchScale=pixelRatio/sourceResolution;sources.forEach(function(src,i,arr){var xPos=src.extent[0]-sourceDataExtent[0],yPos=-(src.extent[3]-sourceDataExtent[3]),srcWidth=getWidth(src.extent),srcHeight=getHeight(src.extent);stitchContext.drawImage(src.image,gutter,gutter,src.image.width-2*gutter,src.image.height-2*gutter,xPos*stitchScale,yPos*stitchScale,srcWidth*stitchScale,srcHeight*stitchScale)});var targetTopLeft=getTopLeft(targetExtent);return triangulation.getTriangles().forEach(function(triangle,i,arr){var source=triangle.source,target=triangle.target,x0=source[0][0],y0=source[0][1],x1=source[1][0],y1=source[1][1],x2=source[2][0],y2=source[2][1],u0=(target[0][0]-targetTopLeft[0])/targetResolution,v0=-(target[0][1]-targetTopLeft[1])/targetResolution,u1=(target[1][0]-targetTopLeft[0])/targetResolution,v1=-(target[1][1]-targetTopLeft[1])/targetResolution,u2=(target[2][0]-targetTopLeft[0])/targetResolution,v2=-(target[2][1]-targetTopLeft[1])/targetResolution,sourceNumericalShiftX=x0,sourceNumericalShiftY=y0;x0=0,y0=0;var affineCoefs=solveLinearSystem([[x1-=sourceNumericalShiftX,y1-=sourceNumericalShiftY,0,0,u1-u0],[x2-=sourceNumericalShiftX,y2-=sourceNumericalShiftY,0,0,u2-u0],[0,0,x1,y1,v1-v0],[0,0,x2,y2,v2-v0]]);if(affineCoefs){context.save(),context.beginPath();var centroidX=(u0+u1+u2)/3,centroidY=(v0+v1+v2)/3,p0=enlargeClipPoint(centroidX,centroidY,u0,v0),p1=enlargeClipPoint(centroidX,centroidY,u1,v1),p2=enlargeClipPoint(centroidX,centroidY,u2,v2);context.moveTo(p1[0],p1[1]),context.lineTo(p0[0],p0[1]),context.lineTo(p2[0],p2[1]),context.clip(),context.transform(affineCoefs[0],affineCoefs[2],affineCoefs[1],affineCoefs[3],u0,v0),context.translate(sourceDataExtent[0]-sourceNumericalShiftX,sourceDataExtent[3]-sourceNumericalShiftY),context.scale(sourceResolution/pixelRatio,-sourceResolution/pixelRatio),context.drawImage(stitchContext.canvas,0,0),context.restore()}}),opt_renderEdges&&(context.save(),context.strokeStyle="black",context.lineWidth=1,triangulation.getTriangles().forEach(function(triangle,i,arr){var target=triangle.target,u0=(target[0][0]-targetTopLeft[0])/targetResolution,v0=-(target[0][1]-targetTopLeft[1])/targetResolution,u1=(target[1][0]-targetTopLeft[0])/targetResolution,v1=-(target[1][1]-targetTopLeft[1])/targetResolution,u2=(target[2][0]-targetTopLeft[0])/targetResolution,v2=-(target[2][1]-targetTopLeft[1])/targetResolution;context.beginPath(),context.moveTo(u1,v1),context.lineTo(u0,v0),context.lineTo(u2,v2),context.closePath(),context.stroke()}),context.restore()),context.canvas}var MAX_SUBDIVISION=10,MAX_TRIANGLE_WIDTH=.25,Triangulation=function(){function Triangulation(sourceProj,targetProj,targetExtent,maxSourceExtent,errorThreshold){this.sourceProj_=sourceProj,this.targetProj_=targetProj;var transformInvCache={},transformInv=getTransform(this.targetProj_,this.sourceProj_);this.transformInv_=function(c){var key=c[0]+"/"+c[1];return transformInvCache[key]||(transformInvCache[key]=transformInv(c)),transformInvCache[key]},this.maxSourceExtent_=maxSourceExtent,this.errorThresholdSquared_=errorThreshold*errorThreshold,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!maxSourceExtent&&!!this.sourceProj_.getExtent()&&getWidth(maxSourceExtent)==getWidth(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?getWidth(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?getWidth(this.targetProj_.getExtent()):null;var destinationTopLeft=getTopLeft(targetExtent),destinationTopRight=getTopRight(targetExtent),destinationBottomRight=getBottomRight(targetExtent),destinationBottomLeft=getBottomLeft(targetExtent),sourceTopLeft=this.transformInv_(destinationTopLeft),sourceTopRight=this.transformInv_(destinationTopRight),sourceBottomRight=this.transformInv_(destinationBottomRight),sourceBottomLeft=this.transformInv_(destinationBottomLeft);if(this.addQuad_(destinationTopLeft,destinationTopRight,destinationBottomRight,destinationBottomLeft,sourceTopLeft,sourceTopRight,sourceBottomRight,sourceBottomLeft,MAX_SUBDIVISION),this.wrapsXInSource_){var leftBound_1=1/0;this.triangles_.forEach(function(triangle,i,arr){leftBound_1=Math.min(leftBound_1,triangle.source[0][0],triangle.source[1][0],triangle.source[2][0])}),this.triangles_.forEach(function(triangle){if(Math.max(triangle.source[0][0],triangle.source[1][0],triangle.source[2][0])-leftBound_1>this.sourceWorldWidth_/2){var newTriangle=[[triangle.source[0][0],triangle.source[0][1]],[triangle.source[1][0],triangle.source[1][1]],[triangle.source[2][0],triangle.source[2][1]]];newTriangle[0][0]-leftBound_1>this.sourceWorldWidth_/2&&(newTriangle[0][0]-=this.sourceWorldWidth_),newTriangle[1][0]-leftBound_1>this.sourceWorldWidth_/2&&(newTriangle[1][0]-=this.sourceWorldWidth_),newTriangle[2][0]-leftBound_1>this.sourceWorldWidth_/2&&(newTriangle[2][0]-=this.sourceWorldWidth_);var minX=Math.min(newTriangle[0][0],newTriangle[1][0],newTriangle[2][0]);Math.max(newTriangle[0][0],newTriangle[1][0],newTriangle[2][0])-minX<this.sourceWorldWidth_/2&&(triangle.source=newTriangle)}}.bind(this))}transformInvCache={}}return Triangulation.prototype.addTriangle_=function(a,b,c,aSrc,bSrc,cSrc){this.triangles_.push({source:[aSrc,bSrc,cSrc],target:[a,b,c]})},Triangulation.prototype.addQuad_=function(a,b,c,d,aSrc,bSrc,cSrc,dSrc,maxSubdivision){var sourceQuadExtent=boundingExtent([aSrc,bSrc,cSrc,dSrc]),sourceCoverageX=this.sourceWorldWidth_?getWidth(sourceQuadExtent)/this.sourceWorldWidth_:null,sourceWorldWidth=this.sourceWorldWidth_,wrapsX=this.sourceProj_.canWrapX()&&sourceCoverageX>.5&&sourceCoverageX<1,needsSubdivision=!1;if(maxSubdivision>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_)needsSubdivision=getWidth(boundingExtent([a,b,c,d]))/this.targetWorldWidth_>MAX_TRIANGLE_WIDTH||needsSubdivision;!wrapsX&&this.sourceProj_.isGlobal()&&sourceCoverageX&&(needsSubdivision=sourceCoverageX>MAX_TRIANGLE_WIDTH||needsSubdivision)}if(needsSubdivision||!this.maxSourceExtent_||intersects(sourceQuadExtent,this.maxSourceExtent_)){if(!(needsSubdivision||isFinite(aSrc[0])&&isFinite(aSrc[1])&&isFinite(bSrc[0])&&isFinite(bSrc[1])&&isFinite(cSrc[0])&&isFinite(cSrc[1])&&isFinite(dSrc[0])&&isFinite(dSrc[1]))){if(!(maxSubdivision>0))return;needsSubdivision=!0}if(maxSubdivision>0){if(!needsSubdivision){var center=[(a[0]+c[0])/2,(a[1]+c[1])/2],centerSrc=this.transformInv_(center),dx=void 0;if(wrapsX)dx=(modulo(aSrc[0],sourceWorldWidth)+modulo(cSrc[0],sourceWorldWidth))/2-modulo(centerSrc[0],sourceWorldWidth);else dx=(aSrc[0]+cSrc[0])/2-centerSrc[0];var dy=(aSrc[1]+cSrc[1])/2-centerSrc[1];needsSubdivision=dx*dx+dy*dy>this.errorThresholdSquared_}if(needsSubdivision){if(Math.abs(a[0]-c[0])<=Math.abs(a[1]-c[1])){var bc=[(b[0]+c[0])/2,(b[1]+c[1])/2],bcSrc=this.transformInv_(bc),da=[(d[0]+a[0])/2,(d[1]+a[1])/2],daSrc=this.transformInv_(da);this.addQuad_(a,b,bc,da,aSrc,bSrc,bcSrc,daSrc,maxSubdivision-1),this.addQuad_(da,bc,c,d,daSrc,bcSrc,cSrc,dSrc,maxSubdivision-1)}else{var ab=[(a[0]+b[0])/2,(a[1]+b[1])/2],abSrc=this.transformInv_(ab),cd=[(c[0]+d[0])/2,(c[1]+d[1])/2],cdSrc=this.transformInv_(cd);this.addQuad_(a,ab,cd,d,aSrc,abSrc,cdSrc,dSrc,maxSubdivision-1),this.addQuad_(ab,b,c,cd,abSrc,bSrc,cSrc,cdSrc,maxSubdivision-1)}return}}if(wrapsX){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(a,c,d,aSrc,cSrc,dSrc),this.addTriangle_(a,b,c,aSrc,bSrc,cSrc)}},Triangulation.prototype.calculateSourceExtent=function(){var extent=createEmpty();return this.triangles_.forEach(function(triangle,i,arr){var src=triangle.source;extendCoordinate(extent,src[0]),extendCoordinate(extent,src[1]),extendCoordinate(extent,src[2])}),extent},Triangulation.prototype.getTriangles=function(){return this.triangles_},Triangulation}(),ReprojTile=function(_super){function ReprojTile(sourceProj,sourceTileGrid,targetProj,targetTileGrid,tileCoord,wrappedTileCoord,pixelRatio,gutter,getTileFunction,opt_errorThreshold,opt_renderEdges){var _this=_super.call(this,tileCoord,TileState.IDLE)||this;_this.renderEdges_=void 0!==opt_renderEdges&&opt_renderEdges,_this.pixelRatio_=pixelRatio,_this.gutter_=gutter,_this.canvas_=null,_this.sourceTileGrid_=sourceTileGrid,_this.targetTileGrid_=targetTileGrid,_this.wrappedTileCoord_=wrappedTileCoord||tileCoord,_this.sourceTiles_=[],_this.sourcesListenerKeys_=null,_this.sourceZ_=0;var targetExtent=targetTileGrid.getTileCoordExtent(_this.wrappedTileCoord_),maxTargetExtent=_this.targetTileGrid_.getExtent(),maxSourceExtent=_this.sourceTileGrid_.getExtent(),limitedTargetExtent=maxTargetExtent?getIntersection(targetExtent,maxTargetExtent):targetExtent;if(0===getArea(limitedTargetExtent))return _this.state=TileState.EMPTY,_this;var sourceProjExtent=sourceProj.getExtent();sourceProjExtent&&(maxSourceExtent=maxSourceExtent?getIntersection(maxSourceExtent,sourceProjExtent):sourceProjExtent);var targetResolution=targetTileGrid.getResolution(_this.wrappedTileCoord_[0]),sourceResolution=calculateSourceResolution(sourceProj,targetProj,getCenter(limitedTargetExtent),targetResolution);if(!isFinite(sourceResolution)||sourceResolution<=0)return _this.state=TileState.EMPTY,_this;var errorThresholdInPixels=void 0!==opt_errorThreshold?opt_errorThreshold:ERROR_THRESHOLD;if(_this.triangulation_=new Triangulation(sourceProj,targetProj,limitedTargetExtent,maxSourceExtent,sourceResolution*errorThresholdInPixels),0===_this.triangulation_.getTriangles().length)return _this.state=TileState.EMPTY,_this;_this.sourceZ_=sourceTileGrid.getZForResolution(sourceResolution);var sourceExtent=_this.triangulation_.calculateSourceExtent();if(maxSourceExtent&&(sourceProj.canWrapX()?(sourceExtent[1]=clamp(sourceExtent[1],maxSourceExtent[1],maxSourceExtent[3]),sourceExtent[3]=clamp(sourceExtent[3],maxSourceExtent[1],maxSourceExtent[3])):sourceExtent=getIntersection(sourceExtent,maxSourceExtent)),getArea(sourceExtent)){for(var sourceRange=sourceTileGrid.getTileRangeForExtentAndZ(sourceExtent,_this.sourceZ_),srcX=sourceRange.minX;srcX<=sourceRange.maxX;srcX++)for(var srcY=sourceRange.minY;srcY<=sourceRange.maxY;srcY++){var tile=getTileFunction(_this.sourceZ_,srcX,srcY,pixelRatio);tile&&_this.sourceTiles_.push(tile)}0===_this.sourceTiles_.length&&(_this.state=TileState.EMPTY)}else _this.state=TileState.EMPTY;return _this}return __extends(ReprojTile,_super),ReprojTile.prototype.disposeInternal=function(){this.state==TileState.LOADING&&this.unlistenSources_(),_super.prototype.disposeInternal.call(this)},ReprojTile.prototype.getImage=function(){return this.canvas_},ReprojTile.prototype.reproject_=function(){var sources=[];if(this.sourceTiles_.forEach(function(tile,i,arr){tile&&tile.getState()==TileState.LOADED&&sources.push({extent:this.sourceTileGrid_.getTileCoordExtent(tile.tileCoord),image:tile.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===sources.length)this.state=TileState.ERROR;else{var z=this.wrappedTileCoord_[0],size=this.targetTileGrid_.getTileSize(z),width="number"==typeof size?size:size[0],height="number"==typeof size?size:size[1],targetResolution=this.targetTileGrid_.getResolution(z),sourceResolution=this.sourceTileGrid_.getResolution(this.sourceZ_),targetExtent=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=render$2(width,height,this.pixelRatio_,sourceResolution,this.sourceTileGrid_.getExtent(),targetResolution,targetExtent,this.triangulation_,sources,this.gutter_,this.renderEdges_),this.state=TileState.LOADED}this.changed()},ReprojTile.prototype.load=function(){if(this.state==TileState.IDLE){this.state=TileState.LOADING,this.changed();var leftToLoad_1=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(tile,i,arr){var state=tile.getState();if(state==TileState.IDLE||state==TileState.LOADING){leftToLoad_1++;var sourceListenKey_1=listen(tile,EventType.CHANGE,function(e){var state=tile.getState();state!=TileState.LOADED&&state!=TileState.ERROR&&state!=TileState.EMPTY||(unlistenByKey(sourceListenKey_1),0===--leftToLoad_1&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(sourceListenKey_1)}}.bind(this)),this.sourceTiles_.forEach(function(tile,i,arr){tile.getState()==TileState.IDLE&&tile.load()}),0===leftToLoad_1&&setTimeout(this.reproject_.bind(this),0)}},ReprojTile.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(unlistenByKey),this.sourcesListenerKeys_=null},ReprojTile}(Tile);function createFromTemplate(template,tileGrid){var zRegEx=/\{z\}/g,xRegEx=/\{x\}/g,yRegEx=/\{y\}/g,dashYRegEx=/\{-y\}/g;return function(tileCoord,pixelRatio,projection){return tileCoord?template.replace(zRegEx,tileCoord[0].toString()).replace(xRegEx,tileCoord[1].toString()).replace(yRegEx,tileCoord[2].toString()).replace(dashYRegEx,function(){var z=tileCoord[0],range=tileGrid.getFullTileRange(z);return assert(range,55),(range.getHeight()-tileCoord[2]-1).toString()}):void 0}}function createFromTemplates(templates,tileGrid){for(var len=templates.length,tileUrlFunctions=new Array(len),i=0;i<len;++i)tileUrlFunctions[i]=createFromTemplate(templates[i],tileGrid);return createFromTileUrlFunctions(tileUrlFunctions)}function createFromTileUrlFunctions(tileUrlFunctions){return 1===tileUrlFunctions.length?tileUrlFunctions[0]:function(tileCoord,pixelRatio,projection){if(tileCoord){var index=modulo(hash(tileCoord),tileUrlFunctions.length);return tileUrlFunctions[index](tileCoord,pixelRatio,projection)}}}function nullTileUrlFunction(tileCoord,pixelRatio,projection){}function expandUrl(url){var urls=[],match=/\{([a-z])-([a-z])\}/.exec(url);if(match){var startCharCode=match[1].charCodeAt(0),stopCharCode=match[2].charCodeAt(0),charCode=void 0;for(charCode=startCharCode;charCode<=stopCharCode;++charCode)urls.push(url.replace(match[0],String.fromCharCode(charCode)));return urls}if(match=match=/\{(\d+)-(\d+)\}/.exec(url)){for(var stop_1=parseInt(match[2],10),i=parseInt(match[1],10);i<=stop_1;i++)urls.push(url.replace(match[0],i.toString()));return urls}return urls.push(url),urls}var tmpTileCoord=[0,0,0],TileGrid=function(){function TileGrid(options){var zoomFactor;if(this.minZoom=void 0!==options.minZoom?options.minZoom:0,this.resolutions_=options.resolutions,assert(isSorted(this.resolutions_,function(a,b){return b-a},!0),17),!options.origins)for(var i=0,ii=this.resolutions_.length-1;i<ii;++i)if(zoomFactor){if(this.resolutions_[i]/this.resolutions_[i+1]!==zoomFactor){zoomFactor=void 0;break}}else zoomFactor=this.resolutions_[i]/this.resolutions_[i+1];this.zoomFactor_=zoomFactor,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==options.origin?options.origin:null,this.origins_=null,void 0!==options.origins&&(this.origins_=options.origins,assert(this.origins_.length==this.resolutions_.length,20));var extent=options.extent;void 0===extent||this.origin_||this.origins_||(this.origin_=getTopLeft(extent)),assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==options.tileSizes&&(this.tileSizes_=options.tileSizes,assert(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==options.tileSize?options.tileSize:this.tileSizes_?null:DEFAULT_TILE_SIZE,assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==extent?extent:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],void 0!==options.sizes?this.fullTileRanges_=options.sizes.map(function(size,z){return new TileRange(Math.min(0,size[0]),Math.max(size[0]-1,-1),Math.min(0,size[1]),Math.max(size[1]-1,-1))},this):extent&&this.calculateTileRanges_(extent)}return TileGrid.prototype.forEachTileCoord=function(extent,zoom,callback){for(var tileRange=this.getTileRangeForExtentAndZ(extent,zoom),i=tileRange.minX,ii=tileRange.maxX;i<=ii;++i)for(var j=tileRange.minY,jj=tileRange.maxY;j<=jj;++j)callback([zoom,i,j])},TileGrid.prototype.forEachTileCoordParentTileRange=function(tileCoord,callback,opt_tileRange,opt_extent){var x,y,tileCoordExtent=null,z=tileCoord[0]-1;for(2===this.zoomFactor_?(x=tileCoord[1],y=tileCoord[2]):tileCoordExtent=this.getTileCoordExtent(tileCoord,opt_extent);z>=this.minZoom;){if(callback(z,2===this.zoomFactor_?createOrUpdate$1(x=Math.floor(x/2),x,y=Math.floor(y/2),y,opt_tileRange):this.getTileRangeForExtentAndZ(tileCoordExtent,z,opt_tileRange)))return!0;--z}return!1},TileGrid.prototype.getExtent=function(){return this.extent_},TileGrid.prototype.getMaxZoom=function(){return this.maxZoom},TileGrid.prototype.getMinZoom=function(){return this.minZoom},TileGrid.prototype.getOrigin=function(z){return this.origin_?this.origin_:this.origins_[z]},TileGrid.prototype.getResolution=function(z){return this.resolutions_[z]},TileGrid.prototype.getResolutions=function(){return this.resolutions_},TileGrid.prototype.getTileCoordChildTileRange=function(tileCoord,opt_tileRange,opt_extent){if(tileCoord[0]<this.maxZoom){if(2===this.zoomFactor_){var minX=2*tileCoord[1],minY=2*tileCoord[2];return createOrUpdate$1(minX,minX+1,minY,minY+1,opt_tileRange)}var tileCoordExtent=this.getTileCoordExtent(tileCoord,opt_extent);return this.getTileRangeForExtentAndZ(tileCoordExtent,tileCoord[0]+1,opt_tileRange)}return null},TileGrid.prototype.getTileRangeExtent=function(z,tileRange,opt_extent){var origin=this.getOrigin(z),resolution=this.getResolution(z),tileSize=toSize(this.getTileSize(z),this.tmpSize_),minX=origin[0]+tileRange.minX*tileSize[0]*resolution,maxX=origin[0]+(tileRange.maxX+1)*tileSize[0]*resolution;return createOrUpdate(minX,origin[1]+tileRange.minY*tileSize[1]*resolution,maxX,origin[1]+(tileRange.maxY+1)*tileSize[1]*resolution,opt_extent)},TileGrid.prototype.getTileRangeForExtentAndZ=function(extent,z,opt_tileRange){var tileCoord=tmpTileCoord;this.getTileCoordForXYAndZ_(extent[0],extent[3],z,!1,tileCoord);var minX=tileCoord[1],minY=tileCoord[2];return this.getTileCoordForXYAndZ_(extent[2],extent[1],z,!0,tileCoord),createOrUpdate$1(minX,tileCoord[1],minY,tileCoord[2],opt_tileRange)},TileGrid.prototype.getTileCoordCenter=function(tileCoord){var origin=this.getOrigin(tileCoord[0]),resolution=this.getResolution(tileCoord[0]),tileSize=toSize(this.getTileSize(tileCoord[0]),this.tmpSize_);return[origin[0]+(tileCoord[1]+.5)*tileSize[0]*resolution,origin[1]-(tileCoord[2]+.5)*tileSize[1]*resolution]},TileGrid.prototype.getTileCoordExtent=function(tileCoord,opt_extent){var origin=this.getOrigin(tileCoord[0]),resolution=this.getResolution(tileCoord[0]),tileSize=toSize(this.getTileSize(tileCoord[0]),this.tmpSize_),minX=origin[0]+tileCoord[1]*tileSize[0]*resolution,minY=origin[1]-(tileCoord[2]+1)*tileSize[1]*resolution;return createOrUpdate(minX,minY,minX+tileSize[0]*resolution,minY+tileSize[1]*resolution,opt_extent)},TileGrid.prototype.getTileCoordForCoordAndResolution=function(coordinate,resolution,opt_tileCoord){return this.getTileCoordForXYAndResolution_(coordinate[0],coordinate[1],resolution,!1,opt_tileCoord)},TileGrid.prototype.getTileCoordForXYAndResolution_=function(x,y,resolution,reverseIntersectionPolicy,opt_tileCoord){var z=this.getZForResolution(resolution),scale=resolution/this.getResolution(z),origin=this.getOrigin(z),tileSize=toSize(this.getTileSize(z),this.tmpSize_),adjustX=reverseIntersectionPolicy?.5:0,adjustY=reverseIntersectionPolicy?.5:0,xFromOrigin=Math.floor((x-origin[0])/resolution+adjustX),yFromOrigin=Math.floor((origin[1]-y)/resolution+adjustY),tileCoordX=scale*xFromOrigin/tileSize[0],tileCoordY=scale*yFromOrigin/tileSize[1];return reverseIntersectionPolicy?(tileCoordX=Math.ceil(tileCoordX)-1,tileCoordY=Math.ceil(tileCoordY)-1):(tileCoordX=Math.floor(tileCoordX),tileCoordY=Math.floor(tileCoordY)),createOrUpdate$2(z,tileCoordX,tileCoordY,opt_tileCoord)},TileGrid.prototype.getTileCoordForXYAndZ_=function(x,y,z,reverseIntersectionPolicy,opt_tileCoord){var origin=this.getOrigin(z),resolution=this.getResolution(z),tileSize=toSize(this.getTileSize(z),this.tmpSize_),adjustX=reverseIntersectionPolicy?.5:0,adjustY=reverseIntersectionPolicy?.5:0,xFromOrigin=Math.floor((x-origin[0])/resolution+adjustX),yFromOrigin=Math.floor((origin[1]-y)/resolution+adjustY),tileCoordX=xFromOrigin/tileSize[0],tileCoordY=yFromOrigin/tileSize[1];return reverseIntersectionPolicy?(tileCoordX=Math.ceil(tileCoordX)-1,tileCoordY=Math.ceil(tileCoordY)-1):(tileCoordX=Math.floor(tileCoordX),tileCoordY=Math.floor(tileCoordY)),createOrUpdate$2(z,tileCoordX,tileCoordY,opt_tileCoord)},TileGrid.prototype.getTileCoordForCoordAndZ=function(coordinate,z,opt_tileCoord){return this.getTileCoordForXYAndZ_(coordinate[0],coordinate[1],z,!1,opt_tileCoord)},TileGrid.prototype.getTileCoordResolution=function(tileCoord){return this.resolutions_[tileCoord[0]]},TileGrid.prototype.getTileSize=function(z){return this.tileSize_?this.tileSize_:this.tileSizes_[z]},TileGrid.prototype.getFullTileRange=function(z){return this.fullTileRanges_?this.fullTileRanges_[z]:null},TileGrid.prototype.getZForResolution=function(resolution,opt_direction){return clamp(linearFindNearest(this.resolutions_,resolution,opt_direction||0),this.minZoom,this.maxZoom)},TileGrid.prototype.calculateTileRanges_=function(extent){for(var length=this.resolutions_.length,fullTileRanges=new Array(length),z=this.minZoom;z<length;++z)fullTileRanges[z]=this.getTileRangeForExtentAndZ(extent,z);this.fullTileRanges_=fullTileRanges},TileGrid}();function getForProjection(projection){var tileGrid=projection.getDefaultTileGrid();return tileGrid||(tileGrid=createForProjection(projection),projection.setDefaultTileGrid(tileGrid)),tileGrid}function wrapX(tileGrid,tileCoord,projection){var z=tileCoord[0],center=tileGrid.getTileCoordCenter(tileCoord),projectionExtent=extentFromProjection(projection);if(containsCoordinate(projectionExtent,center))return tileCoord;var worldWidth=getWidth(projectionExtent),worldsAway=Math.ceil((projectionExtent[0]-center[0])/worldWidth);return center[0]+=worldWidth*worldsAway,tileGrid.getTileCoordForCoordAndZ(center,z)}function createForExtent(extent,opt_maxZoom,opt_tileSize,opt_corner){var corner=void 0!==opt_corner?opt_corner:Corner.TOP_LEFT,resolutions=resolutionsFromExtent(extent,opt_maxZoom,opt_tileSize);return new TileGrid({extent:extent,origin:getCorner(extent,corner),resolutions:resolutions,tileSize:opt_tileSize})}function createXYZ(opt_options){var xyzOptions=opt_options||{},extent=xyzOptions.extent||get$2("EPSG:3857").getExtent(),gridOptions={extent:extent,minZoom:xyzOptions.minZoom,tileSize:xyzOptions.tileSize,resolutions:resolutionsFromExtent(extent,xyzOptions.maxZoom,xyzOptions.tileSize)};return new TileGrid(gridOptions)}function resolutionsFromExtent(extent,opt_maxZoom,opt_tileSize){for(var maxZoom=void 0!==opt_maxZoom?opt_maxZoom:DEFAULT_MAX_ZOOM,height=getHeight(extent),width=getWidth(extent),tileSize=toSize(void 0!==opt_tileSize?opt_tileSize:DEFAULT_TILE_SIZE),maxResolution=Math.max(width/tileSize[0],height/tileSize[1]),length=maxZoom+1,resolutions=new Array(length),z=0;z<length;++z)resolutions[z]=maxResolution/Math.pow(2,z);return resolutions}function createForProjection(projection,opt_maxZoom,opt_tileSize,opt_corner){return createForExtent(extentFromProjection(projection),opt_maxZoom,opt_tileSize,opt_corner)}function extentFromProjection(projection){var extent=(projection=get$2(projection)).getExtent();if(!extent){var half=180*METERS_PER_UNIT[Units.DEGREES]/projection.getMetersPerUnit();extent=createOrUpdate(-half,-half,half,half)}return extent}var TileSource=function(_super){function TileSource(options){var _this=_super.call(this,{attributions:options.attributions,attributionsCollapsible:options.attributionsCollapsible,projection:options.projection,state:options.state,wrapX:options.wrapX})||this;_this.opaque_=void 0!==options.opaque&&options.opaque,_this.tilePixelRatio_=void 0!==options.tilePixelRatio?options.tilePixelRatio:1,_this.tileGrid=void 0!==options.tileGrid?options.tileGrid:null;var cacheSize=options.cacheSize;if(void 0===cacheSize){var tileSize=[256,256],tileGrid=options.tileGrid;tileGrid&&toSize(tileGrid.getTileSize(tileGrid.getMinZoom()),tileSize);var canUseScreen="undefined"!=typeof screen,width=canUseScreen?screen.availWidth||screen.width:1920,height=canUseScreen?screen.availHeight||screen.height:1080;cacheSize=4*Math.ceil(width/tileSize[0])*Math.ceil(height/tileSize[1])}return _this.tileCache=new TileCache(cacheSize),_this.tmpSize=[0,0],_this.key_=options.key||"",_this.tileOptions={transition:options.transition},_this.zDirection=options.zDirection?options.zDirection:0,_this}return __extends(TileSource,_super),TileSource.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},TileSource.prototype.expireCache=function(projection,usedTiles){var tileCache=this.getTileCacheForProjection(projection);tileCache&&tileCache.expireCache(usedTiles)},TileSource.prototype.forEachLoadedTile=function(projection,z,tileRange,callback){var tileCache=this.getTileCacheForProjection(projection);if(!tileCache)return!1;for(var tile,tileCoordKey,loaded,covered=!0,x=tileRange.minX;x<=tileRange.maxX;++x)for(var y=tileRange.minY;y<=tileRange.maxY;++y)tileCoordKey=getKeyZXY(z,x,y),loaded=!1,tileCache.containsKey(tileCoordKey)&&(loaded=(tile=tileCache.get(tileCoordKey)).getState()===TileState.LOADED)&&(loaded=!1!==callback(tile)),loaded||(covered=!1);return covered},TileSource.prototype.getGutterForProjection=function(projection){return 0},TileSource.prototype.getKey=function(){return this.key_},TileSource.prototype.setKey=function(key){this.key_!==key&&(this.key_=key,this.changed())},TileSource.prototype.getOpaque=function(projection){return this.opaque_},TileSource.prototype.getResolutions=function(){return this.tileGrid.getResolutions()},TileSource.prototype.getTile=function(z,x,y,pixelRatio,projection){return abstract()},TileSource.prototype.getTileGrid=function(){return this.tileGrid},TileSource.prototype.getTileGridForProjection=function(projection){return this.tileGrid?this.tileGrid:getForProjection(projection)},TileSource.prototype.getTileCacheForProjection=function(projection){var thisProj=this.getProjection();return thisProj&&!equivalent(thisProj,projection)?null:this.tileCache},TileSource.prototype.getTilePixelRatio=function(pixelRatio){return this.tilePixelRatio_},TileSource.prototype.getTilePixelSize=function(z,pixelRatio,projection){var tileGrid=this.getTileGridForProjection(projection),tilePixelRatio=this.getTilePixelRatio(pixelRatio),tileSize=toSize(tileGrid.getTileSize(z),this.tmpSize);return 1==tilePixelRatio?tileSize:scale$2(tileSize,tilePixelRatio,this.tmpSize)},TileSource.prototype.getTileCoordForTileUrlFunction=function(tileCoord,opt_projection){var projection=void 0!==opt_projection?opt_projection:this.getProjection(),tileGrid=this.getTileGridForProjection(projection);return this.getWrapX()&&projection.isGlobal()&&(tileCoord=wrapX(tileGrid,tileCoord,projection)),withinExtentAndZ(tileCoord,tileGrid)?tileCoord:null},TileSource.prototype.clear=function(){this.tileCache.clear()},TileSource.prototype.refresh=function(){this.clear(),_super.prototype.refresh.call(this)},TileSource.prototype.useTile=function(z,x,y,projection){},TileSource}(Source),TileSourceEvent=function(_super){function TileSourceEvent(type,tile){var _this=_super.call(this,type)||this;return _this.tile=tile,_this}return __extends(TileSourceEvent,_super),TileSourceEvent}(BaseEvent),TileEventType={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},UrlTile=function(_super){function UrlTile(options){var _this=_super.call(this,{attributions:options.attributions,cacheSize:options.cacheSize,opaque:options.opaque,projection:options.projection,state:options.state,tileGrid:options.tileGrid,tilePixelRatio:options.tilePixelRatio,wrapX:options.wrapX,transition:options.transition,key:options.key,attributionsCollapsible:options.attributionsCollapsible,zDirection:options.zDirection})||this;return _this.generateTileUrlFunction_=!options.tileUrlFunction,_this.tileLoadFunction=options.tileLoadFunction,_this.tileUrlFunction=options.tileUrlFunction?options.tileUrlFunction.bind(_this):nullTileUrlFunction,_this.urls=null,options.urls?_this.setUrls(options.urls):options.url&&_this.setUrl(options.url),_this.tileLoadingKeys_={},_this}return __extends(UrlTile,_super),UrlTile.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},UrlTile.prototype.getTileUrlFunction=function(){return this.tileUrlFunction},UrlTile.prototype.getUrls=function(){return this.urls},UrlTile.prototype.handleTileChange=function(event){var type,tile=event.target,uid=getUid(tile),tileState=tile.getState();tileState==TileState.LOADING?(this.tileLoadingKeys_[uid]=!0,type=TileEventType.TILELOADSTART):uid in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[uid],type=tileState==TileState.ERROR?TileEventType.TILELOADERROR:tileState==TileState.LOADED||tileState==TileState.ABORT?TileEventType.TILELOADEND:void 0),null!=type&&this.dispatchEvent(new TileSourceEvent(type,tile))},UrlTile.prototype.setTileLoadFunction=function(tileLoadFunction){this.tileCache.clear(),this.tileLoadFunction=tileLoadFunction,this.changed()},UrlTile.prototype.setTileUrlFunction=function(tileUrlFunction,key){this.tileUrlFunction=tileUrlFunction,this.tileCache.pruneExceptNewestZ(),void 0!==key?this.setKey(key):this.changed()},UrlTile.prototype.setUrl=function(url){var urls=this.urls=expandUrl(url);this.setUrls(urls)},UrlTile.prototype.setUrls=function(urls){this.urls=urls;var key=urls.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(createFromTemplates(urls,this.tileGrid),key):this.setKey(key)},UrlTile.prototype.useTile=function(z,x,y){var tileCoordKey=getKeyZXY(z,x,y);this.tileCache.containsKey(tileCoordKey)&&this.tileCache.get(tileCoordKey)},UrlTile}(TileSource),TileImage=function(_super){function TileImage(options){var _this=_super.call(this,{attributions:options.attributions,cacheSize:options.cacheSize,opaque:options.opaque,projection:options.projection,state:options.state,tileGrid:options.tileGrid,tileLoadFunction:options.tileLoadFunction?options.tileLoadFunction:defaultTileLoadFunction,tilePixelRatio:options.tilePixelRatio,tileUrlFunction:options.tileUrlFunction,url:options.url,urls:options.urls,wrapX:options.wrapX,transition:options.transition,key:options.key,attributionsCollapsible:options.attributionsCollapsible,zDirection:options.zDirection})||this;return _this.crossOrigin=void 0!==options.crossOrigin?options.crossOrigin:null,_this.tileClass=void 0!==options.tileClass?options.tileClass:ImageTile,_this.tileCacheForProjection={},_this.tileGridForProjection={},_this.reprojectionErrorThreshold_=options.reprojectionErrorThreshold,_this.renderReprojectionEdges_=!1,_this}return __extends(TileImage,_super),TileImage.prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var key in this.tileCacheForProjection)if(this.tileCacheForProjection[key].canExpireCache())return!0;return!1},TileImage.prototype.expireCache=function(projection,usedTiles){var usedTileCache=this.getTileCacheForProjection(projection);for(var id in this.tileCache.expireCache(this.tileCache==usedTileCache?usedTiles:{}),this.tileCacheForProjection){var tileCache=this.tileCacheForProjection[id];tileCache.expireCache(tileCache==usedTileCache?usedTiles:{})}},TileImage.prototype.getGutterForProjection=function(projection){return this.getProjection()&&projection&&!equivalent(this.getProjection(),projection)?0:this.getGutter()},TileImage.prototype.getGutter=function(){return 0},TileImage.prototype.getOpaque=function(projection){return!(this.getProjection()&&projection&&!equivalent(this.getProjection(),projection))&&_super.prototype.getOpaque.call(this,projection)},TileImage.prototype.getTileGridForProjection=function(projection){var thisProj=this.getProjection();if(!this.tileGrid||thisProj&&!equivalent(thisProj,projection)){var projKey=getUid(projection);return projKey in this.tileGridForProjection||(this.tileGridForProjection[projKey]=getForProjection(projection)),this.tileGridForProjection[projKey]}return this.tileGrid},TileImage.prototype.getTileCacheForProjection=function(projection){var thisProj=this.getProjection();if(!thisProj||equivalent(thisProj,projection))return this.tileCache;var projKey=getUid(projection);return projKey in this.tileCacheForProjection||(this.tileCacheForProjection[projKey]=new TileCache(this.tileCache.highWaterMark)),this.tileCacheForProjection[projKey]},TileImage.prototype.createTile_=function(z,x,y,pixelRatio,projection,key){var tileCoord=[z,x,y],urlTileCoord=this.getTileCoordForTileUrlFunction(tileCoord,projection),tileUrl=urlTileCoord?this.tileUrlFunction(urlTileCoord,pixelRatio,projection):void 0,tile=new this.tileClass(tileCoord,void 0!==tileUrl?TileState.IDLE:TileState.EMPTY,void 0!==tileUrl?tileUrl:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return tile.key=key,tile.addEventListener(EventType.CHANGE,this.handleTileChange.bind(this)),tile},TileImage.prototype.getTile=function(z,x,y,pixelRatio,projection){var sourceProjection=this.getProjection();if(sourceProjection&&projection&&!equivalent(sourceProjection,projection)){var cache=this.getTileCacheForProjection(projection),tileCoord=[z,x,y],tile=void 0,tileCoordKey=getKey$1(tileCoord);cache.containsKey(tileCoordKey)&&(tile=cache.get(tileCoordKey));var key=this.getKey();if(tile&&tile.key==key)return tile;var sourceTileGrid=this.getTileGridForProjection(sourceProjection),targetTileGrid=this.getTileGridForProjection(projection),wrappedTileCoord=this.getTileCoordForTileUrlFunction(tileCoord,projection),newTile=new ReprojTile(sourceProjection,sourceTileGrid,projection,targetTileGrid,tileCoord,wrappedTileCoord,this.getTilePixelRatio(pixelRatio),this.getGutter(),function(z,x,y,pixelRatio){return this.getTileInternal(z,x,y,pixelRatio,sourceProjection)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_);return newTile.key=key,tile?(newTile.interimTile=tile,newTile.refreshInterimChain(),cache.replace(tileCoordKey,newTile)):cache.set(tileCoordKey,newTile),newTile}return this.getTileInternal(z,x,y,pixelRatio,sourceProjection||projection)},TileImage.prototype.getTileInternal=function(z,x,y,pixelRatio,projection){var tile=null,tileCoordKey=getKeyZXY(z,x,y),key=this.getKey();if(this.tileCache.containsKey(tileCoordKey)){if((tile=this.tileCache.get(tileCoordKey)).key!=key){var interimTile=tile;tile=this.createTile_(z,x,y,pixelRatio,projection,key),interimTile.getState()==TileState.IDLE?tile.interimTile=interimTile.interimTile:tile.interimTile=interimTile,tile.refreshInterimChain(),this.tileCache.replace(tileCoordKey,tile)}}else tile=this.createTile_(z,x,y,pixelRatio,projection,key),this.tileCache.set(tileCoordKey,tile);return tile},TileImage.prototype.setRenderReprojectionEdges=function(render){if(this.renderReprojectionEdges_!=render){for(var id in this.renderReprojectionEdges_=render,this.tileCacheForProjection)this.tileCacheForProjection[id].clear();this.changed()}},TileImage.prototype.setTileGridForProjection=function(projection,tilegrid){var proj=get$2(projection);if(proj){var projKey=getUid(proj);projKey in this.tileGridForProjection||(this.tileGridForProjection[projKey]=tilegrid)}},TileImage}(UrlTile);function defaultTileLoadFunction(imageTile,src){imageTile.getImage().src=src}var XYZ=function(_super){function XYZ(opt_options){var options=opt_options||{},projection=void 0!==options.projection?options.projection:"EPSG:3857",tileGrid=void 0!==options.tileGrid?options.tileGrid:createXYZ({extent:extentFromProjection(projection),maxZoom:options.maxZoom,minZoom:options.minZoom,tileSize:options.tileSize});return _super.call(this,{attributions:options.attributions,cacheSize:options.cacheSize,crossOrigin:options.crossOrigin,opaque:options.opaque,projection:projection,reprojectionErrorThreshold:options.reprojectionErrorThreshold,tileGrid:tileGrid,tileLoadFunction:options.tileLoadFunction,tilePixelRatio:options.tilePixelRatio,tileUrlFunction:options.tileUrlFunction,url:options.url,urls:options.urls,wrapX:void 0===options.wrapX||options.wrapX,transition:options.transition,attributionsCollapsible:options.attributionsCollapsible,zDirection:options.zDirection})||this}return __extends(XYZ,_super),XYZ}(TileImage),ATTRIBUTION='&#169; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.',OSM=function(_super){function OSM(opt_options){var attributions,options=opt_options||{};attributions=void 0!==options.attributions?options.attributions:[ATTRIBUTION];var crossOrigin=void 0!==options.crossOrigin?options.crossOrigin:"anonymous",url=void 0!==options.url?options.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png";return _super.call(this,{attributions:attributions,cacheSize:options.cacheSize,crossOrigin:crossOrigin,opaque:void 0===options.opaque||options.opaque,maxZoom:void 0!==options.maxZoom?options.maxZoom:19,reprojectionErrorThreshold:options.reprojectionErrorThreshold,tileLoadFunction:options.tileLoadFunction,url:url,wrapX:options.wrapX,attributionsCollapsible:!1})||this}return __extends(OSM,_super),OSM}(XYZ);export{Draw,Feature,Fill,GeoJSON,Map$1 as Map,OSM,Point,Projection,Stroke,Style,TileLayer,VectorLayer,VectorSource,View,getCenter};